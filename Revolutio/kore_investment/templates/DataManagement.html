<!DOCTYPE html>

{% extends extend_template %}
{% load render_bundle from webpack_loader %}
{% load static %}

{% block body_block %}
<!-- Bootstrap4 Duallistbox -->
<link rel="stylesheet" href="{% static 'vendor/Base_theme/bootstrap4-duallistbox/bootstrap-duallistbox.min.css' %}">
<!--Official dataTables default  CSS FILE-->
<link rel="stylesheet" href="{% static 'css/KoreD/jquery.dataTables.css' %}">
<link rel="stylesheet" href="{% static 'css/KoreD/buttons.dataTables.min.css' %}">

<!-- Equation Builder -->
<link rel="stylesheet" href="{% static 'css/ebstyle.css' %}">
<link rel="stylesheet" href="{% static 'css/dm_eq_style.css' %}">

<!-- Bootstrap4 Duallistbox -->
<script src="{% static 'vendor/Base_theme/bootstrap4-duallistbox/jquery.bootstrap-duallistbox.min.js' %}"></script>

<!--Official dataTables default  CSS FILE-->
<link rel="stylesheet" href="{% static 'css/KoreD/jquery.dataTables.css' %}">
<link rel="stylesheet" href="{% static 'css/KoreD/buttons.dataTables.min.css' %}">
<link rel="stylesheet" href="{% static 'vendor/Base_theme/datatables-responsive/css/responsive.bootstrap4.min.css' %}">
<link rel="stylesheet" href="{% static 'vendor/Base_theme/datatables-colreorder/css/colReorder.bootstrap4.min.css' %}">

<!-- DataTables -->
<script src="{% static 'vendor/Base_theme/datatables/jquery.dataTables.js' %}"></script>
<script src="{% static 'vendor/Base_theme/datatables-responsive/js/dataTables.responsive.min.js' %}"></script>
<script src="{% static 'vendor/Base_theme/datatables-fixedheader/js/dataTables.fixedHeader.min.js' %}"></script>
<script src="{%static 'vendor/Base_theme/datatables-bs4/js/dataTables.bootstrap4.js'%}"></script>

<script src="{%static 'vendor/Base_theme/datatables-buttons/js/dataTables.buttons.min.js'%}"></script>
<script src="{%static 'vendor/Base_theme/jszip/jszip.min.js'%}"></script>
<script src="{%static 'vendor/Base_theme/pdfmake/pdfmake.min.js'%}"></script>
<script src="{%static 'vendor/Base_theme/pdfmake/vfs_fonts.js'%}"></script>
<script src="{%static 'vendor/Base_theme/datatables-buttons/js/buttons.html5.min.js'%}"></script>
<script src="{%static 'vendor/Base_theme/datatables-buttons/js/buttons.colVis.min.js'%}"></script>

{% csrf_token %}

<style>
  .switch-container {
    width: 4em;
    height: 2em;
    border-radius: 10em;
    box-shadow: 2px 0px 10px 0px #cfd8dc;
    position: relative;
  }
  input.switch {
    display: none;
  }
  .switch-color {
    width: 3.8em;
    height: 1.8em;
    left: 0.1em;
    top: 0.1em;
    background: #cfd8dc;
    border-radius: 10em;
    z-index: 0;
    position: absolute;
    transition: all 500ms cubic-bezier(0.34, 1.36, 0.2, 1);
  }
  .switch-color .trigger-label{
    height: 100%;
    width: 100%;
    margin: 0;
    cursor: pointer;
  }
  .switch-container label.switch-label {
    width: 1.6em;
    height: 1.6em;
    border-radius: 10em;
    background: white;
    position: absolute;
    top: 2.5px;
    left: 0.2em;
    box-shadow: 2px 2px 10px 2px #cfd8dc;
    z-index: 99;
    cursor: pointer;
  }
  .switch:checked ~ label.switch-label {
    transform: translatex(2em) rotatez(360deg);
  }


  .switch ~ label.switch-label {
    transition: all 1s cubic-bezier(0.34, 1.36, 0.2, 1);
  }

  .sortable-order li{
    cursor: move;
  }
</style>





<!-- Breadcrumb-->
<div class="breadcrumb-holder" style="background-color: #e9ecef; ">
  <div class="container-fluid" id="dynamicTabs">
    <ul class="breadcrumb" id="dynamicbreadcrumbs">
      <li class="breadcrumb-item"><a {% if current_application_code != 'App0' %} {% if current_application_code == 'Dev' %} {% if current_dev_mode == 'Edit' %} {% if edit_app_code != 'Not Selected' %} href="{% url 'users:homePage' edit_app_code current_dev_mode %}" {% else %} href="{% url 'users:homePage' 'Dev' current_dev_mode %}" {% endif %} {% elif current_dev_mode == 'Build' %} {% if build_app_code != 'Not Selected' %} href="{% url 'users:homePage' build_app_code current_dev_mode %}" {% else %} href="{% url 'users:select_application' %}"  {% endif %}  {% endif %} {% else %} href="{% url 'users:homePage' current_application_code 'User' %}" {% endif %} {% else %} href="{% url 'users:select_application' %}" {% endif %}>
        <b> Home </b></a></li>
      <li class="breadcrumb-item "><b>Data Management</b></li>
      <li class="breadcrumb-item "><b>Data Management</b></li>
    </ul>
  </div>
</div>

<section class="content">
  <div class="container-fluid">

    <ul class="nav nav-tabs nav-justified md-tabs indigo" style="margin-left:1rem" id="myTabJust" role="tablist">
      <li class="nav-item active" >

        <a class="nav-link l3items" id="validate-tab-just" data-toggle="tab" href="#validate-just" role="tab"
          aria-controls="validate-just" aria-selected="true">
          <center>Data tables</center>
        </a>

      </li>

      {% if current_application_code == 'Dev' %}
      {% if current_dev_mode == 'Build' %}
      <li class="nav-item">
        <a class="nav-link l3items" id="home2-tab-just" data-toggle="tab" href="#home2-just" role="tab"
          aria-controls="home2-just" aria-selected="true">
          <center>New table definition</center>
        </a>
      </li>
      {% endif %}
      {% endif %}
      <li class="nav-item">
        <a class="nav-link l3items" id="search-tab-just" data-toggle="tab" href="#search-just" role="tab"
          aria-controls="search-just" aria-selected="true">
          <center>Data relationships</center>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link l3items" id="search2-tab-just" data-toggle="tab" href="#search2-just" role="tab"
          aria-controls="search2-just" aria-selected="true">
          <center>Data hierarchy</center>
        </a>
      </li>
    </ul>
    <script>
      $(document).ready(function(){

      const queryString = window.location.search;

      const urlParams = new URLSearchParams(queryString);
      const page_type = urlParams.get('value')

   $('.l3items').each(function(){
     if(page_type != null){

  if($(this).text().trim()==page_type){

   hrefOftabs= $(this).attr("href")
   $(`.nav-item a[href="${hrefOftabs}"]`).tab('show');
     textbreadcrumb=$(this).text().trim()
     $('#dynamicbreadcrumbs').append(`<li class="breadcrumb-item breadcrumbdynamiclist"><b>${textbreadcrumb}</b></li>`)
  }
     }
   else{


   if($(this).attr('class')=="nav-link l3items show active"){

     linkbreadcrumbs=$(this).attr('href')
     textbreadcrumb=$(this).text().trim()
     $('#dynamicbreadcrumbs').append(`<li class="breadcrumb-item breadcrumbdynamiclist"><b>${textbreadcrumb}</b></li>`)
   }
   }
  })
      })
    </script>
    <script>
      $('.l3items').click(function(){
       linkbreadcrumbs= $(this).attr('href')
       textbreadcrumbs= $(this).text()
       $('.breadcrumbdynamiclist').each(function(){
         $(this).remove()
       })
       $('#dynamicbreadcrumbs').append(`<li class="breadcrumb-item breadcrumbdynamiclist"> <b> ${textbreadcrumbs}</b></li>`)
      }
      )
    </script>

    <div class="tab-content card pt-5" id="myTabContentJust" style="margin-left:1rem;">

      <div class="tab-pane fade show active" id="validate-just" role="tabpanel" aria-labelledby="validate-tab-just">
        <div class="row">
          <div class="col-lg-6" style="padding-right:14px; padding-left:14px;">
            <div id="card11" class="card card-default collapsed-card">
              <!-- /.card-header -->
              <div class="card-header cardheader11">
                <h6 class="card-title">System defined tables</h6>
                <div class="card-tools">
                  <span><i class="fa fa-check-circle" style="color:green;display:none;" aria-hidden="true"></i></span>
                  <button type="button" class="btn btn-tool" data-card-widget="collapse"><i id="card11"
                      class="fas fa-minus"></i></button>
                </div>
              </div>
              <!-- /.card-body -->
              <div class="card-body cardbody11" style="display: block;">
                <div>
                <input class="form-control mr-3" id="sysdefSearch" type="text" placeholder="Search"
                  aria-label="Search">
                </div>
                <br>
                <div id="sysdeftable" style="height:15em;overflow-x:scroll;overflow-y:scroll;">
                  <form method="POST">
                    {% csrf_token %}
                    <div class="row" style="margin-left: auto;">
                      {% for model in level1 %}
                      <button type="button" class="entitybuttons buttonstyling acies_btn acies_btn-primary"
                        id="{{model}}"
                        style="margin-right:5px; margin-top:5px;">{{model}}</button>
                      {% endfor %}
                    </div>
                  </form>
                </div>
              </div>
              <!-- /.card-footer -->
              <div class="card-footer cardfooter11" style="display: block;">
              </div>
            </div>
          </div>

          <div class="col-lg-6" style="padding-right:14px; padding-left:14px;">
            <div id="card12" class="card card-default collapsed-card">
              <!-- /.card-header -->
              <div class="card-header cardheader12">
                <h6 class="card-title">User defined tables</h6>
                <div class="card-tools">
                  <span><i class="fa fa-check-circle" style="color:green;display:none;" aria-hidden="true"></i></span>
                  <button type="button" class="btn btn-tool" data-card-widget="collapse"><i id="card12"
                      class="fas fa-minus"></i></button>
                </div>
              </div>
              <!-- /.card-body -->
              <div class="card-body cardbody12" style="display: block;">
                <div class="row">
                  <div class="col-6">
                    <input class="form-control mr-3 w-10" id="userdefSearch" type="text" placeholder="Search"
                    aria-label="Search">
                  </div>
                  <div class="col-3">
                    {% if build_app_code != 'Not Selected' %}
                    <form action="{% url 'users:export_tables' build_app_code current_dev_mode %}">
                    {% elif edit_app_code != 'Not Selected' %}
                    <form action="{% url 'users:export_tables' edit_app_code current_dev_mode %}"></form>
                    {% endif %}
                      <button type="submit" class="btn btn-primary btn-xs">Export tables</button>
                    </form>
                  </div>
                  <div class="col-3">
                      <button type="button" class="btn btn-primary btn-xs" data-toggle="modal"
                      data-target="#datamgmt_uploadModal">Import tables</button>
                  </div>
                </div>
                <br>
                <div id="userdeftable" style="height:15em;overflow-x:scroll;overflow-y:scroll;">
                  <form method="POST">
                    {% csrf_token %}
                    <div class="row" id="userdefrow" style="margin-left: auto;">
                      {% for model in level2 %}
                      <button type="button" class="entitybuttons buttonstyling acies_btn acies_btn-primary"
                        id="{{model}}"
                        style="margin-right:5px; margin-top:5px;">{{model}}</button>
                      {% endfor %}
                    </div>
                  </form>
                </div>
              </div>
              <!-- /.card-footer -->
              <div class="card-footer cardfooter12" style="display: block;">
              </div>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-lg-3" style="padding-left:14px;padding-right:14px;">
            <div class="card">
              <!-- /.card-header -->
              <div class="card-header">
                <h6 class="card-title">
                  Data elements
                </h6>
              </div>
              <!-- /.card-body -->
              <div class="card-body dataElements" style="height:25em;">
                <div class="row">
                  <div class="col-5">
                    <p>
                      <!--<b>Selected Table: </b>-->
                    </p>
                  </div>
                  <div class="col-7 text-right">
                    <form>
                      <a id="dataele_dataAccess" title="Configure Data Access" hidden
                        ><i class="fa-solid fa-filter fa-2x"aria-hidden= "true" style="color:var(--primary-color);"></i>&nbsp;</a>
                      <a id="dataele_add" title="Add new element"  data-toggle="modal" hidden
                        data-target="#addelement" ><i class="fa fa-plus-square fa-2x"aria-hidden= "true" style="color:var(--primary-color);"></i>&nbsp;</a>
                      <a id="dataele_delete" title="Delete table"  hidden
                        ><i class="fas fa-trash fa-2x"aria-hidden= "true" style="color:var(--primary-color);"></i>&nbsp;</a>
                      <a id="dataele_order" title="Order Columns"  hidden data-toggle="dropdown"
                        ><i class="fa-solid fa-arrow-down-short-wide fa-2x" aria-hidden= "true" style="color:var(--primary-color);"></i>&nbsp;
                      </a>
                      <a id="dataele_replica_table" title="Create replica table"  hidden onclick="showReplica(this)"
                        ><i class="fas fa-table fa-2x" aria-hidden= "true" style="color:var(--primary-color);"></i>&nbsp;
                      </a>
                        <div class="dropdown-menu dropdown-menu-lg dropdown-menu-left" style="height: fit-content;min-width: 12em;border-radius: 1rem;overflow-y: auto;margin:0 !important;padding-top: 0 !important;">
                          <div class="yourapps-dropdown">
                            <span>Column Order</span>
                            <a class="btn btn-secondary text-light" onclick="saveColumnOrder(this)">Save</a>
                          </div>
                          <div class="apps-dropdownItems">
                            <ul class="sortable-order col pt-2" style="list-style: none;">
                            </ul>
                          </div>
                        </div>
                    </form>
                  </div>
                </div>
                <br>
                <div class="list-group" id="myList" style="height:17em;overflow-x:auto;overflow-y:auto;">
                </div>
              </div>
            </div>
          </div>

          <div class="col-lg-3" style="padding-left:14px;padding-right:14px;">
            <div class="card">
              <!-- /.card-header -->
              <div class="card-header">
                <h6 class="card-title">
                  Attribute details
                </h6>
              </div>
              <!-- /.card-body -->
              <div class="card-body attributeDetails"
                style="height:25em;word-wrap:break-word;">
                <div class="row">
                  <div class="col-6">
                    <p id="selectedElement">
                      <!--<b>Selected Element: </b>-->
                    </p>
                  </div>
                </div>
                <div class="row">
                  <div class="col-12">
                    <form>
                      <a id= 'edit_att_det' title="Edit attribute"  data-toggle="modal"
                      data-target="#editattr_modal1" hidden><i class="fa fa-edit ihover javaSC thin-icon" style="font-size:18px"></i>&nbsp;</a>
                      <a id= 'add_att_val' title="Add validation"  data-toggle="modal"
                      data-target="#add_val_modal" hidden><i class="fa fa-check-square ihover javaSC thin-icon" style="font-size:18px"></i>&nbsp;</a>
                      <a id="delete_att_det" title="Delete attribute"   hidden
                      ><i class="fa fa-minus-square ihover javaSC thin-icon" aria-hidden= "true" style="font-size:18px"></i>&nbsp;</a>
                    </form>
                  </div>
                </div>
                <table id="example1" class="row-border display" style="width: 100%;">
                  <thead id= "myTablehead">
                    <th>Attribute</th>
                    <th>Value</th>
                  </thead>
                  <tbody id="myTable">
                  </tbody>
                </table>
                <br>
              </div>
            </div>
          </div>

          <div class="col-lg-6" style="padding-left:14px;padding-right:14px;">
            <div class="card">
              <!-- /.card-header -->
              <div class="card-header">
                <h6 class="card-title">
                  Relationships
                </h6>
              </div>
              <!-- /.card-body -->
              <div class="card-body attributeDetails"
                style="height: 25em; overflow-x: scroll; overflow-y: scroll; word-wrap: break-word;">
                <p id= 'RelatioshipElement'>
                  <!--<b>Selected Element: </b>-->
                </p>
                <br>
                <form>
                  <table id="example2" class="row-border display" style="width: 100%;">
                    <thead>
                      <th>Table name</th>
                      <th>Related column</th>
                      <th>Relationship</th>

                    </thead>
                    <tbody id="relTable">
                    </tbody>
                  </table>
                </form>
                <br>
              </div>
            </div>
          </div>
        </div>


        <div class="row">
          <div class="col-lg-12" style="padding-left:14px;padding-right:14px;">
            <div class="card">
              <!-- /.card-header -->
              <div class="card-header">
                <h6 class="card-title">
                  Data discovery
                </h6>
              </div>
              <!-- /.card-body -->
              <div class="card-body">
                <!-- Search form -->
                <div style="margin: auto">
                  <form class="form-inline align-items-end">
                    <div class="col-3 form-group"style="padding-left: 0">
                      <div class="input-group">
                        <input type="search" id="search_field1" placeholder="Search" style="height: 2.8em;width:80%">
                        <div class="input-group-append" style="margin-top: 0em; margin-bottom: 0em;width:20%">
                          <button class="btn btn-secondary" id="btn_search1" type="button">
                            <i class="fa fa-search"></i>
                          </button>
                        </div>
                      </div>
                    </div>

                    <div class="col-2 form-group">
                      <label class="acies_label"style="padding-left:20">Condition:</label>

                      <select class="select2 form-control" id="search_option1" style="width:100%" name="null">
                        <option value="" disabled>Select Option</option>
                        <option value="Yes" selected>Contains</option>
                      </select>
                    </div>
                  </form>
                 <br>
                </div>
              </div>
              <div style="height:20em;overflow-x:scroll;word-wrap:break-word;">
                <table id="example12" class="row-border display" style="width: 100%;">
                  <thead id = "searchhead1">
                    <th>Table name</th>
                    <th>Column name</th>
                    <th>Actions</th>
                  </thead>
                  <tbody id="searchTable1">
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="tab-pane fade " id="home2-just" role="tabpanel" aria-labelledby="home2-tab-just">
        <div class="row">
          <div class="col-lg-6">
            <div id="card11" class="card card-default collapsed-card">
              <!-- /.card-header -->
              <div class="card-header cardheader11">
                <h6 class="card-title">System defined tables</h6>
                <div class="card-tools">
                  <span><i class="fa fa-check-circle" style="color:green;display:none;" aria-hidden="true"></i></span>
                  <button type="button" class="btn btn-tool" data-card-widget="collapse"><i id="card11"
                      class="fas fa-minus"></i></button>
                </div>
              </div>
              <!-- /.card-body -->
              <div class="card-body cardbody11" style="display: block;">
                <div>
                <input class="form-control mr-3" id="sysdefSearch_def" type="text" placeholder="Search"
                  aria-label="Search">
                </div>
                <br>
                <div id="sysdeftable_def" style="height:15em;overflow-x:scroll;overflow-y:scroll;">
                  <form method="POST">
                    {% csrf_token %}
                    <div class="row" style="margin-left: auto;">
                      {% for model in level1 %}
                      <button type="button" class="entitybuttons buttonstyling acies_btn acies_btn-primary"
                        id="{{model}}"
                        style="margin-right:5px; margin-top:5px;">{{model}}</button>
                      {% endfor %}
                    </div>
                  </form>
                </div>
              </div>
              <!-- /.card-footer -->
              <div class="card-footer cardfooter11" style="display: block;">
              </div>
            </div>
          </div>

          <div class="col-lg-6">
            <div id="card12" class="card card-default collapsed-card">
              <!-- /.card-header -->
              <div class="card-header cardheader12">
                <h6 class="card-title">User defined tables</h6>
                <div class="card-tools">
                  <span><i class="fa fa-check-circle" style="color:green;display:none;" aria-hidden="true"></i></span>
                  <button type="button" class="btn btn-tool" data-card-widget="collapse"><i id="card12"
                      class="fas fa-minus"></i></button>
                  <!--<button type="button" class="btn btn-tool" data-card-widget="remove"><i class="fas fa-remove"></i></button>-->
                </div>
              </div>
              <!-- /.card-body -->
              <div class="card-body cardbody12" style="display: block;">
                <div>
                <input class="form-control mr-3 " id="userdefSearch_def" type="text" placeholder="Search"
                  aria-label="Search">
                <br>
                </div>
                <div id="userdeftable_def"  style="height:15em;overflow-x:scroll;overflow-y:scroll;">
                  <form method="POST">
                    {% csrf_token %}
                    <div class="row" id="userdef2row" style="margin-left: auto;">
                      {% for model in level2 %}
                      <button type="button" class="entitybuttons buttonstyling acies_btn acies_btn-primary"
                        id="{{model}}"
                        style="margin-right:5px; margin-top:5px;">{{model}}</button>
                      {% endfor %}
                    </div>
                  </form>
                </div>
              </div>
              <!-- /.card-footer -->
              <div class="card-footer cardfooter12" style="display: block;">
              </div>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-lg-12 justify-content-center">
            <div class="card new_table_creation_card">
              <!-- /.card-header -->
              <div class="card-header">
                <h6 class="card-title">
                  Table creation
                </h6>
              </div>
              <!-- /.card-body -->
              <div class="card-body dataElements">
                <div class="card-body">
                  <form method="post" action =''>
                    <div class="row">
                      <div class='col-3'style="display:flex; flex-direction: row; justify-content: left; align-items: left">
                        <div class="form-inline">
                          <label for="name">Tablename:</label>
                          <input class="form-control" placeholder="Enter table name" type="text" textarea onkeypress="return RestrictSpace()" id="tname"
                            name="tblname" style="margin-left: 0.8em;min-width: 9.5em;" required size="30">
                        </div>
                        <div><span id ="alerts1" style="display:none;color:red;">Table with same name already exist!</span></div>
                      </div>
                      <div class="col-8" style="display:flex; flex-direction: row; justify-content: left; align-items: left">
                        <div class="custom-control custom-checkbox form-group col-4">
                          <input type="checkbox" name="scenario_table_checkbox" id="scenario_table_checkbox" class="checkboxinput custom-control-input" value="0">
                          <label for="scenario_table_checkbox" class="custom-control-label">
                              Create corresponding scenario table
                          </label>
                        </div>
                        <div class="custom-control custom-checkbox form-group col-4">
                          <input type="checkbox" name="replicate_tableSchema" id="replicate_tableSchema" class="checkboxinput custom-control-input" value="0">
                          <label for="replicate_tableSchema" class="custom-control-label">
                              Create table using existing schema
                          </label>
                        </div>
                        <div class="custom-control custom-checkbox form-group col-4">
                          <input type="checkbox" name="replicate_table" id="replicate_table" class="checkboxinput custom-control-input" value="0">
                          <label for="replicate_table" class="custom-control-label">
                              Create replica table
                          </label>
                        </div>
                      </div>

                      <div class="col-1">
                        <span id="addFieldRow" class="float-right mb-3 mr-2" title="Add new column" style="display:flex; flex-direction: row; justify-content: right; align-items: right">
                          <a href="#!" class="text-success">
                            <i class="fa fa-plus fa-2x"aria-hidden="true"></i>
                          </a>
                        </span>
                      </div>
                    </div>

                    <!-- Replicate Schema row -->
                    <div class="row" id='exisitingSchemaRow' style="display: none;">
                      <div style="display:flex; justify-content: left; align-items: left">

                          <label>Select exisiting Table Schema:</label>
                          &nbsp;&nbsp;
                          <select class="select2" id="exisitingSchemaTables">
                            <option value="">Select Table</option>
                          </select>
                          <button type="button" class="btn  btn-sm btn-primary btn-xs ml-2" id="populate_exisiting_schema">
                             Replicate
                          </button>
                      </div>
                    </div>
                  </form>
                  <div id="table" class="table-editable">

                    <table class="table" id="example11" style="width: 100%;">
                      <thead>
                        <tr>
                          <th>Field name</th>
                          <th>Field data type</th>
                          <th>Parent table</th>
                          <th>Field header</th>
                          <th>Nullable?</th>
                          <th>Maximum length*</th>
                          <th>Choices</th>
                          <th>Computed value</th>
                          <th>Default</th>
                          <th>Auto now?</th>
                          <th>Editable?</th>
                          <th>Unique</th>
                          <th>Columns</th>
                          <th>Divider</th>
                          <th>Blacklist Characters</th>
                          <th>Computed Input</th>
                          <th>Actions</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td><span id='fld_name' class="fld_name" textarea onkeypress="return RestrictSpace()" style="display: inline-block;min-width: 70px;max-width:70px;overflow:hidden; text-transform:lowercase;">id</span>
                          </td>
                          <td>
                            <select class="table_datatype browser-default custom-select select2 form-control fieldselect" disabled>
                              <option value="">Select</option>
                              <option value="AutoField" selected>AutoField (Primary key)</option>
                              <option value="CharField">CharField (Text,numbers,special characters,etc.)</option>
                              <option value="TextField">TextField (Large text)</option>
                              <option value="BooleanField">BooleanField (Yes or No,True or False,etc.)</option>
                              <option value="FileField">FileField (File/Document upload)</option>
                              <option value="VideoField">VideoField</option>
                              <option value="ImageField">ImageField (image upload)</option>
                              <option value="IntegerField">IntegerField (Integer numbers)</option>
                              <option value="BigIntegerField">BigIntegerField (Big Integer numbers)</option>
                              <option value="FloatField">FloatField (Integer or decimal numbers)</option>
                              <option value="DateField">DateField (Date)</option>
                              <option value="DateTimeField">DateTimeField (Date and Time)</option>
                              <option value="TimeField">TimeField (Time)</option>
                            </select>
                          </td>
                          <td><span id = 'prnt_tbl' contenteditable="false" style="display: inline-block;min-width: 70px;max-width:70px;overflow:hidden"></span></td>
                          <td><span id = 'field_header' class='field_header' contenteditable="true"  style="display: inline-block;min-width: 70px;max-width:70px;overflow:hidden">id</span></td>
                          <td>
                            <select class="browser-default custom-select nulloption select2 form-control" disabled
                              >
                              <option value="">Select</option>
                              <option value="1">Yes</option>
                              <option value="2" selected>No</option>
                            </select>
                          </td>

                          <td><span id='max_length_ID' class='max_length_ID' contenteditable="false" style="display: inline-block;min-width: 70px;max-width:70px;overflow:hidden"></span></td>
                          <td><span contenteditable="false" style="display: inline-block;min-width: 70px;max-width:70px;overflow:hidden"></span></td>
                          <td>
                            <select class="browser-default custom-select coption select2 form-control computedoption" disabled
                              >
                              <option value="">Select</option>
                              <option value="1">Yes</option>
                              <option value="2" selected>No</option>
                            </select>
                          </td>
                          <td><span  id='default_ID' contenteditable="false" style="display: inline-block; min-width: 70px;max-width:70px;overflow:hidden"></span></td>
                          <td>
                            <select class="browser-default custom-select select2 form-control autonowoption" disabled id="autonowoption"
                              >
                              <option value="" selected>Select</option>
                              <option value="1">Yes</option>
                              <option value="2">No</option>
                            </select>
                          </td>
                          <td>
                            <select class="browser-default custom-select select2 form-control editableoption" disabled
                              >
                              <option value="" selected>Select</option>
                              <option value="1">Yes</option>
                              <option value="2">No</option>
                            </select>
                          </td>
                          <td>
                            <select class="browser-default custom-select select2 form-control uniqueoption" disabled id="uniqueoption">
                              <option value="">select</option>
                              <option value="1"  selected>Yes</option>
                              <option value="2">No</option>
                            </select>
                          </td>
                          <td contenteditable="true">

                          </td>
                          <td>
                            <select class="browser-default custom-select select2 form-control" disabled>
                              <option value="" selected>No divider</option>
                              <option value="_">_</option>
                              <option value="*">*</option>
                              <option value="-">-</option>
                              <option value="+">+</option>
                              <option value="#">#</option>
                              <option value="$">$</option>
                              <option value="%">%</option>
                              <option value="@">@</option>
                              <option value="!">!</option>
                              <option value="&">&</option>
                              <option value=".">.</option>
                              <option value="?">?</option>
                            </select>
                          </td>
                          <td>
                            <select class="browser-default custom-select select2 form-control" disabled></select>
                          </td>
                          <td>
                            <select class="browser-default custom-select select2 form-control" disabled></select>
                          </td>
                          <td>
                            <span class="equationBuilder" style="display: none;">
                              <a data-toggle="tooltip" title="Equation Builder" value="eq" id="EBDisplayButtonID"><i name="actions1" value="eq" class="fas fa-square-root-alt ihover javaSC thin-icontrash ebdeqbtn" style="font-size: 18px;"></i></a>
                            </span>
                            <span id="uuid_config" style="display:none" data-toggle="modal" data-target="#uuid_settings_modal" onclick="uuid_modal(this)" name="">
                              <a data-toggle="tooltip" title="UniqueIDField settings" value="uuid_settings"><i name="actions" value="uuid_settings" class="far fa-edit ihover javaSC thin-icon" style="font-size: 18px "></i></a>
                            </span>
                            <span id="file_config" style="display:none" data-toggle="modal" data-target="#file_settings_modal" onclick="file_modal(this)" name="">
                              <a data-toggle="tooltip" title="UniqueIDField settings" value="file_settings"><i name="actions" value="file_settings" class="far fa-edit ihover javaSC thin-icon" style="font-size: 18px "></i></a>
                            </span>
                            <span id="video_config" style="display:none" data-toggle="modal" data-target="#video_settings_modal" onclick="video_modal(this)" name="">
                              <a data-toggle="tooltip" title="UniqueIDField settings" value="video_settings"><i name="actions" value="video_settings" class="far fa-edit ihover javaSC thin-icon" style="font-size: 18px "></i></a>
                            </span>
                          </td>
                        </tr>
                        <!-- This is our clonable table line -->

                      </tbody>
                    </table>
                  </div>
                  <br>
                  <div class="row">
                    <button type="button" class="btn  btn-sm btn-primary btn-xs ml-2 standard_button_click" id="export-btn"
                      style="font-size:inherit;position: absolute; right: 3em;">
                      Create table
                      <i class="fa fa-plus"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-sm-12" style="padding-left:14px;padding-right:14px;">
            <div class="card">
              <!-- /.card-header -->
              <div class="card-header">
                <h6 class="card-title">
                  Data discovery
                </h6>
              </div>
              <!-- /.card-body -->
              <div class="card-body">
                <!-- Search form -->
                <div style="margin: auto">
                  <form class="form-inline align-items-end">
                    <div class="col-3 form-group" style= "padding-left: 0;">
                      <div class="input-group">
                        <input type="search" id="search_field" placeholder="Search" style="height: 2.8em;width:80%">
                        <div class="input-group-append" style="margin-top: 0em; margin-bottom: 0em;width:20%;">
                          <button class="btn btn-secondary" id="btn_search" type="button">
                            <i class="fa fa-search"></i>
                          </button>
                        </div>
                      </div>
                    </div>

                    <div class="col-2 form-group">
                      <label class="acies_label"style="padding-left:20">Condition:</label>

                        <select class="select2 form-control" id="search_option" style="width:100%" name="null">
                          <option value="" disabled>Select Option</option>
                          <option value="Yes" selected>Contains</option>
                        </select>
                    </div>
                  </form>
                 <br>
                </div>
              </div>

              <div style="height:20em;overflow-x:scroll;word-wrap:break-word;">
                <table id="example3" class="row-border display" style="width: 100%;">
                  <thead id="searchHead">
                    <th>Table name</th>
                    <th>Column name</th>
                    <th>Actions</th>
                  </thead>
                  <tbody id="searchTable">
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="tab-pane fade" id="search-just" role="tabpanel" aria-labelledby="search-tab-just">
        <div id="root1" style="height: 703.125px;">
        </div>
        {% render_bundle 'main' 'js' 'DEFAULT' %}
      </div>

      <div class="tab-pane fade" id="search2-just" role="tabpanel" aria-labelledby="search2-tab-just">
        <div id="root2" style="height: 703.125px;">
        </div>
        {% render_bundle 'main' 'js' 'HIERARCHY' %}
      </div>
    </div>
  </div>



</section>

<!--Add element modal-->
<div class="modal fade" id="addelement" role="dialog">
  <div class="modal-dialog modal-dialog-centered" style="max-width:700px;">

    <!-- Modal content-->
    <div class="modal-content">
      <!-- Modal header-->
      <div class="modal-header">
        <h6 class="modal-title">Add a new element</h6>
        <i class="fa-regular fa-square-plus iconsize"></i>
      </div>
      <!-- Modal body-->
      <div class="modal-body modalbody1">
        <form>
          <div class="fields" id="addElementPropContainer">
            <div class="row permAddDetailRow">
              <div class="col-md-6 col-sm-12 form-group">
                <label class="acies_label">Field name</label>
                <input type="text" name="Field Name" id="fieldmdl" textarea onkeypress="return RestrictSpace()"class="form-control textInput field_name" placeholder="Field Name" style="text-transform: lowercase;" />
              </div>
              <div class="col-md-6 col-sm-12 form-group" id="field_relatedname" style="display:none;">
                <label class="acies_label">Field Related name</label>
                <input type="text" name="FKRelated Name" id="field_related_name" textarea onkeypress="return RestrictSpace()"class="form-control" placeholder="Field Related Name" />
              </div>
              <div class="col-md-6 col-sm-12 form-group" id= "parent_table_fk" style="display: none;">
                <label class="acies_label">Parent Table</label>
                <input type="text" name="FKTable Name" id="parent_table_add" textarea onkeypress="return RestrictSpace()"class="form-control" placeholder="Parent Table Name" />
              </div>
              <div class="col-md-6 col-sm-12 form-group">
                <label class="acies_label">Field name alias (to be displayed on the front end)</label>
                <input type="text" name="Field Verbose Name" class="form-control textInput field_header " placeholder="Verbose Name" />
              </div>
            </div>
            <div class="row permAddDetailRow">
              <div class="col-md-6 col-sm-12 form-group">
                <label class="acies_label">Field data type</label>
                <select class="select2 datatype form-control" id="fielddatatypeadd" name="Field DataType">
                  <option value="0" disabled selected>Select data type</option>
                  <option value="AutoField" disabled>AutoField</option>
                  <option value="CharField">CharField (Text,numbers,special characters,etc.)</option>
                  <option value="ConcatenationField">ConcatenationField</option>
                  <option value="TextField">TextField (Large text)</option>
                  <option value="BooleanField">BooleanField (Yes or No,True or False,etc.)</option>
                  <option value="FileField">FileField (File/document upload)</option>
                  <option value="VideoField">VideoField</option>
                  <option value="ImageField">ImageField (Image upload)</option>
                  <option value="IntegerField">IntegerField (Integer numbers)</option>
                  <option value="BigIntegerField">BigIntegerField (Big Integer numbers)</option>
                  <option value="FloatField">FloatField (Integer or decimal numbers)</option>
                  <option value="DateField">DateField (Date)</option>
                  <option value="DateTimeField">DateTimeField (Date and Time)</option>
                  <option value="TimeField">TimeField (Time)</option>
                  <option value="UniqueIDField">UniqueIDField</option>
                  <option value="URLField">URLField (URL Link)</option>
                  <option value="DateTimeRangeField">DateTimeRangeField</option>
                  <option value="DateRangeField">DateRangeField</option>
                  <option value="ForeignKey">ForeignKey</option>
                  <option value="TimeRangeField">TimeRangeField</option>
                  <option value="CardField">CardField (Credit card/Debit card)</option>
                  <option value="CardCvvField">CardCvvField</option>
                  <option value="CardExpiryField">CardExpiryField</option>
                  <option value="CardTypeField">CardTypeField (Identifies the type of card)</option>
                  <option value="UserField">UserField</option>
                  <option value="EmailTypeField">EmailTypeField</option>
                  <option value="TableField">TableField</option>
                  <option value="MultiselectField">MultiselectField</option>
                  <option value="RTFField">RTFField</option>
                  <option value="PrivacyField">PrivacyField</option>
                </select>
              </div>
              <div class="col-md-6 col-sm-12 form-group">
                <label class="acies_label">Can take null values?</label>
                <select class="select2 nullField form-control" name="null" id="addelement_null">
                  <option value="0" disabled selected>Select option</option>
                  <option value="Yes">Yes</option>
                  <option value="No">No</option>
                </select>
              </div>
              <div class="col-md-6 col-sm-12 form-group ">
                <label class="acies_label">Computed value</label>
                <div class="d-flex">
                  <div class="switch-container">
                    <input class="switch comp_cbox" type="checkbox" id="ComputedValuec" name="ComputedValuec" required="">
                    <div class="switch-color"><label class="trigger-label" for="ComputedValuec"></label></div>
                    <label class="switch-label" for="ComputedValuec"></label>
                  </div>
                  <div class="col-md-6 col-sm-12 form-group">
                    <span class="equationBuilder1" style="display: none;margin-top: 3px;">
                      <a data-toggle="tooltip" title="Equation Builder" value="eq" id="EBDisplayButtonID"><i name="actions1" value="eq" class="fas fa-square-root-alt ihover javaSC thin-icontrash ebdeqbtn" style="font-size: 18px;"></i></a>
                    </span>
                  </div>
                </div>
              </div>
              <div class="col-md-6 col-sm-12 form-group ">
                <label class="acies_label">Computed Input</label>
                <select class="select2 form-control multipleform_compInp_add" multiple>
                </select>
              </div>


              <div class="col-md-6 col-sm-12 form-group">
                <label class="acies_label">Unique</label>
                <select class="select2 nullField form-control" name="unique" id="addelement_unique">
                  <option value="0" disabled selected>Select Option</option>
                  <option value="Yes">Yes</option>
                  <option value="No">No</option>
                </select>
              </div>
            </div>
          </div>
        </form>
        <br><br>

        <div id="dynamicsearchfield_layer" style="max-height:200px;width:auto;overflow-y:hidden;overflow-x: scroll;table-layout: fixed;word-wrap:break-word;text-align:center;">

          <table id="dynamicsearchfield" class="row-border display" style="width: 100%;">
            <thead>
              <th scope="col">Table name</th>
              <th scope="col">Column name</th>
              <th scope="col">Action</th>
            </thead>
            <tbody id="dynamic">
            </tbody>
          </table>


        </div>
      </div>
      <!-- Modal footer-->
      <div class=" modal-footer ">

        <button type="button" class="btn buttonfooter float-right addSave" onclick="addElements()">Save</button>
        <button type="button" class="btn btn-primary btn-xs float-right addSave1" style="display:none;" onclick="addElements1()">Save</button>
        <button type="button" class="btn  buttonfooter" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<!--Add element modal ends-->

<!--Edit Attribute modal-->
<div class="modal fade" id="editattr_modal" role="dialog">
  <div class="modal-dialog modal-dialog-centered" style="max-width:700px;">

    <!-- Modal content-->
    <div class="modal-content">
      <!-- Modal header-->
      <div class="modal-header">
        <h6 class="modal-title">Edit element attributes</h6>
        <i class="fa-solid fa-pen-to-square iconsize"></i>
      </div>
      <!-- Modal body-->
      <div class="modal-body modalbody2">
        <form>
          <div class="row justify-content-start ">
            <div class="fields">
              <div class="row ml-0">
                <div class="col-6 form-group">
                  <label class="acies_label" style="padding-left:0.3em;">Field name alias (to be displayed on the
                    front
                    end)</label>
                  </div>
                  <div class="col-4">
                  <input type="text" name="Field Verbose Name" class="form-control textInput" id="verbose_name"
                    placeholder="Verbose Name" />
                  </div>

                <div class="col-6 form-group">
                  <label class="acies_label" style="padding-left:0.3em;">Field data type</label>
                </div>
                  <div class="col-4">
                  <select class="select2 datatype2 form-control" id="field_datatype" name="Field DataType">
                    <option value="" disabled selected>Select data type</option>
                    <option value="AutoField" disabled>AutoField</option>
                    <option value="CharField">CharField (Text,numbers,special characters,etc.)</option>
                    <option value="ConcatenationField">ConcatenationField</option>
                    <option value="TextField">TextField (Large text)</option>
                    <option value="BooleanField">BooleanField (Yes or No,True or False,etc.)</option>
                    <option value="FileField">FileField (File/document upload)</option>
                    <option value="VideoField">VideoField</option>
                    <option value="ImageField">ImageField (Image upload)</option>
                    <option value="IntegerField">IntegerField (Integer numbers)</option>
                    <option value="BigIntegerField">BigIntegerField (Big Integer numbers)</option>
                    <option value="FloatField">FloatField (Integer or decimal numbers)</option>
                    <option value="DateField">DateField (Date)</option>
                    <option value="DateTimeField">DateTimeField (Date and Time)</option>
                    <option value="TimeField">TimeField (Time)</option>
                    <option value="UniqueIDField">UniqueIDField</option>
                    <option value="URLField">URLField (URL Link)</option>
                    <option value="TimeRangeField">TimeRangeField</option>
                    <option value="DateTimeRangeField">DateTimeRangeField</option>
                    <option value="DateRangeField">DateRangeField</option>
                    <option value="ForeignKey">ForeignKey</option>
                    <option value="CardField">CardField (Credit card/Debit card)</option>
                    <option value="CardCvvField">CardCvvField</option>
                    <option value="CardExpiryField">CardExpiryField</option>
                    <option value="CardTypeField">CardTypeField (Identifies the type of card)</option>
                    <option value="UserField">UserField</option>
                    <option value="EmailTypeField">EmailTypeField</option>
                    <option value="TableField">TableField</option>
                    <option value="MultiselectField">MultiselectField</option>
                    <option value="RTFField">RTFField</option>
                    <option value="PrivacyField">PrivacyField</option>
                  </select>
                </div>
                <div class="col-6 form-group">
                  <label class="acies_label" style="padding-left:0.3em;">Can take null values?</label>
                    </div>
                    <div class="col-4">
                      <select class="select2 nullField form-control" style="width:100%" id="null_field_edit" name="null_field">
                        <option value="" disabled selected>Select option</option>
                        <option value="Yes">Yes</option>
                        <option value="No">No</option>
                      </select>
                </div>
                <div class="col-6 form-group ">
                  <label class="acies_label">Computed value</label>
                </div>
                 <div class="col-4">
                  <div class="d-flex">
                    <div class="switch-container">
                      <input class="switch" type="checkbox" id="ComputedValue2" name="ComputedValue2" required="">
                      <div class="switch-color"><label class="trigger-label" for="ComputedValue2"></label></div>
                      <label class="switch-label" for="ComputedValue2"></label>
                    </div>

                      <span class="equationBuilder2" style="display: none;margin-top: 3px;">
                        <a data-toggle="tooltip" title="Equation Builder" value="eq" id="EBDisplayButtonID"><i name="actions1" value="eq" class="fas fa-square-root-alt ihover javaSC thin-icontrash ebdeqbtn" style="font-size: 18px;"></i></a>
                      </span>
                  </div>
                  </div>

                  <div class="col-6 form-group ">
                    <label class="acies_label">Computed Input</label>
                  </div>
                  <div class="col-4">
                    <select class="select2 form-control multipleform_compInp_edit" multiple>
                    </select>
                  </div>


                <div class="col-6 form-group">
                  <label class="acies_label" style="padding-left:0.3em;">Unique</label>
                </div>
                <div class="col-4">
                  <select class="select2 nullField form-control" id="unique" name="unique">
                    <option value="" disabled selected>Select option</option>
                    <option value="Yes">Yes</option>
                    <option value="No">No</option>
                  </select>
                </div>


              </div>
            </div>
          </div>
          <!-- Modal footer-->

        </form>
      </div>
      <div class=" modal-footer">
        <button type="button" class="btn buttonfooter saveEdit" onclick="editattributes()">Save</button>
        <button type="button" class="btn  buttonfooter" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<!--Add element modal ends-->

<!-- View element modal-->
<div class="modal fade" id="viewdetailElement" role="dialog">
  <div class="modal-dialog modal-dialog-centered" style="max-width:700px;">

    <!-- Modal content-->
    <div class="modal-content">
      <!-- Modal header-->
      <div class="modal-header">
        <h6 class="modal-title">View Detail</h6>
        <i class="fa-solid fa-eye iconsize"></i>
      </div>
      <!-- Modal body-->
      <div class="modal-body modalbody1">



          <div class="fields">
            <div class="row view_details_table_row">
              <div class="col-6 form-group">
                <label class="acies_label" style="padding-left:0.3em;">Table Name1</label>
                <input type="text" name="Table Name" class="form-control textInput" id="view_table_name"
                  placeholder="Table Name" disabled/>
              </div>
              <div class="col-6 form-group">


                <label class="acies_label" style="padding-left:0.3em;">Field name </label>
                <input type="text" name="Field_Name" class="form-control textInput" id="view_field_name"
                  placeholder="Field Name"disabled />
              </div>
              <div class="col-6 form-group">

                <label class="acies_label" style="padding-left:0.3em;">Field name(Verbose Name) </label>
                <input type="text" name="Front End Name" class="form-control textInput" id="view_verbose_field_name"
                  placeholder="Field Name"disabled />
              </div>

              <div class="col-6 form-group">
                <label class="acies_label" style="padding-left:0.3em;">Field data type</label>
                <select class="select2 datatype2 form-control " id="view_field_datatype" name="DataType" disabled>
                  <option value="" disabled selected>Select data type</option>
                  <option value="AutoField" disabled>AutoField</option>
                  <option value="CharField">CharField (Text,numbers,special characters,etc.)</option>
                  <option value="TextField">TextField (Large text)</option>
                  <option value="BooleanField">BooleanField (Yes or No,True or False,etc.)</option>
                  <option value="FileField">FileField (File/document upload)</option>
                  <option value="VideoField">VideoField</option>
                  <option value="ImageField">ImageField (Image upload)</option>
                  <option value="IntegerField">IntegerField (Integer numbers)</option>
                  <option value="BigIntegerField">BigIntegerField (Big Integer numbers)</option>
                  <option value="FloatField">FloatField (Integer or decimal numbers)</option>
                  <option value="DateField">DateField (Date)</option>
                  <option value="DateTimeField">DateTimeField (Date and Time)</option>
                  <option value="TimeField">TimeField (Time)</option>
                  <option value="ForeignKey">ForeignKey</option>
                </select>
              </div>
              <div class="col-6 form-group">
                <label class="acies_label" style="padding-left:0.3em;">Primary Key</label>
                <select class="select2 nullField form-control" id="view_primary_key" name="Primary Key" disabled>
                  <option value="" disabled selected>Select option</option>
                  <option value="Yes">Yes</option>
                  <option value="No">No</option>
                </select>
              </div>
              <div class="col-6 form-group">
                <label class="acies_label" style="padding-left:0.3em;">Can take null values?</label>
                <select class="select2 nullField form-control" id="view_null_field" name="Nullable" disabled>
                  <option value="0" disabled selected>Select option</option>
                  <option value="Yes">Yes</option>
                  <option value="No">No</option>
                </select>
              </div>

              <div class="col-6 form-group">
                <label class="acies_label" style="padding-left:0.3em;">Unique</label>
                <select class="select2 nullField form-control" id="view_unique" name="Unique" disabled>
                  <option value="" disabled selected>Select option</option>
                  <option value="Yes">Yes</option>
                  <option value="No">No</option>
                </select>
              </div>
              <div class="col-6 form-group ">
                <label class="acies_label" style="padding-left:0.3em;">Editable</label>
                <select class="select2 nullField form-control" id="view_editable" name="Editable" disabled>
                  <option value="" disabled selected>Select option</option>
                  <option value="Yes">Yes</option>
                  <option value="No">No</option>
                </select>
              </div>
              <div class="col-6 form-group">
                <label class="acies_label" style="padding-left:0.3em;">Max Length</label>
                <input  name="Max Length" class="form-control" id="view_max_length"
                  placeholder="Max Length" disabled />
              </div>
              <div class="col-6 form-group">
                <label class="acies_label" style="padding-left:0.3em;">Default</label>
                <input  name="Default" class="form-control textInput" id="view_default"
                  placeholder="Default" disabled />
              </div>
              <div class="col-6 form-group">
                <label class="acies_label" style="padding-left:0.3em;">Choices</label>
                <input  name="Choices" class="form-control" id="view_choices"
                  placeholder="Choices" disabled />
              </div>
              <div class="col-6 form-group">
                <label class="acies_label" style="padding-left:0.3em;">Validations</label>
                <input  name="Validations" class="form-control" id="view_validations"
                  placeholder="Validations" disabled />
              </div>
              <div class="col-6 form-group">
              <label class="acies_label" style="padding-left:0.3em;" style="display: none;">Parent name </label>
              <input type="text " name="Parent_Name" class="form-control textInput" id="view_parent_fk_name"
                placeholder="Parent Name" style="display: none;" disabled />
              </div>
            </div>
          </div>

      </div>
      <!-- Modal footer-->
      <div class=" modal-footer d-flex justify-content-end">
        <button type="button" class="btn buttonfooter" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<!-- View element modal ends  -->

<!--Add validation modal-->
<div class="modal fade" id="add_val_modal" role="dialog">
  <div class="modal-dialog modal-dialog-centered" style="max-width:700px;">

    <!-- Modal content-->
    <div class="modal-content">
      <!-- Modal header-->
      <div class="modal-header">
        <h6 class="modal-title">Add validations</h6>
        <i class="fa-regular fa-square-plus iconsize"></i>

      </div>
      <!-- Modal body-->
      <div class="modal-body modalbody3" id="mbody3">
        <form>
          <div class="fields">
            <div class="row">
              <div class="col-3 form-group">
                <label class="acies_label" style="padding-left: 0.3em;">Select Validation</label>
              </div>
                <div class="col-6">
                <select class="select2 valtype form-control" name="Selected Validation">
                  <option value="" disabled selected>Select Validation</option>
                </select>
              </div>
            </div>
          </div>
        </form>
      </div>
      <!-- Modal footer-->
      <div class="modal-footer">
        <button type="button" class="btn buttonfooter" onclick="addvalidations()">Save</button>
        <button type="button" class="btn buttonfooter" onclick="removevalidations()">Remove Validation</button>
      </div>
    </div>
  </div>
</div>
<!--Add element modal ends-->

<!-- Relationship modal data table (model creation screen1) starts-->
<div class="modal fade" id="relation_modal" role="dialog">
  <div class="modal-dialog modal-dialog-centered" style="max-width:700px;">

    <!-- Modal content-->
    <div class="modal-content">
      <!-- Modal header-->
      <div class="modal-header">
        <h6 class="modal-title">Create relationship</h6>
        <i class="fa-solid fa-link iconsize"></i>
      </div>
      <!-- Modal body-->
      <div class="modal-body modalbodyrel">
        <form>

            <div class="fieldsrel">
              <div class="row">
                <div class="col-6 form-group">
                  <label class="acies_label" style="padding-left:0.6em;">Parent table</label>
                  <input type="text" name="Parent table" class="form-control textInput" id="parent_table_datamanagement" disabled
                    />
                </div>
                <div class="col-6 form-group">
                  <label class="acies_label" style="padding-left:0.6em;">Child table</label>
                  <input type="text" name="Child table" class="form-control textInput" id="child_table_datamanagement"  disabled
                    />
                </div>
                <div class="col-6 form-group">
                  <label class="acies_label" style="padding-left:0.6em;">Parent element</label>
                  <input type="text" name="Parent element" class="form-control textInput" id="parent_element" disabled
                    />
                </div>
                <div class="col-6 form-group">
                  <label class="acies_label" style="padding-left:0.6em;">Child element</label>
                  <input type="text" name="Child element" class="form-control textInput" id="child_element" disabled
                    />
                </div>
                <div class="col-6 form-group">
                  <label class="acies_label">Field data type</label>
                  <input type="text" name="Field DataType" class="form-control textInput" id="fieldatatype"
                    value="ForeignKey" disabled/>
                </div>
                <div class="col-6 form-group">
                  <label class="acies_label">Can take null values?</label>
                  <select class="select2 nullField form-control" id="null" name="null">
                    <option value="" disabled selected>Select option</option>
                    <option value="Yes">Yes</option>
                    <option value="No">No</option>
                  </select>
                </div>
                <div class="col-6 form-group ">
                  <label class="acies_label">Computed value</label>
                  <div class="d-flex">
                    <div class="switch-container">
                      <input class="switch comp_cbox" type="checkbox" id="ComputedValue1" name="ComputedValue1" required="">
                      <div class="switch-color"><label class="trigger-label" for="ComputedValue1"></label></div>
                      <label class="switch-label" for="ComputedValue1"></label>
                    </div>
                      <div class="col-md-6 col-sm-12 form-group">
                        <span class="equationBuilder1" style="display: none;margin-top: 3px;">
                          <a data-toggle="tooltip" title="Equation Builder" value="eq" id="EBDisplayButtonID"><i name="actions1" value="eq" class="fas fa-square-root-alt ihover javaSC thin-icontrash ebdeqbtn" style="font-size: 18px;"></i></a>
                        </span>
                      </div>
                  </div>
                </div>
              </div>
            </div>

          <!-- Modal footer-->

        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn buttonfooter" onclick="maprelbuild()">Map Data</button>
        <button type="button" class="btn buttonfooter" onclick="relbuild()">Save</button>
      </div>
    </div>
  </div>
</div>

<!-- Relationship modal data table (model creation screen1) ends -->

<!-- Relationship modal new table definition (model creation screen2) starts-->
<div class="modal fade" id="relation_modal_2" role="dialog">
  <div class="modal-dialog" style="max-width:700px;">

    <!-- Modal content-->
    <div class="modal-content">
      <!-- Modal header-->
      <div class="modal-header">
        <h6 class="modal-title">Create relationship</h6>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>
      <!-- Modal body-->

      <form>
        <div class="modal-body modalbodyrel_2">
          <div class="row justify-content-start">
            <div class="fieldsrel_2">
              <div class="row" style="margin:0 7px;">
                <div class="col-5 form-group">
                  <label class="acies_label">Parent table</label>
                  <input type="text" name="Parent table" class="form-control textInput" id="parent_table2" disabled
                    />
                </div>
                <div class="col-5 form-group">
                  <label class="acies_label">Parent element</label>
                  <input type="text" name="Parent element" class="form-control textInput" id="parent_element2" disabled
                    />
                </div>
                <div class="col-5 form-group">
                  <label class="acies_label">Field data type</label>
                  <input type="text" name="Field DataType" class="form-control textInput" id="fieldatatype2"
                    value="ForeignKey" disabled/>
                </div>
                <div class="col-5 form-group">
                  <label class="acies_label">Can take null values?</label>
                  <select class="select2 nullField form-control" id="null2" name="null">
                    <option value="0" disabled selected>Select option</option>
                    <option value="Yes">Yes</option>
                    <option value="No">No</option>
                  </select>
                </div>
                <div class="col-2 form-group ">
                  <label class="acies_label">Computed value</label>
                  <div class="d-flex">
                    <div class="switch-container">
                      <input class="switch comp_cbox" type="checkbox" id="computed2" name="ComputedValue" value="off">
                      <div class="switch-color"><label class="trigger-label" for="computed2"></label></div>
                      <label class="switch-label" for="computed2"></label>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Modal footer-->
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" onclick="createtable_relbuild()">Add foreign key</button>
        </div>

      </form>

    </div>
  </div>
</div>

<!-- Relationship modal new table definition (model creation screen2) ends -->

<!-- Dependency Modal -->
<div class="modal" id="dependencyChecker">
  <div class="modal-dialog modal-lg modal-dialog-centered" style="justify-content: center;">
    <div class="modal-content" style="width: 50%;text-align: center;justify-content: center;" >

      <div class="modal-header">
        <h6 class="modal-title">Related Application Dependencies</h6>

      </div>

      <div class="modal-body" style="height: 8rem;overflow: auto;">
          <table class="table">
              <tbody id="dependencyTable" >
              </tbody>
          </table>
      </div>

      <div class="modal-footer">
        <button type="button" id="btn_dependencySave" class="btn  buttonfooter" data-dismiss="modal">Save</button>
        <button type="button" class="btn buttonfooter" data-dismiss="modal">Close</button>
      </div>

    </div>
  </div>
</div>

<!-- End Dependency Modal -->





<!--Mapper Modal -->
<div class="modal" id="mapper_modal">
  <div class="modal-dialog modal-xl modal-dialog-centered" style="justify-content: center;" style="height:40vh">
    <div class="modal-content" style="width: 50%;text-align: center;justify-content: center;" >

      <div class="modal-header" style="background-color: #565a5e;">
        <h6 class="modal-title" style="margin: auto;color: white;font-weight: bold;">Foreignkey Data Mapper</h6>
      </div>

      <div class="modal-body" id="mapper_modal_main_body" style="max-height: 26rem;overflow:auto;overflow-y: hidden;">

          <table id="mapper_modal_datatable" class="row-border display" style="width: 100%;">
            <thead>
              <th scope="col">Table name</th>
              <th scope="col">Change Value</th>
              <th scope="col">New Value</th>
            </thead>
            <tbody id="mapper_modal_content">

            </tbody>
          </table>

      </div>

      <div class="modal-footer">
        <button type="button" id="configureforeignkey_save" data-current-table ="" class="btn btn-primary  mx-2 rounded px-2" data-dismiss="modal">Save Changes</button>
        <button type="button" id="datadiscovery_save" data-current-table ="" class="btn btn-primary  mx-2 rounded px-2" data-dismiss="modal">Save Data Changes</button>
        <button type="button" class="btn btn-primary mx-2 rounded px-2" data-dismiss="modal">Close</button>
      </div>

    </div>
  </div>
</div>

<!-- End Mapper Modal -->



<!--Validation Modal -->
<div class="modal" id="validation_cap_error">
  <div class="modal-dialog modal-xl modal-dialog-centered" style="justify-content: center;" style="height:40vh">
    <div class="modal-content" style="width: 50%;justify-content: center;" >

      <div class="modal-header">
        <h6 class="modal-title">Validation Message</h6>
        <i class="fa-solid fa-list-check iconsize"></i>
      </div>

      <div class="modal-body" id="validation_cap_error_main_body">


      </div>

      <div class="modal-footer d-flex justify-content-end">
        <button type="button" class="btn buttonfooter" data-dismiss="modal">Close</button>
      </div>

    </div>
  </div>
</div>

<!-- End Validation Modal -->

<!-- Equation Builder Modal -->
<div class="modal" id="EBDisplayModel">
  <div>
      <div style="height:100vh;overflow:auto;background:whitesmoke;z-index:10;position: relative;">

          <div id="EBbody">

              <div class="overlay" id="overlay" style="display:none;"></div>
              <div class="popup" id="popup" style="display:none;">
                  <div class="popup-inner">
                      <input type="button" name="Close" class="s3-btn-close" onclick="popupClose();" value="&times;">

                      <h2 id='funcHeading' style="font-size:28px"></h2>
                      <br />
                      <div id="funcInput" class='ScrollStyle'>
                      </div>
                      <p id='funcDesc' style="font-size:22px;"></p>
                  </div>
              </div>

              <div class="equation-left">
                  <div class="fav-functions">
                      <div class="functions-search">
                          <h2>Favourite Functions</h2>
                      </div>

                      <div id="favouriteList">

                      </div>
                  </div>

                  <div class="eq-functions">
                      <div class="functions-search">
                          <h2>Search Functions</h2>
                          <div class="searchWrapper">
                              <input type="text" name="searchBar" id="searchBar"
                                  placeholder="Search for a function" />
                          </div>
                      </div>

                      <div id="functionsList">

                      </div>
                  </div>
              </div>
              <div class="equation-right">
                  <div class="search-table">
                      <div class="searchWrapper t_table">
                      </div>
                      <div id="tableList">
                          {% for model in level2 %}
                          <div onClick='selectTable("{{model}}")' class="tableItem btn-xs btn">
                              <p class="tableItemP"
                                  onClick='selectTable(e.target.value);changeTableandColumns(e.target.value)'
                                  value="{{model}}">{{model}}</p>
                          </div>
                          {% endfor %}
                      </div>
                  </div>
                  <div id='selectedTablesDiv'>

                  </div>
                  <div id="table-columns" class="dragAreaPossible"></div>
                  <div class="eq-workspace">
                      <div class="workspace-left lmgm">
                          <div class="ebSteps">
                              <h2>Steps</h2>
                              <div id="stepNumsEb"></div>
                          </div>
                          <div class="ebFunctions dragAreaPossible">
                              <h2>Functions</h2>
                          </div>
                          <div id="dataElementParent" class="ebDataElements">
                              <h2>Data Elements</h2>
                          </div>
                      </div>
                      <div class="workspace-right rmgm">
                          <h2>Preview</h2>
                          <div id="functionPreviews"></div>
                      </div>
                  </div>
              </div>

          </div>

          <div class="modal-footer">
              <button type="button" class="btn btn-primary btn-xs mx-2 rounded px-2" data-dismiss="modal">Close</button>
              <button type="button" class="btn btn-primary btn-xs mx-2 rounded px-2" id="save_workflow_equ">Save</button>
          </div>
      </div>
  </div>
</div>
<!-- End Equation Builder Modal -->

<!-- Export Data modal -->
<div class="modal" id="exportEquModal">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">

      <!-- Modal Header -->
      <div class="modal-header">
        <h6 class="modal-title">Select Configurations</h6>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>

      <!-- Modal body -->
      <div class="modal-body" id="exportEqData" style="max-height:25rem;overflow:auto;">
              <div class="dropdown">

                  <div class="form-group" id="exportTable1">
                      <label for="exportTable1">Select table to export Data:</label>
                      <select id="selectExportTable1" class="select2 form-control" name="exportTable1">
                      <option value="" disabled selected>Select Table Name</option>
                      {% for model in level2 %}
                      <option value="{{model}}">{{model}}</option>
                      {%endfor%}
                      </select>
                  </div>

                  <div class="form-group" id="exportTypeContainer1">
                      <label for="selectExportDataType1">Export type: </label>
                      <select class="select2 form-control" name="selectExportDataType1" id="selectExportDataType1">
                          <option value='append' selected>Append to existing data</option>
                          <option value='update'>Update existing data</option>
                          <option value='replace'>Replace the existing data</option>
                      </select>
                  </div>

                  <div class="form-group"  id="exportColumn1">
                      <label for="column1">Column Name:</label>
                      <select id="exportselectColumn1" class="select2 form-control" name="column1" multiple>
                      </select>
                  </div>

                  <div class="form-group" id="updateIdentifierContainer1" style="display: none;">
                      <label for="selectUpdateIdentifierCol1">Select identifier columns: </label>
                      <select class="select2 form-control" name="selectUpdateIdentifierCol1" id="selectUpdateIdentifierCol1" multiple>
                      </select>
                  </div>
                  <div class="form-group" id="updateColumnContainer1" style="display: none;">
                      <label for="selectUpdateCol1">Select columns to update: </label>
                      <select class="select2 form-control" name="selectUpdateCol1" id="selectUpdateCol1" multiple>
                      </select>
                  </div>

                  <br>

                  <div class="form-group" style="text-align: left;">
                      <button type="button" id="save_buttonExportData1" class="btn btn-primary btn-xs mx-2 rounded px-2">Save</button>
                      <button type="submit" id="run_stepExportData1" class="btn btn-primary btn-xs mx-2 rounded px-2">Run</button>
                  </div>
              </div>

              <br>
      </div>

      <!-- Modal footer -->
      <div class="modal-footer">
        <button type="button" class="btn btn-primary btn-xs mx-2 rounded px-2" data-dismiss="modal">Close</button>
      </div>

    </div>
  </div>
</div>
<!-- End Export Data modal -->

<!-- Import File Creation Modal -->
<div class="modal fade" id="datamgmt_uploadModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header" style='background:#565a5e; color:white;'>
        <h5 class="modal-title" style="margin-left:auto;" >Upload</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
            <form id="datamgmt_table_form">
              <div class="form-row">
                <div class="custom-file">
                  <input type="file" class="custom-file-input" id="datamgmt_uploadFile"  name="datamgmt_uploadFile" onclick="this.value=null;">
                  <label id="datamgmtF1" class="custom-file-label" for="datamgmt_uploadFile">Upload File</label>
                </div>

              </div>
            </form>
      </div>
      <div class="modal-footer">
      <button id="datamgmt_uploadFileBtn" name="datamgmt_uploadFileBtn" type="button"
        class="btn btn-primary" >Submit</button>
      </div>

      </div>
    </div>
  </div>

  <div class="modal fade" id="errorDetail" tabindex="-1" role="dialog" aria-labelledby="formModalLabel" aria-hidden="true" >
    <div class="modal-dialog modal-dialog-centered modal-xl" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="formModalLabel">Report for reconfiguring elements</h5>
          <i class="fa-solid fa-table-list iconsize"></i>
        </div>
      <div class="modal-body" style="max-height: 550px;overflow-y: scroll;">
      </div>
      <div class="modal-footer">
        <button class="btn buttonfooter" id="generateReport">Confirm</button>
        <button type="button" class="btn  buttonfooter" data-dismiss="modal">Close</button>
      </div>
    </div>
    </div>
  </div>
<!-- End Import File Creation Modal -->

<!--Data Access modal-->
<div class="modal fade" id="dataAccessModal" role="dialog">
  <div class="modal-dialog modal-dialog-centered" style="max-width:700px;">

    <!-- Modal content-->
    <div class="modal-content">
      <!-- Modal header-->
      <div class="modal-header">
        <h6 class="modal-title">Configure User Data Access</h6>
        <i class="fa fa-filter iconsize fa-2xl"></i>
      </div>
      <!-- Modal body-->
      <div class="modal-body">
        <div class="row">
          <div class="col-3 form-group">
            <label class="acies_label" style="padding-top: 0.5em;">Select Control Type: </label>
          </div>
          <div class="col-8">
            <select class="select2 form-control" name="selectAccessControlType" id="selectAccessControlType">
              <option value="" selected>No Access Controls (default)</option>
              <option value="created_by_user">Allow Access To Records Created/ Modified by User</option>
              <option value="custom">Custom Controls</option>
            </select>
          </div>
        </div>
        <div class="row" id="customControlContainer" style="display: none;">
          <div class="col-3 form-group">
            <label class="acies_label" style="padding-left: 0.3em;">Select Fields to Check For User's Username: </label>
          </div>
          <div class="col-8">
            <select class="select2 form-control" id="selectAccessControlCustomField" name="selectAccessControlCustomField" multiple>
            </select>
          </div>
          <div class="col-3 form-group">
            <label class="acies_label" style="padding-left: 0.3em;">Allow Access to Records: </label>
          </div>
          <div class="col-8">
            <select class="select2 form-control" id="selectCustomAccessControlType" name="selectCustomAccessControlType">
              <option value="any">If User's Username is Mentioned in Any One Of The Fields</option>
              <option value="all">If User's Username is Mentioned in All Of The Fields</option>
              <option value="any_email">If User's Email Id is Mentioned in Any One Of The Non-Audit Fields</option>
              <option value="all_email">If User's Email Id is Mentioned in All Of The Non-Audit Fields</option>
            </select>
          </div>
        </div>
      </div>
      <!-- Modal footer-->
      <div class="modal-footer">
        <button type="button" class="btn buttonfooter" onclick="saveUserDataAccessControl()">Save</button>
        <button type="button" class="btn buttonfooter" onclick="removeUserDataAccessControl()">Reset Config</button>
      </div>
    </div>
  </div>
</div>


<script>
  let auditFields = ['created_by','created_date','modified_by','modified_name','approved_by','approval_status','from',"value","transaction_id", "active_from", "active_to", "scenario_id","is_active_flag"]

  function saveColumnOrder(obj) {
    var columnOrderDict = []
    $(obj).parent().parent().find(".sortable-order").children().each(function() {
      columnOrderDict.push($(this).attr("name"))
    })
    $.ajax({
        url: window.location.pathname,
        data:{'operation': 'column_reorder','model_name':$('.dataElements').find('p').text(), 'column_order': JSON.stringify(columnOrderDict)},
        type: "POST",
        dataType: "json",
        success: function(data){
          Swal.fire({icon: 'success',text: `Column reordered successfully!`});
        },
        error: function () {
        Swal.fire({icon: 'error',text: 'Error! Please try again.'});
        }
        }).done(function() {
          $(`#${$('.dataElements').find('p').text()}`).trigger("click")
          regenrateHtml();
      });
  }

  $("#edit_att_det").on("click",function() {
    if(!auditFields.includes($("#selectedElement").text())){
      $("#editattr_modal").modal("show")
      $('#verbose_name').off().on('keypress', function (event) {
        var specialChars = "<>@!#$%^&*()+[]{}?:;|'\"\\,./~`=";
        var key = String.fromCharCode(!event.charCode ? event.which : event.charCode);
        for(i = 0; i < specialChars.length;i++){
          if(key.indexOf(specialChars[i]) > -1){
            event.preventDefault();
            return false
            }
        }
      });
      $('#verbose_name').on('paste', function (event) {
        var clipboardData = event.originalEvent.clipboardData || window.clipboardData;
        var pastedText = clipboardData.getData('text');
        var containsSpecialChars = false;
        var specialChars = "<>@!#$%^&*()+[]{}?:;|'\"\\,./~`=";
        for (i = 0; i < specialChars.length; i++) {
            if (pastedText.indexOf(specialChars[i]) > -1) {
                containsSpecialChars = true;
                break;
            }
        }

        if(containsSpecialChars){
           event.preventDefault();
           this.value = this.value+pastedText.replace(/[<>@!#$%^&*()+\[\]{}?:;|'\"\\,./~`=\s]/g, '')
        }


      });
    } else{
      Swal.fire({icon: 'warning',text: 'Audit fields cannot be edited.'});
    }
  })
  var ctoken = $('form').find("input[name='csrfmiddlewaretoken']").attr('value')

  $.ajaxSetup({
    beforeSend: function (xhr, settings) {
      xhr.setRequestHeader("X-CSRFToken", ctoken);
    }
  });

  $('.entitybuttons').click(function () {
    var model_name = $(this).attr('id');

    $('#selectedElement').empty()
    $('#RelatioshipElement').empty()
    document.getElementById("edit_att_det").hidden = true;
    document.getElementById("add_att_val").hidden = true;
    document.getElementById("delete_att_det").hidden = true;
    $(".dataElements").find("p").empty()
    $(".dataElements").find("p").append(model_name)
    document.getElementById("dataele_dataAccess").hidden = false;
    document.getElementById("dataele_add").hidden = false;
    document.getElementById("dataele_delete").hidden = false;
    document.getElementById("dataele_order").hidden = false;
    document.getElementById("dataele_replica_table").hidden = false;

    $(".sortable-order").sortable();
    $(".sortable-order li").draggable({
      connectToSortable: ".sortable-order",
      helper: "original",
      revert: "invalid"
    }).draggable("enable");

    $.ajax({
      url: window.location.pathname,
      data: { 'model_name': model_name, 'operation': 'f1' },
      type: "POST",
      dataType: "json",
      success: datatableReload,
      error: function () {
        Swal.fire({icon: 'error',text: 'Error! Please try again.'});
      }
    })

    function datatableReload(data) {

      var column_list = data.column_list;
      var table_type = data.table_type;
      var other_config = data.other_config;
      var verbose_column_name_dict = data.verbose_column_name_dict;

      if(table_type =="System"){
        $("#dataele_dataAccess").hide()
        $("#dataele_add").hide()
        $("#dataele_delete").hide()
        $("#dataele_order").hide()
        $("#delete_att_det").hide()
        $("#edit_att_det").show()
        $("#edit_att_det").attr("data-table_type", "System")
        $("#add_att_val").hide()
        $("#dataele_replica_table").hide()
      }else{
        $("#dataele_dataAccess").show()
        $("#dataele_add").show()
        $("#dataele_delete").show()
        $("#dataele_order").show()
        $("#delete_att_det").show()
        $("#edit_att_det").show()
        $("#edit_att_det").attr("data-table_type", "User")
        $("#add_att_val").show()
        $("#dataele_replica_table").show()
        if (other_config) {
          $("#dataele_dataAccess").attr('data-config', JSON.stringify(other_config));
        } else {
          $("#dataele_dataAccess").removeAttr('data-config');
        }
      }

      $('.list-group').empty()
      $('#myTable').empty()
      $('.sortable-order').empty()
      $('#relTable').empty()
      $(".multipleform_compInp_add").empty()

      for(let [key,value] of Object.entries(verbose_column_name_dict)){
        $(".multipleform_compInp_add").append(`<option value="${value}">${key}</option>`)
      }

      for (x in column_list) {
        $('.list-group').append("<button type='button' class='list-group-item list-group-item-action list-group-item-light' id='" + model_name + "'>" + column_list[x] + "</button>");
        $('.sortable-order').append(`<li class="btn btn-sm btn-light col" name="${column_list[x]}"><span class="ui-icon ui-icon-arrowthick-2-n-s float-left mt-1" data-toggle="tooltip" title="Drag Up/ Down to reorder"></span>${column_list[x]}</li>`);
      }

      $('.list-group-item').click(function () {
        $("#search_field1").val("")
        var model_name = $(this).attr('id');
        var field_name = $(this).text();
        $(".attributeDetails").find("p").empty()
        $(".attributeDetails").find("p").append(field_name)

        document.getElementById("edit_att_det").hidden = false;
        document.getElementById("add_att_val").hidden = false;
        document.getElementById("delete_att_det").hidden = false;
        $.ajax({
          url: window.location.pathname,
          data: { 'model_name': model_name, 'field_name': field_name, 'operation': 'f2' },
          type: "POST",
          dataType: "json",
          success: fieldtableReload,
          error: function () {
            Swal.fire({icon: 'error',text: 'Error! Please try again.'});
          }
        })

        function fieldtableReload(data) {
          var newTableName = $(".dataElements").find("p").text()
          var details = JSON.parse(data)[0]
          var rel_details = JSON.parse(data)[1]
          var search_details = JSON.parse(data)[2]
          $('#myTable').empty()

          for (y in details) {

            if(y == "Computed Value" && details[y] == true){

                $('#myTable').append("<tr> <td>" + y + "</td> <td>" + details[y] + "<a data-toggle='tooltip' title='View Configuration' value='eq'><i name='actions1' value='eq' class='fas fa-square-root-alt ihover javaSC thin-icontrash attr_equ_btn' style='font-size: 18px;margin-left: 13px;'></i></a>" + "</td> </tr>");

            }else{

                $('#myTable').append("<tr> <td>" + y + "</td> <td>" + details[y] + "</td> </tr>");
            }

          }

          $('#relTable').empty()
          for (x in rel_details) {
            $('#relTable').append('<tr> <td id="rel_tab">' + x + '</td> <td>' + rel_details[x][0] + '</td> <td>' + rel_details[x][1] + '</td></tr>');

          }

          $('#searchTable1').empty()
          for (i in search_details) {
            var details = JSON.parse(data)[2][i]
            for (x in details){
          if(i == newTableName)
        {
          $('#searchTable1').append('<tr> <td id="tab_name1">' + i + '</td> <td id="col_name1">' + details[x] + '</td><td><a class="viewdetails_button" data-toggle="modal" data-target="#viewdetailElement" title="View Details" value="detail"><i name="actions" value="detail" class="fa fa-eye ihover javaSC thin-icon" style="font-size: 15px"></i></a></td> </tr>');
        }
        else if(details[x] != field_name)
        {
          $('#searchTable1').append('<tr> <td id="tab_name1">' + i + '</td> <td id="col_name1">' + details[x] + '</td><td><a class="viewdetails_button" data-toggle="modal" data-target="#viewdetailElement" title="View Details" value="detail"><i name="actions" value="detail" class="fa fa-eye ihover javaSC thin-icon" style="font-size: 15px"></i></a></td> </tr>');
        }
        else{
          $('#searchTable1').append('<tr> <td id="tab_name1">' + i + '</td> <td id="col_name1">' + details[x] + '</td><td><a class="viewdetails_button" data-toggle="modal" data-target="#viewdetailElement" title="View Details" value="detail"><i name="actions" value="detail" class="fa fa-eye ihover javaSC thin-icon" style="font-size: 15px"></i></a>   <a data-toggle="modal" data-target="#relation_modal" class="add_foreignkey_button" title="Edit record" value="update"><i name="actions" value="update" class="relbutton fa fa-edit ihover javaSC thin-icon" style="font-size:15px"></i></a></td> </tr>');
        }
          }

        }




        }


      })
    }
  })

  function showReplica(){
    Swal.fire({
      icon:'question',
      text: "Create replica table? \n\nClick 'Yes' to confirm or click 'No' if you wish to unlink it.",
      showDenyButton: true,
      showCancelButton: true,
      confirmButtonText: 'Yes',
      denyButtonText: 'No',
    }).then((result) => {
      if (result.isConfirmed) {
        $.ajax({
            url: window.location.pathname,
            data: { 'model_name': $('.dataElements').find('p').text(), 'operation': 'create_replica_table_dm' },
            type: "POST",
            dataType: "json",
            success: function() {
              Swal.fire({icon: 'success',text: `Replica table created successfully!`});
            },
            error: function () {
              Swal.fire({icon: 'error',text: 'Error! Please try again.'});
            }
          }).done(function() {
            $(`#${$('.dataElements').find('p').text()}`).trigger("click")
        });
      }

      if (result.isDenied) {
        $.ajax({
            url: window.location.pathname,
            data: { 'model_name': $('.dataElements').find('p').text(), 'operation': 'remove_replica_table_dm' },
            type: "POST",
            dataType: "json",
            success: function() {
              Swal.fire({icon: 'success',text: `Table unlinked sucessfully !`});
            },
            error: function () {
              Swal.fire({icon: 'error',text: 'Error! Please try again.'});
            }
          }).done(function() {
            $(`#${$('.dataElements').find('p').text()}`).trigger("click")
        });
      }

    })
  }

</script>





<script>

  var ctoken = $('form').find("input[name='csrfmiddlewaretoken']").attr('value')
  $.ajaxSetup({
    beforeSend: function (xhr, settings) {
      xhr.setRequestHeader("X-CSRFToken", ctoken);
    }
  });

  $('.graphbuttons').click(function () {
    var model_name = $(this).attr('id');

    $.ajax({
      url: window.location.pathname,
      data: { 'model_name': model_name, 'operation': 'f3' },
      type: "POST",
      dataType: "json",
      success: datatableReload,
      error: function () {
        Swal.fire({icon: 'error',text: 'Error! Please try again.'});
      }
    })

    function datatableReload(data) {
      $('#modelgraph').empty()

      var elem = document.createElement("img");
      elem.src = "{% static 'model_graphs/my_project_subsystem.png' %}";
      $('#modelgraph').append(elem)
      location.reload()
      $('#search-just').tab('show')

    }

  })

</script>

<script>
  $('card11').ready(function () {
    $('.cardheader11').on('click', function (e) {

      $('.cardbody11').toggle();
      $('.cardfooter11').toggle();

      if ($('.cardbody11').css('display') == 'none') {
        $(".cardheader11").find("i.fa-minus").addClass('fa-plus').removeClass('fa-minus').end();
      }

      if ($('.cardbody11').css('display') == 'block') {
        $(".cardheader11").find("i.fa-plus").addClass('fa-minus').removeClass('fa-plus').end();

      }
    });
  });

  $('card12').ready(function () {
    $('.cardheader12').on('click', function (e) {

      $('.cardbody12').toggle();
      $('.cardfooter12').toggle();

      if ($('.cardbody12').css('display') == 'none') {
        $(".cardheader12").find("i.fa-minus").addClass('fa-plus').removeClass('fa-minus').end();
      }

      if ($('.cardbody12').css('display') == 'block') {
        $(".cardheader12").find("i.fa-plus").addClass('fa-minus').removeClass('fa-plus').end();

      }
    });
  });
</script>

<script>
  $('#btn_search1').click(function () {
    var search_text = $('#search_field1').val();
    var selected_text = $('#selectedElement').text()
    var search_option = $('#search_option1').find(":selected").text();
    var newTableName = $(".dataElements").find("p").text()

    $.ajax({
      url: window.location.pathname,
      data: { 'search_text': search_text, 'search_option': search_option, 'operation': 'f5' },
      type: "POST",
      dataType: "json",
      success: fieldtableReload,
      error: function () {
        Swal.fire({icon: 'error',text: 'Error! Failure in executing search request. Please try again.'});
      }
    })


    function fieldtableReload(data) {
      var details = JSON.parse(data)
      $('#searchTable1').empty()
      for (i in details) {
        var details = JSON.parse(data)[i]
        for (x in details) {

        if(x == newTableName)
        {
          $('#searchTable1').append('<tr> <td id="tab_name1">' + x + '</td> <td id="col_name1">' + details[x] + '</td><td><a class="viewdetails_button" data-toggle="modal" data-target="#viewdetailElement" title="View Details"value="detail"><i name="actions" value="detail" class="fa fa-eye ihover javaSC thin-icon" style="font-size: 15px"></i></a> <a  title="Edit record" class="add_foreignkey_relationship" style="display:none" data-toggle="modal" data-target="#relation_modal" value="update"><i name="actions" value="update" class="relbutton fa fa-edit ihover javaSC thin-icon" style="font-size:15px"></i></a></td> </tr>');
        }
        else if(details[x] != search_text)
        {
          $('#searchTable1').append('<tr> <td id="tab_name1">' + x + '</td> <td id="col_name1">' + details[x] + '</td><td><a class="viewdetails_button" data-toggle="modal" data-target="#viewdetailElement" title="View Details"value="detail"><i name="actions" value="detail" class="fa fa-eye ihover javaSC thin-icon" style="font-size: 15px"></i></a> <a  title="Edit record" class="add_foreignkey_relationship" style="display:none" data-toggle="modal" data-target="#relation_modal" value="update"><i name="actions" value="update" class="relbutton fa fa-edit ihover javaSC thin-icon" style="font-size:15px"></i></a></td> </tr>');
        }
        else{
          $('#searchTable1').append('<tr> <td id="tab_name1">' + x + '</td> <td id="col_name1">' + details[x] + '</td><td><a class="viewdetails_button" data-toggle="modal" data-target="#viewdetailElement" title="View Details"value="detail"><i name="actions" value="detail" class="fa fa-eye ihover javaSC thin-icon" style="font-size: 15px"></i></a>    <a  title="Edit record" class="add_foreignkey_relationship" data-toggle="modal" data-target="#relation_modal" value="update"><i name="actions" value="update" class="relbutton fa fa-edit ihover javaSC thin-icon" style="font-size:15px"></i></a></td> </tr>');
        }
        }
      }
      if(search_text != selected_text)
      {
        $('.add_foreignkey_relationship').css("display","none")
      }
    }
  })

</script>

<script>
  $('#btn_search').click(function () {
    var search_text = $('#search_field').val();
    var search_option = $('#search_option').find(":selected").text();

    $.ajax({
      url: window.location.pathname,
      data: { 'search_text': search_text, 'search_option': search_option, 'operation': 'f6' },
      type: "POST",
      dataType: "json",
      success: fieldtableReload,
      error: function () {
        Swal.fire({icon: 'error',text: 'Error! Failure in executing search request. Please try again.'});
      }
    })

    function fieldtableReload(data) {
      var details = JSON.parse(data)

      $('#searchTable').empty()
      for (i in details) {
        var details = JSON.parse(data)[i]

        for (x in details) {
          $('#searchTable').append('<tr> <td id="tab_name2">' + x + '</td> <td id="col_name2">' + details[x] + '</td><td><a class="viewdetails_button" data-toggle="modal" data-target="#viewdetailElement" title="View Details"value="detail"><i name="actions" value="detail" class="fa fa-eye ihover javaSC thin-icon" style="font-size: 15px"></i></a>   <a data-toggle="modal" data-target="#relation_modal_2" title="Edit record" value="update"><i name="actions" value="update" class="relbutton2 fa fa-edit ihover javaSC thin-icon" style="font-size:15px"></i></a></td> </tr>');

        }
      }

    }
  })

</script>

<!-- script to reset add data element modal fields after clicking on close -->
<script>
  function resetAddElementModal(){
    $('#dynamic').empty()
    $(".datatype").val(0).trigger('change.select2');
    var fieldPosition = $('.datatype').parent().parent().parent()
    extraElements = $('#addElementPropContainer').find('div.row:not(.permAddDetailRow)');
    extraElements.each(function () {
      $(this).remove()
    })
    $(".nullField").val(0).trigger('change.select2');
    $("#fieldmdl").prop("readonly", false);
    $("#field_relatedname").css('display', 'none');
    $('#parent_table_fk').css('display', 'none');
    $("#parent_table_add").prop("readonly", false);
    $("#fielddatatypeadd").prop("disabled", false);
    $('#addelement').find('form').trigger('reset');
    $('.equationBuilder1').css('display', 'none');
  }
</script>
<!-- end -->

<script>

  $(document).on("click", ".addforeignkey", function(){
    var parent_table_add = $(this).closest('tr').find("#tab_name_add").text()
    var parent_col_add = $(this).closest('tr').find("#col_name_add").text()
    $("#fieldmdl").val(parent_col_add).prop("readonly", true);
    $("#field_relatedname").css('display', 'block');
    $("#field_related_name").val('id').prop("readonly", true);
    $('#parent_table_fk').css('display', 'block');
    $("#parent_table_add").val(parent_table_add).prop("readonly", true);
    $("#fielddatatypeadd").val("ForeignKey").trigger("change").prop("disabled", true);
  });

$('#addelement').on('show.bs.modal', function (e){

  $("#addelement_null").on("change", function() {
        if($(this).val() == "Yes"){
          $("#addelement_unique").val("No").change().prop("disabled", true);
        } else {
          $("#addelement_unique").prop("disabled", false);
        }
      });

       $('.field_header').on('keypress', function (event) {
        var specialChars = "<>@!#$%^&*()+[]{}?:;|'\"\\,./~`=";
        var key = String.fromCharCode(!event.charCode ? event.which : event.charCode);
        for(i = 0; i < specialChars.length;i++){
          if(key.indexOf(specialChars[i]) > -1){
            event.preventDefault();
            return false
            }
        }
      });

      $('.field_header').on('paste', function (event) {
        var clipboardData = event.originalEvent.clipboardData || window.clipboardData;
        var pastedText = clipboardData.getData('text');
        var containsSpecialChars = false;
        var specialChars = "<>@!#$%^&*()+[]{}?:;|'\"\\,./~`=";
        var stripped_out_str = ""
        for (i = 0; i < specialChars.length; i++) {
            if (pastedText.indexOf(specialChars[i]) > -1) {
                containsSpecialChars = true;
                break;
            }
        }
        if(containsSpecialChars){
           event.preventDefault();
           this.value = this.value + pastedText.replace(/[<>@!#$%^&*()+\[\]{}?:;|'\"\\,./~`=\s]/g, '')
        }

      });

       $('.field_name').on('keypress', function (event) {
        var specialChars = "<>@!#$%^&*()+[]{}?:;|'\"\\,./~`=-";
        var key = String.fromCharCode(!event.charCode ? event.which : event.charCode);
        for(i = 0; i < specialChars.length;i++){
          if(key.indexOf(specialChars[i]) > -1){
            event.preventDefault();
            return false
            }
        }
      });

      $('#fieldmdl').on('paste', function (event) {
        var clipboardData = event.originalEvent.clipboardData || window.clipboardData;
        var pastedText = clipboardData.getData('text');
        var containsSpecialChars = false;
        var specialChars = "<>@!#$%^&*()+[]{}?:;|'\"\\,./~`=-";
        var stripped_out_str = ""
        for (i = 0; i < specialChars.length; i++) {
            if (pastedText.indexOf(specialChars[i]) > -1) {
                containsSpecialChars = true;
                break;
            }
        }

        if(containsSpecialChars){
           event.preventDefault();
           this.value =this.value+pastedText.replace(/[<>@!#$%^&*()+\[\]{}?:;|'\"\\,./~`=-\s]/g, '')
        }


      });

      $('.max_length_ID').on('keypress', function (event) {
        var specialChars = "0123456789";
        var key = String.fromCharCode(!event.charCode ? event.which : event.charCode);
        if(!Number.isInteger(Number(key))) {
          event.preventDefault();
            return false
        }
      });


})

  function addElements() {
    var newTableName = $(".dataElements").find("p").text()
    let cap_fields_val= []
    var audit_fields =  ['created_by','created_date','modified_by','modified_name','approved_by','approval_status','from',"value","transaction_id", "active_from", "active_to", "scenario_id", "is_active_flag"]
    let field_name_add = $("#fieldmdl").val().toLowerCase();
    let cap_status =  (/[A-Z]/.test(field_name_add))
    let space_status =  (/\s/.test(field_name_add))
    var val_msg = "";
    var create_table_flag = true;
    var fieldList = []
    var val_msg = "";
    $('.modalbody1').find('.fields').each(function () {
    var fieldDict = {}
    if($(this).find('input[name="Field Name"]').val() == "") {
      val_msg += `<li><p>${field_name_add} : <em style="color:red;font-style:normal">'Field Name' cannot be empty.</em></p></li>`
      create_table_flag = false;
    } else {
      if($(this).find('input[name="Field Name"]').val() != undefined) {
        fieldDict['fieldName'] = $(this).find('input[name="Field Name"]').val().toLowerCase();
      } else {
        fieldDict['fieldName'] = $(this).find('input[name="Field Name"]').val();
      }
    }
    if ($(this).find('input[name="Field DataType"]').val() != "0") {
      fieldDict['fieldDatatype'] = $(this).find('input[name="Field DataType"]').val()
    } else {
      val_msg += `<li><p>${field_name_add} : <em style="color:red;font-style:normal">'Field DataType' cannot be empty.</em></p></li>`
      create_table_flag = false;
    }
    if ($(this).find('select[name="Field DataType"]').val() != "0") {
      fieldDict['fieldDatatype'] = $(this).find('select[name="Field DataType"]').val()
    } else {
      val_msg += `<li><p>${field_name_add} : <em style="color:red;font-style:normal">'Field DataType' cannot be empty.</em></p></li>`
      create_table_flag = false;
    }
    fieldDict['fieldVerboseName'] = $(this).find('input[name="Field Verbose Name"]').val()
    if ($(this).find('select[name="null"]').val() != null) {
      fieldDict['fieldNull'] = $(this).find('select[name="null"]').val()
    } else {
      if($(this).find('input[name="Field Name"]').val() != undefined) {
        val_msg += `<li><p>${field_name_add} : <em style="color:red;font-style:normal">'Field Null' cannot be empty.</em></p></li>`
        create_table_flag = false;
      }
    }
    if($(this).find('select[name="unique"]').val() != null) {
      fieldDict['fieldUnique'] = $(this).find('select[name="unique"]').val()
    } else {
      if($(this).find('input[name="Field Name"]').val() != undefined) {
        val_msg += `<li><p>${field_name_add} : <em style="color:red;font-style:normal">'Field Unique' cannot be empty.</em></p></li>`
        create_table_flag = false;
      }
    }
    if($(this).find('input[name="ComputedValuec"]').eq(0).is(":checked")){
      var check_model_compeq = []
      $.ajax({
        url: window.location.pathname,
        data: { 'model_name': newTableName, 'operation': 'check_model_compeq'},
        type: "POST",
        async: false,
        dataType: "json",
        success: function(data) {
          var check_model_compeq_data = JSON.parse(data.data)
          for (i in check_model_compeq_data["element_name"]) {
            if(check_model_compeq_data["element_name"][i] != null) {
              check_model_compeq.push(check_model_compeq_data["element_name"][i].slice(newTableName.length,-10))
            }
          }
        }
        }).done(function() {
          fieldDict['computedValue'] = "Yes"
            if(!check_model_compeq.includes($('.modalbody1').find('.fields').find('input[name="Field Name"]').val())) {
              val_msg += `<li><p>${$('.modalbody1').find('.fields').find('input[name="Field Name"]').val()} : <em style="color:red;font-style:normal">No Computation configured</em></p></li>`
              create_table_flag = false;
            }
        })
    }else if ($(this).find('input[name="ComputedValuec"]').eq(0).is(":not(:checked)")){
      fieldDict['computedValue'] = "No"
    }
    if (fieldDict['fieldDatatype'] == 'CharField') {
      if ($(this).find('input[name="maxLength"]').val() != "") {
        fieldDict['fieldMaxLength'] = $(this).find('input[name="maxLength"]').val()
      } else {
        val_msg += `<li><p>${field_name_add} : <em style="color:red;font-style:normal">'Maximum length' cannot be empty.</em></p></li>`
        create_table_flag = false;
      }
      fieldDict['fieldChoices'] = $(this).find('select[name="choices"]').val()
      fieldDict["secure_with"] = $(".enclass").val()
      if($(".enclass").val() != "None") {
        if($(".kclass").find("input").val() != "") {
          fieldDict["datakey"] = $(".kclass").find("input").val()
        } else {
          val_msg += `<li><p>${field_name_add} : <em style="color:red;font-style:normal">No key entered configured</em></p></li>`
          create_table_flag = false
        }
      }
    }
    if (fieldDict['fieldDatatype'] == 'ConcatenationField') {
      fieldDict['fieldMaxLength'] = $(this).find('input[name="edit_maxLength"]').val()
      if ($(this).find('select[name="concat_columns"]').val().length != 0) {
        fieldDict['columns'] = JSON.stringify(($(this).find('select[name="concat_columns"]').val()))
      } else {
        val_msg += `<li><p>${field_name_add} : <em style="color:red;font-style:normal">Columns not configured for ConcatenationField</em></p></li>`
        create_table_flag = false;
      }
      if($(this).find('select[name="divider"]').val() != "") {
        fieldDict['divider'] = $(this).find('select[name="divider"]').val()
      } else {
        val_msg += `<li><p>${field_name_add} : <em style="color:red;font-style:normal">Divider not configured for ConcatenationField</em></p></li>`
        create_table_flag = false;
      }
      fieldDict['fieldEditable'] = "No"
    }
    if (fieldDict['fieldDatatype'] == 'FileField') {
      fieldDict['file_extension'] = $(this).find('select[name="edit_extension"]').val()
    }
    if (fieldDict['fieldDatatype'] == 'VideoField') {
      fieldDict['video_type'] = $(this).find('select[name="video_type_extension"]').val()
    }
    if (fieldDict['fieldDatatype'] == 'UniqueIDField') {
      fieldDict['fieldMaxLength'] = $(this).find('input[name="edit_maxLength"]').val()
      fieldDict['fieldEditable'] = "No"
      if ($('#add_uuid_config').attr("name") != "") {
        fieldDict['uuid_config'] = $('#add_uuid_config').attr("name")
      } else {
        val_msg += `<li><p>${field_name_add} : <em style="color:red;font-style:normal">No UniqueIDField settings configured.</em></p></li>`
        create_table_flag = false;
      }
    }
    if (fieldDict['fieldDatatype'] == 'ForeignKey') {
      if ($(this).find('input[name="FKTable Name"]').val()) {
        fieldDict['fieldFKTable'] = $(this).find('input[name="FKTable Name"]').val()
      }
      if ($(this).find('select[name="FKTable Name"]').val()) {
        fieldDict['fieldFKTable'] = $(this).find('select[name="FKTable Name"]').val()
      }
      fieldDict['fieldRelatedName'] = $(this).find('input[name="FKRelated Name"]').val()
    }

    if (fieldDict['fieldDatatype'] == 'TimeRangeField') {
      fieldDict['timerange_type'] = 1
    }

    if (["FileField", "ImageField"].includes(fieldDict['fieldDatatype'])) {

    }
    if (fieldDict['fieldDatatype'] == 'DateRangeField') {
      fieldDict['daterange_type'] = 1
    }
    if (["IntegerField","BigIntegerField", "FloatField", "CharField", "TextField", "URLField"].includes(fieldDict['fieldDatatype'])) {
      fieldDict['fieldDefault'] = $(this).find('input[name="default"]').val()
    }
    if (["CharField", "TextField", "URLField"].includes(fieldDict['fieldDatatype'])) {
      fieldDict['blacklist_chars'] = $(this).find('.multipleform_bklist_add').val()
    }

    if (fieldDict['computedValue'] == "Yes") {
      fieldDict['computedInput'] = $(this).find('.multipleform_compInp_add').val()
    }else{
      fieldDict['computedInput'] = []
    }

    if (fieldDict['fieldDatatype'] == 'DateTimeRangeField') {
      fieldDict['datetimerange_type'] = 1
    }

    if (["DateField", "TimeField", "DateTimeField"].includes(fieldDict['fieldDatatype'])) {
      if($(this).find('select[name="autoNow"]').val() != null) {
        fieldDict['fieldAutoNow'] = $(this).find('select[name="autoNow"]').val()
      } else {
        val_msg += `<li><p>${field_name_add} : <em style="color:red;font-style:normal">Autonow not configured for ${fieldDict['fieldDatatype']}</em></p></li>`
        create_table_flag = false;
      }
      if($(this).find('select[name="editable"]').val() != null) {
        fieldDict['fieldEditable'] = $(this).find('select[name="editable"]').val()
      } else {
        val_msg += `<li><p>${field_name_add} : <em style="color:red;font-style:normal">Editable not configured for ${fieldDict['fieldDatatype']}</em></p></li>`
        create_table_flag = false;
      }
      if(fieldDict['fieldDatatype'] != "DateField") {
        fieldDict['fieldUseSeconds'] = $(this).find('select[name="useseconds"]').val()
      }
    }

    if (fieldDict['fieldDatatype'] == 'CardField') {
      fieldDict['fieldMaxLength'] = 19
      is_config_present = $('#add_card_config').attr("name")
      if(is_config_present != ""){
        is_config_present = JSON.parse(is_config_present)
        fieldDict['card_config'] = $('#add_card_config').attr("name")
      }else{
        val_msg += `<li><p>${field_name_add} : <em style="color:red;font-style:normal">Please configure the cardfield settings.</em></p></li>`
        create_table_flag = false
      }
    }
    if (fieldDict['fieldDatatype'] == 'PrivacyField') {
      is_config_present = $('#add_privacy_config').attr("name")
      if(is_config_present != ""){
        is_config_present = JSON.parse(is_config_present)
        fieldDict['privacy_config'] = $('#add_privacy_config').attr("name")
      }else{
        val_msg += `<li><p>${field_name_add} : <em style="color:red;font-style:normal">Please configure the PrivacyField settings.</em></p></li>`
        create_table_flag = false;
      }
    }
    if (fieldDict['fieldDatatype'] == 'TableField') {
      fieldDict['fieldMaxLength'] = 19
      is_config_present = $('#add_table_config').attr("name")
      if(is_config_present != ""){
        is_config_present = JSON.parse(is_config_present)
        fieldDict['table_config'] = $('#add_table_config').attr("name")
      }else{
        val_msg += `<li><p>${field_name_add} : <em style="color:red;font-style:normal">Please configure the TableField settings.</em></p></li>`
        create_table_flag = false
      }
    }
    if (fieldDict['fieldDatatype'] == 'CardCvvField') {
      fieldDict['fieldMaxLength'] = 4
    }
    if (fieldDict['fieldDatatype'] == 'CardTypeField') {
      fieldDict['fieldMaxLength'] = 15
    }
    if (fieldDict['fieldDatatype'] == 'EmailTypeField') {
      if ($(this).find('input[name="maxLength"]').val() != "") {
        fieldDict['fieldMaxLength'] = $(this).find('input[name="maxLength"]').val()
      } else {
        val_msg += `<li><p>${field_name_add} : <em style="color:red;font-style:normal">'Maximum length cannot be empty.</em></p></li>`
        create_table_flag = false;
      }
    }
    if (fieldDict['fieldDatatype'] == 'MultiselectField') {
      is_config_present = $('#add_mulsel_config').attr("name")
      if(is_config_present != ""){
        is_config_present = JSON.parse(is_config_present)
        fieldDict['mulsel_config'] = $('#add_mulsel_config').attr("name")
      }else{
        val_msg += `<li><p>${field_name_add} : <em style="color:red;font-style:normal">Please configure the MultiselectField settings.</em></p></li>`
        create_table_flag = false
      }
    }
    if (fieldDict['fieldDatatype'] == 'RTFField') {
      if ($(this).find('input[name="maxLength"]').val() != "") {
        fieldDict['fieldMaxLength'] = $(this).find('input[name="maxLength"]').val()
      } else {
        val_msg += `<li><p>${field_name_add} : <em style="color:red;font-style:normal">'Maximum length cannot be empty.</em></p></li>`
        create_table_flag = false;
      }
    }
  })


    if(cap_status == true){
      cap_fields_val.push({"Capital":field_name_add})
    }
    if(space_status == true){
      cap_fields_val.push({"Space":field_name_add})
    }

    if(audit_fields.includes(field_name_add.toLowerCase())){
      cap_fields_val.push({"Restricted":field_name_add})
    }

    if(!create_table_flag) {
      cap_fields_val.push({"ColumnCreationValidation": ""})
    }
    if(cap_fields_val.length >0){
      $("#validation_cap_error_main_body").empty()
      let audit_count = 0
        var html_content= ""
      $("#validation_cap_error_main_body").append(`<p style='font-size: 16px;'>Following fields consist of certain validation errors:</p>`)
      for(let j=0;j<cap_fields_val.length;j++){
        if(Object.keys(cap_fields_val[j])[0] == "Capital"){
          html_content += `<li><p>${cap_fields_val[j]["Capital"]} : <em style='color:red;font-style:normal'>Field name cannot contain captial letter.</em></p></li>`
        }
        if(Object.keys(cap_fields_val[j])[0] == "Space"){
          html_content += `<li><p>${cap_fields_val[j]["Space"]} : <em style='color:red;font-style:normal'> Field name cannot contain space.</em></p></li>`
        }
        if(Object.keys(cap_fields_val[j])[0] == "Restricted"){
          html_content += `<li><p>${cap_fields_val[j]["Restricted"]} : <em style='color:red;font-style:normal'>Field name can not be one of the restricted names.</em></p>
            </li>`
            audit_count+=1
        }

      }
      html_content += val_msg
      $("#validation_cap_error_main_body").append(`<ul style='list-style-type: disc;font-size: 13px;overflow: auto;'>${html_content}</ul>`)
        if(audit_count >0){
          $("#validation_cap_error_main_body").append(` <p style='color:red;'>*Restricted field names: <em style='color:black;font-style:normal;'> created_by, created_date, modified_by, modified_name,\n approved_by, approval_status, from, value, transaction_id, active_from, active_to, scenario_id<em></p>`)
        }
      $("#validation_cap_error").modal('show')

    }else{
      $(".addSave").html('Generating report <i class="fa fa-circle-notch fa-spin"></i>')

      checkChangedConfig(newTableName,"Column added",".addSave","addelement","add")
    }
  }
  function addElements1() {
    var fieldList = []
    var fieldsTotal = $('.modalbody1').find('.fields').each(function () {
      var fieldDict = {}
      fieldDict['fieldName'] = $(this).find('input[name="Field Name"]').val()
      if ($(this).find('input[name="Field DataType"]').val()) {
        fieldDict['fieldDatatype'] = $(this).find('input[name="Field DataType"]').val()
      }
      if ($(this).find('select[name="Field DataType"]').val()) {
        fieldDict['fieldDatatype'] = $(this).find('select[name="Field DataType"]').val()
      }
      fieldDict['fieldVerboseName'] = $(this).find('input[name="Field Verbose Name"]').val()
      fieldDict['fieldNull'] = $(this).find('select[name="null"]').val()
      fieldDict['fieldUnique'] = $(this).find('select[name="unique"]').val()
      if($(this).find('input[name="ComputedValuec"]').eq(0).is(":checked")){
        fieldDict['computedValue'] = "Yes"
      }else if ($(this).find('input[name="ComputedValuec"]').eq(0).is(":not(:checked)")){
        fieldDict['computedValue'] = "No"
      }
      if(fieldDict['computedValue'] == "Yes"){
        fieldDict["computed_input"] = $(this).find(".multipleform_compInp_add").val()
      }
      if (fieldDict['fieldDatatype'] == 'CharField') {
        fieldDict['fieldMaxLength'] = $(this).find('input[name="maxLength"]').val()
        fieldDict['fieldChoices'] = $(this).find('select[name="choices"]').val()
        fieldDict["secure_with"] = $(".enclass").val()
        if($(".enclass").val() != "None") {
          fieldDict["datakey"] = $(".kclass").find("input").val()
        }
      }
      if (fieldDict['fieldDatatype'] == 'ConcatenationField') {
        fieldDict['fieldMaxLength'] = $(this).find('input[name="edit_maxLength"]').val()
        fieldDict['columns'] = JSON.stringify(($(this).find('select[name="concat_columns"]').val()))
        fieldDict['divider'] = $(this).find('select[name="divider"]').val()
        fieldDict['fieldEditable'] = "No"
      }
      if (fieldDict['fieldDatatype'] == 'FileField') {
        fieldDict['file_extension'] = $(this).find('select[name="edit_extension"]').val()
      }
      if (fieldDict['fieldDatatype'] == 'VideoField') {
        fieldDict['video_type'] = $(this).find('select[name="video_type_extension"]').val()
      }
      if (fieldDict['fieldDatatype'] == 'UniqueIDField') {
        fieldDict['fieldMaxLength'] = $(this).find('input[name="edit_maxLength"]').val()
        fieldDict['fieldEditable'] = "No"
        fieldDict['uuid_config'] = $('#add_uuid_config').attr("name")
      }
      if (fieldDict['fieldDatatype'] == 'ForeignKey') {
        if ($(this).find('input[name="FKTable Name"]').val()) {
          fieldDict['fieldFKTable'] = $(this).find('input[name="FKTable Name"]').val()
        }
        if ($(this).find('select[name="FKTable Name"]').val()) {
          fieldDict['fieldFKTable'] = $(this).find('select[name="FKTable Name"]').val()
        }
        fieldDict['fieldRelatedName'] = $(this).find('input[name="FKRelated Name"]').val()
      }

      if (fieldDict['fieldDatatype'] == 'TimeRangeField') {
        fieldDict['timerange_type'] = 1
      }

      if (["FileField", "ImageField"].includes(fieldDict['fieldDatatype'])) {

      }
      if (fieldDict['fieldDatatype'] == 'DateRangeField') {
        fieldDict['daterange_type'] = 1
      }
      if (["IntegerField","BigIntegerField", "FloatField", "CharField", "TextField", "URLField"].includes(fieldDict['fieldDatatype'])) {
        fieldDict['fieldDefault'] = $(this).find('input[name="default"]').val()
      }
      if (["CharField", "TextField", "URLField"].includes(fieldDict['fieldDatatype'])) {
        fieldDict['blacklist_chars'] = $(this).find('.multipleform_bklist_add').val()
      }
      if (["IntegerField","BigIntegerField", "FloatField"].includes(fieldDict['fieldDatatype'])) {
        fieldDict['fieldEditable'] = $(this).find('select[name="editable"]').val()
      }
      if (fieldDict['fieldDatatype'] == 'DateTimeRangeField') {
        fieldDict['datetimerange_type'] = 1
      }

      if (["DateField", "TimeField", "DateTimeField"].includes(fieldDict['fieldDatatype'])) {
        fieldDict['fieldAutoNow'] = $(this).find('select[name="autoNow"]').val()
        fieldDict['fieldEditable'] = $(this).find('select[name="editable"]').val()
        if(fieldDict['fieldDatatype'] != "DateField") {
          fieldDict['fieldUseSeconds'] = $(this).find('select[name="useseconds"]').val()
        }
      }

      if (fieldDict['fieldDatatype'] == 'CardField') {
        fieldDict['fieldMaxLength'] = 19
        fieldDict['card_config'] = $('#add_card_config').attr("name")
        is_config_present = JSON.parse($('#add_card_config').attr("name"))
        fieldDict["secure_with"] = is_config_present["card_field_create_enclass"]
        if(is_config_present["card_field_create_enclass"] != "None") {
          fieldDict["datakey"] = is_config_present["card_field_create_kclass"]
          fieldDict['fieldMaxLength'] = 255
        }
      }
      if (fieldDict['fieldDatatype'] == 'PrivacyField') {
        fieldDict['privacy_config'] = $('#add_privacy_config').attr("name")
      }
      if (fieldDict['fieldDatatype'] == 'TableField') {
        fieldDict['fieldMaxLength'] = 19
        fieldDict['table_config'] = $('#add_table_config').attr("name")
        is_config_present = JSON.parse($('#add_table_config').attr("name"))
      }
      if (fieldDict['fieldDatatype'] == 'CardCvvField') {
        fieldDict['fieldMaxLength'] = 4
      }
      if (fieldDict['fieldDatatype'] == 'CardTypeField') {
        fieldDict['fieldMaxLength'] = 15
      }
      if (fieldDict['fieldDatatype'] == 'EmailTypeField') {
        fieldDict['fieldMaxLength'] = $(this).find('input[name="maxLength"]').val()
      }
      if (fieldDict['fieldDatatype'] == 'RTFField') {
        fieldDict['fieldMaxLength'] = $(this).find('input[name="maxLength"]').val()
      }
      if (fieldDict['fieldDatatype'] == 'MultiselectField') {
        fieldDict['mulsel_config'] = $('#add_mulsel_config').attr("name")
      }
      fieldList.push(fieldDict)
    })

    extra_fields_config = $('#add_card_config').attr("name")
    if(extra_fields_config != undefined){
      extra_fields_config = JSON.parse(extra_fields_config)
    }else{
      extra_fields_config = {}
    }

    extra_f_list = []
    for(let [k,v] of Object.entries(extra_fields_config)){
      if(v === true){
        extra_f_list.push(k.split('_')[0])
      }
    }

    for(let i in extra_f_list){
      if(extra_f_list[i] == "cardtype"){

        let secure_with = extra_fields_config["cardtype_field_create_enclass"]
        let datakey = null
        if(secure_with != "None") {
          datakey = extra_fields_config["cardtype_field_create_kclass"]
          fieldList.push({
            "fieldName":extra_fields_config["cardtype_field_create_fname"],
            "fieldDatatype":"CardTypeField",
            "fieldVerboseName":extra_fields_config["cardtype_field_create_vname"],
            "fieldNull":extra_fields_config["cardtype_field_create_null"] == "1" ? "Yes" : "No",
            "fieldUnique":"No",
            "computedValue":"No",
            "fieldMaxLength":255,
            "secure_with":secure_with,
            "datakey":datakey,
          })
        }else{
          fieldList.push({
            "fieldName":extra_fields_config["cardtype_field_create_fname"],
            "fieldDatatype":"CardTypeField",
            "fieldVerboseName":extra_fields_config["cardtype_field_create_vname"],
            "fieldNull":extra_fields_config["cardtype_field_create_null"] == "1" ? "Yes" : "No",
            "fieldUnique":"No",
            "computedValue":"No",
            "fieldMaxLength":15,
            "secure_with":secure_with,
          })
        }
      }else if(extra_f_list[i] == "cvv"){
        let secure_with = extra_fields_config["cvv_field_create_enclass"]
        let datakey = null
        if(secure_with != "None") {
          datakey = extra_fields_config["cvv_field_create_kclass"]
          fieldList.push({
            "fieldName":extra_fields_config["cvv_field_create_fname"],
            "fieldDatatype":"CardCvvField",
            "fieldVerboseName":extra_fields_config["cvv_field_create_fname"],
            "fieldNull":extra_fields_config["cvv_field_create_null"] == "1" ? "Yes" : "No",
            "fieldUnique":"No",
            "computedValue":"No",
            "fieldMaxLength":255,
            "secure_with":secure_with,
            "datakey":datakey,
          })
        }else{
          fieldList.push({
            "fieldName":extra_fields_config["cvv_field_create_fname"],
            "fieldDatatype":"CardCvvField",
            "fieldVerboseName":extra_fields_config["cvv_field_create_fname"],
            "fieldNull":extra_fields_config["cvv_field_create_null"] == "1" ? "Yes" : "No",
            "fieldUnique":"No",
            "computedValue":"No",
            "fieldMaxLength":4,
            "secure_with":secure_with,
          })
        }
      }else if(extra_f_list[i] == "expiryDate"){
        let secure_with = extra_fields_config["expiryDate_field_create_enclass"]
        let datakey = null
        if(secure_with != "None") {
          datakey = extra_fields_config["expiryDate_field_create_kclass"]
          fieldList.push({
            "fieldName":extra_fields_config["expiryDate_field_create_fname"],
            "fieldDatatype":"CardExpiryField",
            "fieldVerboseName":extra_fields_config["expiryDate_field_create_vname"],
            "fieldNull":extra_fields_config["expiryDate_field_create_null"] == "1" ? "Yes" : "No",
            "fieldUnique":"No",
            "computedValue":"No",
            "fieldMaxLength":255,
            "secure_with":secure_with,
            "datakey":datakey,
          })
        }else{
          fieldList.push({
            "fieldName":extra_fields_config["expiryDate_field_create_fname"],
            "fieldDatatype":"CardExpiryField",
            "fieldVerboseName":extra_fields_config["expiryDate_field_create_vname"],
            "fieldNull":extra_fields_config["expiryDate_field_create_null"] == "1" ? "Yes" : "No",
            "fieldUnique":"No",
            "computedValue":"No",
            "fieldMaxLength":20,
            "secure_with":secure_with,
          })
        }
      }
    }

    var newTableName = $(".dataElements").find("p").text()
    var currentDevMode = "{{current_dev_mode}}"
            var mode_list=["Edit","Build"]
    if(mode_list.includes(currentDevMode.trim())){
        $.ajax({
                url: window.location.pathname,
                data: {
                'operation': "fetchDependenciesDataManagement",
                'name': newTableName,
                },
                type: "POST",
                dataType: "json",
                success: function (data) {
                if (data.appDependency.length > 0) {
                  $('#dependencyTable').empty()

                            for(var i=0;i<data.appDependency.length;i++){
                                 $('#dependencyTable').append(`<tr><td style="font-weight:bold">${i+1}.</td><td style="font-weight:bold;text-align:start">&nbsp;&nbsp;${data.appDependency[i]}</td></tr>`)
                            }
                             $('#dependencyChecker').modal('show')
                             $('#btn_dependencySave').off('click').on('click',function(){
                       $.ajax({
                      url: window.location.pathname,
                      data: { 'tablename': newTableName, 'fieldDict': JSON.stringify(fieldList), 'operation': 'addelement' },
                      type: "POST",
                      dataType: "json",
                      success: datatableReload,
                      error: function () {
                        Swal.fire({icon: 'error',text: 'Error! Please try again.'});
                      }
                    })

                    function datatableReload(data) {
                      regenrateHtml()
                      $('#dynamic').empty()
                      $(this).find('form').trigger('reset');
                      $('#addelement').modal('hide');
                      Swal.fire({icon: 'success',text: 'Element added successfully!'});
                      var model_name = JSON.parse(data)[1]
                      var field_name_all = JSON.parse(data)[2]
                      for (let name in field_name_all){
                        field_name = field_name_all[name]
                        $('.list-group').append("<button type='button' class='list-group-item list-group-item-action list-group-item-light' id='" + model_name + "'>" + field_name + "</button>");

                        $('.list-group-item').click(function () {
                        var model_name = $(this).attr('id');
                        var field_name = $(this).text();
                        $(".attributeDetails").find("p").empty()
                        $(".attributeDetails").find("p").append(field_name)

                        document.getElementById("edit_att_det").hidden = false;
                        document.getElementById("add_att_val").hidden = false;
                        document.getElementById("delete_att_det").hidden = false;
                        $.ajax({
                          url: window.location.pathname,
                          data: { 'model_name': model_name, 'field_name': field_name, 'operation': 'f2' },
                          type: "POST",
                          dataType: "json",
                          success: fieldtableReload,
                          error: function () {
                            Swal.fire({icon: 'error',text: 'Error! Please try again.'});
                          }
                        })

                        function fieldtableReload(data) {
                          var details = JSON.parse(data)[0]
                          var rel_details = JSON.parse(data)[1]
                          var search_details = JSON.parse(data)[2]

                          $('#myTable').empty()

                          for (y in details) {
                            if(y == "Computed Value" && details[y] == true){

                                $('#myTable').append("<tr> <td>" + y + "</td> <td>" + details[y] + "<a data-toggle='tooltip' title='View Configuration' value='eq'><i name='actions1' value='eq' class='fas fa-square-root-alt ihover javaSC thin-icontrash attr_equ_btn ' style='font-size: 18px;margin-left: 13px;'></i></a>" + "</td> </tr>");

                              }else{
                                  $('#myTable').append("<tr> <td>" + y + "</td> <td>" + details[y] + "</td> </tr>");
                              }
                          }

                          $('#relTable').empty()
                          for (x in rel_details) {
                            $('#relTable').append('<tr> <td>' + x + '</td> <td>' + rel_details[x][0] + '</td> <td>' + rel_details[x][1] +'</td> </tr>');

                          }

                          $('#searchTable1').empty()
                          for (i in search_details) {
                            var details = JSON.parse(data)[2][i]

                            for (x in details){
                            $('#searchTable1').append('<tr> <td id="tab_name1">' + i + '</td> <td id="col_name1">' + details[x] + '</td><td><a data-toggle="tooltip" title="View Details" value="detail"><i name="actions" value="detail" class="fa fa-search ihover javaSC thin-icon" style="font-size: 15px"></i></a>   <a data-toggle="modal" data-target="#relation_modal" title="Edit record" value="update"><i name="actions" value="update" class="relbutton fa fa-edit ihover javaSC thin-icon" style="font-size:15px"></i></a></td> </tr>');

                          }
                        }
                        }

                        })
                      }

                    }
                    })
                  } else {
                     $.ajax({
                    url: window.location.pathname,
                    data: { 'tablename': newTableName, 'fieldDict': JSON.stringify(fieldList), 'operation': 'addelement' },
                    type: "POST",
                    dataType: "json",
                    success: datatableReload,
                    error: function () {
                      Swal.fire({icon: 'error',text: 'Error! Please try again.'});
                    }
                  })

                  function datatableReload(data) {
                    regenrateHtml()
                    $('#dynamic').empty()
                    $(this).find('form').trigger('reset');
                    $('#addelement').modal('hide');
                    Swal.fire({icon: 'success',text: 'Element added successfully!'});
                    var model_name = JSON.parse(data)[1]
                    var field_name_all = JSON.parse(data)[2]
                    for(let name in field_name_all){
                      field_name = field_name_all[name]
                      $('.list-group').append("<button type='button' class='list-group-item list-group-item-action list-group-item-light' id='" + model_name + "'>" + field_name + "</button>");

                      $('.list-group-item').click(function () {
                      var model_name = $(this).attr('id');
                      var field_name = $(this).text();
                      $(".attributeDetails").find("p").empty()
                      $(".attributeDetails").find("p").append(field_name)

                      document.getElementById("edit_att_det").hidden = false;
                      document.getElementById("add_att_val").hidden = false;
                      document.getElementById("delete_att_det").hidden = false;
                      $.ajax({
                        url: window.location.pathname,
                        data: { 'model_name': model_name, 'field_name': field_name, 'operation': 'f2' },
                        type: "POST",
                        dataType: "json",
                        success: fieldtableReload,
                        error: function () {
                          Swal.fire({icon: 'error',text: 'Error! Please try again.'});
                        }
                      })

                      function fieldtableReload(data) {
                        var details = JSON.parse(data)[0]
                        var rel_details = JSON.parse(data)[1]
                        var search_details = JSON.parse(data)[2]

                        $('#myTable').empty()

                        for (y in details) {
                          if(y == "Computed Value" && details[y] == true){

                              $('#myTable').append("<tr> <td>" + y + "</td> <td>" + details[y] + "<a data-toggle='tooltip' title='View Configuration' value='eq'><i name='actions1' value='eq' class='fas fa-square-root-alt ihover javaSC thin-icontrash attr_equ_btn ' style='font-size: 18px;margin-left: 13px;'></i></a>" + "</td> </tr>");

                            }else{
                              $('#myTable').append("<tr> <td>" + y + "</td> <td>" + details[y] + "</td> </tr>");
                            }
                        }

                        $('#relTable').empty()
                        for (x in rel_details) {
                          $('#relTable').append('<tr> <td>' + x + '</td> <td>' + rel_details[x][0] + '</td> <td>' + rel_details[x][1] + '</td></tr>');

                        }

                        $('#searchTable1').empty()
                        for (i in search_details) {
                          var details = JSON.parse(data)[2][i]
                          for (x in details){

                              $('#searchTable1').append('<tr> <td id="tab_name1">' + i + '</td> <td id="col_name1">' + details[x] + '</td><td><a data-toggle="tooltip" title="View Details" value="detail"><i name="actions" value="detail" class="fa fa-search ihover javaSC thin-icon" style="font-size: 15px"></i></a>   <a data-toggle="modal" data-target="#relation_modal" title="Edit record" value="update"><i name="actions" value="update" class="relbutton fa fa-edit ihover javaSC thin-icon" style="font-size:15px"></i></a></td> </tr>');


                        }
                      }
                      }

                      })
                  }
                  }
                  }
            },
            error: function () {
            Swal.fire({icon: 'error',text: 'Error! Please try again.'});
            }
            });

  }else{
     $.ajax({
      url: window.location.pathname,
      data: { 'tablename': newTableName, 'fieldDict': JSON.stringify(fieldList), 'operation': 'addelement' },
      type: "POST",
      dataType: "json",
      success: datatableReload,
      error: function () {
        Swal.fire({icon: 'error',text: 'Error! Please try again.'});
      }
    })

    function datatableReload(data) {
      regenrateHtml()
      $('#dynamic').empty()
      $(this).find('form').trigger('reset');
      $('#addelement').modal('hide');
      Swal.fire({icon: 'success',text: 'Element added successfully!'});
      var model_name = JSON.parse(data)[1]
      var field_name_all = JSON.parse(data)[2]
      for(let name in field_name_all){
        field_name = field_name_all[name]
        $('.list-group').append("<button type='button' class='list-group-item list-group-item-action list-group-item-light' id='" + model_name + "'>" + field_name + "</button>");

        $('.list-group-item').click(function () {
        var model_name = $(this).attr('id');
        var field_name = $(this).text();

        $(".attributeDetails").find("p").empty()
        $(".attributeDetails").find("p").append(field_name)

        document.getElementById("edit_att_det").hidden = false;
        document.getElementById("add_att_val").hidden = false;
        document.getElementById("delete_att_det").hidden = false;
        $.ajax({
          url: window.location.pathname,
          data: { 'model_name': model_name, 'field_name': field_name, 'operation': 'f2' },
          type: "POST",
          dataType: "json",
          success: fieldtableReload,
          error: function () {
            Swal.fire({icon: 'error',text: 'Error! Please try again.'});
          }
        })

        function fieldtableReload(data) {

          var details = JSON.parse(data)[0]
          var rel_details = JSON.parse(data)[1]
          var search_details = JSON.parse(data)[2]

          $('#myTable').empty()

          for (y in details) {
            if(y == "Computed Value" && details[y] == true){

                  $('#myTable').append("<tr> <td>" + y + "</td> <td>" + details[y] + "<a data-toggle='tooltip' title='View Configuration' value='eq'><i name='actions1' value='eq' class='fas fa-square-root-alt ihover javaSC thin-icontrash attr_equ_btn' style='font-size: 18px;margin-left: 13px;'></i></a>" + "</td> </tr>");

              }else{
                    $('#myTable').append("<tr> <td>" + y + "</td> <td>" + details[y] + "</td> </tr>");
              }
          }

          $('#relTable').empty()
          for (x in rel_details) {
            $('#relTable').append('<tr> <td>' + x + '</td> <td>' + rel_details[x][0] + '</td> <td>' + rel_details[x][1] +'</td></tr>');

          }

          $('#searchTable1').empty()
          for (i in search_details) {
            var details = JSON.parse(data)[2][i]

            for (x in details){
            $('#searchTable1').append('<tr> <td id="tab_name1">' + i + '</td> <td id="col_name1">' + details[x] + '</td><td><a data-toggle="tooltip" title="View Details" value="detail"><i name="actions" value="detail" class="fa fa-search ihover javaSC thin-icon" style="font-size: 15px"></i></a>   <a data-toggle="modal" data-target="#relation_modal" title="Edit record" value="update"><i name="actions" value="update" class="relbutton fa fa-edit ihover javaSC thin-icon" style="font-size:15px"></i></a></td> </tr>');

          }
        }
        }

        })
    }
    }
  }
  }
</script>

<script>

  $('#editattr_modal').on('show.bs.modal', function (e) {
    var model_name = $(".dataElements").find("p").text()
    var field_name = $('#selectedElement').text()
    let table_type = $("#edit_att_det").attr("data-table_type")
    $("#null_field_edit").on("change", function() {
      if($(this).val() == "Yes"){
        $("#unique").val("No").change().prop("disabled", true);
      } else {
        $("#unique").prop("disabled", false);
      }
    });
    $("#configureforeignkey_save").show()
    $("#datadiscovery_save").hide()
    $.ajax({
      url: window.location.pathname,
      data: { 'model_name': model_name, 'field_name': field_name, 'operation': 'attr_details' },
      type: "POST",
      dataType: "json",
      success: datatableReload,
      error: function () {
        Swal.fire({icon: 'error',text: 'Error! Please try again.'});
      }
    })

    function datatableReload(data) {
      var attribute_details = JSON.parse(data)
      var fieldName = attribute_details['Field_name'];
      var selectedDataType = attribute_details['Data Type']
      var fieldPosition = $('.modalbody2 .fields')
      $("#field_datatype").val(attribute_details['Data Type']).prop("disabled", false);
        extraElements = fieldPosition.find("div").slice(16)
      extraElements.each(function () {
        $(this).remove()
      })


      if (attribute_details['Nullable'] == true) {
        attribute_details['Nullable'] = 'Yes'
      } else {
        attribute_details['Nullable'] = 'No'
      }

      if (attribute_details['Unique'] == true) {
        attribute_details['Unique'] = 'Yes'
      } else {
        attribute_details['Unique'] = 'No'
      }
      $("#parent_table_edit").css('display', 'none');
      $("#dynamicsearchfield_layer_foreign").css('display', 'none');
      $("#verbose_name").val(attribute_details['Front End Name']);

      $("#field_datatype").val(attribute_details['Data Type']).trigger('change');
      $("#null_field_edit").val(attribute_details['Nullable']).trigger('change');
      if (attribute_details['Computed Value'] == true) {
        $("#ComputedValue2").prop('checked', true).trigger("change");

      }else{
        $("#ComputedValue2").prop('checked', false).trigger("change");
      }
      $("#unique").val(attribute_details['Unique']).trigger('change');
      if (selectedDataType == 'ForeignKey') {
        fieldPosition.find('.row').eq(0).append(`

        <div class="col-6 form-group" id="parent_table_edit" style="display: none;">
        <label class="acies_label" style="padding-left:0.3em;">Parent Table</label>
        </div>
        <div class="col-4">
        <input type="text" value = "" name="FKTableName" id="parent_table_edit_dm" class="form-control textInput" placeholder="Parent Table" />
      </div>`)
        $("#parent_table_edit").css('display', 'block');
        var parent_table_edit = $("#relTable").find('tr td:first-child')[0].innerText
        $("#parent_table_edit_dm").val(parent_table_edit).prop("readonly", true);
        var newTableName = $(".dataElements").find("p").text()
        var table_not_list =[]
        if( newTableName && parent_table_edit){
          table_not_list.push(parent_table_edit)
        table_not_list.push(newTableName)
        }
            //Populate the Datatable with table names
            html_conf =""

              var value1 = $('#selectedElement').text().toLowerCase();

                if (value1 !== "") {
            col_dict = {}
            col_list = []
            name_list = []
            final_list = []
            $.each($search, function (key, value) {
              var jk = [key]
              for (val in jk) {
                $.each(jk, function () {

                  $.each(value, function (index, value) {
                    if (value.match(value1) !== null) {
                      col_list.push(value);
                      $.each(col_list, function (index, name) {
                        col_dict[key] = name
                        name_list.push(col_dict)
                        col_list = []
                        col_dict = {}
                      }
                      )
                    }
                  });
                }
                )
              }
            })

              $.each(name_list, function (index, name) {
              $.each(name, function (key2, val2) {
                if(!table_not_list.includes(key2)){

                  html_conf += '<tr> <td id="tab_name_conf" style="width:50px">' + key2 + '</td> <td id="col_name_conf" style="width:50px;text-align:center">' + val2 + '</td> <td style="padding-left:7px;width:20px;"><a title="Change Parent Table" value="update" ><i name="actions" value="update" class="configureforeignkey fa fa-plus-square fa-2x" style="color:var(--primary-color);" data-current-table='+key2+'></i></a></td></tr>';

                }

              })
            })

          }
          fieldPosition.find('.row').eq(0).find('#foreign_table').remove()

          fieldPosition.find('.row').eq(0).append(`
        <div class="col-12 form-group"  id="foreign_table" >
        <div id="dynamicsearchfield_layer_foreign" style="width:99%;table-layout: fixed;word-wrap:break-word;text-align:center;">
        <table id="dynamicsearchfield_foreign" class="row-border display" style="width: 100%;height:5vh;">
          <thead>
            <th scope="col">Table name</th>
            <th scope="col">Column name</th>
            <th scope="col">Action</th>
          </thead>
          <tbody id="dynamic_foreign" style="max-height:3rem;overflow:auto;overflow-x:hidden;">
            ${html_conf}
          </tbody>
        </table>
        </div></div>
        `)

        if($.fn.dataTable.isDataTable('#dynamicsearchfield_foreign')){

              $('#dynamicsearchfield_foreign').DataTable().clear().destroy()


            }


   $("#dynamicsearchfield_foreign"+"_wrapper").remove()
            $("#dynamicsearchfield_foreign").remove()

            var customDatatable=`
            <table id="dynamicsearchfield_foreign" class="row-border display" style="width: 100%;">
                    <thead>
                      <th scope="col">Table name</th>
                      <th scope="col">Column name</th>
                      <th scope="col">Action</th>
                    </thead>
                    <tbody id="dynamic_foreign">
                      ${html_conf}
                    </tbody>
                  </table>
            `
            $("#dynamicsearchfield_layer_foreign").append(customDatatable)


          $('#dynamicsearchfield_foreign').DataTable({
              "paging": false,
              "ordering": false,
              "info": false,
              "searching": false,
              "autoWidth": true,
              "scrollY": "200px",
              "sScrollX": "110%",
              "scrollX":true,
              "scrollCollapse": true,

              columnDefs: [
                {
                  targets: "_all",
                  className: 'dt-center allColumnClass all'
                }
                ],

              });




      }

      if (selectedDataType == 'CharField') {
        if(attribute_details['Default'] == "null" || attribute_details['Default'] == null){
          def_val=""
        }else{
          def_val=attribute_details['Default']
        }
        var specificElements = `<div class="row ml-0">
                          <div class="col-3 form-group" >
                  <label class="acies_label col-md-12" style="padding-left:3px;">Maximum Length<span class="asteriskField">*</span></label>
                    <input type="number" name="maxLength" class="form-control numberinput" min="0" value="` + attribute_details['Max Length'] + `" />
                </div>
                 <div class="col-3 form-group" >
                    <label class="acies_label col-md-12" style="padding-left:3px;">Choices</label>
                    <select class="form-control select2_multiplechoices_edit" multiple="multiple" name=choices style="display: inline-block;width:8em;padding:0px;border:0px solid black">
                  </select>
                </div>
                <div class="col-3 form-group" >
                <label class="acies_label col-md-12">Default</label>
                  <input type="text" name="default" class="form-control textInput" value="` + def_val + `"/>
              </div>
              <div class="col-3 form-group" >
                <label class="acies_label col-md-12">Blacklist Characters</label>
                  <select class="form-control multipleform_bklist_edit" multiple></select>
              </div>
              </div>
              <div class="row ml-0"><div class="col-3 form-group">
                <label class="acies_label col-md-12">Secure with?</label>
                  <select name="datakey" class="form-control select2 enclass" min="0">
                    <option value="None" selected="">None
                    </option><option value="encrypt">Encryption
                    </option></select>
              </div><div class="col-3 form-group kclass" style="display: none">
                <label class="acies_label col-md-12">Key1</label>
                  <input type="text" name="datakey" class="form-control textInput" min="0">
              </div></div>`
        fieldPosition.append(specificElements)

      }
      if (selectedDataType == 'VideoField') {
        var specificElements = `<div class="row">
                          <div class="col-3 form-group">
                          <label class="acies_label" style="padding-left:0.3em;">Video Type1</label>
                          <select name="video_type_extension" id="video_type_extension" class="form-control select2 video_type_extension" style="margin-right: 15px;margin-top:-18px;">
                          <option value="external_link">External links (Youtube & Vimeo links)</option>
                          <option value="Video">Video files (mp4/webm/ogv)</option>
                          <option value="mp4">Video files (mp4 only)</option>
                          <option value="webm">Video files (webm only) </option>
                          <option value="ogv">Video files (ogv only)</option>
                        </select>
                </div></div>`
                fieldPosition.append(specificElements)
        $('#addelement_unique').parent().css("display","none");
        $('#unique').parent().css("display","none");
        $(".video_type_extension").val(attribute_details['video_type']).trigger("change")
        }
      if (selectedDataType == 'FileField') {
      var specificElements = `
              <div class="row">
                <div class="col-3 form-group">
                  <label class="acies_label" style="padding-left:0.3em;">Limit file extensions</label>
                  <select name="edit_extension" id="edit_extension" class="form-control select2 edit_extension" style="margin-right: 15px;margin-top:-18px;">
                    <option value="Any">Any</option>
                    <option value="Images">Images(All formats)</option>
                    <option value="PDF">PDF</option>
                    <option value="Document">Document(PDF, CSV, Excel, Word)</option>
                  </select>
                </div>
                <div class="col-3 form-group">
                  <label class="acies_label" style="padding-left:0.3em;">Limit file size (in KB)</label>
                  <input type="tel" name="edit_file_size" class="form-control numberinput" min="1" max="200000" id="edit_file_size"/>
                </div>
              </div>`
              fieldPosition.append(specificElements)
              $('#edit_file_size').on('input', function(){
                $(this).val($(this).val().replace(/[^0-9]/g, ''));
              });
      $(".edit_extension").val(attribute_details['File extension']).trigger("change")
      }
      if (selectedDataType == 'ConcatenationField') {

       var specificElements = `<div class="row">
                         <div class="col-3 form-group" >
                 <label class="acies_label col-md-12">Maximum length<span class="asteriskField">*</span></label>
                   <input type="number" name="edit_maxLength" class="form-control numberinput" min="0" value="` + attribute_details['Max Length'] + `"  />
               </div>
                </div>
                <div class = "row concat_field">
             <div class="col-4">
               <label class="acies_label">Columns</label>
               <select class="form-control" id="editform_multipleform_add" name="concat_columns" multiple="multiple" style="width:8em;padding:0px;border:0px solid black">
               </select>
             </div>
             <div class="col-4">
               <label class="acies_label">Divider</label>
               <select class="select2 editform_divider" name="divider" style="width:103.225px !important;">
                 <option value="" selected>No divider</option>
                 <option value="_">_</option>
                 <option value="*">*</option>
                 <option value="-">-</option>
                 <option value="+">+</option>
                 <option value="#">#</option>
                 <option value="$">$</option>
                 <option value="%">%</option>
                 <option value="@">@</option>
                 <option value="!">!</option>
                 <option value="&">&</option>
                 <option value=".">.</option>
                 <option value="?">?</option>
               </select>
             </div>
             <div class="col-4">

             </div>
           </div>`
       fieldPosition.append(specificElements)

       $('.editform_divider').val(attribute_details['divider']).trigger("change")

     }

     if (selectedDataType == 'DateRangeField') {

          $("#addelement_unique").val("No").change()
          $("#addelement_unique").attr('disabled', true)
          $("#unique").attr('disabled', true)

    }

     if (selectedDataType == 'UniqueIDField') {
      uuid_config = JSON.parse(attribute_details["uuid_config"])
      var specificElements = `<div class="row">
                         <div class="col-3" >
                 <label class="acies_label col-md-12">Maximum length<span class="asteriskField">*</span></label>
                   <input type="number" name="edit_maxLength" class="form-control" min="0" value="` + attribute_details['Max Length'] + `"  />
               </div>
                <div class="col-3" >
                    <label class="acies_label col-md-12" style="margin-left:3px;">Editable?</label>
                    <select class="form-control" name="editable">
                      <option value="No" disabled selected>No</option>
                    </select>
                </div>
               </div>
                <div class="row">
                <div class="col-4 m-2 form-inline">
              <label class="acies_label pr-2">UniqueIDField settings</label>
              <span id="edit_uuid_config" data-toggle="modal" data-target="#uuid_settings_modal" onclick="edit_uuid_modal(this)" name="">
                              <a data-toggle="tooltip" title="UniqueIDField settings" value="uuid_settings"><i name="actions" value="uuid_settings" class="far fa-edit ihover javaSC thin-icon" style="font-size: 18px "></i></a>
                  </span>
                </div></div>`
          fieldPosition.append(specificElements)
          $("#edit_uuid_config").attr('name', JSON.stringify(uuid_config))
          $("#id_type").on('change', function() {
            if ($('option:selected', `#id_type`).val() == "Alphanumeric") {
              $("#showhidealpha").css("display", "")
            }
            else {
              $("#showhidealpha").css("display", "none")
            }
          })
          $("select[name='editable']").attr("disabled", true)
          $("#null_field_edit").attr('disabled', true)
          $("#unique").attr('disabled', true)
          $("#id_type").val(uuid_config["id_type"]).change()
          $("#serial").val(uuid_config["serial"]).change()
          $("#id_length").val(uuid_config["id_length"])
          if($("#id_type").val() == "Alphanumeric") {
            $("#showhidealpha").css("display", "")
            $("#id_text").val(uuid_config["id_text"])
            $("#position").val(uuid_config["position"])
          }
       $('.editform_divider').val(attribute_details['divider']).trigger("change")
    }

    if (selectedDataType == 'DateTimeRangeField') {

          $("#addelement_unique").val("No").change()
          $("#addelement_unique").attr('disabled', true)
          $("#unique").attr('disabled', true)

      }

      if (selectedDataType == 'TimeRangeField') {

      $("#addelement_unique").val("No").change()
      $("#addelement_unique").attr('disabled', true)
      $("#unique").attr('disabled', true)

      }

      if (["CharField","TextField","IntegerField","BigIntegerField", "FloatField"].includes(selectedDataType)) {
        var specificElements = `<div class="row ml-0">`
        if (["IntegerField","BigIntegerField", "FloatField"].includes(selectedDataType)) {
          specificElements = specificElements + `<div class="col-3 form-group" >
            <label class="acies_label col-md-12" style="padding-left:3px;">Default</label>
            <input type="number" name="default" class="form-control numberinput" min="0" value="` + attribute_details['Default'] + `"/>
          </div>`
        }

        specificElements = specificElements + `<div class="col-3 form-group">
          <label class="acies_label col-md-12" style="padding-left:3px;">Editable?</label>
          <select class="select2 form-control" name="editable">
            <option value="" disabled>Select Option</option>`
        if (attribute_details['Editable'] == true) {
          specificElements = specificElements + `<option value="Yes" selected>Yes</option>
                                                  <option value="No">No</option>`
        } else {
          specificElements = specificElements + `<option value="Yes">Yes</option>
                                                  <option value="No" selected>No</option>`
        }
        specificElements = specificElements + `</select></div></div>`
        fieldPosition.append(specificElements)
      }
      if (["TextField","URLField"].includes(selectedDataType)) {
        if(attribute_details['Default'] == "null" || attribute_details['Default'] == null){
          def_val=""
        }else{
          def_val=attribute_details['Default']
        }
        var specificElements = `<div class="row">
                          <div class="col-3 form-group" >
                  <label class="acies_label col-md-12" style="padding-left:3px;">Default</label>
                    <input type="text" name="default" class="form-control" style="border: 1px solid #444;border-radius: 3px;" value="` + def_val + `"/>
                </div>
                <div class="col-3 form-group" >
                  <label class="acies_label col-md-12" style="padding-left:3px;">Blacklist Characters</label>
                    <select class="form-control multipleform_bklist_edit" multiple></select>
                </div>
                </div>`
        fieldPosition.append(specificElements)
      }
      if (['DateField', 'DateTimeField', 'TimeField'].includes(selectedDataType)) {
        var specificElements = `<div class="row ml-0">
                        <div class="col-3 form-group">
                    <label class="acies_label col-md-12" style="padding-left:3px;">Auto Now?</label>
                    <select class="select2 form-control" name="autoNow">
                      <option value="" disabled>Select Option</option>`

        if (attribute_details['Auto Now'] == true) {
          specificElements = specificElements + `<option value="Yes" selected>Yes</option>
                                                  <option value="No">No</option>`
        } else {
          specificElements = specificElements + `<option value="Yes">Yes</option>
                                                  <option value="No" selected>No</option>`
        }
        specificElements = specificElements + `</select>
                  </div>
                <div class="col-3 form-group">
                    <label class="acies_label col-md-12" style="padding-left:3px;">Editable?</label>
                    <select class="select2 form-control" name="editable">
                      <option value="" disabled>Select Option</option>`
        if (attribute_details['Editable'] == true) {
          specificElements = specificElements + `<option value="Yes" selected>Yes</option>
                                                  <option value="No">No</option>`
        } else {
          specificElements = specificElements + `<option value="Yes">Yes</option>
                                                  <option value="No" selected>No</option>`
        }
        if (selectedDataType != "DateField") {
        specificElements = specificElements + `</select>
                  </div>
                  <div class="col-3 form-group">
                    <label class="acies_label col-md-12" style="padding-left:3px;">Seconds precision?</label>
                    <select class="select2 form-control" name="useseconds">
                      <option value="" disabled>Select Option</option>
                      `
        if (attribute_details['Seconds precision'] == "true") {
          specificElements = specificElements + `<option value="true" selected>Yes</option>
        <option value="false">No</option></div></div>`
        } else {
          specificElements = specificElements + `<option value="true">Yes</option>
        <option value="false" selected>No</option></div></div>`
        }
        }
        else {
          specificElements = specificElements + `</select>
        </div></div>`
        }
        fieldPosition.append(specificElements)

      }

      if (selectedDataType == 'TableField') {
      table_config = JSON.parse(attribute_details["table_config"])
      var specificElements = `<div class="row">
                         <div class="col-3" >
                 <label class="acies_label col-md-12">Maximum length<span class="asteriskField">*</span></label>
                   <input type="number" name="edit_maxLength" class="form-control" min="0" value="` + attribute_details['Max Length'] + `" disabled />
               </div>
                <div class="col-3" >
                    <label class="acies_label col-md-12" style="margin-left:3px;">Editable?</label>
                    <select class="form-control" name="editable">
                      <option value="No" disabled selected>No</option>
                    </select>
                </div>
               </div>
                <div class="row">
                <div class="col-4 m-2 form-inline">
              <label class="acies_label pr-2">TableField settings</label>
              <span id="edit_table_config" data-toggle="modal" data-target="#table_settings_modal" onclick="edit_table_modal(this)" name="">
                              <a data-toggle="tooltip" title="TableField settings" value="table_settings"><i name="actions" value="table_settings" class="far fa-edit ihover javaSC thin-icon" style="font-size: 18px "></i></a>
                  </span>
                </div></div>`
          fieldPosition.append(specificElements)
          $("#edit_table_config").attr('name', JSON.stringify(table_config))
          $("select[name='editable']").attr("disabled", true)
          $("#null_field_edit").attr('disabled', false)
          $("#unique").attr('disabled', true)
          $('.editform_divider').val(attribute_details['divider']).trigger("change")
          $('.table_master_class').val(table_config['table_field_master']).trigger("change")
    }

      if (selectedDataType == 'CardField') {
      card_config = JSON.parse(attribute_details["card_config"])
      var specificElements = `<div class="row">
                         <div class="col-3" >
                 <label class="acies_label col-md-12">Maximum length<span class="asteriskField">*</span></label>
                   <input type="number" name="edit_maxLength" class="form-control" min="0" value="` + attribute_details['Max Length'] + `" disabled />
               </div>
                <div class="col-3" >
                    <label class="acies_label col-md-12" style="margin-left:3px;">Editable?</label>
                    <select class="form-control" name="editable">
                      <option value="No" disabled selected>No</option>
                    </select>
                </div>
               </div>
                <div class="row">
                <div class="col-4 m-2 form-inline" style="display:none;">
              <label class="acies_label pr-2">CardField settings</label>
              <span id="edit_card_config" data-toggle="modal" data-target="#card_settings_modal" onclick="edit_card_modal(this)" name="">
                              <a data-toggle="tooltip" title="CardField settings" value="card_settings"><i name="actions" value="card_settings" class="far fa-edit ihover javaSC thin-icon" style="font-size: 18px "></i></a>
                  </span>
                </div></div>`
          fieldPosition.append(specificElements)
          $("#edit_card_config").attr('name', JSON.stringify(card_config))
          $("select[name='editable']").attr("disabled", true)
          $("#null_field_edit").attr('disabled', false)
          $("#unique").attr('disabled', true)
          $('.editform_divider').val(attribute_details['divider']).trigger("change")

    }

    if (selectedDataType == 'PrivacyField') {
      privacy_config = JSON.parse(attribute_details["privacy_config"])
      var specificElements = `<div class="row">
               </div>
                <div class="row">
                <div class="col-4 m-2 form-inline">
              <label class="acies_label pr-2">PrivacyField settings</label>
              <span id="edit_privacy_config" data-toggle="modal" data-target="#privacy_settings_modal" onclick="edit_privacy_modal(this)" name="">
                              <a data-toggle="tooltip" title="PrivacyField settings" value="privacy_settings"><i name="actions" value="privacy_settings" class="far fa-edit ihover javaSC thin-icon" style="font-size: 18px "></i></a>
                  </span>
                </div></div>`
          fieldPosition.append(specificElements)
          if(privacy_config["privacy_option"]){
            $(".privacyf_selectop").val(privacy_config["privacy_option"]).trigger("change")
            $(".privacyf_selectop").val(privacy_config["privacy_option"]).trigger("select2:select")

            if(privacy_config.hasOwnProperty("master_table")){
              $(".privacy_master_table").val(privacy_config["master_table"]).trigger("change")
              $(".privacy_master_table").val(privacy_config["master_table"]).trigger("select2:select")

              $(".privacy_master_groupf").attr("data-reload",privacy_config["group_field"])
              $(".privacy_master_userf").attr("data-reload",privacy_config["user_field"])
            }
          }
          $("#edit_privacy_config").attr('name', JSON.stringify(privacy_config))
    }

    if (selectedDataType == 'CardCvvField') {
      var specificElements = `<div class="row">
                         <div class="col-3" >
                 <label class="acies_label col-md-12">Maximum length<span class="asteriskField">*</span></label>
                   <input type="number" name="edit_maxLength" class="form-control" min="0" value="` + attribute_details['Max Length'] + `" disabled />
               </div>
               </div>
                `
          fieldPosition.append(specificElements)
          $("#null_field_edit").attr('disabled', false)
          $("#unique").attr('disabled', true)
    }

    if (selectedDataType == 'CardExpiryField') {

        $("#null_field_edit").attr('disabled', false)
        $("#unique").attr('disabled', true)
    }

    if (selectedDataType == 'CardTypeField') {

          $("#null_field_edit").attr('disabled', false)
          $("#unique").attr('disabled', true)
    }

    if (selectedDataType == 'EmailTypeField') {
        var specificElements = `<div class="row ml-0">
                          <div class="col-3 form-group" >
                  <label class="acies_label col-md-12" style="padding-left:3px;">Maximum Length<span class="asteriskField">*</span></label>
                    <input type="number" name="maxLength" class="form-control numberinput" min="0" value="` + attribute_details['Max Length'] + `" />
                </div>
              </div>`
        fieldPosition.append(specificElements)

      }

      if (selectedDataType == 'RTFField') {
        var specificElements = `<div class="row ml-0">
                          <div class="col-3 form-group" >
                  <label class="acies_label col-md-12" style="padding-left:3px;">Maximum Length<span class="asteriskField">*</span></label>
                    <input type="number" name="maxLength" class="form-control numberinput" min="0" value="` + attribute_details['Max Length'] + `" />
                </div>
              </div>`
        fieldPosition.append(specificElements)

      }

      if (selectedDataType == 'MultiselectField') {
      mulsel_config = JSON.parse(attribute_details["mulsel_config"])
      var specificElements = `<div class="row">
                <div class="col-3" >
                    <label class="acies_label col-md-12" style="margin-left:3px;">Editable?</label>
                    <select class="form-control" name="editable">
                      <option value="No" disabled selected>No</option>
                    </select>
                </div>
               </div>
                <div class="row">
                <div class="col-4 m-2 form-inline">
              <label class="acies_label pr-2">MultiselectField settings</label>
              <span id="edit_mulsel_config" data-toggle="modal" data-target="#mulsel_settings_modal" onclick="edit_mulsel_modal(this)" name="">
                              <a data-toggle="tooltip" title="MultiselectField settings" value="mulsel_settings"><i name="actions" value="mulsel_settings" class="far fa-edit ihover javaSC thin-icon" style="font-size: 18px "></i></a>
                  </span>
                </div></div>`
          fieldPosition.append(specificElements)
          $("#edit_mulsel_config").attr('name', JSON.stringify(mulsel_config))
          $("select[name='editable']").attr("disabled", true)
          $("#null_field_edit").attr('disabled', false)
          $("#unique").attr('disabled', true)
          $('.editform_divider').val(attribute_details['divider']).trigger("change")
          $(".multipleSelectedColumn").val($('#selectedElement').text()).trigger("change")
          $('.selectMultipleFormTable').val(mulsel_config["value"][0]).trigger('change')
          if(mulsel_config["plusBtn"][$('#selectedElement').text()]){
            $('.plus').prop("checked",true)
          }
          if(mulsel_config["popUpOption"][$('#selectedElement').text()]["popupCheckbox"]=="true"){
            $('.option_popup').prop("checked",true)
          }
          $('#additionalInfoCB').prop('checked', mulsel_config.additionalInfoBtn === true);
          for(let t = 0; t < mulsel_config.checkBox.length; t++) {
            if (mulsel_config.checkBox[t] == 1) {
              $('.defaultValue').eq(t).prop('checked',true);
            } else {
              $('.defaultValue').eq(t).prop('checked',false);
            }
            if (mulsel_config["condition"].length > 0){
              $(".multiselectButton").eq(t).attr("data-data",JSON.stringify(mulsel_config["condition"][t]));
            } else {
              $(".multiselectButton").eq(t).attr("data-data",JSON.stringify([]));
            }
          }

          var ok = mulsel_config.masterColumn;
          var ok1 = mulsel_config.add;
          var m = mulsel_config.master;
          var ok2 = [];
          if(Object.prototype.hasOwnProperty.call(mulsel_config, 'def_MulVal')){
            ok2 = mulsel_config.def_MulVal;
          }

          $.ajax({
            url:`/users/${urlPath}/processGraphModule/`,

            data: {
              'operation': 'formTableMiltipleFieldsUnique',
              'tablesForm': JSON.stringify(mulsel_config["value"]),
            },
            type: "POST",
            dataType: "json",
            success: function (data) {
                $('.selectTableColumns').empty()
                for (j in data.finalFieldList) {
                  $('.selectTableColumns').append(
                    `<option value="${data.finalFieldList[j]['fieldName']}">${data.finalFieldList[j]['fieldVerbose']}</option>`
                  );
                }

              $('.selectTableColumns').off('change').on('change',fillcolvalMul)

                  $('.selectTableColumns').attr("data-data",JSON.stringify(ok2[0]))

                $('.selectTableColumns').val(ok[0]).trigger('change');
            },
            error: function () {
              Swal.fire({icon: 'error',text: 'Error! Please try again.'});
            }
          })

          $.ajax({
            url: `/users/${urlPath}/processGraphModule/`,

            data: {
              'operation': 'formTableMiltipleFields',
              'tablesForm': JSON.stringify(mulsel_config["value"]),
            },
            type: "POST",
            dataType: "json",
            success: function (data) {

                $('.additional').empty();
                for (j in data.finalFieldList) {
                  $('.additional').append(
                    `<option value="${data.finalFieldList[j]['fieldName']}">${data.finalFieldList[j]['fieldVerbose']}</option>`
                  )
                }

              for(j_ in ok1) {
                $('.additional').val(ok1[j_]).trigger('change');
              }
            },
            error: function () {
              Swal.fire({icon: 'error',text: 'Error! Please try again.'});
            }
          })
    }

    $('select.select2:not(.modal select.select2)').each(function(){
      parent = $(this).parent()
      $(this).select2({dropdownParent:parent})
  })
  $('.modal select.select2').each(function(){
      $(this).select2()
  })
      $("#editform_multipleform_add").select2({
      })

      $(".select2_multiplechoices_edit").select2({
        tags:true
      })

      $(".multipleform_bklist_edit").select2({
        tags:true
      })

      if(attribute_details['Choices'] != undefined)
      {
      for (var i = 0; i < attribute_details['Choices'].length; i++) {

          $('.select2_multiplechoices_edit').append(`<option value="${attribute_details['Choices'][i]}">
            ${attribute_details['Choices'][i]}
                                  </option>`);
       }
      $('.select2_multiplechoices_edit').val(attribute_details['Choices']).trigger("change")

      }

      if(attribute_details['Blacklist Characters'] != undefined)
      {
      for (var i = 0; i < attribute_details['Blacklist Characters'].length; i++) {

          $('.multipleform_bklist_edit').append(`<option value="${attribute_details['Blacklist Characters'][i]}">
            ${attribute_details['Blacklist Characters'][i]}
                                  </option>`);
       }
      $('.multipleform_bklist_edit').val(attribute_details['Blacklist Characters']).trigger("change")

      }

      if(attribute_details['Computed Input'] != undefined)
      {

        $.ajax({
            url: window.location.pathname,
            data: {
              'operation': 'get_table_fields',
              'model_name': model_name,
            },
            type: "POST",
            dataType: "json",
            async: false,
            success: function (data) {

                val_set = []
                $('.multipleform_compInp_edit').empty();
                for(let [key,value] of Object.entries(data)){
                  $('.multipleform_compInp_edit').append(
                    `<option value="${value}">${key}</option>`
                  )
                  if(attribute_details['Computed Input'].includes(value)){
                    val_set.push(value)
                  }
                }

                $('.multipleform_compInp_edit').val(val_set).trigger("change")
            },
            error: function () {
              Swal.fire({icon: 'error',text: 'Error! Please try again.'});
            }
          })
      }else{
        $.ajax({
            url: window.location.pathname,
            data: {
              'operation': 'get_table_fields',
              'model_name': model_name,
            },
            type: "POST",
            dataType: "json",
            async: false,
            success: function (data) {

                $('.multipleform_compInp_edit').empty();
                for(let [key,value] of Object.entries(data)){
                  $('.multipleform_compInp_edit').append(
                    `<option value="${value}">${key}</option>`
                  )
                }

            },
            error: function () {
              Swal.fire({icon: 'error',text: 'Error! Please try again.'});
            }
          })
      }

      var child_list = ($("#myList")[0].children.length)

      var name;
      for (var i = 1; i < child_list; i++) {
        name = $("#myList")[0].children[i].innerHTML
        if(!((name == "created_date") || (name == "modified_date") || (name =="created_by") || (name == "modified_by")))
         {
          $('#editform_multipleform_add').append(`<option value="${name}">
                                       ${name}
                                  </option>`);
         }
       }

       if (attribute_details.hasOwnProperty("columns")) {
        $('#editform_multipleform_add').val(JSON.parse(attribute_details['columns'])).trigger("change")
       }
       $(".enclass").on("change", function() {
        if($(this).val() != "None"){
          $(".kclass").show();
          $('.kclass').find("input").prop("disabled", false);
        }
        else {
            $(".kclass").hide();
        }
    })
       if (attribute_details.hasOwnProperty("secure_with")) {
        if (attribute_details["secure_with"] != "None") {
          $('.enclass').val(attribute_details['secure_with']).trigger("change")
          $('.kclass').find("input").prop("disabled", true);
        }
       }

       if(table_type == "System"){
          $('#editattr_modal').find('.fields').find('input,select,textarea:visible').each(function(){
              if($(this).attr('name') != "Field Verbose Name"){
                  $(this).attr('disabled',true)
              }
          })
       }
    }
  })


  let parent_table_change= false

    // Configure Data Mapper for foreign Key
  $(document).on('click','.configureforeignkey',function(){
    var fieldDict = {}
    Swal.fire({
      icon:'question',
      text: "Change this Parent Table? \n\nClick 'Yes' to confirm or click 'No' if you do not wish to change it.",
      showDenyButton: true,
      showCancelButton: true,
      confirmButtonText: 'Yes',
      denyButtonText: 'No1',
    }).then((result) => {
      if (result.isConfirmed) {
        var fieldsTotal = $('.modalbody2').find('.fields').each(function () {
          if ($(this).find('input[name="Field DataType"]').val()) {
            fieldDict['fieldDatatype'] = $(this).find('input[name="Field DataType"]').val()
          }
          if ($(this).find('select[name="Field DataType"]').val()) {
            fieldDict['fieldDatatype'] = $(this).find('select[name="Field DataType"]').val()
          }
          if (fieldDict['fieldDatatype'] == 'ForeignKey') {
            fieldDict['fieldFKTable'] = $("#relTable").find('tr td:first-child')[0].innerText
            fieldDict['fieldRelatedName'] = $(this).find('input[name="FKRelated Name"]').val()
              fieldDict['fieldParentFKTable'] = $("#parent_table_edit_dm").val()
            fieldDict['fieldRelatedColumn'] =$('#selectedElement').text()
          }
          fieldDict['fieldName'] = $('#selectedElement').text()
        })
        let newParentTableName =  $(this).attr('data-current-table')
        let childTable  = $(".dataElements").find("p").text()
        let columnName = $('#selectedElement').text()
        $.ajax({
          url: window.location.pathname,
          data: { 'parent_tablename': newParentTableName,'child_tablename':childTable ,'fieldDict': JSON.stringify(fieldDict), 'operation': 'configureForeignMapper' },
          type: "POST",
          dataType: "json",
          success: function(data){
            $("#configureforeignkey_save").attr('data-current-table',newParentTableName)
            if(data.model_status == true){
            $("#mapper_modal").modal("show")
            $("#mapper_modal_datatable"+"_wrapper").remove()
            $("#mapper_modal_datatable").remove()
            var customDatatable=`
            <table id="mapper_modal_datatable" class="row-border display" style="width: 100%;">
            <thead>
              <th scope="col">Table name</th>
              <th scope="col">Change Value</th>
              <th scope="col">New Value</th>
            </thead>
            <tbody id="mapper_modal_content">

            </tbody>
          </table>`
          $("#mapper_modal_main_body").append(customDatatable)
          $("#mapper_modal_content").empty()
          var old_data = JSON.parse(data.field_data.old_value)
          var change_data = JSON.parse(data.field_data.change_value)
          for(i of old_data){
            $("#mapper_modal_content").append(`<tr> <td>${newParentTableName}</td>  <td data-old-id=${i[Object.keys(i)[0]]} >${i[Object.keys(i)[1]]}</td>  <td><select class="form-control select2 foreign_select_changes"   aria-hidden="true"></select></td> </tr>`)
          }
          $(".foreign_select_changes").append(`<option data-change-id="">NULL</option`)
          for(j of change_data){
            $(".foreign_select_changes").append(`<option data-change-id=${j[Object.keys(j)[0]]}> ${j[Object.keys(j)[1]]}</option`)
          }
          $(".foreign_select_changes").select2({width:'100%'})
            }else{
              $("#parent_table_edit_dm").val(newParentTableName).trigger('change')
              parent_table_change =true
            }
          },
          error: function () {
            Swal.fire({icon: 'error',text: 'Error! Please try again.'});
          }
        });
      }
    });
  });


  // Parent Table Change, Update  Datatable

  $("#parent_table_edit_dm").on('change',function(){
       //Populate the Datatable with table names
       html_conf =""

var value1 = $('#selectedElement').text().toLowerCase();
var parent_changed_name = $(this).val()
var newTableName = $(".dataElements").find("p").text()
var table_not_list =[]
if( newTableName && parent_changed_name){
  table_not_list.push(parent_changed_name)
table_not_list.push(newTableName)
}

  if (value1 !== "") {
col_dict = {}
col_list = []
name_list = []
final_list = []
$.each($search, function (key, value) {
var jk = [key]
for (val in jk) {
  $.each(jk, function () {

    $.each(value, function (index, value) {
      if (value.match(value1) !== null) {
        col_list.push(value);
        $.each(col_list, function (index, name) {
          col_dict[key] = name
          name_list.push(col_dict)
          col_list = []
          col_dict = {}
        }
        )
      }
    });
  }
  )
}
})

$.each(name_list, function (index, name) {
$.each(name, function (key2, val2) {
  if(!table_not_list.includes(key2)){

    html_conf += '<tr> <td id="tab_name_conf" style="width:50px">' + key2 + '</td> <td id="col_name_conf" style="width:50px;text-align:center">' + val2 + '</td> <td style="padding-left:7px;width:20px;"><a title="Change Parent Table" value="update" ><i name="actions" value="update" class="configureforeignkey fa fa-plus-square fa-2x" style="color:var(--primary-color);" data-current-table='+key2+'></i></a></td></tr>';

  }

})
})

}




if($.fn.dataTable.isDataTable('#dynamicsearchfield_foreign')){

$('#dynamicsearchfield_foreign').DataTable().clear().destroy()
}

$("#dynamicsearchfield_foreign"+"_wrapper").remove()
$("#dynamicsearchfield_foreign").remove()
var customDatatable=`
<table id="dynamicsearchfield_foreign" class="row-border display" style="width: 100%;">
      <thead>
        <th scope="col">Table name</th>
        <th scope="col">Column name</th>
        <th scope="col">Action</th>
      </thead>
      <tbody id="dynamic_foreign">
        ${html_conf}
      </tbody>
    </table>
`
$("#dynamicsearchfield_layer_foreign").append(customDatatable)


  $('#dynamicsearchfield_foreign').DataTable({
"paging": false,
"ordering": false,
"info": false,
"searching": false,
"autoWidth": true,
"scrollY": "200px",
"sScrollX": "110%",
"scrollX":true,
"scrollCollapse": true,

columnDefs: [
  {
    targets: "_all",
    className: 'dt-center allColumnClass all'
  }
  ],

});



  })

  var finalize_list=[]
  // Configure Foreign Save Change
  $(document).on('click',"#configureforeignkey_save",function(){
    finalize_list=[]
    let newParentTableName =  $(this).attr('data-current-table')
    $("#mapper_modal_content tr").each(function(){
      changed_value_dict ={}
      changed_value_dict['ref_id'] = $(this).find("td").eq(1).attr('data-old-id')
      changed_value_dict['new_id'] =$(this).find("td").eq(2).find('select option:selected').attr('data-change-id')
      finalize_list.push(changed_value_dict)
    })
    $("#parent_table_edit_dm").val(newParentTableName).trigger('change')
    parent_table_change =true
  })




  function editattributes() {
    var newTableName = $(".dataElements").find("p").text()
    var selectedDataType = $("#field_datatype").val();
    var create_table_flag = true;
    var val_msg = "";
    var check_model_compeq = []
    $('.modalbody2').find('.fields').each(function () {
      if($(this).find('input[name="ComputedValue2"]').eq(0).is(":checked")){
        $.ajax({
          url: window.location.pathname,
          data: { 'model_name': newTableName, 'operation': 'check_model_compeq'},
          type: "POST",
          async: false,
          dataType: "json",
          success: function(data) {
            var check_model_compeq_data = JSON.parse(data.data)
            for (i in check_model_compeq_data["element_name"]) {
              if(check_model_compeq_data["element_name"][i] != null) {
                check_model_compeq.push(check_model_compeq_data["element_name"][i].slice(newTableName.length,-10))
              }
            }
          }
          }).done(function() {
              if(!check_model_compeq.includes($("#selectedElement").text())) {
                val_msg += `<li><p>${$("#selectedElement").text()} : <em style="color:red;font-style:normal">No Computation configured</em></p></li>`
                create_table_flag = false;
              }
          })
      }

      if (selectedDataType == 'CharField') {
        if ($(this).find('input[name="maxLength"]').val() == "") {
          val_msg += `<li><p>${$("#selectedElement").text()} : <em style="color:red;font-style:normal">'Maximum length' cannot be empty.</em></p></li>`
          create_table_flag = false;
        }
        if(!["None", null].includes($(".enclass").val())) {
        if($(".kclass").find("input").val() == "") {
          val_msg += `<li><p>${$("#selectedElement").text()} : <em style="color:red;font-style:normal">No key entered configured and key cannot be changed if it is already present. </em></p></li>`
          create_table_flag = false
        }
        }
      }
      else if (selectedDataType == 'ConcatenationField') {
        if ($(this).find('input[name="edit_maxLength"]').val() == "") {
          val_msg += `<li><p>${$("#selectedElement").text()} : <em style="color:red;font-style:normal">'Maximum length' cannot be empty.</em></p></li>`
          create_table_flag = false;
        }
        if ($("#editform_multipleform_add").val().length == 0) {
          val_msg += `<li><p>${$("#selectedElement").text()} : <em style="color:red;font-style:normal">Columns not configured for ConcatenationField</em></p></li>`
          create_table_flag = false;
        }
        if ($(".edit_divider").val() == "") {
          val_msg += `<li><p>${$("#selectedElement").text()} : <em style="color:red;font-style:normal">Divider not configured for ConcatenationField</em></p></li>`
          create_table_flag = false;
        }
      }
      else if (selectedDataType == 'UniqueIDField') {
        if($('#edit_uuid_config').attr("name") == "") {
          val_msg += `<li><p>${$("#selectedElement").text()} : <em style="color:red;font-style:normal">No UniqueIDField settings configured</em></p></li>`
          create_table_flag = false
        }
      }
      else if (["DateField", "TimeField", "DateTimeField"].includes(selectedDataType)) {
         if($(this).find('select[name="autoNow"]').val() == null) {
          val_msg += `<li><p>${$("#selectedElement").text()} : <em style="color:red;font-style:normal">Autonow not configured for ${selectedDataType}</em></p></li>`
          create_table_flag = false;
          }
         if($(this).find('select[name="editable"]').val() == null) {
          val_msg += `<li><p>${$("#selectedElement").text()} : <em style="color:red;font-style:normal">Editable not configured for ${selectedDataType}</em></p></li>`
          create_table_flag = false;
          }
      }
      else if (selectedDataType == 'CardField') {
        if($('#edit_card_config').attr("name") == "") {
          val_msg += `<li><p>${$("#selectedElement").text()} : <em style="color:red;font-style:normal">No CardField settings configured</em></p></li>`
          create_table_flag = false
        }
      }
      else if (selectedDataType == 'PrivacyField') {
        if($('#edit_privacy_config').attr("name") == "") {
          val_msg += `<li><p>${$("#selectedElement").text()} : <em style="color:red;font-style:normal">No PrivacyField settings configured</em></p></li>`
          create_table_flag = false;
        }
      }
      else if (selectedDataType == 'TableField') {
        if($('#edit_table_config').attr("name") == "") {
          val_msg += `<li><p>${$("#selectedElement").text()} : <em style="color:red;font-style:normal">No TableField settings configured</em></p></li>`
          create_table_flag = false
        }
      }
      else if (["CardCvvField", "CardExpiryField", "CardTypeField"].includes(selectedDataType)) {
          val_msg += `<li><p>${$("#selectedElement").text()} : <em style="color:red;font-style:normal">Kindly delete the card field and create a new one if you wish to make changes to ${selectedDataType}</em></p></li>`
          create_table_flag = false
      }
      else if (selectedDataType == 'EmailTypeField') {
        if ($(this).find('input[name="maxLength"]').val() == "") {
          val_msg += `<li><p>${$("#selectedElement").text()} : <em style="color:red;font-style:normal">'Maximum length cannot be empty.</em></p></li>`
          create_table_flag = false;
        }
      }
      else if (selectedDataType == 'RTFField') {
        if ($(this).find('input[name="maxLength"]').val() == "") {
          val_msg += `<li><p>${$("#selectedElement").text()} : <em style="color:red;font-style:normal">'Maximum length cannot be empty.</em></p></li>`
          create_table_flag = false;
        }
      }
      else if (selectedDataType == 'MultiselectField') {
        if($('#edit_mulsel_config').attr("name") == "") {
          val_msg += `<li><p>${$("#selectedElement").text()} : <em style="color:red;font-style:normal">No MultiselectField settings configured</em></p></li>`
        }
      }
      });
      if(!create_table_flag) {
        $("#validation_cap_error_main_body").empty()
        $("#validation_cap_error_main_body").append(`<ul style='list-style-type: disc;font-size: 13px;overflow: auto;'>${val_msg}</ul>`)
        $("#validation_cap_error").modal('show')
      } else {
        if(!auditFields.includes($("#selectedElement").text())){
          $(".saveEdit").html('Generating report <i class="fa fa-circle-notch fa-spin"></i>')
          var newTableName = $(".dataElements").find("p").text()
          checkChangedConfig(newTableName,"Characteristics of column have been changed",".saveEdit","editattr_modal","edit")
        } else{
          Swal.fire({icon: 'warning',text: 'Audit fields cannot be edited.'});
        }
      }
  }
  function editattributes1() {
    var fieldList = []

    var fieldsTotal = $('.modalbody2').find('.fields').each(function () {
      var fieldDict = {}

      if ($(this).find('input[name="Field DataType"]').val()) {
        fieldDict['fieldDatatype'] = $(this).find('input[name="Field DataType"]').val()
      }
      if ($(this).find('select[name="Field DataType"]').val()) {
        fieldDict['fieldDatatype'] = $(this).find('select[name="Field DataType"]').val()
      }
      fieldDict['fieldVerboseName'] = $(this).find('input[name="Field Verbose Name"]').val()
      fieldDict['fieldNull'] = $(this).find('select[name="null_field"]').val()
      fieldDict['fieldUnique'] = $(this).find('select[name="unique"]').val()
      if($(this).find('input[name="ComputedValue2"]').eq(0).is(":checked")){
        fieldDict['computedValue'] = "Yes"
      }else if ($(this).find('input[name="ComputedValue2"]').eq(0).is(":not(:checked)")){
        fieldDict['computedValue'] = "No"
      }
      if(fieldDict['computedValue'] == "Yes"){
        fieldDict['computed_input'] = $(this).find('.multipleform_compInp_edit').val()
      }
      if (fieldDict['fieldDatatype'] == 'CharField') {
        fieldDict['fieldMaxLength'] = $(this).find('input[name="maxLength"]').val()
        fieldDict['fieldChoices'] = $(this).find('select[name="choices"]').val()
        fieldDict["secure_with"] = $(".enclass").val()
        if(!["None", null].includes($(".enclass").val())) {
          if($(".kclass").find("input").val() != "") {
            fieldDict["datakey"] = $(".kclass").find("input").val()
          }
        }
      }
      if (fieldDict['fieldDatatype'] == 'ConcatenationField') {
        fieldDict['fieldMaxLength'] = $(this).find('input[name="edit_maxLength"]').val()
        fieldDict['columns'] = JSON.stringify(($(this).find('select[name="concat_columns"]').val()))
        fieldDict['divider'] = $(this).find('select[name="divider"]').val()
        fieldDict['fieldEditable'] = "No"
      }
      if (fieldDict['fieldDatatype'] == 'UniqueIDField') {
        fieldDict['fieldMaxLength'] = $(this).find('input[name="edit_maxLength"]').val()
        fieldDict['fieldEditable'] = "No"
        fieldDict['uuid_config'] = $('#edit_uuid_config').attr("name")
      }
      if (fieldDict['fieldDatatype'] == 'TimeRangeField') {
        fieldDict['timerange_type'] = 1
      }
      if (fieldDict['fieldDatatype'] == 'FileField') {
        fieldDict['file_extension'] = $(this).find('select[name="edit_extension"]').val()
        fieldDict['file_size'] = $(this).find('input[name="edit_file_size"]').val();
      }
      if (fieldDict['fieldDatatype'] == 'VideoField') {
        fieldDict['video_type'] = $(this).find('select[name="video_type_extension"]').val()
      }
      if (fieldDict['fieldDatatype'] == 'DateRangeField') {
        fieldDict['daterange_type'] = 1
      }
      if (fieldDict['fieldDatatype'] == 'ForeignKey') {
        fieldDict['fieldFKTable'] = $("#relTable").find('tr td:first-child')[0].innerText
        fieldDict['fieldRelatedName'] = $(this).find('input[name="FKRelated Name"]').val()
        if(parent_table_change){
          fieldDict['fieldParentFKTable'] = $("#parent_table_edit_dm").val()
          fieldDict['fieldRelatedColumn'] =$('#selectedElement').text()
          if(finalize_list.length > 0){
            fieldDict['fieldChangedValue'] = finalize_list
          }
        }
      }
      if (fieldDict['fieldDatatype'] == 'DateTimeRangeField') {
        fieldDict['datetimerange_type'] = 1
      }
      if (["ImageField"].includes(fieldDict['fieldDatatype'])) {

      }
      if (["CharField", "TextField", "URLField"].includes(fieldDict['fieldDatatype'])) {
        fieldDict['blacklist_chars'] = $(this).find('.multipleform_bklist_edit').val()
      }
      if (["IntegerField","BigIntegerField", "FloatField", "CharField", "TextField", "URLField"].includes(fieldDict['fieldDatatype'])) {
        fieldDict['fieldDefault'] = $(this).find('input[name="default"]').val()
      }
      if (["CharField","TextField","IntegerField","BigIntegerField", "FloatField"].includes(fieldDict['fieldDatatype'])) {
        fieldDict['fieldEditable'] = $(this).find('select[name="editable"]').val()
      }
      if (["DateField", "TimeField", "DateTimeField"].includes(fieldDict['fieldDatatype'])) {
        fieldDict['fieldAutoNow'] = $(this).find('select[name="autoNow"]').val()
        fieldDict['fieldEditable'] = $(this).find('select[name="editable"]').val()
        if(fieldDict['fieldDatatype'] != "DateField") {
          fieldDict['fieldUseSeconds'] = $(this).find('select[name="useseconds"]').val()
        }
      }
      if (fieldDict['fieldDatatype'] == 'CardField') {
        fieldDict['fieldMaxLength'] = 19
        fieldDict['card_config'] = $('#edit_card_config').attr("name")
      }
      if (fieldDict['fieldDatatype'] == 'PrivacyField') {
        fieldDict['privacy_config'] = $('#edit_privacy_config').attr("name")
      }
      if (fieldDict['fieldDatatype'] == 'TableField') {
        fieldDict['fieldMaxLength'] = 19
        fieldDict['table_config'] = $('#edit_table_config').attr("name")
      }
      if (fieldDict['fieldDatatype'] == 'CardCvvField') {
        fieldDict['fieldMaxLength'] = 4
      }
      if (fieldDict['fieldDatatype'] == 'CardTypeField') {
        fieldDict['fieldMaxLength'] = 15
      }
      if (fieldDict['fieldDatatype'] == 'EmailTypeField') {
        fieldDict['fieldMaxLength'] = $(this).find('input[name="maxLength"]').val()
      }
      if (fieldDict['fieldDatatype'] == 'RTFField') {
        fieldDict['fieldMaxLength'] = $(this).find('input[name="maxLength"]').val()
      }
      if (fieldDict['fieldDatatype'] == 'MultiselectField') {
        fieldDict['mulsel_config'] = $('#edit_mulsel_config').attr("name")
      }

      fieldDict['fieldName'] = $('#selectedElement').text()
      fieldList.push(fieldDict)
    })

    var newTableName = $(".dataElements").find("p").text()
    var currentDevMode = "{{current_dev_mode}}"
            var mode_list=["Edit","Build"]
    if(mode_list.includes(currentDevMode.trim())){

        $.ajax({
                url: window.location.pathname,
                data: {
                'operation': "fetchDependenciesDataManagement",
                'name': newTableName,
                },
                type: "POST",
                dataType: "json",
                success: function (data) {
                if (data.appDependency.length > 0) {
                  $('#dependencyTable').empty()

                            for(var i=0;i<data.appDependency.length;i++){
                                 $('#dependencyTable').append(`<tr><td style="font-weight:bold">${i+1}.</td><td style="font-weight:bold;text-align:start">&nbsp;&nbsp;${data.appDependency[i]}</td></tr>`)
                            }
                             $('#dependencyChecker').modal('show')
                             $('#btn_dependencySave').off('click').on('click',function(){

                      $.ajax({
                        url: window.location.pathname,
                        data: { 'tablename': newTableName, 'fieldDict': JSON.stringify(fieldList), 'operation': 'allow_editattributes' },
                        type: "POST",
                        dataType: "json",
                        success: function (data) {
                          if(data.error == "yes"){
                            Swal.fire({
                                        icon:'question',
                                        text: data.msg,
                                        showDenyButton: true,
                                        showCancelButton: true,
                                        confirmButtonText: 'Yes',
                                        denyButtonText: 'No',
                                      }).then((result) => {
                                        if (result.isConfirmed) {
                                          $.ajax({
                                                  url: window.location.pathname,
                                                  data: { 'tablename': newTableName, 'fieldDict': JSON.stringify(fieldList), 'operation': 'editattributes', 'drop_n_create': 'yes' },
                                                  type: "POST",
                                                  dataType: "json",
                                                  success: datatableReload,
                                                  error: function () {
                                                    Swal.fire({icon: 'error',text: 'Error! Please try again.'});
                                                  }
                                                })
                                        }
                                      })
                          }else{
                              $.ajax({
                              url: window.location.pathname,
                              data: { 'tablename': newTableName, 'fieldDict': JSON.stringify(fieldList), 'operation': 'editattributes' },
                              type: "POST",
                              dataType: "json",
                              success: datatableReload,
                              error: function () {
                                Swal.fire({icon: 'error',text: 'Error! Please try again.'});
                              }
                            })
                          }
                        },
                        error: function () {
                          Swal.fire({icon: 'error',text: 'Error! Please try again.'});
                        }
                      })

                        function datatableReload(data) {
                          regenrateHtml()
                        $(this).find('form').trigger('reset');
                        $('#editattributes').modal('hide')
                        var name_detail1 = JSON.parse(data)[0]
                        if(name_detail1['Data Type'] == 'ForeignKey' ){
                      if('fieldParentFKTable' in name_detail1){
                          if(name_detail1["unique_check"]){
                            Swal.fire({icon: 'info',text: 'Current column / element has unique value.'});
                          }else{

                            $("#rel_tab").text(name_detail1['fieldParentFKTable']).trigger('change')
                            delete name_detail1['fieldParentFKTable']
                            delete name_detail1["unique_check"]
                            Swal.fire({icon: 'success',text: 'Attribute details have been updated successfully!'});
                            $('#myTable').empty()
                            for (y in name_detail1) {

                          if(y == "Computed Value" && name_detail1[y] == true){

                            $('#myTable').append("<tr> <td>" + y + "</td> <td>" + name_detail1[y] + "<a data-toggle='tooltip' title='View Configuration' value='eq'><i name='actions1' value='eq' class='fas fa-square-root-alt ihover javaSC thin-icontrash attr_equ_btn' style='font-size: 18px;margin-left: 13px;'></i></a>" + "</td> </tr>");

                            }else{
                            $('#myTable').append("<tr> <td>" + y + "</td> <td>" + name_detail1[y] + "</td> </tr>");
                            }
                        }
                          }
                      }else{
                        Swal.fire({icon: 'success',text: 'Attribute details have been updated successfully!'});
                        $('#myTable').empty()
                        for (y in name_detail1) {

                          if(y == "Computed Value" && name_detail1[y] == true){

                            $('#myTable').append("<tr> <td>" + y + "</td> <td>" + name_detail1[y] + "<a data-toggle='tooltip' title='View Configuration' value='eq'><i name='actions1' value='eq' class='fas fa-square-root-alt ihover javaSC thin-icontrash attr_equ_btn' style='font-size: 18px;margin-left: 13px;'></i></a>" + "</td> </tr>");

                            }else{
                            $('#myTable').append("<tr> <td>" + y + "</td> <td>" + name_detail1[y] + "</td> </tr>");
                            }
                        }
                      }
                      }else{
                        Swal.fire({icon: 'success',text: 'Attribute details have been updated successfully!'});
                        $('#myTable').empty()
                        $("#relTable").empty()

                        for (y in name_detail1) {

                          if(y == "Computed Value" && name_detail1[y] == true){

                            $('#myTable').append("<tr> <td>" + y + "</td> <td>" + name_detail1[y] + "<a data-toggle='tooltip' title='View Configuration' value='eq'><i name='actions1' value='eq' class='fas fa-square-root-alt ihover javaSC thin-icontrash attr_equ_btn' style='font-size: 18px;margin-left: 13px;'></i></a>" + "</td> </tr>");

                            }else{
                            $('#myTable').append("<tr> <td>" + y + "</td> <td>" + name_detail1[y] + "</td> </tr>");
                            }
                        }

                      }
                      }
                    })
                } else {
                  $.ajax({
                        url: window.location.pathname,
                        data: { 'tablename': newTableName, 'fieldDict': JSON.stringify(fieldList), 'operation': 'allow_editattributes' },
                        type: "POST",
                        dataType: "json",
                        success: function (data) {
                          if(data.error == "yes"){
                            Swal.fire({
                                        icon:'question',
                                        text: data.msg,
                                        showDenyButton: true,
                                        showCancelButton: true,
                                        confirmButtonText: 'Yes',
                                        denyButtonText: 'No',
                                      }).then((result) => {
                                        if (result.isConfirmed) {
                                          $.ajax({
                                                  url: window.location.pathname,
                                                  data: { 'tablename': newTableName, 'fieldDict': JSON.stringify(fieldList), 'operation': 'editattributes', 'drop_n_create': 'yes' },
                                                  type: "POST",
                                                  dataType: "json",
                                                  success: datatableReload,
                                                  error: function () {
                                                    Swal.fire({icon: 'error',text: 'Error! Please try again.'});
                                                  }
                                                })
                                        }
                                      })
                          }else{
                              $.ajax({
                              url: window.location.pathname,
                              data: { 'tablename': newTableName, 'fieldDict': JSON.stringify(fieldList), 'operation': 'editattributes' },
                              type: "POST",
                              dataType: "json",
                              success: datatableReload,
                              error: function () {
                                Swal.fire({icon: 'error',text: 'Error! Please try again.'});
                              }
                            })
                          }
                        },
                        error: function () {
                          Swal.fire({icon: 'error',text: 'Error! Please try again.'});
                        }
                      })

                      function datatableReload(data) {
                        regenrateHtml()
                        $(this).find('form').trigger('reset');
                        $('#editattributes').modal('hide')
                        var name_detail1 = JSON.parse(data)[0]
                        if(name_detail1['Data Type'] == 'ForeignKey' ){
                      if('fieldParentFKTable' in name_detail1){
                          if(name_detail1["unique_check"]){
                            Swal.fire({icon: 'info',text: 'Current column / element has unique value.'});
                          }else{
                            $("#rel_tab").text(name_detail1['fieldParentFKTable']).trigger('change')
                            delete name_detail1['fieldParentFKTable']
                            delete name_detail1["unique_check"]
                            Swal.fire({icon: 'success',text: 'Attribute details have been updated successfully!'});
                            $('#myTable').empty()
                            for (y in name_detail1) {

                          if(y == "Computed Value" && name_detail1[y] == true){

                            $('#myTable').append("<tr> <td>" + y + "</td> <td>" + name_detail1[y] + "<a data-toggle='tooltip' title='View Configuration' value='eq'><i name='actions1' value='eq' class='fas fa-square-root-alt ihover javaSC thin-icontrash attr_equ_btn' style='font-size: 18px;margin-left: 13px;'></i></a>" + "</td> </tr>");

                            }else{
                            $('#myTable').append("<tr> <td>" + y + "</td> <td>" + name_detail1[y] + "</td> </tr>");
                            }
                        }
                          }
                      }else{
                        Swal.fire({icon: 'success',text: 'Attribute details have been updated successfully!'});
                        $('#myTable').empty()
                        for (y in name_detail1) {

                          if(y == "Computed Value" && name_detail1[y] == true){

                            $('#myTable').append("<tr> <td>" + y + "</td> <td>" + name_detail1[y] + "<a data-toggle='tooltip' title='View Configuration' value='eq'><i name='actions1' value='eq' class='fas fa-square-root-alt ihover javaSC thin-icontrash attr_equ_btn' style='font-size: 18px;margin-left: 13px;'></i></a>" + "</td> </tr>");

                            }else{
                            $('#myTable').append("<tr> <td>" + y + "</td> <td>" + name_detail1[y] + "</td> </tr>");
                            }
                        }
                      }
                      }else{
                        Swal.fire({icon: 'success',text: 'Attribute details have been updated successfully!'});
                        $('#myTable').empty()
                        $("#relTable").empty()

                        for (y in name_detail1) {

                          if(y == "Computed Value" && name_detail1[y] == true){

                            $('#myTable').append("<tr> <td>" + y + "</td> <td>" + name_detail1[y] + "<a data-toggle='tooltip' title='View Configuration' value='eq'><i name='actions1' value='eq' class='fas fa-square-root-alt ihover javaSC thin-icontrash attr_equ_btn' style='font-size: 18px;margin-left: 13px;'></i></a>" + "</td> </tr>");

                            }else{
                            $('#myTable').append("<tr> <td>" + y + "</td> <td>" + name_detail1[y] + "</td> </tr>");
                            }
                        }
                      }
                      }
                }
                },
                error: function () {
                Swal.fire({icon: 'error',text: 'Error! Please try again.'});
                }
                });
            }else{

              $.ajax({
                        url: window.location.pathname,
                        data: { 'tablename': newTableName, 'fieldDict': JSON.stringify(fieldList), 'operation': 'editattributes' },
                        type: "POST",
                        dataType: "json",
                        success: datatableReload,
                        error: function () {
                          Swal.fire({icon: 'error',text: 'Error! Please try again.'});
                        }
                      })
                      function datatableReload(data) {
                        regenrateHtml()
                        $(this).find('form').trigger('reset');
                        $('#editattributes').modal('hide')
                        var name_detail1 = JSON.parse(data)[0]
                        if(name_detail1['Data Type'] == 'ForeignKey' ){
                      if('fieldParentFKTable' in name_detail1){
                          if(name_detail1["unique_check"]){
                            Swal.fire({icon: 'info',text: 'Current column / element has unique value.'});
                          }else{
                            $("#rel_tab").text(name_detail1['fieldParentFKTable']).trigger('change')
                            delete name_detail1['fieldParentFKTable']
                            delete name_detail1["unique_check"]
                            Swal.fire({icon: 'success',text: 'Attribute details have been updated successfully!'});
                            $('#myTable').empty()
                            for (y in name_detail1) {

                          if(y == "Computed Value" && name_detail1[y] == true){

                              $('#myTable').append("<tr> <td>" + y + "</td> <td>" + name_detail1[y] + "<a data-toggle='tooltip' title='View Configuration' value='eq'><i name='actions1' value='eq' class='fas fa-square-root-alt ihover javaSC thin-icontrash attr_equ_btn' style='font-size: 18px;margin-left: 13px;'></i></a>" + "</td> </tr>");

                              }else{
                              $('#myTable').append("<tr> <td>" + y + "</td> <td>" + name_detail1[y] + "</td> </tr>");
                              }
                        }
                          }
                      }else{
                        Swal.fire({icon: 'success',text: 'Attribute details have been updated successfully!'});
                        $('#myTable').empty()
                        for (y in name_detail1) {

                          if(y == "Computed Value" && name_detail1[y] == true){

                            $('#myTable').append("<tr> <td>" + y + "</td> <td>" + name_detail1[y] + "<a data-toggle='tooltip' title='View Configuration' value='eq'><i name='actions1' value='eq' class='fas fa-square-root-alt ihover javaSC thin-icontrash attr_equ_btn' style='font-size: 18px;margin-left: 13px;'></i></a>" + "</td> </tr>");

                            }else{
                            $('#myTable').append("<tr> <td>" + y + "</td> <td>" + name_detail1[y] + "</td> </tr>");
                            }
                        }
                      }
                      }else{
                        Swal.fire({icon: 'success',text: 'Attribute details have been updated successfully!'});
                        $('#myTable').empty()
                        $("#relTable").empty()

                        for (y in name_detail1) {

                          if(y == "Computed Value" && name_detail1[y] == true){

                            $('#myTable').append("<tr> <td>" + y + "</td> <td>" + name_detail1[y] + "<a data-toggle='tooltip' title='View Configuration' value='eq'><i name='actions1' value='eq' class='fas fa-square-root-alt ihover javaSC thin-icontrash attr_equ_btn' style='font-size: 18px;margin-left: 13px;'></i></a>" + "</td> </tr>");

                            }else{
                            $('#myTable').append("<tr> <td>" + y + "</td> <td>" + name_detail1[y] + "</td> </tr>");
                            }
                        }
                      }
                      }
            }
            parent_table_change = false
  }
</script>


<script>
var validation_fields_data = null
var validation_fields_id;
if (validation_fields_id == undefined) {
  validation_fields_id = 1;
}

  $('#add_val_modal').on('show.bs.modal', function(e) {
  // $(".valtype").val("").change()
  fields_id = 1;
  validation_fields_id = 1;
  $(".validationbody").empty()
  var model_name = $(".dataElements").find("p").text()
  var field_name = $('#selectedElement').text()

    $.ajax({
      url: window.location.pathname,
      data: { 'model_name': model_name, 'field_name': field_name, 'operation': 'get_validations' },
      type: "POST",
      dataType: "json",
      success: datatableReload,
      error: function () {
        Swal.fire({icon: 'error',text: 'Error! Please try again.'});
      }
    })


    function datatableReload(data) {
      var newOptions = JSON.parse(data)

      $('.valtype option').slice(1).remove();

      var $el = $(".valtype");
      $.each(newOptions, function (key, value) {
        $el.append($("<option></option>")
          .attr("value", key).text(value));
      });
      $el.val("").change()
    }
  })



  $('.valtype').on('select2:select', displaySpecificFeilds);
  validation_labels = [];
  var selected_validation;
  function displaySpecificFeilds() {
    var fieldPosition = $(this).parent().parent().parent()
    selected_validation = $(this).val()
    var model_name = $(".dataElements").find("p").text()
    var field_name = $('#selectedElement').text()
    extraElements = fieldPosition.find("div").slice(3)
    extraElements.each(function () {
      $(this).remove()
    })

    $.ajax({
      url: window.location.pathname,
      data: { 'selected_validation': selected_validation, 'operation': 'get_validation_fields' },
      type: "POST",
      dataType: "json",
      success: datatableReload,
      error: function () {
        Swal.fire({icon: 'error',text: 'Error! Please try again.'});
      }
    })
    var validation_fields_data;
    function addRowHTML(validation_fields_id) {
      return `
    <div class="acies-float-right">
      <div class="col-3 form-group" >
      <button class="btn btn-primary btn-xs rounded" type="button" name="post" style="display:none">+</button>
    </div>
    </div>
    <div class="row">
      <div class="col-3 form-group" >
          <input type="number" min="1" name="start_value" id="start_value`+validation_fields_id+`" class="form-control numberinput" />
      </div>
      <div class="col-3 form-group" >
          <input type="number" min="1" name="end_value" id="end_value`+validation_fields_id+`" class="form-control numberinput" />
      </div>
      <div class="col-3 form-group" >
            <select id="validationid`+validation_fields_id+`" name="validationlist" form="validationform" class="form-control select2 validclass">
            <option value="Alphabet">Alphabet</option>
            <option value="Numeric">Numeric</option>
            <option value="Alphanumeric">Alphanumeric</option>
            <option value="Special Character">Special Character</option>
            <option value="Whitespace">Whitespace</option>
            <option value="Equal to">Equal to</option>
            </select>
      </div>
      <div class="col-3 form-group patternid select2" style='display:none;' id="pattern_div`+validation_fields_id+`">
          <select name="pattern_value" class="form-control select2" id="pattern_value`+validation_fields_id+`"> </select>
        </div>
        </div>`
    }

    function datatableReload(data) {
      var validation_details = JSON.parse(data)
      var fieldPosition = $('.modalbody3 .fields')
      var desc = `<div class="row validationbody"><p style="margin-left:10px"><b>` + validation_details['desc'] + `</b></p></div>`
      fieldPosition.append(desc)
      fieldPosition.append(validation_details['field_str'])
      validation_labels[0] = validation_details
      $('#addRow').off('click').on('click',function() {
        var html = addRowHTML(validation_fields_id)
        validation_fields_id += 1;
        fields_id += 1;
        $('#newRow').append(html);
        $(`#validationid${validation_fields_id-1}`).select2()
        $(`#pattern_value${validation_fields_id-1}`).select2({tags:true})
      });
       var fieldsPosition = $('.modalbody3').find('.fields')
      $.ajax({
        url: window.location.pathname,
        data: { 'model_name': model_name, 'field_name':field_name, 'operation': 'get_validation_config' },
        type: "POST",
        dataType: "json",
        success: function (data) {
                  validation_fields_data = data[selected_validation]

                  if(selected_validation == "ColumnValidator"){
                            $.ajax({
                              url: window.location.pathname,
                              data: {'operation': 'get_validation_columns', 'tablename': model_name },
                              type: "POST",
                              dataType: "json",
                              success: function (data) {
                                fieldsPosition.find('select[name="colV_col1_val"]').empty()
                                fieldsPosition.find('select[name="colV_col2_val"]').empty()
                                if(Object.keys(data).length > 0){
                                  for(let [key,value] of Object.entries(data) ){
                                    fieldsPosition.find('select[name="colV_col1_val"]').append(`<option value='${key}'>${value}</option>`)
                                    fieldsPosition.find('select[name="colV_col2_val"]').append(`<option value='${key}'>${value}</option>`)
                                  }
                                }
                                fieldsPosition.find('select[name="colV_col1_val"]').val(field_name).trigger("change")
                                fieldsPosition.find('select[name="colV_col1_val"]').attr("disabled", true)
                                if (validation_fields_data != undefined) {
                                  for (let i=0; i < Object.keys(validation_fields_data).length; i++) {
                                    if (Object.keys(validation_fields_data)[i] == "error_message_colV"){
                                      fieldsPosition.find('input[name="' + Object.keys(validation_fields_data)[i] + '"]').val(validation_fields_data[Object.keys(validation_fields_data)[i]])
                                    }else{
                                      fieldsPosition.find('select[name="' + Object.keys(validation_fields_data)[i] + '"]').val(validation_fields_data[Object.keys(validation_fields_data)[i]]).trigger("change")
                                    }
                                  }
                                }

                              },
                              error: function () {
                                Swal.fire({icon: 'error',text: 'Error! Please try again.'});
                              }
                            })
                    }

                   if (validation_fields_data != undefined) {
                     for (let i = 0; i < Object.keys(validation_fields_data).length - 2; i++) {
                       if (selected_validation == "AdvancedValidator") {
                          if (i>0) {
                            var html = addRowHTML(i)
                            $('#newRow').append(html);
                            $(`#validationid${i}`).select2()
                            $(`#pattern_value${i}`).select2({tags:true})
                          }
                           $("#error_message").val(validation_fields_data["message"])
                           $("#start_value" + i).val(validation_fields_data[String(i)]["start_value"])
                           $("#end_value"+ i).val(validation_fields_data[String(i)]["end_value"])
                           $("#validationid"+ i).val(validation_fields_data[String(i)]["validationid"]).change()
                           validation_fields_id = i + 1
                           fields_id = validation_fields_id
                           if(validation_fields_data[String(i)]["pattern_value"] != '') {
                             var pval = validation_fields_data[String(i)]["pattern_value"]
                             if (pval != undefined) {
                               $('#pattern_value' + i).append(`<option value="`+ pval +`" selected="selected">`+ pval +`</option>`);
                             }
                           }
                       }
                     }
                    if (selected_validation == "MaxLengthValidator" || selected_validation == "MinLengthValidator"  || selected_validation == "EmailValidator") {
                         for (let i=0; i < Object.keys(validation_fields_data).length; i++) {
                         fieldsPosition.find('input[name="' + Object.keys(validation_fields_data)[i] + '"]').val(validation_fields_data[Object.keys(validation_fields_data)[i]])
                         }
                       }
                   }
                   if(selected_validation == "AdvanceDateValidation"){
                    for (let i=0; i < Object.keys(validation_fields_data).length; i++) {
                        if (Object.keys(validation_fields_data)[i] == "error_message_colV"){
                          fieldsPosition.find('input[name="' + Object.keys(validation_fields_data)[i] + '"]').val(validation_fields_data[Object.keys(validation_fields_data)[i]])
                        }else{

                          fieldsPosition.find('select[name="' + Object.keys(validation_fields_data)[i] + '"]').val(validation_fields_data[Object.keys(validation_fields_data)[i]]).trigger("change")
                          fieldsPosition.find('select[name="' + Object.keys(validation_fields_data)[i] + '"]').val(validation_fields_data[Object.keys(validation_fields_data)[i]]).trigger("select2:select")
                        }
                      }

                      if(validation_fields_data["custom-date"]){
                        fieldsPosition.find('input[name="colV_cond_val2"]').val(validation_fields_data["custom-date"]).trigger("change")
                      }
                   }

                   $('select.select2:not(.modal select.select2)').each(function(){
                    parent = $(this).parent()
                    $(this).select2({dropdownParent:parent})
                })
                $('.modal select.select2').each(function(){
                    $(this).select2()
                })
              },
                error: function () {
      }})

    }
  }

  $(document.body).on('change',".validclass",function (e) {
    var selected_item = $(this).val()
    var pattern_id = $(this).parent().parent().find('.patternid').attr('id')
   if (selected_item == "Equal to") {
     $('#' + pattern_id).css("display", "block")
    }
    else {
      $('#' + pattern_id).css("display", "none")
    }
  });

      var model_name = $(".dataElements").find("p").text()
      var field_name = $('#selectedElement').text()
      function addvalidations() {
        $('#add_val_modal').modal('hide')
        var fieldsPosition = $('.modalbody3').find('.fields')
      var val_name = fieldsPosition.find('select[name="Selected Validation"]').val()
    if (val_name == "AdvancedValidator") {
      var ValDict = {}
      var prevEnd = 0;
      for (var j = 0; j < fields_id; j++) {
        var VarList = {}
        for (var i = 0; i < validation_labels[0]['arguments'].length; i++) {
          VarList[validation_labels[0]['arguments'][i]] = fieldsPosition.find('select[id="' + validation_labels[0]['arguments'][i] + j + '"]').val() ||
          fieldsPosition.find('input[id="' + validation_labels[0]['arguments'][i] + j + '"]').val()
        }
        if(j > 0) {
          prevEnd = Number(fieldsPosition.find('input[id="end_value' + String(j-1) + '"]').val())
          currStart =  Number(fieldsPosition.find('input[id="start_value' + j + '"]').val())
          if(!(prevEnd + 1 == currStart)) {
            Swal.fire({icon: 'info',text: 'Indexing is not continous or overlapping at row' + j + '.'});
            return
          }
        }
        ValDict[j] = VarList
      }
    }
    else if (val_name == "ColumnValidator") {
      var ValDict = {}
      for (var i = 0; i < validation_labels[0]['arguments'].length; i++) {
        if (validation_labels[0]['arguments'][i] == "error_message_colV"){
          ValDict[validation_labels[0]['arguments'][i]] = fieldsPosition.find('input[name="' + validation_labels[0]['arguments'][i] + '"]').val()
        }else{
          ValDict[validation_labels[0]['arguments'][i]] = fieldsPosition.find('select[name="' + validation_labels[0]['arguments'][i] + '"]').val()
        }
      }
    }
    else if(val_name == "AdvanceDateValidation"){

      var ValDict = {}
      for(var i = 0; i < validation_labels[0]['arguments'].length; i++){
        if (validation_labels[0]['arguments'][i] == "error_message_colV"){
          ValDict[validation_labels[0]['arguments'][i]] = fieldsPosition.find('input[name="' + validation_labels[0]['arguments'][i] + '"]').val()
        }else{

          ValDict[validation_labels[0]['arguments'][i]] = fieldsPosition.find('select[name="' + validation_labels[0]['arguments'][i] + '"]').val()
          ValDict["custom-date"] = fieldsPosition.find('input[name="' + validation_labels[0]['arguments'][i] + '"]').val()
        }

      }

    }

    else {
      var ValDict = {}
      for (var i = 0; i < validation_labels[0]['arguments'].length; i++) {
        ValDict[validation_labels[0]['arguments'][i]] = fieldsPosition.find('input[name="' + validation_labels[0]['arguments'][i] + '"]').val()
      }
    }
    ValDict["message"] = fieldsPosition.find('input[name="message"]').val()
    var model_name = $(".dataElements").find("p").text()
    var field_name = $('#selectedElement').text()
    $.ajax({
      url: window.location.pathname,
      data: { 'model_name': model_name, 'field_name': field_name, 'val_name': val_name, 'ValDict': JSON.stringify(ValDict), 'operation': 'add_validations' },
      type: "POST",
      dataType: "json",
      success: datatableReload,
      error: function () {
        Swal.fire({icon: 'error',text: 'Error! Please try again.'});
      }
    })

    function datatableReload(data) {
      $(this).find('form').trigger('reset');
      $('#add_validations').modal('hide');
      Swal.fire({icon: 'success',text: 'Validations have been added successfully!'});
      var name_detail = JSON.parse(data)[0]
      $('#myTable').empty()
      for (y in name_detail) {
        $('#myTable').append("<tr> <td>" + y + "</td> <td>" + name_detail[y] + "</td> </tr>");
      }
    }

  }

  function removevalidations(){
    Swal.fire({
                icon:'question',
                text: "Remove validation?\n\nClick 'Yes' to confirm or click 'No' if you do not wish to  remove it.",
                showDenyButton: true,
                showCancelButton: true,
                confirmButtonText: 'Yes',
                denyButtonText: 'No',
              }).then((result) => {
                if (result.isConfirmed) {
                  var fieldsPosition = $('.modalbody3').find('.fields')
                  var val_name = fieldsPosition.find('select[name="Selected Validation"]').val()
                  var model_name = $(".dataElements").find("p").text()
                  var field_name = $('#selectedElement').text()

                  $.ajax({
                    url: window.location.pathname,
                    data: { 'model_name': model_name, 'field_name': field_name, 'val_name': val_name, 'operation': 'remove_validations' },
                    type: "POST",
                    dataType: "json",
                    success: datatableReload,
                    error: function () {
                      Swal.fire({icon: 'error',text: 'Error! Failure in removing selected validation. Please try again.'});
                    }
                  })

                  function datatableReload(data) {
                    $(this).find('form').trigger('reset');
                    $('#add_val_modal').modal('hide');
                    Swal.fire({icon: 'success',text: 'Validation have been removed successfully!'});
                    var name_detail = JSON.parse(data)[0]
                    $('#myTable').empty()
                    for (y in name_detail) {
                      $('#myTable').append("<tr> <td>" + y + "</td> <td>" + name_detail[y] + "</td> </tr>");
                    }
                  }
                }
              })

  }

  function saveUserDataAccessControl() {
    var additionalConfig = {};
    if ($('#selectAccessControlType').val() == "custom") {
      additionalConfig['controlMeasure'] = $('#selectCustomAccessControlType').val();
      additionalConfig['fields'] = $('#selectAccessControlCustomField').val();
    }
    $.ajax({
      url: window.location.pathname,
      data: {
        'model_name': $(".dataElements").find("p").text(),
        'access_type': $('#selectAccessControlType').val(),
        'additional_config': JSON.stringify(additionalConfig),
        'operation': 'saveUserDataAccessControl',
      },
      type: "POST",
      dataType: "json",
      success: function () {
        Swal.fire({icon: 'success',text: 'Data Access Controls saved successfully.'});
      },
      error: function () {
        Swal.fire({icon: 'error',text: 'Error! Failure in saving Data Access Controls. Please try again.'});
      }
    });
  };

  function removeUserDataAccessControl() {
    $.ajax({
      url: window.location.pathname,
      data: {
        'model_name': $(".dataElements").find("p").text(),
        'operation': 'removeUserDataAccessControl',
      },
      type: "POST",
      dataType: "json",
      success: function () {
        Swal.fire({icon: 'success',text: 'Data Access Controls removed successfully.'});
      },
      error: function () {
        Swal.fire({icon: 'error',text: 'Error! Failure in removing Data Access Controls. Please try again.'});
      }
    });
  };

</script>

<!-- start of Foreignkey relationship from data discovery screen1 javascript -->
<script>
var finalize_datads_list=[]
  $(document).on("click", ".relbutton", function(){
      var parent_table = $(this).closest('tr').find('#tab_name1').text()
      var parent_col = $(this).closest('tr').find('#col_name1').text()
      $("#parent_element").val(parent_col).trigger("change");
      $("#parent_table_datamanagement").val(parent_table);
  });

$('#relation_modal').on('show.bs.modal', function (e) {

  var model_name = $(".dataElements").find("p").text()
  var field_name = $('#selectedElement').text()
  var $rows = $('#searchTable1').find('tr:not(:hidden)');
  $("#child_table_datamanagement").val(model_name);
  $("#child_element").val(field_name).trigger("change");
  $("#configureforeignkey_save").hide()
  $("#datadiscovery_save").show()
})

$('#relation_modal').on('hidden.bs.modal', function (e) {
  finalize_datads_list=[]
})

  // Configure Foreign Save Change
  $(document).on('click',"#datadiscovery_save",function(){
    finalize_datads_list=[]

    $("#mapper_modal_content tr").each(function(){
      changed_value_dict ={}
      changed_value_dict['ref_id'] = $(this).find("td").eq(1).text().trim()
      changed_value_dict['new_id'] =$(this).find("td").eq(2).find('select option:selected').attr('data-change-id')
      finalize_datads_list.push(changed_value_dict)
    })

  })

function maprelbuild(){
var fieldList = []
var fieldsTotal = $('.modalbodyrel').find('.fieldsrel').each(function () {
  var fieldDict = {}
  fieldDict['fieldDatatype'] = $(this).find('#fieldatatype').val()
  fieldDict['parent_table'] = $('#parent_table_datamanagement').val()
  fieldDict['parent_element'] = $(this).find('#parent_element').val()
  fieldDict['child_table'] = $('#child_table_datamanagement').val()
  fieldDict['child_element'] = $(this).find('#child_element').val()
  fieldDict['fieldNull'] = $(this).find('#null').val()

  fieldList.push(fieldDict)
})


$.ajax({
    url: window.location.pathname,
    data: {'fieldDict': JSON.stringify(fieldList), 'operation': 'checkrelation1'},
    type: "POST",
    dataType: "json",
    success: function(data){
      org_data = JSON.parse(data)
      parent_name = $('#parent_table_datamanagement').val()
      child_name = $('#child_table_datamanagement').val()
      $("#datadiscovery_save").attr('data-current-table',child_name)
      if(org_data[1]){
        $("#mapper_modal").modal("show")
              $("#mapper_modal_datatable"+"_wrapper").remove()
              $("#mapper_modal_datatable").remove()
              var customDatatable=`
              <table id="mapper_modal_datatable" class="row-border display" style="width: 100%;">
              <thead>
                <th scope="col">Table name</th>
                <th scope="col">Change Value</th>
                <th scope="col">New Value</th>
              </thead>
              <tbody id="mapper_modal_content">

              </tbody>
              </table>`
              $("#mapper_modal_main_body").append(customDatatable)

              $("#mapper_modal_content").empty()
              var old_data = JSON.parse(org_data[0].old_value)
              var change_data = JSON.parse(org_data[0].change_value)
              for(i of old_data){

              $("#mapper_modal_content").append(`<tr> <td>${parent_name}</td>  <td data-old-id=${i[Object.keys(i)[0]]} >${i[Object.keys(i)[1]]}</td>  <td><select class="form-control select2 foreign_select_changes"   aria-hidden="true"></select></td> </tr>`)
              }

              $(".foreign_select_changes").append(`<option data-change-id="">NULL</option`)

              for(j of change_data){
              $(".foreign_select_changes").append(`<option data-change-id=${j[Object.keys(j)[0]]}> ${j[Object.keys(j)[1]]}</option`)
              }
              $(".foreign_select_changes").select2({width:'100%'})
      }else{
        Swal.fire({icon: 'warning',text: 'No data found in the Child Table.'});
      }

    },
    error: function () {
      Swal.fire({icon: 'error',text: 'Error! Please try again.'});
    }
  })

}


function relbuild() {

  var fieldList = []


  var fieldsTotal = $('.modalbodyrel').find('.fieldsrel').each(function () {
    var fieldDict = {}
    fieldDict['fieldDatatype'] = $(this).find('#fieldatatype').val()
    fieldDict['parent_table'] = $('#parent_table_datamanagement').val()
    fieldDict['parent_element'] = $(this).find('#parent_element').val()
    fieldDict['child_table'] = $('#child_table_datamanagement').val()
    fieldDict['child_element'] = $(this).find('#child_element').val()
    fieldDict['fieldNull'] = $(this).find('#null').val()

    fieldList.push(fieldDict)
  })



$.ajax({
    url: window.location.pathname,
    data: {'fieldDict': JSON.stringify(fieldList), 'operation': 'checkrelation1'},
    type: "POST",
    dataType: "json",
    success: function(data){
      org_data = JSON.parse(data)
      parent_name = $('#parent_table_datamanagement').val()
      child_name = $('#child_table_datamanagement').val()
      $("#datadiscovery_save").attr('data-current-table',child_name)
      if(org_data[1] && finalize_datads_list.length > 0){
          if(finalize_datads_list.length > 0){
            $.ajax({
              url: window.location.pathname,
              data: {'fieldDict': JSON.stringify(fieldList),'mapper_data':JSON.stringify(finalize_datads_list) ,'operation': 'createrelation1'},
              type: "POST",
              dataType: "json",
              success: datatableReload,
              error: function () {
                Swal.fire({icon: 'error',text: 'Error! Please try again.'});
              }
            })

            function datatableReload(data) {
              Swal.fire({icon: 'success',text: 'Relationship between tables have been successfully created!'});
            }

          }
      }else if(!org_data[1]){
            $.ajax({
              url: window.location.pathname,
              data: {'fieldDict': JSON.stringify(fieldList),'operation': 'createrelation1'},
              type: "POST",
              dataType: "json",
              success: datatableReload,
              error: function () {
                Swal.fire({icon: 'error',text: 'Error! Please try again.'});
              }
            })

            function datatableReload(data) {
              Swal.fire({icon: 'success',text: 'Relationship between tables have been successfully created!'});
            }
      }else if(org_data[1] && finalize_datads_list.length == 0){
        Swal.fire({icon: 'warning',text: 'Use Data Mapper to map the data in the Child Table with the Parent Table data.'});
      }

    },
    error: function () {
      Swal.fire({icon: 'error',text: 'Error! Please try again.'});
    }
  })






}



</script>
 <!-- end of Foreignkey relationship from data discovery screen1 javascript -->

<!-- start of Foreignkey relationship from data discovery screen2 javascript -->
<script>

  $(document).on("click", ".relbutton2", function(){
      var parent_table2 = $(this).closest('tr').find('#tab_name2').text()
      var parent_col2 = $(this).closest('tr').find('#col_name2').text()
      $('#computed2')[0].checked=false;
      $('.nullField').val(0).trigger('change.select2');
      $("#parent_table2").val(parent_table2);
      $("#parent_element2").val(parent_col2);

  });

$('#relation_modal_2').on('show.bs.modal', function (e) {

})

function createtable_relbuild() {

  var fieldList = []
  var fieldsTotal = $('.modalbodyrel_2').find('.fieldsrel_2').each(function () {
    var $TABLE = $('div#table');
     var parent_table = $(this).find('#parent_table2').val()
     var field_name = $(this).find('#parent_element2').val()
     var null_value = $(this).find('#null2').val()
     if($('#computed2')[0].checked==true){
       var computed_value = "on"
     } else {
       var computed_value = "off"
     }
    var templateString = `<tr>
                          <td><span id='fld_name' class="fld_name" contenteditable="true" style="display: inline-block;min-width: 70px;text-transform:lowercase;max-width:70px;overflow:hidden;">${field_name}</span></td>
                          <td>
                            <select class="table_datatype browser-default select2 custom-select fieldselect"
                              >
                              <option value="" disabled >Select</option>
                              <option value="AutoField">AutoField (Primary key)</option>
                              <option value="CharField">CharField (Text,numbers,special characters,etc.)</option>
                              <option value="TextField">TextField (Large text)</option>
                              <option value="BooleanField">BooleanField (Yes or No,True or False,etc.</option>
                              <option value="FileField">FileField (File/Document upload)</option>
                              <option value="VideoField">VideoField</option>
                              <option value="ImageField">ImageField (image upload)</option>
                              <option value="IntegerField">IntegerField (Integer numbers)</option>
                              <option value="BigIntegerField">BigIntegerField (Big Integer numbers)</option>
                              <option value="FloatField">FloatField (Integer or decimal numbers)</option>
                              <option value="DateField">DateField (Date)</option>
                              <option value="DateTimeField">DateTimeField (Date and Time)</option>
                              <option value="TimeField">TimeField (Time)</option>
                              <option value="TimeRangeField">TimeRangeField</option>
                              <option value="DateTimeRangeField">DateTimeRangeField</option>
                              <option value="DateRangeField">DateRangeField</option>
                              <option selected value="ForeignKey">ForeignKey</option>
                              <option value="CardField">CardField (Credit card/Debit card)</option>
                              <option value="CardCvvField">CardCvvField</option>
                              <option value="CardExpiryField">CardExpiryField</option>
                              <option value="CardTypeField">CardTypeField (Identifies the type of card)</option>
                              <option value="UserField">UserField</option>
                              <option value="EmailTypeField">EmailTypeField</option>
                              <option value="TableField">TableField</option>
                              <option value="MultiselectField">MultiselectField</option>
                              <option value="RTFField">RTFField</option>
                              <option value="PrivacyField">PrivacyField</option>
                            </select>
                          </td>
                          <td><span id = 'prnt_tbl' contenteditable="false" style="display: inline-block;min-width: 70px;">${parent_table}</span></td>
                          <td><span contenteditable="true"  style="display: inline-block;min-width: 70px;"></span></td>`
                            if (null_value == "Yes"){
                              templateString = templateString + `<td>
                                <select class="browser-default custom-select select2 nulloption">
                              <option value="" disabled>Select</option>
                              <option value="1" selected>Yes</option>
                              <option value="2">No</option>
                            </select></td>`
                            }
                            else if (null_value == "No"){
                              templateString = templateString + `<td>
                                <select class="browser-default select2 custom-select nulloption"
                              >
                              <option value="" disabled>Select</option>
                              <option value="1">Yes</option>
                              <option value="2" selected>No</option>
                            </select></td>`
                            }
                            else{
                              templateString = templateString + `<td>
                                <select class="browser-default select2 custom-select nulloption"
                              >
                              <option value="" disabled selected>Select</option>
                              <option value="1">Yes</option>
                              <option value="2">No</option>
                            </select></td>`
                            }
                            templateString = templateString + `
                          <td><span contenteditable="false" style="display: inline-block;min-width: 70px;"></span></td>
                          <td><span contenteditable="false" style="display: inline-block;min-width: 70px;"></span></td>`
                          if (computed_value == "on"){
                            templateString = templateString + `<td>
                            <select class="browser-default select2 custom-select coption computedoption"
                              >
                              <option value="" disabled>Select</option>
                              <option value="1" selected>Yes</option>
                              <option value="2">No</option>
                            </select>
                          </td>`
                        }
                        else{
                          templateString = templateString + `<td>
                            <select class="browser-default select2 custom-select coption computedoption"
                              >
                              <option value="" disabled>Select</option>
                              <option value="1">Yes</option>
                              <option value="2" selected>No</option>
                            </select>
                          </td>`
                        }
                        templateString = templateString + `<td><span contenteditable="false" style="display: inline-block; min-width: 70px;"></span></td>
                          <td>
                            <select class="browser-default select2 custom-select autonowoption" disabled
                              >
                              <option value="" disabled selected>Select</option>
                              <option value="1">Yes</option>
                              <option value="2">No</option>
                            </select>
                          </td>
                          <td>
                            <select class="browser-default select2 custom-select editableoption" disabled
                              >
                              <option value="" disabled selected>Select</option>
                              <option value="1">Yes</option>
                              <option value="2">No</option>
                            </select>
                          </td>
                          <td>
                            <select class="browser-default select2 custom-select">
                              <option value="" disabled selected>select</option>
                              <option value="1">Yes</option>
                              <option value="2">No</option>
                            </select>
                          </td>
                          <td>

                          </td>
                          <td>
                            <select class="browser-default select2 custom-select" disabled>
                              <option value="" selected>No divider</option>
                              <option value="_">_</option>
                              <option value="*">*</option>
                              <option value="-">-</option>
                              <option value="+">+</option>
                              <option value="#">#</option>
                              <option value="$">$</option>
                              <option value="%">%</option>
                              <option value="@">@</option>
                              <option value="!">!</option>
                              <option value="&">&</option>
                              <option value=".">.</option>
                              <option value="?">?</option>
                            </select>
                          </td>
                          <td>
                          <select class="browser-default select2 custom-select multipleform_bklist" multiple></select>
                          </td>
                          <td>
                          <select class="browser-default select2 custom-select multipleform_compInp" multiple></select>
                          </td>
                          <td>
                            <span class="equationBuilder" style="display: none;">
                              <a data-toggle="tooltip" title="Equation Builder" value="eq" id="EBDisplayButtonID"><i name="actions1" value="eq" class="fas fa-square-root-alt ihover javaSC thin-icontrash ebdeqbtn" style="font-size: 18px;"></i></a>
                            </span>
                            <span class="table_remove" id="removerow">
                              <a data-toggle="tooltip" title="Delete record" value="delete"><i name="actions" value="delete" class="far fa-trash-alt ihover javaSC thin-icontrash" style="font-size: 18px "></i></a>
                            </span>
                            <span id="uuid_config" style="display:none" data-toggle="modal" data-target="#uuid_settings_modal" onclick="uuid_modal(this)" name="">
                              <a data-toggle="tooltip" title="UniqueIDField settings" value="uuid_settings"><i name="actions" value="uuid_settings" class="far fa-edit ihover javaSC thin-icon" style="font-size: 18px "></i></a>
                            </span>
                            <span id="file_config" style="display:none" data-toggle="modal" data-target="#file_settings_modal" onclick="file_modal(this)" name="">
                              <a data-toggle="tooltip" title="UniqueIDField settings" value="file_settings"><i name="actions" value="file_settings" class="far fa-edit ihover javaSC thin-icon" style="font-size: 18px "></i></a>
                            </span>
                            <span id="video_config" style="display:none" data-toggle="modal" data-target="#video_settings_modal" onclick="video_modal(this)" name="">
                              <a data-toggle="tooltip" title="UniqueIDField settings" value="video_settings"><i name="actions" value="video_settings" class="far fa-edit ihover javaSC thin-icon" style="font-size: 18px "></i></a>
                            </span>
                            <span id="card_config" style="display:none" data-toggle="modal" data-target="#card_settings_modal" onclick="card_modal(this)" name="">
                              <a data-toggle="tooltip" title="Credit/Debit Card Issuer" value="card_settings"><i name="actions" value="card_settings" class="far fa-edit ihover javaSC thin-icon" style="font-size: 18px "></i></a>
                            </span>
                            <span id="cvv_config" style="display:none" name="">
                              <a data-toggle="tooltip" title="CVV" value="cvv_settings"><i name="actions" value="cvv_settings" class="far fa-edit ihover javaSC thin-icon" style="font-size: 18px "></i></a>
                            </span>
                            <span id="ctype_config" style="display:none" name="">
                              <a data-toggle="tooltip" title="ctype" value="ctype_settings"><i name="actions" value="ctype_settings" class="far fa-edit ihover javaSC thin-icon" style="font-size: 18px "></i></a>
                            </span>
                            <span id="exp_config" style="display:none" name="">
                              <a data-toggle="tooltip" title="exp" value="exp_settings"><i name="actions" value="exp_settings" class="far fa-edit ihover javaSC thin-icon" style="font-size: 18px "></i></a>
                            </span>
                            <span id="mulsel_config" style="display:none" data-toggle="modal" data-target="#mulsel_settings_modal" onclick="mulsel_modal(this)" name="">
                              <a data-toggle="tooltip" title="MultiselectField" value="mulsel_settings"><i name="actions" value="mulsel_settings" class="far fa-edit ihover javaSC thin-icon" style="font-size: 18px "></i></a>
                            </span>
                            <span id="table_config" style="display:none" data-toggle="modal" data-target="#table_settings_modal" onclick="table_modal(this)" name="">
                              <a data-toggle="tooltip" title="TableField Settings" value="table_settings"><i name="actions" value="table_settings" class="far fa-edit ihover javaSC thin-icon" style="font-size: 18px "></i></a>
                            </span>
                            <span id="privacy_config" style="display:none" data-toggle="modal" data-target="#privacy_settings_modal" onclick="privacy_modal(this)" name="">
                              <a data-toggle="tooltip" title="PrivacyField" value="privacy_settings"><i name="actions" value="privacy_settings" class="far fa-edit ihover javaSC thin-icon" style="font-size: 18px "></i></a>
                            </span>
                          </td>
                        </tr>`;

    $TABLE.find('table tbody').append(templateString);

    var lastTr = $TABLE.find('table tr').last();
    lastTr.find('.table_remove').click(removeFunc);
    function removeFunc() {
    $(this).closest('tr').remove();
    };

    lastTr.find('.select2').each(function(){
    parent = $(this).parent()
    $(this).select2({dropdownParent:parent})
  })

    $('.fld_name').on('keypress', function (event) {
      var specialChars = "<>@!#$%^&*()+[]{}?:; |'\"\\,./~`=-";
      var key = String.fromCharCode(!event.charCode ? event.which : event.charCode);
      for(i = 0; i < specialChars.length;i++){
        if(key.indexOf(specialChars[i]) > -1){
          event.preventDefault();
          return false
        }
      }
    });

    lastTr.find('#fld_name').on('paste', function (event) {
        var clipboardData = event.originalEvent.clipboardData || window.clipboardData;
        var pastedText = clipboardData.getData('text');
        var containsSpecialChars = false;
        var specialChars = "<>@!#$%^&*()+[]{}?:; |'\"\\,./~`=-";
        var stripped_out_str = ""
        for (i = 0; i < specialChars.length; i++) {
            if (pastedText.indexOf(specialChars[i]) > -1) {
                containsSpecialChars = true;
                break;
            }
        }
        if(containsSpecialChars){
           event.preventDefault();
           $(this).text(pastedText.replace(/[<>@!#$%^&*()+\[\]{}?:; |'\"\\,./~`=-\s]/g, ''))
        }

      });


    $('#relation_modal_2').modal('hide');
  })

}

</script>
<!-- end of Foreignkey relationship from data discovery screen2 javascript -->

<!--START OF ABHI'S JAVASCRIPT-->

<script>

  $('select.select2:not(.modal select.select2)').each(function(){
    parent = $(this).parent()
    $(this).select2({dropdownParent:parent})
  })
  $('.modal select.select2').each(function(){
      $(this).select2()
  })
  $('.duallistbox').bootstrapDualListbox()
  var ctoken = $('form').find("input[name='csrfmiddlewaretoken']").attr('value')
  $.ajaxSetup({
    beforeSend: function (xhr, settings) {
      xhr.setRequestHeader("X-CSRFToken", ctoken);
    }
  });
  $('card0').ready(function () {
    $('.cardheader0').on('click', function (e) {

      $('.cardbody0').toggle();
      $('.cardfooter0').toggle();

      if ($('.cardbody0').css('display') == 'none') {
        $(".cardheader0").find("i.fa-minus").addClass('fa-plus').removeClass('fa-minus').end();
      }

      if ($('.cardbody0').css('display') == 'block') {
        $(".cardheader0").find("i.fa-plus").addClass('fa-minus').removeClass('fa-plus').end();

      }
    });
  });

  $('card1').ready(function () {
    $('.cardheader1').on('click', function () {
      $('.cardbody1').toggle();
      $('.cardfooter1').toggle();

      if ($('.cardbody1').css('display') == 'none') {
        $(".cardheader1").find("i.fa-minus").addClass('fa-plus').removeClass('fa-minus').end();
      }

      if ($('.cardbody1').css('display') == 'block') {
        $(".cardheader1").find("i.fa-plus").addClass('fa-minus').removeClass('fa-plus').end();
      }
    });
  });

  $('card2').ready(function () {
    $('.cardheader2').on('click', function () {
      $('.cardbody2').toggle();
      $('.cardfooter2').toggle();
      if ($('.cardbody2').css('display') == 'none') {
        $(".cardheader2").find("i.fa-minus").addClass('fa-plus').removeClass('fa-minus').end();
      }

      if ($('.cardbody2').css('display') == 'block') {
        $(".cardheader2").find("i.fa-plus").addClass('fa-minus').removeClass('fa-plus').end();
      }
    });
  });

  $('card3').ready(function () {
    $('.cardheader3').on('click', function () {
      $('.cardbody3').toggle();
      $('.cardfooter3').toggle();
      if ($('.cardbody3').css('display') == 'none') {
        $(".cardheader3").find("i.fa-minus").addClass('fa-plus').removeClass('fa-minus').end();
      }

      if ($('.cardbody3').css('display') == 'block') {
        $(".cardheader3").find("i.fa-plus").addClass('fa-minus').removeClass('fa-plus').end();
      }
    });
  });
  var a = 0;
  $('input[name="Field Name"]').on('change', fieldNameValidation)
  function fieldNameValidation() {
    a = 0
    if ($(this).val().includes(" ")) {
      Swal.fire({icon: 'warning',text: 'The name of the field should not contain spaces. It is advisable that you use the underscore (_) character if you want to add more than one word to the field name.'});
      a++
    }
  }
  b = 0
  $('#saveNewFields').click(function () {
    b++
    if ($('#newTableName').val() && a == 0) {
      $('#newTableData').empty()
      $('.datatype').select2("destroy");
      $('.nullField').select2("destroy")
      $('#newTableData').append($('.cloneElement').clone())
      $('.datatype').each(function () {
        $(this).find('option').each(function () {
          if ($(this).attr('value')) {
            $(this).attr('disabled', false)
          }
        })
      })
      originalSelectValues = []
      $('#formElements0').find('select[name="Field DataType"]').each(function () {
        selectDict = {}
        selectDict['datatype'] = $(this).val()
        selectDict['nullable'] = $(this).parent().parent().find('select[name="null"]').val()
        originalSelectValues.push(selectDict)
      })
      $('select.select2:not(.modal select.select2)').each(function(){
        parent = $(this).parent()
        $(this).select2({dropdownParent:parent})
      })
      $('.modal select.select2').each(function(){
          $(this).select2()
      })
      i = 0
      $('#newTableData').find('select[name="Field DataType"]').each(function () {
        $(this).val(originalSelectValues[i]["datatype"]).trigger('change')
        $(this).parent().parent().find('select[name="null"]').val(originalSelectValues[i]["nullable"]).trigger('change')
        i++
      })

      $('.datatype').on('select2:select', displaySpecificData);

      $('#card0').addClass("collapsed-card");
      $("#card0 > div.card-body").css("display", "none");
      $("#card0 > div.card-footer").css("display", "none");
      $("#card0").find("i.fa-minus").addClass('fa-plus').removeClass('fa-minus');
      $("#card0").find("i.fa-check-circle").css("display", "inline-block");

      $('#card1').removeClass("collapsed-card");
      $("#card1 > div.card-body").css("display", "block");
      $("#card1 > div.card-footer").css("display", "block");
      $("#card1").find("i.fa-plus").addClass('fa-minus').removeClass('fa-plus');
    }
    else {
      Swal.fire({icon: 'warning',text: 'Table Name should not be left blank'});
    }

  })

  $('#saveTableConf').click(function () {
    var level1Selected = JSON.stringify($('#level1').val());
    var level2Selected = JSON.stringify($('#level2').val());
    $.ajax({
      url: window.location.pathname,

      data: {
        'L1table': level1Selected,
        'L2table': level2Selected,
        'operation': 'one'
      },
      type: "POST",
      dataType: "json",
      success: function (data) {
        $('#selectFieldsBox').css("display", "block")
        $('#saveTableStructure').css("display", "block")
        $('#selectFields').empty()
        fieldOptions = data.fieldsFinal
        fieldPK = data.pkList
        for (var i = 0; i < fieldOptions.length; i++) {
          var newOption = new Option(fieldOptions[i], fieldOptions[i], false, false);
          $('#selectFields').append(newOption)
        }
        for (var i = 0; i < fieldPK.length; i++) {
          var newOption = new Option(fieldPK[i], fieldPK[i], false, true);
          $('#selectFields').append(newOption)
          $('#selectFields').find(`option[value='${fieldPK[i]}']`).prop('disabled', true)
        }
        $('.duallistbox').bootstrapDualListbox('refresh', true)
      },
      error: function () {
        Swal.fire({icon: 'error',text: 'Error! Failure in saving Table configuration. Please try again.'});
      }
    })
  })

  $('#saveTableStructure').click(function () {
    if (b == 0) {
      Swal.fire({icon: 'warning',text: 'Please fill the first card'});
    }
    else {
      var selectedFields0 = document.getElementById('bootstrap-duallistbox-selected-list_')
      var selectedFields = [];
      for (var i = 0; i < selectedFields0.options.length; i++) {
        selectedFields.push(selectedFields0.options[i].value)
      }
      $.ajax({
        url: window.location.pathname,

        data: {
          'selectedFields': JSON.stringify(selectedFields),
          'operation': 'two'
        },
        type: "POST",
        dataType: "json",
        success: function (data) {
          var fieldDetails = data.fieldDetails;
          for (var i = 0; i < fieldDetails.length; i++) {
            var stringCommon = `<div class="card col-12">
        <div class="card-tools">
          <button type="button" class="btn btn-tool float-right" data-card-widget="remove" style="margin-top:0.05rem"><i class="fa fa-remove"></i></button>
        </div>
     <div class="fields">
                <div class="row"><div class="col-3 form-group">
                        <label class="acies_label col-md-12">Field Name</label>
                      <input type="text" name="Field Name" class="form-control" placeholder="Field Name" value='${fieldDetails[i].fieldName}'/>
                    </div>
                    <div class="col-3 form-group">
                      <label class="acies_label">Field Data Type</label>
                      <input type="text" name="Field DataType" class="form-control" value='${fieldDetails[i].datatype}' readonly />
                    </div>
                    <div class="col-3 form-group">
                      <label class="acies_label col-md-12">Field Name Alias (to be displayed on the front end)</label>
                      <input type="text" name="Field Verbose Name" class="form-control" placeholder="Verbose Name" value='${fieldDetails[i].verboseName}'/>
                    </div>
                    <div class="col-1.5 form-group">
                      <label class="acies_label">Can take null values?</label>
                      <select class="select2 form-control" name="null">
                        <option value="" disabled>Select Option</option>`
            if (fieldDetails[i].null == "Yes") {
              stringCommon += `<option value="Yes" selected>Yes</option>
                        <option value="No">No</option>
                      </select>
                    </div><div class="col-1.5 form-group ">
                    <center><label class="acies_label">Computed Value</label></center>
                    <center><input type="checkbox" name="ComputedValue" value="off" disabled></center>
                    </div></div>`
            }
            if (fieldDetails[i].null == "No") {
              stringCommon += `<option value="Yes">Yes</option>
                        <option value="No" selected>No</option>
                      </select>
                    </div><div class="col-1.5 form-group ">
                    <label class="acies_label" style="padding-left:4rem">Computed Value</label>
                    <input type="checkbox" name="ComputedValue" value="off" style="margin-left:65%" disabled>
                    </div></div>`
            }

            stringCommon += `<div class="row">`

            if (fieldDetails[i].datatype == 'CharField') {
              stringCommon += `<div class="col-3 form-group" >
                <label class="acies_label col-md-12">Maximum Length<span class="asteriskField">*</span></label>
                  <input type="number" name="maxLength" class="form-control" min="0" value='${fieldDetails[i].maxLength}'/>
              </div>
               <div class="col-3 form-group" >
                  <label class="acies_label col-md-12">Choices</label>
                  <input type="textarea" name="choices" class="form-control" placeholder="Choices" value='${fieldDetails[i].choices}'/>
              </div></div></div></div>`
            }
            if (fieldDetails[i].datatype == 'ForeignKey') {
              stringCommon += `<div class="col-3 form-group">
                <label class="acies_label col-md-12">Foreign Key to(Table Name) :</label>
                  <input type="text" name="FKTable Name" class="form-control" placeholder="Table Name" value='${fieldDetails[i].foreignKeyTo}' readonly/>
                </div>
              <div class="col-3 form-group">
                  <label class="acies_label col-md-12">Related Field Name:</label>
                  <input type="text" name="FKRelated Name" class="form-control" placeholder="Related Name" value='${fieldDetails[i].related_name}'/>
                </div></div></div></div>`
            }
            if (["IntegerField", "BigIntegerField"].includes(fieldDetails[i].datatype)) {
              stringCommon += `<div class="col-3 form-group" >
                <label class="acies_label col-md-12">Default</label>
                  <input type="number" name="default" class="form-control" min="0" value='${fieldDetails[i].default}'/>
              </div></div></div></div>`
            }
            if (["FloatField"].includes(fieldDetails[i].datatype)) {
              stringCommon += `<div class="col-3 form-group" >
                <label class="acies_label col-md-12">Default</label>
                  <input type="number" name="default" class="form-control" min="0" value='${fieldDetails[i].default}' step="0.001"/>
              </div></div></div></div>`
            }
            if (["DateField", "TimeField", "DateTimeField"].includes(fieldDetails[i].datatype)) {
              stringCommon += `<div class="col-3 form-group">
                  <label class="acies_label col-md-12">Auto Now?</label>
                  <select class="select2 form-control" name="autoNow">`
              if (fieldDetails[i].auto_now == true) {
                stringCommon += `<option value="Yes" selected>Yes</option>
                    <option value="No">No</option>
                  </select></div>`
              }
              if (fieldDetails[i].auto_now == false) {
                stringCommon += `<option value="Yes">Yes</option>
                    <option value="No" selected>No</option>
                  </select></div>`
              }
              stringCommon += `<div class="col-3 form-group">
                  <label class="acies_label col-md-12">Editable?</label>
                  <select class="select2 form-control" name="editable">`
              if (fieldDetails[i].editable == true) {
                stringCommon += `<option value="Yes" selected>Yes</option>
                    <option value="No">No</option>
                  </select></div></div></div></div>`
              }
              if (fieldDetails[i].editable == false) {
                stringCommon += `<option value="Yes">Yes</option>
                    <option value="No" selected>No</option>
                  </select></div></div></div></div>`
              }
            }
            $('#formElements').append(stringCommon)
          }
          $('select.select2:not(.modal select.select2)').each(function(){
            parent = $(this).parent()
            $(this).select2({dropdownParent:parent})
        })
        $('.modal select.select2').each(function(){
            $(this).select2()
        })
          $('input[name="Field Name"]').on('change', fieldNameValidation)
          $('#card1').addClass("collapsed-card");
          $("#card1 > div.card-body").css("display", "none");
          $("#card1 > div.card-footer").css("display", "none");
          $("#card1").find("i.fa-minus").addClass('fa-plus').removeClass('fa-minus');
          $("#card1").find("i.fa-check-circle").css("display", "inline-block");

          $('#card2').removeClass("collapsed-card");
          $("#card2 > div.card-body").css("display", "block");
          $("#card2 > div.card-footer").css("display", "block");
          $("#card2").find("i.fa-plus").addClass('fa-minus').removeClass('fa-plus');
        },
        error: function () {
          Swal.fire({icon: 'error',text: 'Error! Failure in saving Data Table. Please try again.'});
        }
      })
    }

  })
  $('#addButton0').click(addFunction)
  $('#addButton').click(addFunction)
  function addFunction(e) {
    var field = `<div class="card col-12"><div class="card-tools">
          <button type="button" class="btn btn-tool float-right" data-card-widget="remove" style="margin-top:0.05rem"><i class="fa fa-remove"></i></button>
        </div><div class="fields ">
                <div class="row">
                <div class="col-3 form-group">
                    <label class="acies_label col-md-12">Field Name</label>
                    <input type="text" name="Field Name" class="form-control" placeholder="Field Name" />
                  </div>
                <div class="col-3 form-group">
                  <label class="acies_label">Field Data Type</label>
                  <select class="select2 datatype form-control select2 form-control" name="Field DataType">
                    <option value="" disabled selected>Select Data Type</option>`
    if (selectedDropdownSelectedValueList) {
      if (selectedDropdownSelectedValueList.length > 0) {
        field += `<option value="AutoField" disabled>AutoField</option>`
      }
      if (selectedDropdownSelectedValueList.length == 0) {
        field += `<option value="AutoField">AutoField</option>`
      }

    }
    else { field += `<option value="AutoField">AutoField (Primary key)</option>` }
    field += `<option value="CharField">CharField (Text,numbers,special characters,etc.)</option>
                    <option value="TextField">TextField (Large text)</option>
                    <option value="BooleanField">BooleanField (Yes or No,True or False,etc.)</option>
                    <option value="FileField">FileField (File/document upload)</option>
                    <option value="VideoField">VideoField</option>
                    <option value="ImageField">ImageField (Image upload)</option>
                    <option value="IntegerField">IntegerField (Integer numbers)</option>
                    <option value="BigIntegerField">BigIntegerField (Big Integer numbers)</option>
                    <option value="FloatField">FloatField (Integer or decimal numbers)</option>
                    <option value="DateField">DateField (Date)</option>
                    <option value="DateTimeField">DateTimeField (Date and Time)</option>
                    <option value="TimeField">TimeField (Time)</option>
                  </select>
                </div>
                <div class="col-3 form-group">
                  <label class="acies_label col-md-12">Field Name Alias (to be displayed on the front end)</label>
                  <input type="text" name="Field Verbose Name" class="form-control" placeholder="Verbose Name" />
                </div>
                <div class="col-1.5 form-group">
                  <label class="acies_label">Can take null values?</label>
                  <select class="select2 nullField form-control" name="null">
                    <option value="" disabled selected>Select Option</option>
                    <option value="Yes">Yes</option>
                    <option value="No">No</option>
                  </select>
                </div>
                <div class="col-1.5 form-group ">
                    <label class="acies_label" style="padding-left:4rem">Computed Value</label>
                    <input type="checkbox" name="ComputedValue" value="off" style="margin-left:65%">
                    </div>
              </div>
              <div class="col-1.5 form-group">
                  <label class="acies_label">Unique</label>
                  <select class="select2 nullField form-control" name="null">
                    <option value="" disabled selected>Select Option</option>
                    <option value="Yes">Yes</option>
                    <option value="No">No</option>
                  </select>
                </div>
                </div></div>`
    if (e.target.id == 'addButton0') {
      $('#formElements0').append(field)
    }
    if (e.target.id == 'addButton') {
      $('#formElements').append(field)
    }
    $("body").off("select2:select")
    $('select.select2:not(.modal select.select2)').each(function(){
      parent = $(this).parent()
      $(this).select2({dropdownParent:parent})
  })
  $('.modal select.select2').each(function(){
      $(this).select2()
  })
    $('.datatype').on('select2:select', displaySpecificData);
    $('input[name="Field Name"]').on('change', fieldNameValidation)
  }
  $('.datatype').on('select2:select', displaySpecificData);
  $('.datatype2').on('select2:select', displaySpecificData2);
  var modelList = {{ modelsList| safe }};

  var selectedDropdownSelectedValueList;

  function displaySpecificData() {

    var fieldPosition = $(this).parent().parent().parent()
    var selectedDataType = $(this).val()
    extraElements = fieldPosition.find("div").slice(15)
    $("#addelement_null").attr('disabled', false)
    $("#addelement_unique").attr('disabled', false)
    extraElements.each(function () {
      $(this).remove()
    })
    direct_field_access = true
    if (selectedDataType == '0') {
      var specificElements = ``
      fieldPosition.append(specificElements)
    }

    if (selectedDataType == 'AutoField') {
      $("#addelement_null").val("No").change()
      $("#addelement_null").attr("disabled", true)
      $("#addelement_unique").val("Yes").change()
      $("#addelement_unique").attr("disabled", true)
    }

    if (selectedDataType == 'CharField') {
      var specificElements = `<div class="row ml-0">
                        <div class="col-3 form-group" >
                <label class="acies_label">Maximum length<span class="asteriskField">*</span></label>
                  <input type="number" name="maxLength" class="form-control numberinput max_length_ID" min="0" />
              </div>
               <div class="col-3 form-group" >
                  <label class="acies_label">Choices</label>
                  <select class="form-control select2_multiplechoices_add" multiple="multiple" name="choices">
                  </select>
              </div>
              <div class="col-3 form-group" >
                <label class="acies_label">Blacklist Characters</label>
                  <select class="form-control multipleform_bklist_add" multiple></select>
              </div>
              <div class="col-3 form-group" >
                <label class="acies_label">Default</label>
                  <input type="text" name="default" class="form-control textInput"/>
              </div>
              <div class="row ml-0"><div class="col-6 form-group">
                <label class="acies_label">Secure with?</label>
                  <select name="datakey" class="form-control select2 enclass" min="0">
                    <option value="None" selected="">None
                    </option><option value="encrypt">Encryption
                    </option></select>
              </div><div class="col-4 form-group kclass" style="">
                <label class="acies_label">Key</label>
                  <input type="text" name="datakey" class="form-control textInput" min="0">
              </div></div>`
      fieldPosition.append(specificElements)
    }
    if (selectedDataType == 'ConcatenationField') {
      var specificElements = `<div class="row">
                                <div class="col-3 form-group" >
                                  <label class="acies_label">Maximum length<span class="asteriskField">*</span></label>
                                  <input type="number" name="edit_maxLength" class="form-control numberinput" min="0" />
                              </div>


            <div class="col-3">
              <label class="acies_label">Columns1</label>
              <select class="form-control textInput" id="multipleform_add" name="concat_columns" multiple="multiple">
              </select>
            </div>
            <div class="col-3">
              <label class="acies_label">Divider</label>
              <select class="select2 divider" name="divider" style="width:103.225px !important;">
                <option value="" selected>No divider</option>
                <option value="_">_</option>
                <option value="*">*</option>
                <option value="-">-</option>
                <option value="+">+</option>
                <option value="#">#</option>
                <option value="$">$</option>
                <option value="%">%</option>
                <option value="@">@</option>
                <option value="!">!</option>
                <option value="&">&</option>
                <option value=".">.</option>
                <option value="?">?</option>
              </select>
            </div>
            <div class="col-3">

            </div>
          </div>`
      fieldPosition.append(specificElements)
    }
    if (selectedDataType == 'VideoField') {
      var specificElements = `<div class="row">
                        <div class="col-3 form-group">
                        <label class="acies_label" style="padding-left:0.3em;">Video Type2</label>
                        <select name="video_type_extension" id="video_type_extension" class="form-control select2 video_type_extension" style="margin-right: 15px;margin-top:-18px;">
                        <option value="external_link">External links (Youtube & Vimeo links)</option>
                        <option value="Video">Video files (mp4/webm/ogv)</option>
                        <option value="mp4">Video files (mp4 only)</option>
                        <option value="webm">Video files (webm only) </option>
                        <option value="ogv">Video files (ogv only)</option>
                      </select>
              </div></div>`
              fieldPosition.append(specificElements)
              $('#unique').parent().css("display","none");
              $('#addelement_unique').parent().css("display","none");
      }
    if (selectedDataType == 'FileField') {
      var specificElements = `<div class="row">
                        <div class="col-3 form-group">
                        <label class="acies_label">Limit file extensions</label>
                        <select name="edit_extension" id="edit_extension" class="form-control select2" style="margin-right: 15px;margin-top:-18px;">
                        <option value="Any">Any</option>
                        <option value="Images">Images(All formats)</option>
                        <option value="PDF">PDF</option>
                        <option value="Document">Document(PDF, CSV, Excel, Word)</option>
                      </select>
              </div></div>`
      fieldPosition.append(specificElements)
    }

    if (selectedDataType == 'DateTimeRangeField') {

          $("#addelement_unique").val("No").change()
          $("#addelement_unique").attr('disabled', true)
    }

    if (selectedDataType == 'UniqueIDField') {
      var specificElements = `<div class="row">
                        <div class="col-3 form-group" >
                <label class="acies_label">Maximum length<span class="asteriskField">*</span></label>
                <input type="number" name="edit_maxLength" class="form-control numberinput" min="0" />
              </div>
              <div class="col-3" >
                    <label class="acies_label col-md-12" style="margin-left:3px;">Editable?</label>
                    <select class="form-control" name="editable">
                      <option value="No" disabled selected>No</option>
                    </select>
                </div>
               </div>
                <div class="row">
                <div class="col-4 m-2 form-inline">
              <label class="acies_label pr-2">UniqueIDField settings</label>
              <span id="add_uuid_config" data-toggle="modal" data-target="#uuid_settings_modal" onclick="edit_uuid_modal(this)" name="">
                              <a data-toggle="tooltip" title="UniqueIDField settings" value="uuid_settings"><i name="actions" value="uuid_settings" class="far fa-edit ihover javaSC thin-icon" style="font-size: 18px "></i></a>
                  </span>
                </div></div>`
          fieldPosition.append(specificElements)
          $("#addelement_null").val("No").change()
          $("select[name='editable']").attr("disabled", true)
          $("#addelement_null").attr('disabled', true)
          $("#addelement_unique").val("Yes").change()
          $("#addelement_unique").attr('disabled', true)
          $("#id_type").val("").change()
          $("#serial").val("").change()
          $("#id_length").val("")
          $("#id_text").val("")
          $("#position").val("").change()
          $("#id_type").on('change', function() {
            if ($('option:selected', `#id_type`).val() == "Alphanumeric") {
              $("#showhidealpha").css("display", "")
            }
            else {
              $("#showhidealpha").css("display", "none")
            }
          })
    }

    if (selectedDataType == 'DateRangeField') {
          $("#addelement_unique").val("No").change()
          $("#addelement_unique").attr('disabled', true)
    }

    if (["IntegerField","BigIntegerField", "FloatField"].includes(selectedDataType)) {
      var specificElements = `<div class="row">
                        <div class="col-3 form-group" >
                <label class="acies_label col-md-12">Default</label>
                  <input type="number" name="default" class="form-control numberInput" min="0" />
              </div><div class="col-3 form-group">
                  <label class="acies_label col-md-12">Editable?</label>
                  <select class="select2 form-control" name="editable">
                    <option value="" disabled selected>Select option</option>
                    <option value="Yes">Yes</option>
                    <option value="No">No</option>
                  </select>
                </div></div>`
      fieldPosition.append(specificElements)
    }

    if (selectedDataType == 'TimeRangeField') {

          $("#addelement_unique").val("No").change()
          $("#addelement_unique").attr('disabled', true)
    }

    if (["TextField","URLField"].includes(selectedDataType)) {
      var specificElements = `<div class="row">
                        <div class="col-3 form-group" >
                <label class="acies_label">Default</label>
                  <input type="text" name="default" class="form-control textInput"/>
              </div>
              <div class="col-3 form-group" >
                <label class="acies_label">Blacklist Characters</label>
                  <select class="form-control multipleform_bklist_add" multiple></select>
              </div>
              </div>`
      fieldPosition.append(specificElements)
    }
    if (['DateField', 'DateTimeField', 'TimeField'].includes(selectedDataType)) {
      var specificElements = `<div class="row">
                      <div class="col-3 form-group">
                  <label class="acies_label col-md-12">Auto now?</label>
                  <select class="select2 form-control" name="autoNow">
                    <option value="" disabled selected>Select option</option>
                    <option value="Yes">Yes</option>
                    <option value="No">No</option>
                  </select>
                </div>
              <div class="col-3 form-group">
                  <label class="acies_label col-md-12">Editable?</label>
                  <select class="select2 form-control" name="editable">
                    <option value="" disabled selected>Select option</option>
                    <option value="Yes">Yes</option>
                    <option value="No">No</option>
                  </select>
                </div>`
                if (selectedDataType != "DateField") {
                  specificElements += `<div class="col-3 form-group">
                    <label class="acies_label col-md-12" style="padding-left:3px;">Seconds precision?</label>
                    <select class="select2 form-control" name="useseconds">
                      <option value="" disabled>Select Option</option>
                      <option value="true">Yes</option>
                      <option value="false">No</option>
                  </div>
                  </div>`
                }
                else {
                  specificElements += "</div>"
                }
      fieldPosition.append(specificElements)
    }

    if (selectedDataType == 'CardField') {
      var specificElements = `<div class="row">
                        <div class="col-3 form-group" >
                <label class="acies_label col-md-12">Maximum length<span class="asteriskField">*</span></label>
                <input type="number" name="edit_maxLength" class="form-control" min="0" value="19" disabled/>
              </div>
              <div class="col-3" >
                    <label class="acies_label col-md-12" style="margin-left:3px;">Editable?</label>
                    <select class="form-control" name="editable">
                      <option value="No" disabled selected>No</option>
                    </select>
                </div>
               </div>
                <div class="row">
                <div class="col-4 m-2 form-inline">
              <label class="acies_label pr-2">CardField settings</label>
              <span id="add_card_config" data-toggle="modal" data-target="#card_settings_modal" onclick="edit_card_modal(this)" name="">
                              <a data-toggle="tooltip" title="CardField settings" value="card_settings"><i name="actions" value="card_settings" class="far fa-edit ihover javaSC thin-icon" style="font-size: 18px "></i></a>
                  </span>
                </div></div>`
          fieldPosition.append(specificElements)
          $("#addelement_null").val("No").change()
          $("select[name='editable']").attr("disabled", true)
          $("#addelement_null").attr('disabled', false)
          $("#addelement_unique").val("Yes").change()
          $("#addelement_unique").attr('disabled', true)
          $("#issuer_type").val("").change()
    }

    if (selectedDataType == 'PrivacyField') {
      var specificElements = `
                <div class="row">
                <div class="col-4 m-2 form-inline">
              <label class="acies_label pr-2">PrivacyField settings</label>
              <span id="add_privacy_config" data-toggle="modal" data-target="#privacy_settings_modal" onclick="edit_privacy_modal(this)" name="">
                              <a data-toggle="tooltip" title="PrivacyField settings" value="privacy_settings"><i name="actions" value="privacy_settings" class="far fa-edit ihover javaSC thin-icon" style="font-size: 18px "></i></a>
                  </span>
                </div></div>`
          fieldPosition.append(specificElements)
          $(".privacyf_selectop").val("").trigger("change")
          $(".privacyf_selectop").val("").trigger("select2:select")
    }

    if (selectedDataType == 'TableField') {
      var specificElements = `<div class="row">
                        <div class="col-3 form-group" >
                <label class="acies_label col-md-12">Maximum length<span class="asteriskField">*</span></label>
                <input type="number" name="edit_maxLength" class="form-control" min="0" value="19" disabled/>
              </div>
              <div class="col-3" >
                    <label class="acies_label col-md-12" style="margin-left:3px;">Editable?</label>
                    <select class="form-control" name="editable">
                      <option value="No" disabled selected>No</option>
                    </select>
                </div>
               </div>
                <div class="row">
                <div class="col-4 m-2 form-inline">
              <label class="acies_label pr-2">TableField settings</label>
              <span id="add_table_config" data-toggle="modal" data-target="#table_settings_modal" onclick="edit_table_modal(this)" name="">
                              <a data-toggle="tooltip" title="TableField settings" value="table_settings"><i name="actions" value="table_settings" class="far fa-edit ihover javaSC thin-icon" style="font-size: 18px "></i></a>
                  </span>
                </div></div>`
          fieldPosition.append(specificElements)
          $("#addelement_null").val("No").change()
          $("select[name='editable']").attr("disabled", true)
          $("#addelement_null").attr('disabled', false)
          $("#addelement_unique").val("Yes").change()
          $("#addelement_unique").attr('disabled', true)
    }

    if (selectedDataType == 'CardCvvField') {
      if(!direct_field_access){
        var specificElements = `<div class="row">
                          <div class="col-3 form-group" >
                  <label class="acies_label col-md-12">Maximum length<span class="asteriskField">*</span></label>
                  <input type="number" name="edit_maxLength" class="form-control" min="0" value="4" disabled/>
                </div>
                </div>
                  `
            fieldPosition.append(specificElements)
            $("#addelement_null").attr('disabled', false)
            $("#addelement_unique").val("No").change()
            $("#addelement_unique").attr('disabled', true)
      }else{
        $(this).val("0").trigger("change")
        Swal.fire({icon: 'warning',text: 'Please use cardfield to create cvv field'});
      }
    }

    if (selectedDataType == 'CardExpiryField') {
      if(!direct_field_access){

          $("#addelement_null").attr('disabled', false)
          $("#addelement_unique").val("No").change()
          $("#addelement_unique").attr('disabled', true)
      }else{
        $(this).val("0").trigger("change")
        Swal.fire({icon: 'warning',text: 'Please use cardfield to create card expiry field'});
      }
    }

    if (selectedDataType == 'CardTypeField') {

      if(!direct_field_access){

        $("#addelement_null").attr('disabled', false)
        $("#addelement_unique").val("No").change()
        $("#addelement_unique").attr('disabled', true)
      }else{
        $(this).val("0").trigger("change")
        Swal.fire({icon: 'warning',text: 'Please use cardfield to create card type field'});
      }
    }

    if (selectedDataType == 'EmailTypeField') {
      var specificElements = `<div class="row ml-0">
                        <div class="col-4 form-group" >
                <label class="acies_label">Maximum length<span class="asteriskField">*</span></label>
                  <input type="number" name="maxLength" class="form-control numberinput max_length_ID" min="0" />
              </div>`
      fieldPosition.append(specificElements)
    }

    if (selectedDataType == 'RTFField') {
      var specificElements = `<div class="row ml-0">
                        <div class="col-4 form-group" >
                <label class="acies_label">Maximum length<span class="asteriskField">*</span></label>
                  <input type="number" name="maxLength" class="form-control numberinput max_length_ID" min="0" />
              </div>`
      fieldPosition.append(specificElements)
    }

    if (selectedDataType == 'MultiselectField') {
      var specificElements = `<div class="row">
              <div class="col-3" >
                    <label class="acies_label col-md-12" style="margin-left:3px;">Editable?</label>
                    <select class="form-control" name="editable">
                      <option value="No" disabled selected>No</option>
                    </select>
                </div>
               </div>
                <div class="row">
                <div class="col-4 m-2 form-inline">
              <label class="acies_label pr-2">MultiselectField settings</label>
              <span id="add_mulsel_config" data-toggle="modal" data-target="#mulsel_settings_modal" onclick="edit_mulsel_modal(this)" name="">
                              <a data-toggle="tooltip" title="MultiselectField settings" value="mulsel_settings"><i name="actions" value="mulsel_settings" class="far fa-edit ihover javaSC thin-icon" style="font-size: 18px "></i></a>
                  </span>
                </div></div>`
          fieldPosition.append(specificElements)
          $("#addelement_null").val("No").change()
          $("select[name='editable']").attr("disabled", true)
          $("#addelement_null").attr('disabled', false)
          $("#addelement_unique").val("Yes").change()
          $("#addelement_unique").attr('disabled', true)

          $('.multipleSelectedColumn').val($('#fieldmdl').val())
          $('.selectMultipleFormTable').val('').trigger('change')
          $(".def_values_opt").empty()
          columnForTables = []
          $('.defaultValue').prop('checked',false)
          $('.plus').prop('checked',false)
          $('.option_popup').prop('checked',false)
          $('#multiselectConditionModal').find('.mainCont').empty()
    }

    direct_field_access = false

    $(".enclass").on("change", function() {
        if($(this).val() != "None"){
          $(".kclass").show();
        }
        else {
            $(".kclass").hide();
        }
    })

    $('.datatype').each(function () {
      $(this).find('option').each(function () {
        if ($(this).attr('value')) {
          $(this).attr('disabled', false)
        }
      })
    })
    selectedDropdownSelectedValueList = [];
    $('.datatype').each(function () {
      var selectedValue = $(this).find(':selected');
      if (selectedValue.attr("value") == 'AutoField') {
        selectedDropdownSelectedValueList.push(selectedValue.attr("value"))
      }
    })
    $('.datatype').each(function () {
      $(this).find('option').each(function () {
        if ($(this).attr('value')) {
          if (selectedDropdownSelectedValueList.includes($(this).attr('value'))) {
            $(this).attr('disabled', true)
          }
        }
      })
    })

    $('select.select2:not(.modal select.select2)').each(function(){
      parent = $(this).parent()
      $(this).select2({dropdownParent:parent})
  })
  $('.modal select.select2').each(function(){
      $(this).select2()
  })
    $('.multipleform_bklist_add').select2({
        tags:true
      })
    $("#multipleform_add").select2({
      })
      $(".select2_multiplechoices_add").select2({
        tags:true
      })
      var child_list = ($("#myList")[0].children.length)
      var name;
      for (var i = 1; i < child_list; i++) {
        name = $("#myList")[0].children[i].innerHTML
        if(!((name == "created_date") || (name == "modified_date") || (name =="created_by") || (name == "modified_by")))
         {
          $('#multipleform_add').append(`<option value="${name}">
                                       ${name}
                                  </option>`);
         }
       }

  }
  function displaySpecificData2() {
    var fieldPosition = $(this).parent().parent().parent()

    var selectedDataType = $(this).val()
    extraElements = fieldPosition.find("div").slice(15)
    $("#null_field_edit").attr('disabled', false)
    $("#unique").attr('disabled', false)
    extraElements.each(function () {
      $(this).remove()
    })
    direct_field_access = true
    if (selectedDataType == '0') {
      var specificElements = ``
      fieldPosition.append(specificElements)
    }

    if (selectedDataType == 'CharField') {
      var specificElements = `<div class="row ml-0">
                        <div class="col-lg-3 col-md-3 col-sm-6 form-group" >
                <label class="acies_label col-md-12">Maximum length<span class="asteriskField">*</span></label>
                  <input type="number" name="maxLength" class="form-control numberinput" min="0" />
              </div>
               <div class="col-lg-3 col-md-3 col-sm-6 form-group" >
                  <label class="acies_label col-md-12">Choices</label>
                  <select class="form-control select2_multiplechoices_edit" multiple="multiple">
                  </select>
              </div>
              <div class="col-lg-3 col-md-3 col-sm-6 form-group" >
                <label class="acies_label col-md-12">Default</label>
                  <input type="text" name="default" class="form-control textInput ml-1" />
              </div>
              <div class="col-lg-3 col-md-3 col-sm-6 form-group" >
                <label class="acies_label col-md-12">Blacklist Characters</label>
                  <select class="form-control multipleform_bklist_add1" multiple></select>
              </div>
              </div>
              <div class="row ml-0"><div class="col-lg-3 col-md-3 col-sm-6 form-group">
                <label class="acies_label col-md-12">Secure with?</label>
                  <select name="datakey" class="form-control select2 enclass ml-1" min="0">
                    <option value="None" selected="">None
                    </option><option value="encrypt">Encryption
                    </option></select>
              </div><div class="col-lg-3 col-md-3 col-sm-6 form-group kclass" style="">
                <label class="acies_label col-md-12">Key</label>
                  <input type="text" name="datakey" class="form-control textInput ml-1" min="0">
              </div></div>`
      fieldPosition.append(specificElements)
    }
    if (selectedDataType == 'VideoField') {
      var specificElements = `<div class="row ml-0">
                        <div class="col-6 form-group">
                        <label class="acies_label" style="padding-left:0.3em;">Video Type3</label>
                        </div>
                        <div class="col-4 form-group">
                        <select name="video_type_extension" id="video_type_extension" class="form-control select2 video_type_extension" style="margin-right: 15px;margin-top:-18px;">
                        <option value="external_link">External links (Youtube & Vimeo links)</option>
                        <option value="Video">Video files (mp4/webm/ogv)</option>
                        <option value="mp4">Video files (mp4 only)</option>
                        <option value="webm">Video files (webm only) </option>
                        <option value="ogv">Video files (ogv only)</option>
                      </select>
              </div></div>`
              fieldPosition.append(specificElements)
              $('#unique').parent().css("display","none");
              $('#addelement_unique').parent().css("display","none");
      }
    if (selectedDataType == 'FileField') {
      var specificElements = `<div class="row ml-0">
                        <div class="col-6 form-group">
                        <label class="acies_label" style="padding-left:0.3em;">Limit file extensions3</label>
                        </div>
                        <div class="col-4 form-group">
                        <select name="edit_extension" id="edit_extension" class="form-control select2" style="margin-right: 15px;margin-top:-18px;">
                        <option value="Any">Any</option>
                        <option value="Images">Images(All formats)</option>
                        <option value="PDF">PDF</option>
                        <option value="Document">Document(PDF, CSV, Excel, Word)</option>
                      </select>
              </div></div>`
              fieldPosition.append(specificElements)
    }
    if (selectedDataType == 'ConcatenationField') {
      var specificElements = `<div class="row ml-0">
                        <div class="col-lg-3 col-md-3 col-sm-6 form-group" >
                <label class="acies_label col-md-12">Maximum length<span class="asteriskField">*</span></label>
                  <input type="number" name="edit_maxLength" class="form-control numberinput ml-0.5" min="0" />
              </div>


            <div class="col-lg-3 col-md-3 col-sm-6 form-group">
              <label class="acies_label">Columns</label>
              <select class="form-control textInput" id="edit_multipleform_add" name="concat_columns" multiple="multiple">
              </select>
            </div>
            <div class="col-lg-3 col-md-3 col-sm-6 form-group">
              <label class="acies_label">Divider</label>
              <select class="select2 edit_divider" name="divider" style="width:103.225px !important;">
                <option value="" selected>No divider</option>
                <option value="_">_</option>
                <option value="*">*</option>
                <option value="-">-</option>
                <option value="+">+</option>
                <option value="#">#</option>
                <option value="$">$</option>
                <option value="%">%</option>
                <option value="@">@</option>
                <option value="!">!</option>
                <option value="&">&</option>
                <option value=".">.</option>
                <option value="?">?</option>
              </select>
            </div>
            <div class="col-lg-3 col-md-3 col-sm-6">

            </div>
          </div>`
      fieldPosition.append(specificElements)
    }
    if (selectedDataType == 'UniqueIDField') {
      var specificElements = `<div class="row ml-0">
                         <div class="col-6" >
                          <label class="acies_label col-md-12">Maximum length<span class="asteriskField">*</span></label>
                         </div>
                         <div class="col-4" >
                  <input type="number" name="edit_maxLength" class="form-control numberinput" min="0" />
               </div>
               <div class="col-6" >
                    <label class="acies_label col-md-12 mt-4">Editable?</label>
               </div>
               <div class="col-4" style="margin-top:12px" >
                <select class="select2  form-control" name="editable">
                  <option value="0" disabled selected>Select option</option>
                  <option value="Yes">Yes</option>
                  <option value="No">No</option>
                </select>
                </div>


                <div class="col-4 mt-4 form-inline">
              <label class="acies_label pr-2">UniqueIDField settings</label>
              <span id="edit_uuid_config" data-toggle="modal" data-target="#uuid_settings_modal" onclick="edit_uuid_modal(this)" name="">
                              <a data-toggle="tooltip" title="UniqueIDField settings" value="uuid_settings"><i name="actions" value="uuid_settings" class="far fa-edit ihover javaSC thin-icon" style="font-size: 18px "></i></a>
                  </span>
                </div></div>`
          fieldPosition.append(specificElements)
          $("select[name='editable']").attr("disabled", true)
          $("#id_type").val("").change()
          $("#serial").val("").change()
          $("#null_field_edit").attr('disabled', false)
          $("#unique").attr('disabled', false)
          $("#id_length").val("")
          $("#id_text").val("")
          $("#position").val("").change()
          $("#id_type").on('change', function() {
            if ($('option:selected', `#id_type`).val() == "Alphanumeric") {
              $("#showhidealpha").css("display", "")
            }
            else {
              $("#showhidealpha").css("display", "none")
            }
          })
    }

    if (selectedDataType == 'DateRangeField') {

          $("#addelement_unique").val("No").change()
          $("#addelement_unique").attr('disabled', true)
    }

    if (["IntegerField","BigIntegerField", "FloatField"].includes(selectedDataType)) {
      var specificElements = `<div class="row ml-0">
                        <div class="col-6 form-group" >
                          <label class="acies_label col-md-12">Default</label>
                        </div>
                        <div class="col-4 form-group" >
                          <input type="number" name="default" class="form-control numberinput" min="0" />
                        </div>
              <div class="col-6 form-group">
                  <label class="acies_label col-md-12">Editable?</label>
              </div>
              <div class="col-4 form-group">
                  <select class="select2 form-control" name="editable">
                    <option value="" disabled selected>Select option</option>
                    <option value="Yes">Yes</option>
                    <option value="No">No</option>
                  </select>
                </div>
              </div>`
      fieldPosition.append(specificElements)
    }

    if (selectedDataType == 'TimeRangeField') {

          $("#addelement_unique").val("No").change()
          $("#addelement_unique").attr('disabled', true)
      }

    if (["TextField","URLField"].includes(selectedDataType)) {
      var specificElements = `<div class="row ml-0">
                        <div class="col-6 form-group" >
                <label class="acies_label col-md-12">Default</label>
                        </div>
                        <div class="col-4 form-group" >
                  <input type="text" name="default" class="form-control textInput" />
              </div></div>
              <div class="row ml-0">
                        <div class="col-6 form-group" >
                <label class="acies_label col-md-12">Blacklist Characters</label>
                        </div>
                        <div class="col-4 form-group" >
                        <select class="form-control multipleform_bklist_add1" multiple></select>
              </div></div>`
      fieldPosition.append(specificElements)
    }

    if (selectedDataType == 'DateTimeRangeField') {

          $("#addelement_unique").val("No").change()
          $("#addelement_unique").attr('disabled', true)
      }


    if (['DateField', 'DateTimeField', 'TimeField'].includes(selectedDataType)) {
      var specificElements = `<div class="row ml-0">
                      <div class="col-6 form-group">
                  <label class="acies_label" style="padding-left:0.3em">Auto now?</label>
                      </div>
                      <div class="col-4 form-group">
                  <select class="select2 form-control" name="autoNow">
                    <option value="" disabled selected>Select option</option>
                    <option value="Yes">Yes</option>
                    <option value="No">No</option>
                  </select>
                </div>
              <div class="col-6 form-group">
                  <label class="acies_label">Editable?</label>
              </div>
              <div class="col-4 form-group">
                  <select class="select2 form-control" name="editable">
                    <option value="" disabled selected>Select option</option>
                    <option value="Yes">Yes</option>
                    <option value="No">No</option>
                  </select>
                </div>`
                  if (selectedDataType != "DateField") {
                  specificElements += `<div class="col-6 form-group">
                    <label class="acies_label col-md-12" style="padding-left:3px;">Seconds precision?</label>
                  </div>
                  <div class="col-4 form-group">
                    <select class="select2 form-control" name="useseconds">
                      <option value="" disabled>Select Option</option>
                      <option value="true">Yes</option>
                      <option value="false">No</option>
                  </div></div>`
                }
                else {
                  specificElements += "</div>"
                }
      fieldPosition.append(specificElements)
    }

    if (['CardCvvField', 'CardExpiryField', 'CardTypeField'].includes(selectedDataType)) {
      if(direct_field_access){
        $(this).val(selectedDataType).trigger("change")
        direct_field_access = false
        Swal.fire({icon: 'warning',text: `Please add a new cardfield to ${selectedDataType}`});
      }
    }

    if (selectedDataType == 'EmailTypeField') {
      var specificElements = `<div class="row ml-0">
                        <div class="col-lg-3 col-md-3 col-sm-6 form-group" >
                <label class="acies_label col-md-12">Maximum length<span class="asteriskField">*</span></label>
                  <input type="number" name="maxLength" class="form-control numberinput" min="0" />
              </div>
              </div>`
      fieldPosition.append(specificElements)
    }

    if (selectedDataType == 'RTFField') {
      var specificElements = `<div class="row ml-0">
                        <div class="col-lg-3 col-md-3 col-sm-6 form-group" >
                <label class="acies_label col-md-12">Maximum length<span class="asteriskField">*</span></label>
                  <input type="number" name="maxLength" class="form-control numberinput" min="0" />
              </div>
              </div>`
      fieldPosition.append(specificElements)
    }

    if (selectedDataType == 'MultiselectField') {
      var specificElements = `<div class="row">
              <div class="col-3" >
                    <label class="acies_label col-md-12" style="margin-left:3px;">Editable?</label>
                    <select class="form-control" name="editable">
                      <option value="No" disabled selected>No</option>
                    </select>
                </div>
               </div>
                <div class="row">
                <div class="col-4 m-2 form-inline">
              <label class="acies_label pr-2">MultiselectField settings</label>
              <span id="edit_mulsel_config" data-toggle="modal" data-target="#mulsel_settings_modal" onclick="edit_mulsel_modal(this)" name="">
                              <a data-toggle="tooltip" title="MultiselectField settings" value="mulsel_settings"><i name="actions" value="mulsel_settings" class="far fa-edit ihover javaSC thin-icon" style="font-size: 18px "></i></a>
                  </span>
                </div></div>`
          fieldPosition.append(specificElements)
          $("#addelement_null").val("No").change()
          $("select[name='editable']").attr("disabled", true)
          $("#addelement_null").attr('disabled', false)
          $("#addelement_unique").val("Yes").change()
          $("#addelement_unique").attr('disabled', true)

          $('.multipleSelectedColumn').val($('#selectedElement').text())
          $('.selectMultipleFormTable').val('').trigger('change')
          $(".def_values_opt").empty()
          columnForTables = []
          $('.defaultValue').prop('checked',false)
          $('.plus').prop('checked',false)
          $('.option_popup').prop('checked',false)
          $('#multiselectConditionModal').find('.mainCont').empty()
    }

    $('.datatype').each(function () {
      $(this).find('option').each(function () {
        if ($(this).attr('value')) {
          $(this).attr('disabled', false)
        }
      })
    })
    selectedDropdownSelectedValueList = [];
    $('.datatype').each(function () {
      var selectedValue = $(this).find(':selected');
      if (selectedValue.attr("value") == 'AutoField') {
        selectedDropdownSelectedValueList.push(selectedValue.attr("value"))
      }
    })
    $('.datatype').each(function () {
      $(this).find('option').each(function () {
        if ($(this).attr('value')) {
          if (selectedDropdownSelectedValueList.includes($(this).attr('value'))) {
            $(this).attr('disabled', true)
          }
        }
      })
    })

     $('select.select2:not(.modal select.select2)').each(function(){
    parent = $(this).parent()
    $(this).select2({dropdownParent:parent})
})
$('.modal select.select2').each(function(){
    $(this).select2()
})
    $('.multipleform_bklist_add1').select2({
        tags:true
      })
    $(".select2_multiplechoices_edit").select2({
        tags:true
      })

    $("#edit_multipleform_add").select2({
      })
      var v_name = $('#verbose_name').val()
      var tree = ($("#myList")[0].children.length)
      var name;
      for (var i = 1; i < tree; i++) {
        name = $("#myList")[0].children[i].innerHTML
        if(name == "created_date" || name == "modified_date" || name =="created_by" || name == "modified_by" || name == v_name)
         {

         }
        else{
           $('#edit_multipleform_add').append(`<option value="${name}">
                                       ${name}
                                  </option>`);
        }
       }

  }


  $('#saveFields').click(function () {
    if (a == 0) {
      $('.datatype').each(function () {
        $(this).find('option').each(function () {
          if ($(this).attr('value')) {
            $(this).attr('disabled', false)
          }
        })
      })
      var fieldList = []

      var fieldsTotal = $('.cardbody2').find('.fields').each(function () {
        var fieldDict = {}
        fieldDict['fieldName'] = $(this).find('input[name="Field Name"]').val()


        if ($(this).find('input[name="Field DataType"]').val()) {
          fieldDict['fieldDatatype'] = $(this).find('input[name="Field DataType"]').val()
        }
        if ($(this).find('select[name="Field DataType"]').val()) {
          fieldDict['fieldDatatype'] = $(this).find('select[name="Field DataType"]').val()
        }
        fieldDict['fieldVerboseName'] = $(this).find('input[name="Field Verbose Name"]').val()
        fieldDict['fieldNull'] = $(this).find('select[name="null"]').val()
        fieldDict['computedValue'] = $(this).find('input[name="ComputedValue"]')[0].checked
        if (fieldDict['fieldDatatype'] == 'CharField') {
          fieldDict['fieldMaxLength'] = $(this).find('input[name="maxLength"]').val()
          fieldDict['fieldChoices'] = $(this).find('select[name="choices"]').val()
        }
        if (fieldDict['fieldDatatype'] == 'ForeignKey') {
          if ($(this).find('input[name="FKTable Name"]').val()) {
            fieldDict['fieldFKTable'] = $(this).find('input[name="FKTable Name"]').val()
          }
          if ($(this).find('select[name="FKTable Name"]').val()) {
            fieldDict['fieldFKTable'] = $(this).find('select[name="FKTable Name"]').val()
          }
          fieldDict['fieldRelatedName'] = $(this).find('input[name="FKRelated Name"]').val()
        }
        if (["FileField", "ImageField"].includes(fieldDict['fieldDatatype'])) {

        }
        if (["IntegerField","BigIntegerField", "FloatField"].includes(fieldDict['fieldDatatype'])) {
          fieldDict['fieldDefault'] = $(this).find('input[name="default"]').val()
        }
        if (["DateField", "TimeField", "DateTimeField"].includes(fieldDict['fieldDatatype'])) {
          fieldDict['fieldAutoNow'] = $(this).find('select[name="autoNow"]').val()
          fieldDict['fieldEditable'] = $(this).find('select[name="editable"]').val()
          if(fieldDict['fieldDatatype'] != "DateField") {
          fieldDict['fieldUseSeconds'] = $(this).find('select[name="useseconds"]').val()
          }
        }

        fieldList.push(fieldDict)
      })
      var newTableName = $('#newTableName').val()
      $.ajax({
        url: window.location.pathname,

        data: {
          'tableName': newTableName,
          'fieldList': JSON.stringify(fieldList),
          'operation': 'three'
        },
        type: "POST",
        dataType: "json",
        success: function (data) {
          $('#card2').addClass("collapsed-card");
          $("#card2 > div.card-body").css("display", "none");
          $("#card2 > div.card-footer").css("display", "none");
          $("#card2").find("i.fa-plus").addClass('fa-plus').removeClass('fa-minus');
          $("#card2").find("i.fa-check-circle").css("display", "inline-block");
          $('#card3').removeClass("collapsed-card");
          $("#card3 > div.card-body").css("display", "block");
          $("#card3 > div.card-footer").css("display", "block");
          $("#card3").find("i.fa-plus").addClass('fa-minus').removeClass('fa-plus');

          $('.duallistbox').bootstrapDualListbox('refresh', true)
        },
        error: function () {
          Swal.fire({icon: 'error',text: 'Error! Failure in saving required fields in the Data Table. Please try again.'});
        }
      })
    }

  })


</script>

<script>
  $('.form-inline').on('keyup keypress', function(e) {
  var keyCode = e.keyCode || e.which;
  if (keyCode === 13) {
    e.preventDefault();
    return false;
  }
});
</script>

<!--Data discovery search script-->
<script>
  // FIlter anything

    $("#sysdefSearch").on("keyup", function () {
      var value = $(this).val().toLowerCase();
      $("#sysdeftable *").filter(function () {
        $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
      });
    });

    $("#sysdefSearch_def").on("keyup", function () {
      var value = $(this).val().toLowerCase();
      $("#sysdeftable_def *").filter(function () {
        $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
      });
    });

</script>

<script>
  // FIlter anything
  $(document).ready(function () {

    $("#fieldmdl").on("change", function () {
      if ($(this).val() !== "") {
        $.ajax({
          url: window.location.pathname,
          data: {
            'field_name': $(this).val(),
            'operation': 'fetch_similar_fields'
          },
          type: "POST",
          dataType: "json",
          success: function(data) {
            $('#dynamic').empty()
            $.each(data.matching_field_list, function (index, name) {
              $.each(name, function (key2, val2) {
                $('#dynamic').append('<tr> <td id="tab_name_add" style="width:50px">' + key2 + '</td> <td id="col_name_add" style="width:50px;text-align:center">' + val2 + '</td> <td style="padding-left:7px;width:20px;"><a title="Add New Element" value="update"><i name="actions" value="update" class="addforeignkey fa fa-plus-square fa-2x" style="color:var(--primary-color);"></i></a></td></tr>');
              })
            })
          },error: function () {
            Swal.fire({icon: 'error',text: 'Error! Please try again.'});
          }
        })
      } else {
        $('#dynamic').empty()
      }
    });
  })



</script>

<script>
  // FIlter anything

    $("#userdefSearch").on("keyup", function () {
      var value = $(this).val().toLowerCase();
      $("#userdeftable *").filter(function () {
        $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
      });
    });

    $("#userdefSearch_def").on("keyup", function () {
      var value = $(this).val().toLowerCase();
      $("#userdeftable_def *").filter(function () {
        $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
      });
    });

</script>



<!-- Equation builder -->
<script type="text/javascript" src="{%static 'js/ebjavascript.js'%}"></script>



<script>
  var $TABLE = $('#table');
  var $BTN = $('#export-btn');
  var $EXPORT = $('#export');

  var checkForSpecialChar = function(string){
    var specialChars = "<>@!#$%^&*()+[]{}?:;|'\"\\,./~`=";
    for(i = 0; i < specialChars.length;i++){
      if(string.indexOf(specialChars[i]) > -1){
          return true
        }
    }
    return false;
    }

    $('#tname').on('keypress', function (event) {
      var specialChars = "<>@!#$%^&*()+[]{}?:;|'\"\\,./~`=-";
      var key = String.fromCharCode(!event.charCode ? event.which : event.charCode);
      for(i = 0; i < specialChars.length;i++){
        if(key.indexOf(specialChars[i]) > -1){
          event.preventDefault();
          return false
          }
      }
    });

    $('#tname').on('paste', function (event) {
        var clipboardData = event.originalEvent.clipboardData || window.clipboardData;
        var pastedText = clipboardData.getData('text');
        var containsSpecialChars = false;
        var specialChars = "<>@!#$%^&*()+[]{}?:;|'\"\\,./~`=-";
        var stripped_out_str = ""
        for (i = 0; i < specialChars.length; i++) {
            if (pastedText.indexOf(specialChars[i]) > -1) {
                containsSpecialChars = true;
                break;
            }
        }

        if(containsSpecialChars){
           event.preventDefault();
           this.value = this.value+pastedText.replace(/[<>@!#$%^&*()+\[\]{}?:;|'\"\\,./~`=-\s]/g, '')
        }

      });

  $('.field_header').on('keypress', function (event) {
    var specialChars = "<>@!#$%^&*()+[]{}?:;|'\"\\,./~`=";
    var key = String.fromCharCode(!event.charCode ? event.which : event.charCode);
    for(i = 0; i < specialChars.length;i++){
      if(key.indexOf(specialChars[i]) > -1){
        event.preventDefault();
        return false
        }
    }
  });
  $('#field_header').on('paste', function (event) {
        var clipboardData = event.originalEvent.clipboardData || window.clipboardData;
        var pastedText = clipboardData.getData('text');
        var containsSpecialChars = false;
        var specialChars = "<>@!#$%^&*()+[]{}?:;|'\"\\,./~`=";
        var stripped_out_str = ""
        for (i = 0; i < specialChars.length; i++) {
            if (pastedText.indexOf(specialChars[i]) > -1) {
                containsSpecialChars = true;
                break;
            }
        }
        if(containsSpecialChars){
           event.preventDefault();
           $(this).text(pastedText.replace(/[<>@!#$%^&*()+\[\]{}?:;|'\"\\,./~`=\s]/g, ''))
        }

      });

  $('.max_length_ID').on('keypress', function (event) {
    var specialChars = "0123456789";
    var key = String.fromCharCode(!event.charCode ? event.which : event.charCode);
    if(!Number.isInteger(Number(key))) {
      event.preventDefault();
        return false
    }
  });

  $("#validation_cap_error").on('hidden.bs.modal', function () {
    $('.standard_button_click').prop('disabled',false)
})
  // CLoning replaced by templateString
  // Attach methods and listeners to new row
  var templateString = `<tr>
                          <td><span id='fld_name' class="fld_name" contenteditable="true" style="display: inline-block;min-width: 70px;max-width:70px;overflow:hidden; text-transform:lowercase;"></span></td>
                          <td>
                            <select class="table_datatype browser-default custom-select select2 form-control fieldselect"  style="width:179.325px !important"
                              >
                              <option value="" disabled selected>Select</option>
                              <option value="AutoField">AutoField (Primary key)</option>
                              <option value="CharField">CharField (Text,numbers,special characters,etc.)</option>
                              <option value="ConcatenationField">ConcatenationField</option>
                              <option value="TextField">TextField (Large text)</option>
                              <option value="BooleanField">BooleanField (Yes or No,True or False,etc.</option>
                              <option value="FileField">FileField (File/Document upload)</option>
                              <option value="VideoField">VideoField</option>
                              <option value="ImageField">ImageField (image upload)</option>
                              <option value="IntegerField">IntegerField (Integer numbers)</option>
                              <option value="BigIntegerField">BigIntegerField (Big Integer numbers)</option>
                              <option value="FloatField">FloatField (Integer or decimal numbers)</option>
                              <option value="DateField">DateField (Date)</option>
                              <option value="DateTimeField">DateTimeField (Date and Time)</option>
                              <option value="TimeField">TimeField (Time)</option>
                              <option value="UniqueIDField">UniqueIDField</option>
                              <option value="TimeRangeField">TimeRangeField</option>
                              <option value="DateTimeRangeField">DateTimeRangeField</option>
                              <option value="DateRangeField">DateRangeField</option>
                              <option value="URLField">URLField (URL Link)</option>
                              <option value="CardField">CardField (Credit card/Debit card)</option>
                              <option value="CardCvvField">CardCvvField</option>
                              <option value="CardExpiryField">CardExpiryField</option>
                              <option value="CardTypeField">CardTypeField (Identifies the type of card)</option>
                              <option value="UserField">UserField</option>
                              <option value="EmailTypeField">EmailTypeField</option>
                              <option value="TableField">TableField</option>
                              <option value="MultiselectField">MultiselectField</option>
                              <option value="RTFField">RTFField</option>
                              <option value="PrivacyField">PrivacyField</option>
                            </select>
                          </td>
                          <td><span id = 'prnt_tbl' contenteditable="false" style="display: inline-block;min-width: 70px;max-width:70px;overflow:hidden"></span></td>
                          <td><span id='field_header' class='field_header' contenteditable="true"  style="display: inline-block;min-width: 70px;max-width:70px;overflow:hidden"></span></td>
                          <td>
                            <select class="browser-default custom-select nulloption select2 form-control" style="width: 61.9625px !important;"
                              >
                              <option value="" disabled selected>Select</option>
                              <option value="1">Yes</option>
                              <option value="2">No</option>
                            </select>
                          </td>
                          <td><span id='max_length_ID' class='max_length_ID' contenteditable="false" style="display: inline-block;min-width: 70px;max-width:70px;overflow:hidden"></span></td>
                          <td>
                            <select class="form-control select2_multiplechoices select2" multiple="multiple" style="display: inline-block;width:70px;padding:0px;border:0px solid black" disabled>
                            </select>
                          </td>
                          <td>
                            <select class="browser-default computed_value_select custom-select coption select2 form-control" style="width: 99.575px !important"
                              >
                              <option value="" disabled selected>Select</option>
                              <option value="1">Yes</option>
                              <option value="2">No</option>
                            </select>
                          </td>
                          <td><span id='default_ID' contenteditable="false" style="display: inline-block; min-width: 70px;max-width:70px;overflow:hidden"></span></td>
                          <td>
                            <select class="browser-default custom-select select2 form-control autonowoption" disabled style="width: 81.175px !important;"
                              >
                              <option value="" disabled selected>Select</option>
                              <option value="1">Yes</option>
                              <option value="2">No</option>
                            </select>
                          </td>
                          <td>
                            <select class="browser-default custom-select select2 form-control editableoption" disabled style="width: 81.175px !important;"
                              >
                              <option value="" disabled selected>Select</option>
                              <option value="1">Yes</option>
                              <option value="2">No</option>
                            </select>
                          </td>
                          <td>
                            <select class="browser-default custom-select select2 form-control uniqueoption" style="width: 66.4875px !important;">
                              <option value="" disabled selected>select</option>
                              <option value="1">Yes</option>
                              <option value="2">No</option>
                            </select>
                          </td>
                          <td>
                            <select class="form-control multipleform select2" disabled multiple="multiple" style="display: inline-block;width:8em;padding:0px;border:0px solid black">
                            </select>
                          </td>
                          <td>
                            <select class="browser-default custom-select select2 form-control divideroption" disabled style="width:103.225px !important;">
                              <option value="">No divider</option>
                              <option value="_">_</option>
                              <option value="*">*</option>
                              <option value="-">-</option>
                              <option value="+">+</option>
                              <option value="#">#</option>
                              <option value="$">$</option>
                              <option value="%">%</option>
                              <option value="@">@</option>
                              <option value="!">!</option>
                              <option value="&">&</option>
                              <option value=".">.</option>
                              <option value="?">?</option>
                            </select>
                          </td>
                          <td>
                          <select class="browser-default custom-select multipleform_bklist select2 form-control" multiple data-tags="true"></select>
                          </td>
                          <td>
                          <select class="browser-default custom-select multipleform_compInp select2 form-control" multiple  data-tags="true"></select>
                          </td>
                          <td>
                            <span class="equationBuilder" style="display: none;">
                              <a data-toggle="tooltip" title="Equation Builder" value="eq" id="EBDisplayButtonID"><i name="actions1" value="eq" class="fas fa-square-root-alt ihover javaSC thin-icontrash ebdeqbtn" style="font-size: 18px;"></i></a>
                            </span>
                            <span class="table_remove" id="removerow">
                              <a data-toggle="tooltip" title="Delete record" value="delete"><i name="actions" value="delete" class="far fa-trash-alt ihover javaSC thin-icontrash" style="font-size: 18px;"></i></a>
                            </span>
                            <span id="uuid_config" style="display:none" data-toggle="modal" data-target="#uuid_settings_modal" onclick="uuid_modal(this)" name="">
                              <a data-toggle="tooltip" title="UniqueIDField settings" value="uuid_settings"><i name="actions" value="uuid_settings" class="far fa-edit ihover javaSC thin-icon" style="font-size: 18px "></i></a>
                            </span>
                            <span id="file_config" style="display:none" data-toggle="modal" data-target="#file_settings_modal" onclick="file_modal(this)" name="">
                              <a data-toggle="tooltip" title="UniqueIDField settings" value="file_settings"><i name="actions" value="file_settings" class="far fa-edit ihover javaSC thin-icon" style="font-size: 18px "></i></a>
                            </span>
                            <span id="video_config" style="display:none" data-toggle="modal" data-target="#video_settings_modal" onclick="video_modal(this)" name="">
                              <a data-toggle="tooltip" title="UniqueIDField settings" value="video_settings"><i name="actions" value="video_settings" class="far fa-edit ihover javaSC thin-icon" style="font-size: 18px "></i></a>
                            </span>
                            <span id="card_config" style="display:none" data-toggle="modal" data-target="#card_settings_modal" onclick="card_modal(this)" name="">
                              <a data-toggle="tooltip" title="Credit/Debit Card Issuer" value="card_settings"><i name="actions" value="card_settings" class="far fa-edit ihover javaSC thin-icon" style="font-size: 18px "></i></a>
                            </span>
                            <span id="cvv_config" style="display:none" name="">
                              <a data-toggle="tooltip" title="CVV" value="cvv_settings"><i name="actions" value="cvv_settings" class="far fa-edit ihover javaSC thin-icon" style="font-size: 18px "></i></a>
                            </span>
                            <span id="ctype_config" style="display:none" name="">
                              <a data-toggle="tooltip" title="ctype" value="ctype_settings"><i name="actions" value="ctype_settings" class="far fa-edit ihover javaSC thin-icon" style="font-size: 18px "></i></a>
                            </span>
                            <span id="exp_config" style="display:none" name="">
                              <a data-toggle="tooltip" title="exp" value="exp_settings"><i name="actions" value="exp_settings" class="far fa-edit ihover javaSC thin-icon" style="font-size: 18px "></i></a>
                            </span>
                            <span id="mulsel_config" style="display:none" data-toggle="modal" data-target="#mulsel_settings_modal" onclick="mulsel_modal(this)" name="">
                              <a data-toggle="tooltip" title="MultiselectField" value="card_settings"><i name="actions" value="mulsel_settings" class="far fa-edit ihover javaSC thin-icon" style="font-size: 18px "></i></a>
                            </span>
                            <span id="table_config" style="display:none" data-toggle="modal" data-target="#table_settings_modal" onclick="table_modal(this)" name="">
                              <a data-toggle="tooltip" title="Tablefield Settings" value="table_settings"><i name="actions" value="table_settings" class="far fa-edit ihover javaSC thin-icon" style="font-size: 18px "></i></a>
                            </span>
                            <span id="privacy_config" style="display:none" data-toggle="modal" data-target="#privacy_settings_modal" onclick="privacy_modal(this)" name="">
                              <a data-toggle="tooltip" title="PrivacyField" value="privacy_settings"><i name="actions" value="privacy_settings" class="far fa-edit ihover javaSC thin-icon" style="font-size: 18px "></i></a>
                            </span>
                          </td>
                        </tr>`;

  $('#addFieldRow').click(function () {
    console.log('clicked')
    console.log($TABLE)
    console.log($TABLE.find('table tbody'))
    $TABLE.find('table tbody').append(templateString);

    var lastTr = $TABLE.find('table tr').last();
    lastTr.find('.table_remove').click(removeFunc);
    lastTr.find('.table-up').click(upFunc);
    lastTr.find('.table-down').click(downFunc);

       $(".multipleform").select2({
      })

      lastTr.find(".multipleform_bklist").select2({tags: true})

    $("#example11 tr").each(function(){
     var opt = $(this).find("td:nth-child(2) select option:selected").text()
     if(opt != "AutoField (Primary key)" && opt != "Select" && opt != "")
     {
      $('.multipleform')
         .append($("<option></option>")
                    .attr("value",($(this).find("td").first().text()))
                    .text(($(this).find("td").first().text())));
     }
    });
    $(".multipleform").select2({
      })

      $(".coption").change(function() {
        let columns = {}
        let tbinx = $(this).parent().parent().index()

        colList = {}
        $(`#table .hide:lt(${tbinx+1})`).each(function(){
                    colList[$(this).find('td').find('.fld_name').text()] = $(this).find('td').find('#field_header').text()
                })
          if($(this).val()=='1') {
              $(this).parent().parent().children().last().find('.equationBuilder').css('display','inline')

              $(this).parent().parent().children().last().find('.equationBuilder').find("#EBDisplayButtonID").off('click').on('click', function(){
                $("#EBDisplayModel").modal('show');
            });

            $(this).parent().parent().find('td').eq(15).find('select').empty()
            for (let [key,value] of Object.entries(colList)) {
              $(this).parent().parent().find('td').eq(15).find('select').append(`<option value="${key}">${value}</option>`)
            }

          }else{
            $(this).parent().parent().children().last().find('.equationBuilder').css('display','none')

          }
      });
      $('.field_header').on('keypress', function (event) {
        var specialChars = "<>@!#$%^&*()+[]{}?:;|'\"\\,./~`=";
        var key = String.fromCharCode(!event.charCode ? event.which : event.charCode);
        for(i = 0; i < specialChars.length;i++){
          if(key.indexOf(specialChars[i]) > -1){
            event.preventDefault();
            return false
            }
        }
      });

     $('#field_header').on('paste', function (event) {
        var clipboardData = event.originalEvent.clipboardData || window.clipboardData;
        var pastedText = clipboardData.getData('text');
        var containsSpecialChars = false;
        var specialChars = "<>@!#$%^&*()+[]{}?:;|'\"\\,./~`=";
        var stripped_out_str = ""
        for (i = 0; i < specialChars.length; i++) {
            if (pastedText.indexOf(specialChars[i]) > -1) {
                containsSpecialChars = true;
                break;
            }
        }
        if(containsSpecialChars){
           event.preventDefault();
           $(this).text(pastedText.replace(/[<>@!#$%^&*()+\[\]{}?:;|'\"\\,./~`=\s]/g, ''))
        }

      });


      lastTr.find('#field_header').on('paste', function (event) {
        var clipboardData = event.originalEvent.clipboardData || window.clipboardData;
        var pastedText = clipboardData.getData('text');
        var containsSpecialChars = false;
        var specialChars = "<>@!#$%^&*()+[]{}?:;|'\"\\,./~`=";
        var stripped_out_str = ""
        for (i = 0; i < specialChars.length; i++) {
            if (pastedText.indexOf(specialChars[i]) > -1) {
                containsSpecialChars = true;
                break;
            }
        }
        if(containsSpecialChars){
           event.preventDefault();
           $(this).text(pastedText.replace(/[<>@!#$%^&*()+\[\]{}?:;|'\"\\,./~`=\s]/g, ''))
        }

      });


      $('.fld_name').on('keypress', function (event) {
        var specialChars = "<>@!#$%^&*()+[]{}?:; |'\"\\,./~`=-";
        var key = String.fromCharCode(!event.charCode ? event.which : event.charCode);
        for(i = 0; i < specialChars.length;i++){
          if(key.indexOf(specialChars[i]) > -1){
            event.preventDefault();
            return false
            }
        }
      });



      lastTr.find('#fld_name').on('paste', function (event) {
        var clipboardData = event.originalEvent.clipboardData || window.clipboardData;
        var pastedText = clipboardData.getData('text');
        var containsSpecialChars = false;
        var specialChars = "<>@!#$%^&*()+[]{}?:; |'\"\\,./~`=-";

        for (i = 0; i < specialChars.length; i++) {
            if (pastedText.indexOf(specialChars[i]) > -1) {
                containsSpecialChars = true;
                break;
            }
        }
        if(containsSpecialChars){
           event.preventDefault();
           $(this).text(pastedText.replace(/[<>@!#$%^&*()+\[\]{}?:; |'\"\\,./~`=-\s]/g, ''))
        }

      });


      $('.max_length_ID').on('keypress', function (event) {
        var specialChars = "0123456789";
        var key = String.fromCharCode(!event.charCode ? event.which : event.charCode);
        if(!Number.isInteger(Number(key))) {
          event.preventDefault();
            return false
        }
      });

      $(".nulloption").on("change", function() {
        if($(this).val() == "1"){
          $(this).parent().parent().find(".uniqueoption").val("2").prop("disabled", true);
        } else {
          $(this).parent().parent().find(".uniqueoption").prop("disabled", false);
        }
      });

      $(".ebdeqbtn").off("click").on("click", function() {
        $(".fld_name").each(function(index) {
            if(index != 0) {
            }
        })
      })
      $(".new_table_creation_card").find('select.select2:not(.modal select.select2)').each(function(){
        $(this).select2({dropdownParent:$(".new_table_creation_card")})
      })
    $(".new_table_creation_card").find('.modal select.select2').each(function(){
        $(this).select2()
    })
  });

  $('.table_remove').click(removeFunc);

  function removeFunc() {
    $(this).closest('tr').remove();
  };

  $('.table-up').click(upFunc);

  function upFunc() {
    var $row = $(this).parents('tr');
    if ($row.index() === 1) return; // Don't go above the header
    $row.prev().before($row.get(0));
  };

  $('.table-down').click(downFunc);

  function downFunc() {
    var $row = $(this).parents('tr');
    $row.next().after($row.get(0));
  };

  $("#validation_cap_error").on("hidden.bs.modal", function () {
    $('#export-btn').prop('disabled', false);
  });
  // A few jQuery helpers for exporting only
  jQuery.fn.pop = [].pop;
  jQuery.fn.shift = [].shift;

  $BTN.click(function () {
    var $rows = $TABLE.find('tr:not(:hidden)');
    var headers = [];
    var data = [];
    var data1 = [];
    let cap_fields_val= []
    $(".fld_name").each(function(index) {
        if(index != 0) {
        $(this).text($(this).text().toLowerCase())
        }
    })
    // Get the headers (add special header logic here)
    $($rows.shift()).find('th:not(:empty)').each(function () {

      headers.push($(this).text().toLowerCase());

    });

    // Turn all existing rows into a loopable array
    var create_table_flag = true;
    var val_msg = "";
    $rows.each(function (index, element) {
      if (index !== 0) {
        var $td = $(this).find('td');
        var h = {};
        var h1 = {};

        var dropdown_list = ["field data type", "nullable?", "unique", "computed value", "auto now?", "editable?","columns","divider","choices", "blacklist characters", "computed input"]
        var valid_field_dict = {
          "AutoField": ["field name", "field data type", "field header", "nullable?","unique","computed value", "computed input"],
          "CharField": ["field name", "field data type", "maximum length*", "field header", "choices", "nullable?","default","unique","blacklist characters","computed value", "computed input"],
          "ConcatenationField": ["field name", "field data type", "maximum length*", "field header", "editable?","nullable?","unique","columns","divider","computed value", "computed input"],
          "BooleanField": ["field name", "field data type", "field header", "nullable?","unique","computed value", "computed input"],
          "FileField": ["field name", "field data type", "nullable?", "field header","unique","computed value", "computed input"],
          "VideoField":["field name", "field data type", "nullable?", "field header"],
          "ImageField": ["field name", "field data type", "nullable?", "field header","unique","computed value", "computed input"],
          "IntegerField": ["field name", "field data type", "field header", "nullable?", "editable?", "default","unique","computed value", "computed input"],
          "BigIntegerField": ["field name", "field data type", "field header", "nullable?", "editable?", "default","unique","computed value", "computed input"],
          "DateField": ["field name", "field data type", "field header", "nullable?", "auto now?", "editable?","unique","computed value", "computed input"],
          "TimeField": ["field name", "field data type", "auto now?", "editable?", "nullable?", "field header","unique","computed value", "computed input"],
          "DateTimeField": ["field name", "field data type", "auto now?", "editable?", "nullable?", "field header","unique","computed value", "computed input"],
          "TextField": ["field name", "field data type", "field header", "nullable?","default","unique","computed value", "blacklist characters", "computed input"],
          "FloatField": ["field name", "field data type", "field header", "nullable?", "editable?", "default","unique","computed value", "computed input"],
          "UniqueIDField": ["field name", "field data type", "maximum length*", "field header", "editable?", "nullable?","unique", "computed value", "computed input"],
          "URLField": ["field name", "field data type", "field header", "nullable?","default","unique","computed value", "blacklist characters", "computed input"],
          "ForeignKey" : ["field name", "field data type","field header", "parent table", "nullable?", "default","unique"],
          "TimeRangeField": ["field name", "field data type", "maximum length*", "field header", "nullable?","unique", "computed value", "computed input"],
          "DateTimeRangeField": ["field name", "field data type", "maximum length*", "field header",, "nullable?","unique", "computed value", "computed input"],
          "DateRangeField": ["field name", "field data type", "maximum length*", "field header", "nullable?","unique", "computed value", "computed input"],
          "CardField": ["field name", "field data type", "field header", "nullable?","unique", "computed value", "computed input"],
          "CardCvvField": ["field name", "field data type", "field header", "nullable?","unique", "computed value", "computed input"],
          "CardExpiryField": ["field name", "field data type", "field header", "nullable?","unique", "computed value", "computed input"],
          "CardTypeField": ["field name", "field data type", "field header", "nullable?","unique", "computed value", "computed input"],
          "UserField": ["field name", "field data type", "field header", "nullable?","unique", "computed value", "computed input"],
          "EmailTypeField": ["field name", "field data type", "maximum length*", "field header", "nullable?","unique", "computed value", "computed input"],
          "TableField": ["field name", "field data type", "field header", "nullable?","unique", "computed value", "computed input"],
          "MultiselectField": ["field name", "field data type", "field header", "nullable?","unique", "computed value", "computed input"],
          "RTFField": ["field name", "field data type", "maximum length*", "field header", "nullable?","unique", "computed value", "computed input"],
          "PrivacyField": ["field name", "field data type", "field header", "nullable?","unique", "computed value", "computed input"],
        }

        var data_type = $td.eq(1).find('option:selected').text();
        var data_type = data_type.split(" ")[0]

        // Use the headers from earlier to name our hash keys
        headers.forEach((header, i) => {
          if(data_type in valid_field_dict) {
            if (valid_field_dict[data_type].includes(header)) {
              if (i == 0) {
                if (dropdown_list.includes(header)) {

                  h1[header] = $td.eq(i).find('option:selected').text().trim();
                } else {
                  if($td.eq(i).text().trim() == "") {
                    val_msg += `<li><p>${$td.find(".fld_name").text()} : <em style="color:red;font-style:normal">'${header}' cannot be empty.</em></p></li>`
                    create_table_flag = false
                  } else {
                    h1[header] = $td.eq(i).text().trim().toLowerCase();
                  }
                }
              } else {

                if (dropdown_list.includes(header)) {
                  if((["select", "Select", ""].includes($td.eq(i).find('option:selected').text()) &&  header != "choices" && header != "blacklist characters" && header != "computed input")) {
                    val_msg += `<li><p>${$td.find(".fld_name").text()} : <em style="color:red;font-style:normal">No '${header}' value selected</em></p></li>`
                    create_table_flag = false
                  } else {
                  if(header == "columns"){
                        selectedValues=[]
                        for(var j=0;j<$td.eq(i).find('option:selected').length;j++){
                          selectedValues.push($td.eq(i).find('option:selected')[j].innerText)
                        }
                        if (selectedValues.length > 0)
                        {
                          h1[header]=selectedValues
                        }
                      }
                      else if(header == "choices" || header == "blacklist characters" || header == "computed input")
                      {
                        selectedValue_choices=[]
                        if(header != "computed input"){
                          for(var j=0;j<$td.eq(i).find('option:selected').length;j++){
                            selectedValue_choices.push($td.eq(i).find('option:selected')[j].innerText)
                          }
                        }else{
                          for(var j=0;j<$td.eq(i).find('option:selected').length;j++){
                            selectedValue_choices.push($td.eq(i).find('option:selected')[j].value)
                          }
                        }

                        if (selectedValue_choices.length > 0)
                        {
                          h1[header]=selectedValue_choices
                        }
                      }
                      else if(header == "divider")
                      {
                        if( $td.eq(i).find('option:selected').text() != "select")
                        {
                          h1[header] = $td.eq(i).find('option:selected').text();
                        }
                      }
                      else{
                        h1[header] = $td.eq(i).find('option:selected').text();
                      }
                    }
                } else {
                  if(header != "default") {
                    if(["select", "Select", ""].includes($td.eq(i).find("span").text().trim())) {
                      val_msg += `<li><p>${$td.find(".fld_name").text()} : <em style="color:red;font-style:normal">No '${header}' value entered</em></p></li>`
                      create_table_flag = false
                    }
                    else {
                      h1[header] = $td.eq(i).text();
                    }
                  } else {
                    h1[header] = $td.eq(i).text();
                  }
                }
              }
            }
        }
        else {
          val_msg += `<li><p>${$td.find(".fld_name").text()} : <em style="color:red;font-style:normal">No 'Field data type' value entered</em></p></li>`
          create_table_flag = false
        }

          h[header] = $td.eq(i).text();
        });
        if (h1["field data type"] == "UniqueIDField") {
          if($td.eq(15).children("#uuid_config").attr("name") != "") {
            h1["uuid_config"] = $td.eq(15).children("#uuid_config").attr("name")
          } else {
            val_msg += `<li><p>${$td.find(".fld_name").text()} : <em style="color:red;font-style:normal">No UniqueIDField settings configured</em></p></li>`
            create_table_flag = false
          }
        }
        if (h1["field data type"] == "FileField (File/Document upload)") {
          if($td.eq(15).children("#file_config").attr("name") != "") {
            h1["file_extension"] = $td.eq(15).children("#file_config").attr("name")
          } else {
            val_msg += `<li><p>${$td.find(".fld_name").text()} : <em style="color:red;font-style:normal">No FileField settings configured</em></p></li>`
            create_table_flag = false
          }
        }
        if (h1["field data type"] == "VideoField") {
          if ($td.eq(15).children("#video_config").attr("name") != "") {
            h1["video_type"] = $td.eq(15).children("#video_config").attr("name")
          } else {
            val_msg += `<li><p>${$td.find(".fld_name").text()} : <em style="color:red;font-style:normal">No VideoField settings configured</em></p></li>`
            create_table_flag = false
          }
        }
        if (h1["field data type"] == "TimeRangeField") {
          h1["timerange_type"] = 1
        }
        if (h1["field data type"] == "DateTimeRangeField") {
          h1["datetimerange_type"] = 1
        }
        if (h1["field data type"] == "DateRangeField") {
          h1["daterange_type"] = 1
        }
        if (h1["field data type"] == "TableField") {
          is_config_present = $td.eq(16).children("#table_config").attr("name")
          if(is_config_present != ""){
            is_config_present = JSON.parse(is_config_present)
            h1["table_config"] = $td.eq(16).children("#table_config").attr("name")
          }else{
            val_msg += `<li><p>${$td.find(".fld_name").text()} : <em style="color:red;font-style:normal">Please configure TableField settings.</em></p></li>`
            create_table_flag = false
          }
        }
        if (h1["field data type"] == "CardField (Credit card/Debit card)") {
          is_config_present = $td.eq(15).children("#card_config").attr("name")
          if(is_config_present != ""){
            is_config_present = JSON.parse(is_config_present)
            h1["card_config"] = $td.eq(15).children("#card_config").attr("name")
            h1["secure_with"] = is_config_present["card_field_create_enclass"]
            if(is_config_present["card_field_create_enclass"] != "None") {
              h1["datakey"] = is_config_present["card_field_create_kclass"]
            }
          }else{
            val_msg += `<li><p>${$td.find(".fld_name").text()} : <em style="color:red;font-style:normal">Please configure cardfield settings.</em></p></li>`
            create_table_flag = false
          }
        }
        if (h1["field data type"] == "PrivacyField") {
          is_config_present = $td.eq(15).children("#privacy_config").attr("name")
          if(is_config_present != ""){
            h1["privacy_config"] = $td.eq(15).children("#privacy_config").attr("name")
          }else{
            val_msg += `<li><p>${$td.find(".fld_name").text()} : <em style="color:red;font-style:normal">Please configure PrivacyField settings.</em></p></li>`
            create_table_flag = false
          }
        }
        if (h1["field data type"] == "CardCvvField") {
          let is_config_present = $td.eq(15).children("#cvv_config").attr("name")
          if(is_config_present != ""){
            is_config_present = JSON.parse(is_config_present)
            h1["secure_with"] = is_config_present["cvv_field_create_enclass"]
            if(is_config_present["cvv_field_create_enclass"] != "None") {
              h1["datakey"] = is_config_present["cvv_field_create_kclass"]
            }
          }
        }
        if (h1["field data type"] == "CardExpiryField") {
          let is_config_present = $td.eq(15).children("#exp_config").attr("name")
          if(is_config_present != ""){
            is_config_present = JSON.parse(is_config_present)
            h1["secure_with"] = is_config_present["expiryDate_field_create_enclass"]
            if(is_config_present["expiryDate_field_create_enclass"] != "None") {
              h1["datakey"] = is_config_present["expiryDate_field_create_kclass"]
            }
          }
        }
        if (h1["field data type"] == "CardTypeField (Identifies the type of card)") {
          let is_config_present = $td.eq(15).children("#ctype_config").attr("name")
          if(is_config_present != ""){
            is_config_present = JSON.parse(is_config_present)
            h1["secure_with"] = is_config_present["cardtype_field_create_enclass"]
            if(is_config_present["cardtype_field_create_enclass"] != "None") {
              h1["datakey"] = is_config_present["cardtype_field_create_kclass"]
            }
          }
        }
        if (h1["field data type"] == "MultiselectField") {
          is_config_present = $td.eq(15).children("#mulsel_config").attr("name")
          if(is_config_present != ""){
            is_config_present = JSON.parse(is_config_present)
            h1["mulsel_config"] = $td.eq(15).children("#mulsel_config").attr("name")
          }else{
            val_msg += `<li><p>${$td.find(".fld_name").text()} : <em style="color:red;font-style:normal">Please configure MultiselectField settings.</em></p></li>`
            create_table_flag = false
          }
        }

        data1.push(h1);
        data.push(h);

      }
    })

    // Output the result
    $EXPORT.text(JSON.stringify(data1));
    var table_name = $('#tname').val();
    if (table_name == "") {
      Swal.fire({text:"Table name cannot be empty.",icon:"warning"});
      create_table_flag = false
    }
    var audit_fields =  ['created_by','created_date','modified_by','modified_name','approved_by','approval_status','from',"value","transaction_id", "active_from", "active_to", "scenario_id","is_active_flag"]
    if(!create_table_flag) {
      setTimeout(function(){
        $('#export-btn').prop('disabled', false);
      }, 1000);
    }
    var check_model_compeq = []
    $.ajax({
      url: window.location.pathname,
       data: { 'model_name': $('#tname').val(), 'operation': 'check_model_compeq'},
       type: "POST",
       dataType: "json",
       success: function(data) {
        var check_model_compeq_data = JSON.parse(data.data)
        for (i in check_model_compeq_data["element_name"]) {
          if(check_model_compeq_data["element_name"][i] != null) {
            check_model_compeq.push(check_model_compeq_data["element_name"][i].slice(table_name.length,-10))
          }
        }
       }
      }).done(function() {

    $EXPORT.text(JSON.stringify(table_name));
    for(let i in data1){
      let cap_status =  (/[A-Z]/.test(data1[i]['field name']))
      let space_status =  (/\s/.test(data1[i]['field name']))
      if(data1[i]['computed value'] == "Yes") {
        if(!check_model_compeq.includes(data1[i]['field name'])) {
          val_msg += `<li><p>${data1[i]['field name']} : <em style="color:red;font-style:normal">No Computation configured</em></p></li>`
          create_table_flag = false
        }
      }

      if(cap_status == true){
        cap_fields_val.push({"Capital":data1[i]['field name']})
      }
      if(space_status == true){
        cap_fields_val.push({"Space":data1[i]['field name']})
      }

      if(audit_fields.includes(data1[i]['field name'] != "")) {
        if(audit_fields.includes(data1[i]['field name'].toLowerCase())){
          cap_fields_val.push({"Restricted":data1[i]['field name']})
        }
      }
      if(!create_table_flag) {
        cap_fields_val.push({"TableCreationValidation": ""})
      }
    }

    if(cap_fields_val.length >0){
      $("#validation_cap_error_main_body").empty()
      let audit_count = 0
        var html_content= ""
      $("#validation_cap_error_main_body").append(`<p style='font-size: 16px;'>Following fields consist of certain validation errors:</p>`)
      for(let j=0;j<cap_fields_val.length;j++){
        if(Object.keys(cap_fields_val[j])[0] == "Capital"){
          html_content += `<li><p>${cap_fields_val[j]["Capital"]} : <em style='color:red;font-style:normal'>Field name cannot contain capital letter.</em></p></li>`
        }
        if(Object.keys(cap_fields_val[j])[0] == "Space"){
          html_content += `<li><p>${cap_fields_val[j]["Space"]} : <em style='color:red;font-style:normal'> Field name cannot contain space.</em></p></li>`
        }
        if(Object.keys(cap_fields_val[j])[0] == "Restricted"){
          html_content += `<li><p>${cap_fields_val[j]["Restricted"]} : <em style='color:red;font-style:normal'>Field name can not be one of the restricted names.</em></p>
            </li>`
            audit_count+=1
        }

      }
      html_content += val_msg
      $("#validation_cap_error_main_body").append(`<ul style='list-style-type: disc;font-size: 13px;overflow: auto;'>${html_content}</ul>`)
        if(audit_count >0){
          $("#validation_cap_error_main_body").append(` <p style='color:red;'>*Restricted field names: <em style='color:black;font-style:normal;'> created_by, created_date, modified_by, modified_name,\n approved_by, approval_status, from, value, transaction_id, active_from, active_to, scenario_id, is_active_flag<em></p>`)
        }
      $("#validation_cap_error").modal('show')

    }else{
      $.ajax({
      url: window.location.pathname,
       data: { 'data': JSON.stringify(data1), 'table_name': JSON.stringify(table_name), 'operation': 'create_table', 'create_scenario_table': $("#scenario_table_checkbox").prop("checked"),'create_replica_table': $("#replicate_table").prop("checked")},
       type: "POST",
       dataType: "json",
       success: function(data) {
         if (data["message"] == "success") {
           fieldtableReload(data["tablename"], scenario=false);
           if ($("#scenario_table_checkbox").prop("checked")) {
             var scenario_table_name = JSON.stringify(JSON.parse(data["tablename"]) + "_scenario")
             fieldtableReload(scenario_table_name, scenario=true);
           }
           if ($("#replicate_table").prop("checked")) {
             var replica_table_name = JSON.stringify(JSON.parse(data["tablename"]) + "_mul")
             fieldtableReload(replica_table_name, scenario=true);
           }
         } else {
          Swal.fire({icon: 'info',text: data["message"]});
         }
       },error: function () {
         Swal.fire({icon: 'error',text: 'Error! Please try again.'});
         $('.standard_button_click').prop('disabled',false)
       }
     })

    function fieldtableReload(data, scenario=false) {
      $('.standard_button_click').prop('disabled',false)
      $(this).find('form').trigger('reset');
      $('#create_table').modal('hide');
      if (scenario == false) {
        Swal.fire({icon: 'success',text: 'Data Table created successfully!'});
      }
      var tablename = JSON.parse(data)

      //Create an input type dynamically.
      var element = document.createElement("button");
      //Assign different attributes to the element.
      element.type = "button";
      element.className = "entitybuttons buttonstyling acies_btn acies_btn-primary";
      element.id = tablename; // And the name too?
      element.style = "margin-right:5px; margin-top:5px;"
      element.textContent = tablename

      //Append the element in page (in span).
      document.getElementById("userdefrow").appendChild(element);

      //Create an input type dynamically.
      var element2 = document.createElement("button");
      //Assign different attributes to the element.
      element2.type = "button";
      element2.className = "entitybuttons buttonstyling acies_btn acies_btn-primary";
      element2.id = tablename; // And the name too?
      element2.style = "margin-right:5px; margin-top:5px;"
      element2.textContent = tablename
      document.getElementById("userdef2row").appendChild(element2);

      $('.entitybuttons').click(function () {
        var model_name = $(this).attr('id');

        $('#selectedElement').empty()
        $('#RelatioshipElement').empty()
        document.getElementById("edit_att_det").hidden = true;
        document.getElementById("add_att_val").hidden = true;
        document.getElementById("delete_att_det").hidden = true;
        $(".dataElements").find("p").empty()
        $(".dataElements").find("p").append(model_name)
        document.getElementById("dataele_dataAccess").hidden = false;
        document.getElementById("dataele_add").hidden = false;
        document.getElementById("dataele_delete").hidden = false;
        $.ajax({
          url: window.location.pathname,
          data: { 'model_name': model_name, 'operation': 'f1' },
          type: "POST",
          dataType: "json",
          success: datatableReload,
          error: function () {
            Swal.fire({icon: 'error',text: 'Error! Please try again.'});
          }
        })

        function datatableReload(data) {

          var column_list = data.column_list;
          var table_type = data.table_type;
          var other_config = data.other_config;
          var verbose_column_name_dict = data.verbose_column_name_dict

          if(table_type =="System"){
            $("#dataele_dataAccess").hide()
            $("#dataele_add").hide()
            $("#dataele_delete").hide()
            $("#dataele_order").hide()
            $("#delete_att_det").hide()
            $("#edit_att_det").hide()
            $("#add_att_val").hide()
            $("#dataele_replica_table").hide()
          }else{
            $("#dataele_dataAccess").show()
            $("#dataele_add").show()
            $("#dataele_delete").show()
            $("#dataele_order").show()
            $("#delete_att_det").show()
            $("#edit_att_det").show()
            $("#add_att_val").show()
            $("#dataele_replica_table").show()
            if (other_config) {
              $("#dataele_dataAccess").attr('data-config', JSON.stringify(other_config));
            } else {
              $("#dataele_dataAccess").removeAttr('data-config');
            }
          }
          $('.list-group').empty()
          $('.sortable-order').empty()
          $('#myTable').empty()
          $('#relTable').empty()
          $(".multipleform_compInp_add").empty()

          for(let [key,value] of Object.entries(verbose_column_name_dict)){
            $(".multipleform_compInp_add").append(`<option value="${value}">${key}</option>`)
          }

          for (x in column_list) {
            $('.list-group').append("<button type='button' class='list-group-item list-group-item-action list-group-item-light' id='" + model_name + "'>" + column_list[x] + "</button>");
            $('.sortable-order').append(`<li class="btn btn-sm btn-light col" name="${column_list[x]}"><span class="ui-icon ui-icon-arrowthick-2-n-s float-left mt-1" data-toggle="tooltip" title="Drag Up/ Down to reorder"></span>${column_list[x]}</li>`);
          }

          $('.list-group-item').click(function () {
            var model_name = $(this).attr('id');
            var field_name = $(this).text();

            $(".attributeDetails").find("p").empty()
            $(".attributeDetails").find("p").append(field_name)

            document.getElementById("edit_att_det").hidden = false;
            document.getElementById("add_att_val").hidden = false;
            document.getElementById("delete_att_det").hidden = false;
            $.ajax({
              url: window.location.pathname,
              data: { 'model_name': model_name, 'field_name': field_name, 'operation': 'f2' },
              type: "POST",
              dataType: "json",
              success: fieldtableReload,
              error: function () {
                Swal.fire({icon: 'error',text: 'Error! Please try again.'});
              }
            })

            function fieldtableReload(data) {

              var details = JSON.parse(data)[0]
              var rel_details = JSON.parse(data)[1]
              var search_details = JSON.parse(data)[2]

              $('#myTable').empty()

              for (y in details) {

                if(y == "Computed Value" && details[y] == true){

                  $('#myTable').append("<tr> <td>" + y + "</td> <td>" + details[y] + "<a data-toggle='tooltip' title='View Configuration' value='eq'><i name='actions1' value='eq' class='fas fa-square-root-alt ihover javaSC thin-icontrash attr_equ_btn' style='font-size: 18px;margin-left: 13px;'></i></a>" + "</td> </tr>");

                }else{
                  $('#myTable').append("<tr> <td>" + y + "</td> <td>" + details[y] + "</td> </tr>");
                }
              }

              $('#relTable').empty()
              for (x in rel_details) {
                $('#relTable').append('<tr> <td>' + x + '</td> <td>' + rel_details[x][0] + '</td> <td>' + rel_details[x][1] + '</td><td><a data-toggle="tooltip" title="View Details" value="detail"><i name="actions" value="detail" class="fa fa-search ihover javaSC thin-icon" style="font-size: 15px"></i></a>  <a data-toggle="modal" title="Edit record" value="update"><i name="actions" value="update" class="relbutton fa fa-edit ihover javaSC thin-icon" style="font-size:15px"></i></a></td> </tr>');
              }

              $('#searchTable1').empty()
              for (i in search_details) {
                var details = JSON.parse(data)[2][i]

                for (x in details){
                $('#searchTable1').append('<tr> <td id="tab_name1">' + i + '</td> <td id="col_name1">' + details[x] + '</td><td><a data-toggle="tooltip" title="View Details" value="detail"><i name="actions" value="detail" class="fa fa-search ihover javaSC thin-icon" style="font-size: 15px"></i></a>   <a data-toggle="modal" data-target="#relation_modal" title="Edit record" value="update"><i name="actions" value="update" class="relbutton fa fa-edit ihover javaSC thin-icon" style="font-size:15px"></i></a></td> </tr>');
              }
            }
            }

          })
        }
      })

    }

    }
  })
  })
</script>

<script>

  $(document).ready(function () {

      var table = $('#example11').DataTable({
        "paging": false,
        "ordering": false,
        "info": false,
        "searching": false,
        "autoWidth": true,
        "scrollY": "21rem",
        "sScrollX": "110%",
        "scrollX":true,
        "scrollCollapse": true,
      columnDefs: [
        {
          targets: "_all",
          className: 'dt-center allColumnClass all'
        }
        ],

      });
    });

  </script>

<script>
  var direct_field_access = false
  $('table').on('select2:select', '.fieldselect', displaySpecificColumn);
  var selectedDropdownSelectedValueList;

  function displaySpecificColumn() {
    var fieldPosition = $(this).find('td');
    var selectedDataType = $(this).children("option:selected").text();
    extraElements = fieldPosition.find("div").slice(6)
    var $rows = $('#table').find('tr:not(:hidden)');
    var headers = []
    direct_field_access = true
    $($rows.shift()).find('th:not(:empty)').each(function () {

      headers.push($(this).text().toLowerCase());

    });

    var $row = $(this).closest("tr");
    var $td = $row.find('td');
    if (selectedDataType.includes('AutoField')) {

    headers.forEach((header, i) => {
      $td.eq(5).find('span').attr('contenteditable', 'false');
      $td.eq(6).find('.select2_multiplechoices').prop('disabled', true);
      $td.eq(10).find('.editableoption').prop('disabled', true);
        $td.eq(9).find('.autonowoption').prop('disabled', true);
      $td.eq(8).find('span').attr('contenteditable', 'false');
      $td.eq(7).find('span').attr('contenteditable', 'false');
      $td.eq(7).find('.computed_value_select').val('2').change().prop('disabled', true);
      $td.eq(12).find('.multipleform').prop('disabled', true);
      $td.eq(13).find('.divideroption').prop('disabled', true);
      $td.eq(14).find('.multipleform_bklist').prop('disabled', true);
      $td.eq(15).find('.multipleform_compInp').prop('disabled', true);
    })
    }
    if (selectedDataType.includes('TextField') || selectedDataType.includes("BooleanField") || selectedDataType.includes('URLField')) {

      headers.forEach((header, i) => {
        $td.eq(5).find('span').attr('contenteditable', 'false');
        $td.eq(6).find('.select2_multiplechoices').prop('disabled', true);
        $td.eq(10).find('.editableoption').prop('disabled', true);
        $td.eq(9).find('.autonowoption').prop('disabled', true);
        if (selectedDataType.includes('TextField'))
        {
        $td.eq(10).find('.editableoption').prop('disabled', false);
        }
        if(!selectedDataType.includes("BooleanField")){
          $td.eq(8).find('span').attr('contenteditable', 'true');
        }else{
          $td.eq(8).find('span').attr('contenteditable', 'false');
        }
        $td.eq(7).find('span').attr('contenteditable', 'false');
        $td.eq(7).find('.computed_value_select').prop('disabled', false);
        $td.eq(12).find('.multipleform').prop('disabled', true);
        $td.eq(13).find('.divideroption').prop('disabled', true);
        if(!selectedDataType.includes("BooleanField")){
          $td.eq(14).find('.multipleform_bklist').prop('disabled', false);
        }else{
          $td.eq(14).find('.multipleform_bklist').prop('disabled', true);
        }
      })
    }

    if (selectedDataType.includes('CharField')) {

      headers.forEach((header, i) => {
        $td.eq(5).find('span').attr('contenteditable', 'true');
        $td.eq(6).find('.select2_multiplechoices').prop('disabled', false);
        if ($td.eq(6).find('.select2_multiplechoices').data('select2')) {
          $td.eq(6).find('.select2_multiplechoices').select2("destroy")
        }
        $td.eq(6).find('.select2_multiplechoices').select2({tags:true,dropdownParent:$(".new_table_creation_card")});
        $td.eq(10).find('.editableoption').prop('disabled', false);
        $td.eq(9).find('.autonowoption').prop('disabled', true);
        $td.eq(8).find('span').attr('contenteditable', 'true');
        $td.eq(7).find('span').attr('contenteditable', 'false');
        $td.eq(7).find('.computed_value_select').prop('disabled', false);
        $td.eq(12).find('.multipleform').prop('disabled', true);
        $td.eq(13).find('.divideroption').prop('disabled', true);
        $td.eq(14).find('.multipleform_bklist').prop('disabled', false);
      })
    }
    if (selectedDataType.includes('ConcatenationField')) {
headers.forEach((header, i) => {
  $td.eq(5).find('span').attr('contenteditable', 'true');
  $td.eq(6).find('.select2_multiplechoices').prop('disabled', true);
  $td.eq(10).find('.editableoption').val("2").change();
  $td.eq(10).find('.editableoption').prop('disabled', true);
  $td.eq(9).find('.autonowoption').prop('disabled', true);
  $td.eq(8).find('span').attr('contenteditable', 'false');
  $td.eq(7).find('span').attr('contenteditable', 'false');
  $td.eq(7).find('.computed_value_select').val('2').change().prop('disabled', true);
  $td.eq(12).find('.multipleform').prop('disabled', false);
  $td.eq(13).find('.divideroption').prop('disabled', false);
  $td.eq(14).find('.multipleform_bklist').prop('disabled', true);
})
}

    if (selectedDataType.includes("FileField") || selectedDataType.includes("ImageField")) {
      headers.forEach((header, i) => {
        $td.eq(5).find('span').attr('contenteditable', 'false');
        $td.eq(6).find('.select2_multiplechoices').val([]).trigger('change');
        $td.eq(6).find('.select2_multiplechoices').prop('disabled', true);
        $td.eq(10).find('.editableoption').prop('disabled', true);
        $td.eq(9).find('.autonowoption').prop('disabled', true);
        $td.eq(8).find('span').attr('contenteditable', 'false');
        $td.eq(7).find('.computed_value_select').prop('disabled', true);
        $td.eq(7).find('.computed_value_select').val('2').change().prop('disabled', true);
        $td.eq(12).find('.multipleform').prop('disabled', true);
        $td.eq(13).find('.divideroption').prop('disabled', true);
        $td.eq(14).find('.multipleform_bklist').prop('disabled', true);
        if (selectedDataType.includes("FileField")) {
          $td.eq(16).find('#file_config').css("display", "inline-block")
          $td.eq(16).find('#video_config').css("display", "none")
        }
        else {
          $td.eq(16).find('#file_config').css("display", "none")
        }
      })
    }
    if (selectedDataType.includes("VideoField")) {
      headers.forEach((header, i) => {
        $td.eq(4).children().val("2")
        $td.eq(4).children().attr('disabled', false)
        $td.eq(5).find('span').attr('contenteditable', 'false');
        $td.eq(6).find('.select2_multiplechoices').prop('disabled', true);
        $td.eq(7).find('select').attr('disabled', true);
        $td.eq(9).find('.autonowoption').prop('disabled', true);
        $td.eq(8).find('span').attr('contenteditable', 'false');
        $td.eq(7).find('span').attr('contenteditable', 'false');
        $td.eq(7).find('.computed_value_select').val('2').change().prop('disabled', true);
        $td.eq(11).children().attr('disabled', true)
        $td.eq(12).find('.multipleform').prop('disabled', true);
        $td.eq(13).find('.divideroption').prop('disabled', true);
        $td.eq(14).find('.multipleform_bklist').prop('disabled', true);
        if (selectedDataType.includes("VideoField")) {
          $td.eq(16).find('#video_config').css("display", "inline-block")
          $td.eq(16).find('#file_config').css("display", "none")
        }
        else {
          $td.eq(16).find('#video_config').css("display", "none")
        }
      })
    }
    if (selectedDataType.includes("IntegerField") || selectedDataType.includes("BigIntegerField") || selectedDataType.includes("FloatField")) {
      headers.forEach((header, i) => {
        $td.eq(5).find('span').attr('contenteditable', 'false');
        $td.eq(6).find('.select2_multiplechoices').prop('disabled', true);
        $td.eq(10).find('.editableoption').prop('disabled', false);
        $td.eq(9).find('.autonowoption').prop('disabled', true);
        $td.eq(8).find('span').attr('contenteditable', 'true');
        $td.eq(7).find('span').attr('contenteditable', 'false');
        $td.eq(7).find('.computed_value_select').prop('disabled', false);
        $td.eq(12).find('.multipleform').prop('disabled', true);
        $td.eq(13).find('.divideroption').prop('disabled', true);
        $td.eq(14).find('.multipleform_bklist').prop('disabled', true);
      })
    }
    if (selectedDataType.includes("DateField") || selectedDataType.includes("DateTimeField") || selectedDataType.includes("TimeField")) {
      headers.forEach((header, i) => {
        $td.eq(5).find('span').attr('contenteditable', 'false');
        $td.eq(6).find('.select2_multiplechoices').prop('disabled', true);
        $td.eq(10).find('.editableoption').prop('disabled', false);
        $td.eq(9).find('.autonowoption').prop('disabled', false);
        $td.eq(8).find('span').attr('contenteditable', 'false');
        $td.eq(7).find('span').attr('contenteditable', 'false');
        $td.eq(7).find('.computed_value_select').prop('disabled', false);
        $td.eq(12).find('.multipleform').prop('disabled', true);
        $td.eq(13).find('.divideroption').prop('disabled', true);
        $td.eq(14).find('.multipleform_bklist').prop('disabled', true);
      })
    }

    if (selectedDataType.includes('UniqueIDField')) {
      headers.forEach((header, i) => {
        $td.eq(4).children().val("2")
        $td.eq(4).children().attr('disabled', true)
        $td.eq(5).find('span').attr('contenteditable', 'true');
        $td.eq(6).find('.select2_multiplechoices').prop('disabled', true);
        $td.eq(10).find('.editableoption').val("2").change();
        $td.eq(10).find('.editableoption').prop('disabled', true);
        $td.eq(9).find('.autonowoption').prop('disabled', true);
        $td.eq(8).find('span').attr('contenteditable', 'false');
        $td.eq(7).find('span').attr('contenteditable', 'false');
        $td.eq(7).find('.computed_value_select').val('2').change().prop('disabled', true);
        $td.eq(11).children().val("1")
        $td.eq(11).children().attr('disabled', true)
        $td.eq(12).find('.multipleform').prop('disabled', true);
        $td.eq(13).find('.divideroption').prop('disabled', true);
        $td.eq(16).find('#uuid_config').css("display", "inline-block")
        $td.eq(14).find('.multipleform_bklist').prop('disabled', true);
      })
    }
    else {
      $td.eq(16).find('#uuid_config').css("display", "none")
    }

    if (selectedDataType.includes('DateRangeField')) {
      headers.forEach((header, i) => {
        $td.eq(5).find('span').attr('disabled', true);
        $td.eq(6).find('.select2_multiplechoices').prop('disabled', true);
        $td.eq(10).find('.editableoption').val("2").change();
        $td.eq(10).find('.editableoption').prop('disabled', true);
        $td.eq(9).find('.autonowoption').prop('disabled', true);
        $td.eq(8).find('span').attr('contenteditable', 'false');
        $td.eq(7).find('span').attr('disabled', true);
        $td.eq(7).find('.computed_value_select').prop('disabled', false);
        $td.eq(12).find('.multipleform').prop('disabled', true);
        $td.eq(13).find('.divideroption').prop('disabled', true);
        $td.eq(11).children().val("2")
        $td.eq(11).children().attr('disabled', true)
        $td.eq(14).find('.multipleform_bklist').prop('disabled', true);
      })
    }

    if (selectedDataType.includes('TimeRangeField')) {
      headers.forEach((header, i) => {
        $td.eq(5).find('span').attr('disabled', true);
        $td.eq(6).find('.select2_multiplechoices').prop('disabled', true);
        $td.eq(10).find('.editableoption').val("2").change();
        $td.eq(10).find('.editableoption').prop('disabled', true);
        $td.eq(9).find('.autonowoption').prop('disabled', true);
        $td.eq(8).find('span').attr('contenteditable', 'false');
        $td.eq(7).find('span').attr('disabled', true);
        $td.eq(7).find('.computed_value_select').prop('disabled', false);
        $td.eq(12).find('.multipleform').prop('disabled', true);
        $td.eq(13).find('.divideroption').prop('disabled', true);
        $td.eq(11).children().val("2")
        $td.eq(11).children().attr('disabled', true)
        $td.eq(14).find('.multipleform_bklist').prop('disabled', true);
      })
    }

    if (selectedDataType.includes('DateTimeRangeField')) {
      headers.forEach((header, i) => {
        $td.eq(5).find('span').attr('disabled', true);
        $td.eq(6).find('.select2_multiplechoices').prop('disabled', true);
        $td.eq(10).find('.editableoption').val("2").change();
        $td.eq(10).find('.editableoption').prop('disabled', true);
        $td.eq(9).find('.autonowoption').prop('disabled', true);
        $td.eq(8).find('span').attr('contenteditable', 'false');
        $td.eq(7).find('span').attr('disabled', true);
        $td.eq(7).find('.computed_value_select').prop('disabled', false);
        $td.eq(12).find('.multipleform').prop('disabled', true);
        $td.eq(13).find('.divideroption').prop('disabled', true);
        $td.eq(11).children().val("2")
        $td.eq(11).children().attr('disabled', true)
        $td.eq(14).find('.multipleform_bklist').prop('disabled', true);
      })
    }

    if (selectedDataType.includes('UserField')) {
        headers.forEach((header, i) => {
          $td.eq(5).find('span').attr('contenteditable', 'false');
          $td.eq(6).find('.select2_multiplechoices').prop('disabled', true);
          $td.eq(10).find('.editableoption').val("2").change();
          $td.eq(10).find('.editableoption').prop('disabled', true);
          $td.eq(9).find('.autonowoption').prop('disabled', true);
          $td.eq(8).find('span').attr('contenteditable', 'false');
          $td.eq(7).find('.computedoption').val("2").change();
          $td.eq(7).find('.computedoption').attr('disabled', true);
          $td.eq(7).find('.computed_value_select').val('2').change().prop('disabled', true);
          $td.eq(11).children().val("1")
          $td.eq(11).children().attr('disabled', true)
          $td.eq(12).find('.multipleform').prop('disabled', true);
          $td.eq(13).find('.divideroption').prop('disabled', true);
        })
    }

    if (selectedDataType.includes('CardField')) {
      headers.forEach((header, i) => {
        $td.eq(5).find('span').attr('contenteditable', 'false');
        $td.eq(6).find('.select2_multiplechoices').prop('disabled', true);
        $td.eq(10).find('.editableoption').val("2").change();
        $td.eq(10).find('.editableoption').prop('disabled', true);
        $td.eq(9).find('.autonowoption').prop('disabled', true);
        $td.eq(8).find('span').attr('contenteditable', 'false');
        $td.eq(7).find('.computedoption').val("2").change();
        $td.eq(7).find('.computedoption').attr('disabled', true);
        $td.eq(7).find('.computed_value_select').val('2').change().prop('disabled', true);
        $td.eq(11).children().val("1")
        $td.eq(11).children().attr('disabled', true)
        $td.eq(12).find('.multipleform').prop('disabled', true);
        $td.eq(13).find('.divideroption').prop('disabled', true);
        $td.eq(16).find('#card_config').css("display", "inline-block")
        $td.eq(14).find('.multipleform_bklist').prop('disabled', true);
      })
    }
    else {
      $td.eq(16).find('#card_config').css("display", "none")
    }

    if (selectedDataType.includes('PrivacyField')) {
      headers.forEach((header, i) => {
        $td.eq(5).find('span').attr('contenteditable', 'false');
        $td.eq(6).find('.select2_multiplechoices').prop('disabled', true);
        $td.eq(10).find('.editableoption').val("2").change();
        $td.eq(10).find('.editableoption').prop('disabled', true);
        $td.eq(9).find('.autonowoption').prop('disabled', true);
        $td.eq(8).find('span').attr('contenteditable', 'false');
        $td.eq(7).find('.computedoption').val("2").change();
        $td.eq(7).find('.computedoption').attr('disabled', true);
        $td.eq(7).find('.computed_value_select').prop('disabled', false);
        $td.eq(11).children().val("1")
        $td.eq(11).children().attr('disabled', true)
        $td.eq(12).find('.multipleform').prop('disabled', true);
        $td.eq(13).find('#divideroption').prop('disabled', true);
        $td.eq(16).find('#privacy_config').css("display", "inline-block")
        $td.eq(14).find('.multipleform_bklist').prop('disabled', true);
      })
    }
    else {
      $td.eq(15).find('#privacy_config').css("display", "none")
    }

    if (selectedDataType.includes('CardCvvField')) {
      if(!direct_field_access || create_access){
        headers.forEach((header, i) => {
          $td.eq(5).find('span').attr('contenteditable', 'false');
          $td.eq(6).find('.select2_multiplechoices').prop('disabled', true);
          $td.eq(10).find('.editableoption').val("2").change();
          $td.eq(10).find('.editableoption').prop('disabled', true);
          $td.eq(9).find('.autonowoption').prop('disabled', true);
          $td.eq(8).find('span').attr('contenteditable', 'false');
          $td.eq(7).find('.computedoption').val("2").change();
          $td.eq(7).find('.computedoption').attr('disabled', true);
          $td.eq(7).find('.computed_value_select').val('2').change().prop('disabled', true);
          $td.eq(11).children().val("2")
          $td.eq(11).children().attr('disabled', true)
          $td.eq(12).find('.multipleform').prop('disabled', true);
          $td.eq(13).find('.divideroption').prop('disabled', true);
          $td.eq(14).find('.multipleform_bklist').prop('disabled', true);
        })
      }else{
        $td.eq(1).find(".fieldselect").val("").trigger("click")
        direct_field_access = false
        Swal.fire({icon: 'warning',text: 'Please use cardfield to create cvv field.'});
      }
    }

    if (selectedDataType.includes('CardExpiryField')) {
      if(!direct_field_access || create_access){
        headers.forEach((header, i) => {
          $td.eq(5).find('span').attr('contenteditable', 'false');
          $td.eq(6).find('.select2_multiplechoices').prop('disabled', true);
          $td.eq(10).find('.editableoption').val("2").change();
          $td.eq(10).find('.editableoption').prop('disabled', true);
          $td.eq(9).find('.autonowoption').prop('disabled', true);
          $td.eq(8).find('span').attr('contenteditable', 'false');
          $td.eq(7).find('.computedoption').val("2").change();
          $td.eq(7).find('.computedoption').attr('disabled', true);
          $td.eq(7).find('.computed_value_select').val('2').change().prop('disabled', true);
          $td.eq(11).children().val("2")
          $td.eq(11).children().attr('disabled', true)
          $td.eq(12).find('.multipleform').prop('disabled', true);
          $td.eq(13).find('.divideroption').prop('disabled', true);
          $td.eq(14).find('.multipleform_bklist').prop('disabled', true);
        })
      }else{
        $td.eq(1).find(".fieldselect").val("").trigger("click")
        direct_field_access = false
        Swal.fire({icon: 'warning',text: 'Please use cardfield to expiry date field.'});
      }
    }

    if (selectedDataType.includes('CardTypeField')) {
      if(!direct_field_access || create_access){
        headers.forEach((header, i) => {
          $td.eq(5).find('span').attr('contenteditable', 'false');
          $td.eq(6).find('.select2_multiplechoices').prop('disabled', true);
          $td.eq(10).find('.editableoption').val("2").change();
          $td.eq(10).find('.editableoption').prop('disabled', true);
          $td.eq(9).find('.autonowoption').prop('disabled', true);
          $td.eq(8).find('span').attr('contenteditable', 'false');
          $td.eq(7).find('.computedoption').val("2").change();
          $td.eq(7).find('.computedoption').attr('disabled', true);
          $td.eq(7).find('.computed_value_select').val('2').change().prop('disabled', true);
          $td.eq(11).children().val("2")
          $td.eq(11).children().attr('disabled', true)
          $td.eq(12).find('.multipleform').prop('disabled', true);
          $td.eq(13).find('.divideroption').prop('disabled', true);
          $td.eq(14).find('.multipleform_bklist').prop('disabled', true);
        })
      }else{
        $td.eq(1).find(".fieldselect").val("").trigger("click")
        direct_field_access = false
        Swal.fire({icon: 'warning',text: 'Please use cardfield to create cardtype field.'});
      }
    }

    if (selectedDataType.includes('EmailTypeField')) {
        headers.forEach((header, i) => {
          $td.eq(5).find('span').attr('contenteditable', 'true');
          $td.eq(6).find('.select2_multiplechoices').prop('disabled', true);
          $td.eq(10).find('.editableoption').val("2").change();
          $td.eq(10).find('.editableoption').prop('disabled', true);
          $td.eq(9).find('.autonowoption').prop('disabled', true);
          $td.eq(8).find('span').attr('contenteditable', 'false');
          $td.eq(7).find('.computedoption').val("2").change();
          $td.eq(7).find('.computedoption').attr('disabled', true);
          $td.eq(11).children().attr('disabled', false)
          $td.eq(12).find('.multipleform').prop('disabled', true);
          $td.eq(13).find('.divideroption').prop('disabled', true);
          $td.eq(14).find('.multipleform_bklist').prop('disabled', true);
        })
    }

    if (selectedDataType.includes('RTFField')) {
        headers.forEach((header, i) => {
          $td.eq(5).find('span').attr('contenteditable', 'true');
          $td.eq(6).find('.select2_multiplechoices').prop('disabled', true);
          $td.eq(10).find('.editableoption').val("2").change();
          $td.eq(10).find('.editableoption').prop('disabled', true);
          $td.eq(9).find('.autonowoption').prop('disabled', true);
          $td.eq(8).find('span').attr('contenteditable', 'false');
          $td.eq(7).find('.computedoption').val("2").change();
          $td.eq(7).find('.computedoption').attr('disabled', true);
          $td.eq(7).find('.computed_value_select').val('2').change().prop('disabled', true);
          $td.eq(11).children().attr('disabled', false)
          $td.eq(12).find('.multipleform').prop('disabled', true);
          $td.eq(13).find('.divideroption').prop('disabled', true);
          $td.eq(14).find('.multipleform_bklist').prop('disabled', true);
        })
    }

    if (selectedDataType.includes('MultiselectField')) {
      headers.forEach((header, i) => {
        $td.eq(5).find('span').attr('contenteditable', 'false');
        $td.eq(6).find('.select2_multiplechoices').prop('disabled', true);
        $td.eq(10).find('.editableoption').val("2").change();
        $td.eq(10).find('.editableoption').prop('disabled', true);
        $td.eq(9).find('.autonowoption').prop('disabled', true);
        $td.eq(8).find('span').attr('contenteditable', 'false');
        $td.eq(7).find('.computedoption').val("2").change();
        $td.eq(7).find('.computedoption').attr('disabled', true);
        $td.eq(11).children().val("1")
        $td.eq(11).children().attr('disabled', true)
        $td.eq(12).find('.multipleform').prop('disabled', true);
        $td.eq(13).find('.divideroption').prop('disabled', true);
        $td.eq(16).find('#mulsel_config').css("display", "inline-block")
        $td.eq(14).find('.multipleform_bklist').prop('disabled', true);
      })
    }
    else {
      $td.eq(15).find('#mulsel_config').css("display", "none")
    }

    if (selectedDataType.includes('TableField')) {
      headers.forEach((header, i) => {
        $td.eq(5).find('span').attr('contenteditable', 'false');
        $td.eq(6).find('.select2_multiplechoices').prop('disabled', true);
        $td.eq(10).find('.editableoption').val("2").change();
        $td.eq(10).find('.editableoption').prop('disabled', true);
        $td.eq(9).find('.autonowoption').prop('disabled', true);
        $td.eq(8).find('span').attr('contenteditable', 'false');
        $td.eq(7).find('.computedoption').val("2").change();
        $td.eq(7).find('.computedoption').attr('disabled', true);
        $td.eq(7).find('.computed_value_select').val('2').change().prop('disabled', true);
        $td.eq(11).children().val("1")
        $td.eq(11).children().attr('disabled', true)
        $td.eq(12).find('.multipleform').prop('disabled', true);
        $td.eq(13).find('.divideroption').prop('disabled', true);
        $td.eq(14).find('.multipleform_bklist').prop('disabled', true);
        $td.eq(16).find('#table_config').css("display", "inline-block")
      })
    }
    else {
      $td.eq(16).find('#table_config').css("display", "none")
    }

    direct_field_access = false

  };
</script>

<script>

$(document).ready(function () {
    var table = $('#example12').DataTable({
      "paging": false,
      "ordering": false,
      "info": false,
      "searching": false,
      "autoWidth": true,
    "scrollY": "200px",
    "scrollCollapse": true,
    columnDefs: [
      {
        targets: "_all",
        className: 'dt-center allColumnClass all'
      }
      ],

    });
  });

</script>




</script>




<script>

  $(document).ready(function () {
      var table = $('#example3').DataTable({
        'deferRender':true,
        "paging": false,
        "ordering": false,
        "info": false,
        "searching": false,
        "autoWidth": true,
      "scrollY": "200px",
      "scrollCollapse": true,
      columnDefs: [
        {
          targets: "_all",
          className: 'dt-center allColumnClass all'
        }
        ],

      });
    });

  </script>

<script>

//Add New Element
$("#dataele_add").on('click',function(){
  $("#dynamicsearchfield"+"_wrapper").remove()
  $("#dynamicsearchfield").remove()
   var customDatatable=`
   <table id="dynamicsearchfield" class="row-border display" style="width: 100%;">
            <thead>
              <th scope="col">Table name</th>
              <th scope="col">Column name</th>
              <th scope="col">Action</th>
            </thead>
            <tbody id="dynamic">
            </tbody>
          </table>
   `
   $("#dynamicsearchfield_layer").append(customDatatable)
    setTimeout(function(){
         var table = $('#dynamicsearchfield').DataTable({
        "paging": false,
        "ordering": false,
        "info": false,
        "searching": false,
        "autoWidth": true,
      "scrollY": "200px",
      "sScrollX": "110%",
      "scrollX":true,
      "scrollCollapse": true,
      columnDefs: [
        {
          targets: "_all",
          className: 'dt-center allColumnClass all'
        }
        ],

      });
    },250)
  })
//Delete Model
  $("#dataele_delete").on('click',function(){
    var model_name = $(".dataElements").find("p").text()

    Swal.fire({
      icon:'question',
      text: `Do you wish to delete ${model_name}? Click 'Yes' to confirm or \n\nclick 'No' if you do not wish to delete it.`,
      showDenyButton: true,
      showCancelButton: true,
      confirmButtonText: 'Yes',
      denyButtonText: 'No',
    }).then((result) => {
      if (result.isConfirmed) {
        $.ajax({
        url: window.location.pathname,
        data:{'operation': 'check_relation_delete','model_name':model_name },
        type: "POST",
        dataType: "json",
        success: function(data){
          if(data.status == "normal"){
            if(data.dependent_items.length > 0){
              let mssg = `${JSON.stringify(data.dependent_items).replace('[','').replace(']','')} Subprocess needs to be configured to be able to delete this Data Table.`
              Swal.fire({icon: 'Warning',text: mssg});
            }else{
              delete_table_model(model_name)
            }
          }else if(data.status == "dependency"){
            if(data.dependent_items.length > 0){
              let mssg = `\u2022 Other tables have foreign key references to ${model_name}, removing this table will drop the foreign key relationships`
              mssg += `\n \u2022 ${JSON.stringify(data.dependent_items).replace('[','').replace(']','')} Subprocess need to be configured to be able to delete this Data Table.`
              Swal.fire({icon: 'warning',text: mssg});
            }else{
              let mssg = `Other tables have foreign key references to ${model_name}, removing this table will drop the foreign key relationships`
              Swal.fire({
                          icon:'question',
                          text: `Do you wish to delete ${model_name}? \n\nClick 'Yes' to confirm or click 'No' if you do not wish to delete it.`,
                          showDenyButton: true,
                          showCancelButton: true,
                          confirmButtonText: 'Yes',
                          denyButtonText: 'No',
                        }).then((result) => {
                          if (result.isConfirmed) {
                            delete_table_model(model_name)
                          }
                        })
            }
          }
          else{
            if(data.dependent_items.length > 0){
              let mssg = `${JSON.stringify(data.dependent_items).replace('[','').replace(']','')} Subprocess need to be configured to be able to delete this Data Table.`
              Swal.fire({icon: 'warning',text: mssg});
            }
          }
        },
        error: function () {
        Swal.fire({icon: 'error',text: 'Error! Please try again.'});
        }
        })
      }
    })

    function delete_table_model(model_name){
      $.ajax({
        url: window.location.pathname,
        data:{'operation': 'delete_table_model','model_name':model_name },
        type: "POST",
        dataType: "json",
        success: function(data){
          Swal.fire({icon: 'success',text: `${model_name} deleted successfully!`});
          $('#userdeftable').find('#userdefrow').find(`#${model_name}`).remove()
          $("#userdeftable_def").find('#userdefrow').find(`#${model_name}`).remove()
          $('.dataElements').find('.list-group').empty()
          $('.dataElements').find('p').empty()
          $('#selectedElement').empty()
          $('#myTable').empty()
          $('#relTable').empty()
          $(".attributeDetails").find("p").empty()
          $("#dataele_add").hide()
          $('#dataele_delete').hide()
          $('#dataele_order').hide()
          $('#edit_att_det').hide()
          $('#delete_att_det').hide()
          $('#add_att_val').hide()
          $("#dataele_replica_table").hide()
        },
        error: function () {
        Swal.fire({icon: 'error',text: 'Error! Please try again.'});
        }
        })
    }
  })


  // Delete  element
  $("#delete_att_det").on('click',function(){
    if(!auditFields.includes($("#selectedElement").text())){
      $("#delete_att_det").html(`<i class="fa fa-circle-notch fa-spin javaSC thin-icon" style="font-size:17px;"></i>`)
      var newTableName = $(".dataElements").find("p").text()
      checkChangedConfig(newTableName,"Column deleted","#delete_att_det","editattr_modal","delete")
    } else {
      Swal.fire({icon: 'warning',text: 'Audit fields cannot be deleted.'});
    }
  })
function deleteColumn() {
  var model_name = $(".dataElements").find("p").text()
    var field_name = $('#selectedElement').text()
    let confirm_del = null
    Swal.fire({
      icon:'question',
      text: `Do you wish to delete ${field_name} from ${model_name}? \n\nClick 'Yes' to confirm or click 'No' if you do not wish to delete it.`,
      showDenyButton: true,
      showCancelButton: true,
      confirmButtonText: 'Yes',
      denyButtonText: 'No',
    }).then((result) => {
      if (result.isConfirmed) {
        $.ajax({
          url: window.location.pathname,
          data: {'operation': 'check_relation_delete','field_name':field_name,'model_name':model_name},
          type: "POST",
          dataType: "json",
          success:function(data){
            if(data.status == "normal"){
              delete_field_element(model_name,field_name)
            }else if(data.status == "autofield_detected"){
              Swal.fire({icon: 'warning',text: `${field_name} is a primary key and cannot be deleted.`});
            }else{
              Swal.fire({
                icon:'question',
                text: `Other tables have Foreign Key references with ${field_name},  removing this table will drop the Foreign Key relationships \n\n Do you wish to remove ${field_name} from ${model_name}? Click 'Yes' to confirm or click 'No' if you do not wish to remove it.`,
                showDenyButton: true,
                showCancelButton: true,
                confirmButtonText: 'Yes',
                denyButtonText: 'No',
              }).then((result) => {
                if (result.isConfirmed) {
                  delete_field_element(model_name,field_name)
                }
              });
            }
          },
          error: function (data){
            Swal.fire({icon: 'error',text: 'Error! Failure in deleting selected column / element. Please try again.'});
          }
        });
      }
    });

      function delete_field_element(model_name,field_name){
        $.ajax({
          url: window.location.pathname,
          data: {'operation': 'delete_field_element','field_name':field_name,'model_name':model_name},
          type: "POST",
          dataType: "json",
          success:datatableReload,
            error: function (data){
              Swal.fire({icon: 'error',text: 'Error! Failure in deleting specific field. Please try again.'});
              }

          });
      }

         function datatableReload(data) {
          regenrateHtml()
          var model_name = $(".dataElements").find("p").text()
          $('#dynamic').empty()
          $(this).find('form').trigger('reset');
          Swal.fire({icon: 'success',text: 'Field removed successfully!'});
          $('#userdeftable').find(`button[id='${model_name}']`).click()

        }
}




// Mapper Modal
$('#mapper_modal').on('show.bs.modal', function (e) {

setTimeout(function(){
    $('#mapper_modal_datatable').DataTable({
  "paging": false,
  "ordering": false,
  "info": false,
  "searching": false,
  "autoWidth": true,
  "scrollY": "200px",
  "sScrollX": "110%",
  "scrollX":true,
  "scrollCollapse": true,
  destroy: true,
  columnDefs: [
    {
      targets: "_all",
      className: 'dt-center allColumnClass all'
    }
    ],

  });
},400)
})
  </script>



<script>
  $(document).on("click", ".viewdetails_button", function(){

var parent_table = $(this).closest('tr').find('td').eq(0).text().trim()
var parent_col = $(this).closest('tr').find('td').eq(1).text().trim()

$.ajax({
url: window.location.pathname,
data:{ 'model_name': parent_table, 'field_name': parent_col, 'operation': 'view_attr_details' },
type: "POST",
dataType: "json",
success: datatableReload,
error: function () {
 Swal.fire({icon: 'error',text: 'Error! Please try again.'});
}
})

function datatableReload(data) {
 var rel_details = JSON.parse(data["details"])
 var fk_rel_details = JSON.parse(data["rel_details"])
 if(rel_details['Primary Key'] == true){
  rel_details['Primary Key'] = 'Yes'
 }else{
  rel_details['Primary Key'] = 'No'
 }

 if(rel_details['Nullable'] == true){
  rel_details['Nullable'] = 'Yes'
 }else{
  rel_details['Nullable'] = 'No'
 }

 if(rel_details['Editable'] == true){
  rel_details['Editable'] = 'Yes'
 }else{
  rel_details['Editable'] = 'No'
 }

 if(rel_details['Unique'] == true){
  rel_details['Unique'] = 'Yes'
 }else{
  rel_details['Unique'] = 'No'
 }

 if(rel_details['Choices']==false){
  rel_details['Choices'] = "Null"
 }

 if(rel_details['Validations'].length < 0){
  rel_details['Validations'] = "Null"
 }
$('#viewDetail_table_body').empty()
$("#view_table_name").val(parent_table)
$("#view_field_name").val(parent_col)
$("#view_null_field").val(rel_details["Nullable"]).trigger('change');
$("#view_field_datatype").val(rel_details["Data Type"]).trigger('change');
$("#view_unique").val(rel_details["Unique"]).trigger('change');
$("#view_editable").val(rel_details["Editable"]).trigger('change');
$("#view_primary_key").val(rel_details["Primary Key"]).trigger('change');



if(rel_details["Data Type"] === "ForeignKey"){


for(var numb =0;numb < Object.keys(rel_details).length;numb++){

  $("#view_parent_fk_name").css('display','block')
  $("#view_parent_fk_name").prev().css('display','block')
  $("#view_parent_fk_name").val(Object.getOwnPropertyNames(fk_rel_details)[0])
  $(".view_details_table_row").find(`input[name='${Object.keys(rel_details)[numb] }']`).val(rel_details[Object.keys(rel_details)[numb]] )
}
}else{
for(var numb =0;numb < Object.keys(rel_details).length;numb++){
  $("#view_parent_fk_name").css('display','none')
    $("#view_parent_fk_name").prev().css('display','none')

  $(".view_details_table_row").find(`input[name='${Object.keys(rel_details)[numb] }']`).val(rel_details[Object.keys(rel_details)[numb]] )
}
}


}
});
</script>

<script>

  $(document).ready(function () {
      var table = $('#example1').DataTable({
        'deferRender':true,
        "paging": false,
        "ordering": false,
        "info": false,
        "searching": false,
        "autoWidth": true,
      "scrollY": "165px",
      "sScrollX": "110%",
      "scrollX":true,
      "scrollCollapse": true,
      columnDefs: [
        {
          targets: "_all",
          className: 'dt-center allColumnClass all'
        }
        ],

      });
    });

  </script>

<script>

  $(document).ready(function () {
      var table = $('#example2').DataTable({
        'deferRender':true,
        "paging": false,
        "ordering": false,
        "info": false,
        "searching": false,
        "autoWidth": true,
      "scrollY": "200px",
      "sScrollX": "110%",
      "scrollX":true,
      "scrollCollapse": true,
      columnDefs: [
        {
          targets: "_all",
          className: 'dt-center allColumnClass all'
        }
        ],

      });
    });

  </script>

<script>
  $('#validate-tab-just').addClass('show');
      $('#validate-tab-just').addClass('active');

</script>


<!--script for table creation msg popup for same table exists& restricts space-->
<div class="modal fade" id="file_settings_modal" role="dialog">
  <div class="modal-dialog modal-dialog-centered">
    <!-- Modal content-->
    <div class="modal-content">
      <!-- Modal header-->
      <div class="modal-header">
        <h6 class="modal-title" id="modal-field-name" name="">File Extension</h6>
        <i class="fa-solid fa-file-import iconsize"></i>
      </div>
      <!-- Modal body-->
      <div class="modal-body">
        <div class="row" id="modal_content">

            <div class="col-4 form-group">
              <label class="acies_label" style="padding-left: 0.3em;">Limit file extensions</label>
            </div>
            <div class="col-8 form-group">
              <select id="extension" class="form-control select2"
                style="margin-right: 15px;margin-top:-18px;">
                <option value="Any">Any</option>
                <option value="Images">Images(All formats)</option>
                <option value="PDF">PDF</option>
                <option value="Document">Document(PDF, CSV, Excel, Word)</option>
              </select>
            </div>

        </div>
      </div>
      <!-- Modal footer-->

        <div class="modal-footer">
          <button type="button" class="btn  buttonfooter" onclick="file_settings_save(this)" value="">Save</button>
          <button type="button" class="btn  buttonfooter" data-dismiss="modal">Close</button>
        </div>

    </div>
  </div>
</div>
<div class="modal fade" id="video_settings_modal" role="dialog">
  <div class="modal-dialog modal-dialog-centered">
    <!-- Modal content-->
    <div class="modal-content">
      <!-- Modal header-->
      <div class="modal-header">
        <h6 class="modal-title" id="video-field-name" name="">Video Type</h6>
        <i class="fa-solid fa-video iconsize"></i>
      </div>
      <!-- Modal body-->
      <div class="modal-body">
        <div class="row" id="video_content">

            <div class="col-4 form-group">
              <label class="acies_label" style="padding-left:0.3em;">Choose Video Type</label>
            </div>
              <div class="col-8 form-group">
              <select id="extension_video" class="form-control select2"
                style="margin-right: 15px;margin-top:-18px;">
                <option value="external_link">External links (Youtube & Vimeo)</option>
                <option value="Video">Video files (mp4/webm/ogv)</option>
                <option value="mp4">Video files (mp4 only)</option>
                <option value="webm">Video files (webm only) </option>
                <option value="ogv">Video files (ogv only)</option>
              </select>
            </div>

        </div>
      </div>
      <!-- Modal footer-->
      <div class="modal-footer">
        <button type="button" class="btn  buttonfooter" onclick="video_settings_save(this)" value="">Save</button>
        <button type="button" class="btn  buttonfooter" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="uuid_settings_modal" role="dialog">
  <div class="modal-dialog modal-dialog-centered">
    <!-- Modal content-->
    <div class="modal-content">
      <!-- Modal header-->
      <div class="modal-header">
        <h6 class="modal-title" id="modal-field-name" name="">UniqueIDField</h6>
        <i class="fa-solid fa-id-card iconsize"></i>

      </div>
      <!-- Modal body-->
      <div class="modal-body">
          <div class="row" id="modal_content">
            <div class="col-4 form-group">
              <label class="acies_label"style="padding-left:0.3em;">ID Type</label>
                  <select class="form-control select2" onchange="id_type_change()" id="id_type">
                    <option value="" disabled selected></option>
                    <option value="Numeric">Numeric</option>
                    <option value="Alphanumeric">Alphanumeric</option>
                  </select>
              </div>
              <div class="col-4 form-group">
              <label class="acies_label">Sequential/ Random?</label>
                  <select class="form-control select2" id="serial">
                    <option value="" disabled selected></option>
                    <option value="Sequencial">Sequential</option>
                    <option value="Random">Random</option>
                  </select>
              </div>
              <div class="col-4 form-group">
              <label class="acies_label ">Length</label>
                  <input class="form-control numberinput" type="number" name="uuid_length" id="id_length">
              </div>
            </div>
              <div class="row" id="showhidealpha1" style="display: none;">
                <div class="col-4 form-group">
                  <label class="acies_label">Prefix/ Suffix Text?</label>
                  <input class="form-control textInput" type="text" id="id_text">
                </div>
                <div class="col-4 form-group">
                  <label class="acies_label">Prefix/ Suffix?</label>
                  <select class="form-control select2" id="position">
                    <option value="" disabled selected></option>
                    <option value="Prefix">Prefix</option>
                    <option value="Suffix">Suffix</option>
                  </select>
                </div>
              </div>
          </div>
      <!-- Modal footer-->
      <div class="modal-footer">
        <button type="button" class="btn buttonfooter" onclick="uuid_settings_save(this)" value="">Save</button>
        <button type="button" class="btn  buttonfooter" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<script>
  $('#id_length').on('input', function () {
      var inputValue = $(this).val();

      if (inputValue < 0 || !/^\d+$/.test(inputValue)) {
          $('#lengthError').text('Length cannot be negative');
          $(this).val('');
      } else {
          $('#lengthError').text('');
      }
  });
</script>
<div class="modal fade" id="card_settings_modal" role="dialog">
  <div class="modal-dialog" style="max-width:75rem;">
    <!-- Modal content-->
    <div class="modal-content">
      <!-- Modal header-->
      <div class="modal-header">
        <h6 class="modal-title" id="modal-field-name" name="">CardField</h6>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>
      <!-- Modal body-->
      <div class="modal-body" style="overflow: auto;max-height: 25rem;" id="modal_content">
            <div class="form-group col-4">
              <label for="card_field_create" class="">
                  Card security settings
              </label>
            </div>
            <div class="row card_field_create_div">
              <div class="col-2 form-group">
                <label class="acies_label col-md-12">Secure with?</label>
                  <select name="datakey" id="card_field_create_enclass" class="form-control select2 card_enclass" min="0">
                    <option value="None" selected="">None</option>
                    <option value="encrypt">Encryption</option>
                  </select>
              </div>
              <div class="col-3 form-group card_kclass">
                <label class="acies_label col-md-12">Key</label>
                  <input type="text" name="datakey" id="card_field_create_kclass" class="form-control" min="0" disabled>
              </div>
            </div>
            <div class="custom-control custom-checkbox form-group col-4">
              <input type="checkbox" name="cvv_field_create" id="cvv_field_create" class="checkboxinput custom-control-input">
              <label for="cvv_field_create" class="custom-control-label">
                  Create CVV field
              </label>
            </div>
            <div class="row cvv_field_create_div" style="display:none;">
              <div class="form-group col-2">
                <label class="acies_label">Enter Field name</label>
                <input type="text" name="cvv_field_create_fname" id="cvv_field_create_fname" class="cardspace_error" style="top:1rem;">
                <small style="display: none;color:red;padding-top: 1rem;">Field name should not be in capital letters and not have spaces</small>
              </div>
              <div class="form-group col-2">
                <label class="acies_label">Enter Field header</label>
                <input type="text" name="cvv_field_create_vname" id="cvv_field_create_vname" style="top:1rem;">
              </div>
              <div class="form-group col-2">
                  <label class="acies_label">Nullable?</label>
                  <select class="form-control select2" id="cvv_field_create_null">
                    <option value="" disabled selected>select one</option>
                    <option value="1">Yes</option>
                    <option value="2">No</option>n>
                  </select>
              </div>
              <div class="col-2 form-group">
                <label class="acies_label col-md-12">Secure with?</label>
                  <select name="datakey" id="cvv_field_create_enclass" class="form-control select2 card_enclass" min="0">
                    <option value="None" selected="">None
                    </option><option value="encrypt">Encryption
                    </option>
                  </select>
              </div>
              <div class="col-3 form-group card_kclass">
                <label class="acies_label col-md-12">Key</label>
                  <input type="text" name="datakey" id="cvv_field_create_kclass" class="form-control" min="0" disabled>
              </div>
            </div>
            <div class="custom-control custom-checkbox form-group col-4">
              <input type="checkbox" name="expiryDate_field_create" id="expiryDate_field_create" class="checkboxinput custom-control-input">
              <label for="expiryDate_field_create" class="custom-control-label">
                  Create Expiry field
              </label>
            </div>
            <div class="row expiryDate_field_create_div" style="display:none;">
              <div class="form-group col-2">
                <label class="acies_label">Enter Field name</label>
                <input type="text" name="expiryDate_field_create_fname" id="expiryDate_field_create_fname" class="cardspace_error" style="top:1rem;">
                <small style="display: none;color:red;padding-top: 1rem;">Field name should not be in capital letters and not have spaces</small>
              </div>
              <div class="form-group col-2">
                <label class="acies_label">Enter Field header</label>
                <input type="text" name="expiryDate_field_create_vname" id="expiryDate_field_create_vname" style="top:1rem;">
              </div>
              <div class="form-group col-2">
                  <label class="acies_label">Nullable?</label>
                  <select class="form-control select2" id="expiryDate_field_create_null">
                    <option value="" disabled selected>select one</option>
                    <option value="1">Yes</option>
                    <option value="2">No</option>n>
                  </select>
              </div>
              <div class="col-2 form-group">
                <label class="acies_label col-md-12">Secure with?</label>
                  <select name="datakey" id="expiryDate_field_create_enclass" class="form-control select2 card_enclass" min="0">
                    <option value="None" selected="">None
                    </option><option value="encrypt">Encryption
                    </option>
                  </select>
              </div>
              <div class="col-3 form-group card_kclass">
                <label class="acies_label col-md-12">Key</label>
                  <input type="text" name="datakey" id="expiryDate_field_create_kclass" class="form-control" min="0" disabled>
              </div>
            </div>
            <div class="custom-control custom-checkbox form-group col-4">
              <input type="checkbox" name="cardtype_field_create" id="cardtype_field_create" class="checkboxinput custom-control-input">
              <label for="cardtype_field_create" class="custom-control-label">
                  Create Card type field
              </label>
            </div>
            <div class="row cardtype_field_create_div" style="display:none;">
              <div class="form-group col-2">
                <label class="acies_label">Enter Field name</label>
                <input type="text" name="cardtype_field_create_fname" id="cardtype_field_create_fname" class="cardspace_error" style="top:1rem;">
                <small style="display: none;color:red;padding-top: 1rem;">Field name should not be in capital letters and not have spaces</small>
              </div>
              <div class="form-group col-2">
                <label class="acies_label">Enter Field header</label>
                <input type="text" name="cardtype_field_create_vname" id="cardtype_field_create_vname" style="top:1rem;">
              </div>
              <div class="form-group col-2">
                  <label class="acies_label">Nullable?</label>
                  <select class="form-control select2" id="cardtype_field_create_null">
                    <option value="" disabled selected>select one</option>
                    <option value="1">Yes</option>
                    <option value="2">No</option>n>
                  </select>
              </div>
              <div class="col-2 form-group">
                <label class="acies_label col-md-12">Secure with?</label>
                  <select name="datakey" id="cardtype_field_create_enclass" class="form-control select2 card_enclass" min="0">
                    <option value="None" selected="">None
                    </option><option value="encrypt">Encryption
                    </option>
                  </select>
              </div>
              <div class="col-3 form-group card_kclass">
                <label class="acies_label col-md-12">Key</label>
                  <input type="text" name="datakey" id="cardtype_field_create_kclass" class="form-control" min="0" disabled>
              </div>
            </div>
          </div>
      <!-- Modal footer-->
      <div class="modal-footer">
        <button type="button" class="btn btn-primary btn-xs float-right" onclick="card_settings_save(this)" value="">Save</button>
      </div>
    </div>
  </div>
</div>


<div class="modal fade" id="privacy_settings_modal" role="dialog">
  <div class="modal-dialog" style="max-width:45rem;">
    <!-- Modal content-->
    <div class="modal-content">
      <!-- Modal header-->
      <div class="modal-header">
        <h6 class="modal-title" id="modal-field-name" name="">PrivacyField</h6>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>
      <!-- Modal body-->
      <div class="modal-body" style="overflow: auto;max-height: 25rem;" id="modal_content">
        <div class="row">
          <div class="form-group col-4">
            <label class="acies_label">Select access for:</label>
            <select class="form-control select2 privacyf_selectop" name="privacy_option">
              <option value="" selected disabled>choose one</option>
              <option value="users">Users</option>
              <option value="groups">Groups</option>
              <option value="master">Master Based</option>
            </select>
          </div>
        </div>
        <div class="row master_priv_div" style="display: none;">
          <div class="form-group col-4">
            <label class="acies_label">Master table:</label>
            <select class="form-control select2 privacy_master_table" name="master_table">
              <option value="" selected>Select One</option>
              {% for model in modelsList %}
                <option value="{{model}}">{{model}}</option>
              {% endfor %}
            </select>
          </div>
          <div class="form-group col-4">
            <label class="acies_label">Group field:</label>
            <select class="form-control select2 privacy_master_groupf" name="group_field">

            </select>
          </div>
          <div class="form-group col-4">
            <label class="acies_label">User field:</label>
            <select class="form-control select2 privacy_master_userf" name="user_field">
            </select>
          </div>
        </div>
      </div>
      <!-- Modal footer-->
      <div class="modal-footer">
        <button type="button" class="btn btn-primary btn-xs float-right" onclick="privacy_settings_save(this)" value="">Save</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="table_settings_modal" role="dialog">
  <div class="modal-dialog" style="max-width:75rem;">
    <!-- Modal content-->
    <div class="modal-content">
      <!-- Modal header-->
      <div class="modal-header">
        <h6 class="modal-title" id="modal-field-name" name="">TableField</h6>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>
      <!-- Modal body-->
      <div class="modal-body" style="overflow: auto;max-height: 25rem;" id="modal_content">
            <div class="row table_field_create_div">
              <div class="col-2 form-group">
                <label class="acies_label col-md-12">Select master table: </label>
                  <select  id="table_field_master" class="form-control select2 table_master_class">
                    {% for model in level2 %}
                      <option value="{{model}}">{{model}}</option>
                    {% endfor %}
                  </select>
              </div>
            </div>
            </div>
          <!-- </div> -->
      <!-- Modal footer-->
      <div class="modal-footer">
        <button type="button" class="btn btn-primary btn-xs float-right" onclick="table_settings_save(this)" value="">Save</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="mulsel_settings_modal" role="dialog">
  <div class="modal-dialog" style="max-width:40rem;">
    <!-- Modal content-->
    <div class="modal-content">
      <!-- Modal header-->
      <div class="modal-header">
        <h6 class="modal-title" id="modal-field-name" name="">MultiselectField</h6>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>
      <!-- Modal body-->
      <div class="modal-body" style="max-height: 90%;" id="modal_content">
        <div class="row">

          <div class="form-group col-6" style="display: block;">
            <label class="acies_label ">Column:&nbsp;</label>
              <input type="text" class= "multipleSelectedColumn" readonly>

            </div>

          <div class="form-group col-8">
            <label class="acies_label ">Master Table:&nbsp;</label>
              <select class="select2 form-control selectMultipleFormTable" onchange="populateMultiselectColumn.call(this)" name="tableform1">
                {% for model in modelsList %}
                <option value="{{model}}">{{model}}</option>
                {% endfor %}
              </select>
          </div>
      </div>
      <div class="row">
        <div class="form-group col-6">
          <label class="acies_label ">Column:&nbsp;</label>
          <select  class="select2 form-control selectTableColumns" name="templateforms">

          </select>
        </div>
        <div class="form-group col-6">
          <label class="acies_label ">Additional :&nbsp;</label>
          <select  class="select2 form-control additional" name="templateforms" multiple>
          </select>
          </div>
      </div>
      <div class="row">
        <div class="custom-control custom-checkbox defaultValueConfig col-7" style="margin-left:1%;">
          <input type="checkbox" name="defaultValueConfig" id="selectAlll" class="checkboxinput custom-control-input defaultValue" value="0">
          <label for="selectAlll" class="custom-control-label">
            Ability to configure Value
          </label>
          </div>
        <div class="col-2">
          <button class="btn btn-primary multiselectButton" type="button" onclick="openMultiselectCondition.call(this,'0')">Condition</button>
        </div>
      </div>
      <div class="row">
        <div class="custom-control custom-checkbox col-7" style="margin-left:1%;">
          <input type="checkbox" id="selectAlll_plus" class="checkboxinput plus custom-control-input">
          <label for="selectAlll_plus" class="custom-control-label">
            Add plus button
          </label>
          </div>
      </div>
      <div class="row" style="margin-top:9px;">
        <div class="custom-control custom-checkbox col-7" style="margin-left:1%;">
          <input type="checkbox" id="additionalInfoCB" class="checkboxinput custom-control-input">
          <label for="additionalInfoCB" class="custom-control-label">
            Display additional information in field dropdown
          </label>
          </div>
      </div>
      <div class="row" style="margin-top:9px;">
        <div class="custom-control custom-checkbox col-7" style="margin-left:1%;">
          <input type="checkbox" id="selectAlll_option_popup" class="checkboxinput option_popup custom-control-input">
          <label for="selectAlll_option_popup" class="custom-control-label">
            Show element attributes
          </label>
          </div>
      </div>
      <div class="row" style="margin-top:9px;">
        <div class="col-7" style="margin-left:1%;">
          <label class="acies_label ">Set default values :&nbsp;</label>
          <select  class="select2 form-control def_values_opt" multiple>
          </select>
          </div>
      </div>
          </div>
      <!-- Modal footer-->
      <div class="modal-footer">
        <button type="button" class="btn btn-primary btn-xs float-right" onclick="mulsel_settings_save(this)" value="">Save</button>
      </div>
    </div>
  </div>
</div>

<div class="modal" id="multiselectConditionModal">
  <div class="modal-dialog modal-xl modal-dialog-centered" style="justify-content: center;">
    <div class="modal-content" style="text-align: center;justify-content: center;" >

      <div class="modal-header" style="background:#565a5e;color:white;">
        <h6 class="modal-title" style="flex: auto;">Multiselect condition</h6>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>

      <div class="modal-body" style="height: 20rem;overflow: auto;">
        <div class="row">
          <div class="col-12">
            <i class="fa fa-plus-square fa-2x" data-toggle="tooltip" title="Add condition" onclick="addMultiselectCond.call(this)" style="float:right;color:var(--primary-color);cursor: pointer;" data-tooltip="Add condition"></i>
          </div>
        </div>
        <div class="row mainCont" style="margin-top:10px; display:block">
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" onclick="saveMultiselectCondition.call(this)" class="btn btn-primary btn-xs mx-2 rounded px-2" data-dismiss="modal">Save</button>
        <button type="button" class="btn btn-primary btn-xs mx-2 rounded px-2" data-dismiss="modal">Close</button>
      </div>

    </div>
  </div>
</div>

<script>

$('.privacyf_selectop').off('select2:select').on('select2:select', function(){
  if($(this).val() == "master"){
    $('.master_priv_div').css("display","flex")
  }else{
    $('.master_priv_div').css("display","none")
  }
})

$('.privacy_master_table').off('select2:select').on('select2:select', function(){

  if($(this).val()){
    $.ajax({
      url: window.location.pathname,
      data: {'table_name': $(this).val(), 'operation': 'getcolumns' },
      type: "POST",
      dataType: "json",
      success:function(data) {
            $(".privacy_master_groupf").empty()
            $(".privacy_master_userf").empty()

            $(".privacy_master_groupf").append(`<option value="" selected>Select one</option>`)
            $(".privacy_master_userf").append(`<option value="" selected>Select one</option>`)

            for(let [key,value] of Object.entries(data)){
              $(".privacy_master_groupf").append(`<option value="${key}">${value}</option>`)
              $(".privacy_master_userf").append(`<option value="${key}">${value}</option>`)
            }

            if($(".privacy_master_groupf").attr("data-reload")){
              val = $(".privacy_master_groupf").attr("data-reload")
              $(".privacy_master_groupf").val(val).trigger("change")
              $(".privacy_master_groupf").removeAttr("data-reload")
            }

            if($(".privacy_master_userf").attr("data-reload")){
              val = $(".privacy_master_userf").attr("data-reload")
              $(".privacy_master_userf").val(val).trigger("change")
              $(".privacy_master_userf").removeAttr("data-reload")
            }

          },
          error: function (data){
            Swal.fire({icon: 'error',text: 'Error! Please try again.'});
           }

      });
  }else{
    $(".privacy_master_groupf").empty()
    $(".privacy_master_userf").empty()
  }

})

$('#cvv_field_create').off('click').on('click', function(){
  if ($('#cvv_field_create')[0].checked==true){
    $('.cvv_field_create_div').css("display","flex")
  }else{
    $('.cvv_field_create_div').css("display","none")
  }
})

$('#expiryDate_field_create').off('click').on('click', function(){
  if ($('#expiryDate_field_create')[0].checked==true){
    $('.expiryDate_field_create_div').css("display","flex")
  }else{
    $('.expiryDate_field_create_div').css("display","none")
  }
})

$('#cardtype_field_create').off('click').on('click', function(){
  if ($('#cardtype_field_create')[0].checked==true){
    $('.cardtype_field_create_div').css("display","flex")
  }else{
    $('.cardtype_field_create_div').css("display","none")
  }
})

$(".card_enclass").on("change", function() {
  if($(this).val() != "None"){
    $(this).parent().parent().find(".card_kclass").find("input").prop("disabled", false);
  }else{
    $(this).parent().parent().find(".card_kclass").find("input").prop("disabled", true);
  }
})

  $('select.select2:not(.modal select.select2)').each(function(){
    parent = $(this).parent()
    $(this).select2({dropdownParent:parent})
})
$('.modal select.select2').each(function(){
    $(this).select2()
})
 function id_type_change() {
   if ($('option:selected', `#id_type`).val() == "Alphanumeric") {
     $("#showhidealpha1").css("display", "")
   }
   else {
    $("#showhidealpha1").css("display", "none")
   }
 }
  $('#tname').change(function(){
    var table_name = $('#tname').val();

      $.ajax({
      url: window.location.pathname,
      data: {'table_name': JSON.stringify(table_name), 'operation': 'errormsg' },
      type: "POST",
      dataType: "json",
      success:function(data) {
            if (data.existing == 'Yes')
            {
              $('#alerts1').css('display','block')
              $('#export-btn').prop("disabled", true);
              var el=document.getElementById('tname')
              el.addEventListener('keydown', function(event) {
                    const key = event.key;
                    if (key === "Backspace" || key === "Delete")
                        {

                          $('#alerts1').css("display","none")
                          $('#export-btn').prop("disabled", false);
                          $('#table_name').css("margin-bottom","1em")
                        }
                      })
            } else {
             {
              $('#export-btn').prop("disabled", false);
              $('#alerts1').css('display','none')
             }
            }
          },
          error: function (data){
            Swal.fire({icon: 'error',text: 'Error! Please try again.'});
           }

      });

    })

  function RestrictSpace() {
     if (event.keyCode == 32) {
         return false;
     }

  }

  $('#tname').on('paste', function(){
    setTimeout(()=>{
      $(this).val($(this).val().replace(/\s+/g, '')).trigger('change')
    }, 100);
  });

  $('a[data-toggle="tab"]').on('shown.bs.tab', function(e){
    $($.fn.dataTable.tables(true)).DataTable()
       .columns.adjust();
 });

 function getColumns(table){
      $.ajax({
        url: `/users/${urlPath}/processGraphModule/`,
        data: {
          'operation': 'formTableFields',
          'tablesForm': JSON.stringify([table]),
        },
        async: false,
        type: "POST",
        dataType: "json",
        success: function (data) {
          for (j in data.finalFieldList2) {
            $(".mainCont").find(".subCont").eq(-1).find(".selectColumnMultiselect").append(`<option value="${data.finalFieldList2[j]['fieldName']}">${data.finalFieldList2[j]['verbose']}</option>`)
          }
        },
        error: function () {
          Swal.fire({text:"Error",icon:"error"});
        }
      })
    }
    function openMultiselectCondition(index) {
      $("#multiselectConditionModal").modal("show");
      $("#multiselectConditionModal").attr("data-number",index);
      $(".mainCont").empty();
      if($(this).attr("data-data") != undefined){
        let data = JSON.parse($(this).attr("data-data"));
        for(let i = 0; i < data.length; i++){
          addMultiselectCond();
          $(".mainCont").find(".subCont").eq(-1).find(".selectConditionMultiselect").val(data[i]["cond"]).trigger("change")
          $(".mainCont").find(".subCont").eq(-1).find(".selectColumnMultiselect").val(data[i]["condColumn"]).trigger("change")
          $(".mainCont").find(".subCont").eq(-1).find(".dynamicValMultiselect").val(data[i]["dynamicVal"]).trigger("change")
          $(".mainCont").find(".subCont").eq(-1).find(".multiselectConstraint").val(data[i]["constraint"]).trigger("change")
          $(".mainCont").find(".subCont").eq(-1).find(".multiselectSet").val(data[i]["ruleSet"]).trigger("change")
          if(JSON.stringify(data[i]["condValue"]).includes("[")){
            let data1 = data[i]["condValue"]
            $(".mainCont").find(".subCont").eq(-1).find(".valueMultiselectTag").css("display","block")
            for(let j = 0; j < data1.length; j++){
              $(".mainCont").find(".subCont").eq(-1).find(".valueMultiselectTag").find("select").append(`<option value="${data1[j]}">${data1[j]}</option>`)
            }
            $(".mainCont").find(".subCont").eq(-1).find(".valueMultiselectTag").find("select").val(data1).trigger("change")
          } else {
            let data1 = data[i]["condValue"]
            $(".mainCont").find(".subCont").eq(-1).find(".valueMultiselect").find("select").append(`<option value="${data1}">${data1}</option>`)
            $(".mainCont").find(".subCont").eq(-1).find(".valueMultiselect").find("select").val(data1).trigger("change")
          }
          $(".mainCont").find(".subCont").eq(-1).find(".selectColumnMultiselect").val(data[i]["condColumn"]).trigger("change")
        }
      }
    }
    function saveMultiselectCondition() {
      let dic = []
      var condValue = []
      var cond = []
      var condColumn = []
      var dynamicVal = []
      var constraint = []
      var ruleSet = []
      let dic1 = {}
      $(this).closest(".modal").find('.subCont').each(function() {
        dic1 = {
          "condValue":"",
          "cond":"",
          "condColumn":"",
          "dynamicVal":"",
          "constraint":"",
          "ruleSet":""
        }
        if($(this).find('.valueMultiselect').css('display') != 'none') {
          var tempVal = $(this).find('.valueMultiselect').find('select').val();
          dic1.condValue = tempVal;
        } else {
          dic1.condValue = $(this).find('.valueMultiselectTag').find('select').val();
        }
        var temp = $(this).find('.selectConditionMultiselect').val()

        dic1.cond = temp;
        dic1.condColumn = $(this).find('.selectColumnMultiselect').val();
        dic1.dynamicVal = $(this).find('.dynamicValMultiselect').val();
        dic1.constraint = $(this).find('.multiselectConstraint').val();
        dic1.ruleSet = $(this).find('.multiselectSet').val();
        dic.push(dic1)
      })
      let index = $("#multiselectConditionModal").attr("data-number");
      $(".multiselectButton").attr("data-data",JSON.stringify(dic))
    }
    function multiselectConditionHtml(){
      let html = `
      <div class="subCont col-12" style="display:flex; margin-top: 10px">
      <div class="col-3">
        <p style="font-weight: bold;">Select Condition Column</p>
        <select class="select2 form-control selectColumnMultiselect" name="selectparentcolumnCond" >
        </select>
      </div>
      <div class="col-2">
        <p style="font-weight: bold;">Select condition:</p>
        <select class="select2 form-control selectConditionMultiselect" required onchange="multiselectCondChange.call(this)">
          <option value="Greater than">Greater than</option>
          <option value="Smaller than">Smaller than</option>
          <option value="Equal to">Equal to</option>
          <option value="Not Equal to">Not Equal to</option>
          <option value="IN">In</option>
          <option value="NOT IN">Not In</option>
          <option value="Starts with">Starts with</option>
          <option value="Ends with">Ends with</option>
        </select>
      </div>
      <div class="col-2 valueMultiselect">
        <p style="font-weight: bold;">Select value:</p>
        <select class="select2 form-control tags" required>
        </select>
      </div>
      <div class="col-2 valueMultiselectTag" style="display: none;">
        <p style="font-weight: bold;">Select value:</p>
        <select class="select2 form-control tags" required multiple>
        </select>
      </div>
      <div class="col-2">
        <p style="font-weight: bold;">Select dynamic value:</p>
        <select class="select2 form-control dynamicValMultiselect">
          <option value="" selected>Select value</option>
          <option value="curr_user">Current User</option>
          <option value="curr_date">Current Date</option>
        </select>
      </div>
      <div class="col-1">
        <p style="font-weight: bold;">Contraint:</p>
        <input class="form-control multiselectConstraint" type="text">
      </div>
      <div class="col-1">
        <p style="font-weight: bold;">Rule set:</p>
        <input class="form-control multiselectSet" type="text">
      </div>
      <div class="col-1">
        <i class="fas fa-minus" onclick="removeMultiselectCond.call(this)" data-toggle="tooltip" title="Remove condition"></i> </i>
      </div>
    </div>
      `
      return html
    }
    function multiselectCondChange(){
      if($(this).val() == "IN" || $(this).val() == "NOT IN"){
        $(this).closest(".subCont").find(".valueMultiselectTag").css("display","block");
        $(this).closest(".subCont").find(".valueMultiselect").css("display","none");
      } else {
        $(this).closest(".subCont").find(".valueMultiselectTag").css("display","none");
        $(this).closest(".subCont").find(".valueMultiselect").css("display","block");
      }
    }
    function removeMultiselectCond() {
      $(this).closest(".subCont").remove()
    }
    function addMultiselectCond() {
      $(".mainCont").append(multiselectConditionHtml());
      $(".mainCont").find(".subCont").eq(-1).find('.select2').each(function(){
    parent = $(this).parent()
    $(this).select2({dropdownParent:parent})
  });
      $(".mainCont").find(".subCont").eq(-1).find(".tags").select2({"tags":true});
      let index = $("#multiselectConditionModal").attr("data-number");
      let option = $(".additional").eq(parseInt(index)).html();
      option = option.replaceAll("data-","");
      getColumns($(".selectMultipleFormTable").eq(index).val());

    }

 columnForTables = []
 function populateMultiselectColumn() {
      var thiss = $(this)
      var selectedTables = JSON.stringify([$(this).val()]);
      // var selectedTab = $(this).val();
      // var change = $('#selectFormTable').val();
      // var dummy = []
      // dummy = [...dummy, ...tableNamesChild];
      // if (change == selectedTab) {
      // $('#selectFormTable').empty();
      //     for(j in dummy) {
      //       if (selectedTab == dummy[j]) {
      //         dummy.splice(j,1);
      //       }
      //     }
      //   for (i in dummy ) {
      //     $('#selectFormTable').append(`<option value="${dummy[i]}">${dummy[i]}</option>`);
      //   }
      // }

      $.ajax({
        url: `/users/${urlPath}/processGraphModule/`,

        data: {
          'operation': 'formTableMiltipleFieldsUnique',
          'tablesForm': selectedTables,
        },
        type: "POST",
        dataType: "json",
        success: function (data) {
          $('.selectTableColumns').empty()
          $('.selectTableColumns').append(
            `<option value="" selected disabled>Select column</option>`
          )
          for (j in data.finalFieldList) {
            $('.selectTableColumns').append(
              `<option value="${data.finalFieldList[j]['fieldName']}">${data.finalFieldList[j]['fieldVerbose']}</option>`
            )

          }
          // $('#periodSelection').empty();
          // $('#ComparableNumList').empty();
          // $('#selectedComparableNumList').empty();

        },
        error: function () {
          Swal.fire({icon: 'error',text: 'Error! Please try again.'});
        }
      })

    $.ajax({
        url: `/users/${urlPath}/processGraphModule/`,
        data: {
          'operation': 'formTableMiltipleFields',
          'tablesForm': selectedTables,
        },
        type: "POST",
        dataType: "json",
        success: function (data) {
          $('.additional').empty()
          for (j in data.finalFieldList) {

            $('.additional').append(
              `<option value="${data.finalFieldList[j]['fieldName']}">${data.finalFieldList[j]['fieldVerbose']}</option>`
            )
            columnForTables.push(data.finalFieldList[j]['fieldName'])
          }
          // $('#periodSelection').empty();

          // $('#ComparableNumList').empty();
          // $('#selectedComparableNumList').empty();
          $('.selectTableColumns').off('change').on('change',fillcolvalMul)

        },
        error: function () {
          Swal.fire({icon: 'error',text: 'Error! Please try again.'});
        }
    })
  }

  function fillcolvalMul () {
      parent = $(this).parent()
      $(this).select2({dropdownParent:parent})
      let master_table = $(this).parent().parent().parent().find('.selectMultipleFormTable').val()
      let col = $(this).val()
      let ind = $(this).parent().parent().parent().parent().index()
      let reload_data = $(this).attr("data-data");
      if(reload_data == undefined){
        reload_data = JSON.stringify('[]')
      }
      $(this).removeAttr("data-data");
      if(master_table && col && col != "" && master_table != ""){
        $.ajax({
            url: `/users/${urlPath}/processGraphModule/`,
            data: {
              'operation': 'formTableUniqueValues',
              'master_table': master_table,
              'col': col,
              "ind": ind,
              "reload_data":reload_data,
            },
            type: "POST",
            dataType: "json",
            success: function (data) {
              indx = parseInt(data.ind)
              $('.def_values_opt').empty()
              for (j in data.finalFieldList) {
                $('.def_values_opt').append(
                  `<option value="${data.finalFieldList[j]}">${data.finalFieldList[j]}</option>`
                )
              }

              r_data = data.reload_data
              if(r_data.length > 0){
                $('.def_values_opt').val(r_data).trigger("change")
              }
        },
        error: function () {
          Swal.fire({icon: 'error',text: 'Error! Please try again.'});
        }
      })

  }
}

 </script>
 <script>

      var selectedCol = ""
      var mod_name = ""
      var idenFlag = ""
      var tb_index = -1
      var att_index
      var edit_col_list = []
      var d_element_id = (Math.floor(Math.random() * (9999999999999 - 1000000000000 + 1)) + 1000000000000).toString()
      $('.t_table').append(`<input type="text" name="searchTable" class="m_table" id="searchTable_${d_element_id}" placeholder="Search for table" />`)

      var element_table = document.getElementsByClassName("m_table");
      element_table[0].addEventListener('keyup', (e)=>{
          const searchString = e.target.value;

          filteredTables = [];
          EBtables.map(item=>{
              if(item.toLowerCase().includes(searchString.toLowerCase())){
                  filteredTables.push(item)
              }
          })
          displayTables(filteredTables);

      })


      $(document).on("change", ".coption", function(){

        if($(this).val()=='1') {
              $(this).parent().parent().children().last().find('.equationBuilder').css('display','inline')
              $(this).parent().parent().children().last().find('.equationBuilder').find("#EBDisplayButtonID").off('click').on('click', function(){
                selectedCol = $(this).parent().parent().parent().find('td').eq(0).find('span').text()
                tb_index = $(this).parent().parent().parent().index()
                mod_name = $('#tname').val()+selectedCol
                idenFlag = 'defn'

                if(tb_index == 0){
                  Swal.fire({icon: 'warning',text: 'Computation logic cannot be configured in the ID element.'});
                  $(this).parent().parent().parent().find('td').find('.computedoption').val('2')
                  $(this).parent().css('display','none')
                }else if(tb_index == 1){
                  Swal.fire({icon: 'warning',text: 'Computation logic cannot be configured in the first field.'});
                  $(this).parent().parent().parent().find('td').find('.computedoption').val('2')
                  $(this).parent().css('display','none')
                }else{

                  $("#EBDisplayModel").modal('show');
                }
            });
          }else{
            $(this).parent().parent().children().last().find('.equationBuilder').css('display','none')

          }

      });

    $("#save_workflow_equ").click(function(){

        a = $('.ebFunctions').find('div').find('a')
            configDict = []
            func_name = ""
            curr = ""
            next = ""
            cc = ""
            bb =""
            i_list = []
            let url_string = window.location.pathname
            let f_occ = url_string.indexOf('/', url_string.indexOf('/') + 1)
            let s_occ = url_string.indexOf('/', url_string.indexOf('/') + f_occ +1)
            let t_occ = url_string.indexOf('/', url_string.indexOf('/') + s_occ +1)
            let app_code2 = url_string.substring(f_occ+1,s_occ)
            let current_dev_mode2 = url_string.substring(s_occ+1,t_occ)
            let modes = ["Build","Edit"]
            let url = ""
            if(current_dev_mode2 != "Build" && current_dev_mode2 != "Edit"){
              current_dev_mode2 = "User"
            }
            for(let i=0;i<a.length;i++){

                try{
                    b=$('.ebDataElementsDiv').eq(i).find('.ColumnItem')
                    b[0].getAttribute('data-element_id')
                    cc=$('.ebFunctions').find('div').find('a').eq(i).attr('data-element_id')

                    try{
                        n=$('.ebFunctions').find('div').find('a').eq(i+1).attr('data-element_id')
                        n.length
                        next = [n]
                    }
                    catch(err){
                        next="#"
                    }

                    func_name = $('.ebFunctions').find('div').find('h2').eq(i).text()

                    var tables_list = new Set();
                    for(let i=0;i<b.length;i++){
                        tables_list.add(b[i].getAttribute('data-element_id'))
                    }
                    final_list = Array.from(tables_list);
                    i_list = final_list.slice()

                    if((func_name=='Left Join' || func_name=='Right Join' || func_name=='Inner Join' || func_name=='Outer Join') && final_list.length==1){
                        bb=$('.ebFunctions').find('div').find('a').eq(i-1).attr('data-element_id')
                        final_list.push(bb)
                    }

                    b = final_list
                    curr=cc

                }
                catch(err){

                    b=$('.ebFunctions').find('div').find('a').eq(i-1).attr('data-element_id')
                    curr=$('.ebFunctions').find('div').find('a').eq(i).attr('data-element_id')
                    func_name = $('.ebFunctions').find('div').find('h2').eq(i).text()

                    try{
                        n=$('.ebFunctions').find('div').find('a').eq(i+1).attr('data-element_id')
                        n.length
                        next = [n]
                        final_list = b
                        b=[b]
                    }
                    catch(err){
                        next="#"
                        b=[b]
                    }
                }


                if (func_name == 'Column sum' || func_name == 'Row sum' || func_name == 'Cell sum' ||
                    func_name == 'Column subtraction' || func_name == 'Row subtraction' || func_name == 'Cell subtraction' ||
                    func_name == 'Column multiplication' || func_name == 'Row multiplication' || func_name == 'Cell multiplication' ||
                    func_name == 'Column division' || func_name == 'Row division' || func_name == 'Cell division'
                    ){
                                func_name = 'Basic Operations'
                            }else if (func_name == 'Round'){
                                func_name = 'Rounding Operations'
                            }else if (func_name == 'Square root'){
                                func_name = 'Power and Root Functions'
                            }else if (func_name == 'Log'){
                                func_name = 'Log and Exponential Functions'
                            }else if(func_name == 'Rename and Drop'){
                                func_name = 'Rename Column'
                            }else if(func_name == 'Add Time Periods'){
                                func_name = 'Add Time Periods'
                            }else{
                                func_name = 'Data Transformation'
                            }



                if(i==0){
                    for(let j=0;j<final_list.length;j++){

                            c={
                                    "element_id":final_list[j],
                                    "text":"Import Data",
                                    "parent":"#",
                                    "child":[
                                            cc
                                    ]
                            }

                            configDict.push(c)
                    }

                    if(i == a.length-1){
                        c={
                            "element_id":cc,
                            "text":func_name,
                            "parent":final_list,
                            "child":"#"
                        }
                        if ($("#exportEqData").attr('data-element_id')) {
                            c["child"] = [$("#exportEqData").attr('data-element_id')];
                          }
                        configDict.push(c)
                    }else{
                            c={
                                "element_id":cc,
                                "text":func_name,
                                "parent":final_list,
                                "child":next
                            }

                            configDict.push(c)
                    }
                }
                else{

                    if(i_list.length==1 && func_name=='Data Transformation'){

                    c={
                    "element_id":i_list[0],
                    "text":"Import Data",
                    "parent":"#",
                    "child":[curr]
                    }

                            configDict.push(c)

                }

                if(i == a.length-1){
                    if( ($("#exportEqData").attr('data-element_id') == '') || (typeof($("#exportEqData").attr('data-element_id')) == 'undefined')){
                        c_child = '#'
                    }else{
                        c_child = [$("#exportEqData").attr('data-element_id')]
                    }

                    c={
                        "element_id":curr,
                        "text":func_name,
                        "parent":b,
                        "child":c_child
                    }

                    configDict.push(c)
                }else{
                        c={
                            "element_id":curr,
                            "text":func_name,
                            "parent":b,
                            "child":next
                        }

                        configDict.push(c)
                }

                }


            }

            if((typeof($("#exportEqData").attr('data-element_id')) != 'undefined')){
                c={
                        "element_id":$("#exportEqData").attr('data-element_id'),
                        "text":'Export Data',
                        "parent":[$('.ebFunctions .function').last().find('a').attr('data-element_id')],
                        "child":'#'
                    }

                configDict.push(c)
            }

            fav = $('#favouriteList').find('h2')
            fav_list = []
            for(let i=0;i<fav.length;i++){
              fav_list.push(fav[i].innerText)
            }

            configDict1 = {
                'function':'Save Favourites',
                'inputs':{
                    'data': fav_list,
                },
            }

            if($('#favouriteList').attr('data-element_id') != undefined){

              c={
                        "element_id":$('#favouriteList').attr('data-element_id'),
                        "text":'Favourites',
                        "parent": '#',
                        "child":'#'
                    }

              configDict.push(c)


              $.ajax({
                  url: `/users/${app_code2}/${current_dev_mode2}/computationModule/`,
                  data: {
                      'model_name':mod_name,
                      'element_id': $('#favouriteList').attr('data-element_id'),
                      'operation': 'save_fav_list',
                      'configList': JSON.stringify(configDict1),
                      'data_id':'datamgm'
                  },
                  type: "POST",
                  dataType: "json",
                  success: function (data1) {

                  },
                  error: function () {
                    Swal.fire({icon: 'error',text: 'Error in saving the favourites list. Please try again.'});
                  }
              });
          }

            $.ajax({
                url: `/users/${app_code2}/${current_dev_mode2}/computationModule/`,
                data: {
                    'xml': "innn",
                    'model_name':mod_name,
                    'operation': 'save_flowchart',
                    'configList': JSON.stringify({ data3:configDict}),
                    'data_id':'datamgm'
                },
                type: "POST",
                dataType: "json",
                success: function (data) {
                  Swal.fire({icon: 'success',text: 'Model saved successfully!'});
                },
                error: function () {
                    Swal.fire({icon: 'error',text: 'Error! Failure in saving Model. Please try again.'});
                }
            })

    })

      $('#EBDisplayModel').on('hidden.bs.modal', function() {

          const index = EBtables.indexOf($('#tname').val());
          if (index > -1) {
            EBtables.splice(index, 1);
          }

          tb_index = -1

      })

      $('#EBDisplayModel').on('shown.bs.modal', function() {

        var table_name = $('#tname').val()
        EBtables.push(table_name)
        if(($('#tableList').children().last().find('p').text() != table_name) && (table_name != "")){
        $('#tableList').append(`
        <div onClick='selectTable("${table_name}")' class="tableItem btn-xs btn">
          <p class="tableItemP"
              onClick='selectTable(e.target.value);changeTableandColumns(e.target.value)'
              value="${table_name}">${table_name}</p>
        </div>
        `)
      }

        if(idenFlag == 'attr'){
          $('#save_workflow_equ').css("display","none")
        }else{
          $('#save_workflow_equ').css("display","block")
        }

        $('.ebDataElementsDiv').remove();
        $('.ebFunctions').find('.function').remove();
        $('.ebSteps').find('#stepNumsEb').empty();
        $('#functionPreviews').empty();
        $('#selectedTablesDiv').empty()
        $('#table-columns').empty()
        $('#functionsList').empty()
        $('#favouriteList').empty()
        selectedTables = {}
        index_count = 0
        counter = 0
        favFunctionList = []
        let url_string = window.location.pathname
        let f_occ = url_string.indexOf('/', url_string.indexOf('/') + 1)
        let s_occ = url_string.indexOf('/', url_string.indexOf('/') + f_occ +1)
        let t_occ = url_string.indexOf('/', url_string.indexOf('/') + s_occ +1)
        let app_code2 = url_string.substring(f_occ+1,s_occ)
        let current_dev_mode2 = url_string.substring(s_occ+1,t_occ)
        let modes = ["Build","Edit"]
        if(current_dev_mode2 != "Build" && current_dev_mode2 != "Edit"){
          current_dev_mode2 = "User"
        }

        if($('#favouriteList').attr('data-element_id') != undefined){
            $('#favouriteList').removeAttr('data-element_id')
        }


        var minm = 1000000000000;
        var maxm = 9999999999999;
        var icon = "";
        uniqueid_maths = "applyMathOps"+(Math.floor(Math.random() * (maxm - minm + 1)) + minm).toString()
        uniqueid_join = "mergeAndJoin"+(Math.floor(Math.random() * (maxm - minm + 1)) + minm).toString()
        uniqueid_rename = "renameColumn"+(Math.floor(Math.random() * (maxm - minm + 1)) + minm).toString()

        const htmlString = funcDic
            .map((character) => {


              if(character.name == 'Column division' || character.name == 'Row division'){
                  icon = "fas fa-divide"
              }else if(character.name == 'Column multiplication' || character.name == 'Row multiplication'){
                  icon = "fas fa-times"
              }else if(character.name == 'Column subtraction' || character.name == 'Row subtraction'){
                  icon = "fas fa-minus"
              }else if(character.name == 'Column sum' || character.name == 'Row sum'){
                  icon = "fas fa-plus"
              }else if(character.name == 'Square root'){
                  icon = "fas fa-square-root-alt"
              }else if((character.name == 'Inner Join' || character.name == 'Left Join' || character.name == 'Right Join' || character.name == 'Outer Join')){
                  icon = "fas fa-coins"
              }else if(character.name == 'Round'){
                  icon = "far fa-circle"
              }else{
                  icon = "fas fa-thumbs-up"
              }

                if(character.name=='Left Join' || character.name=='Right Join' || character.name=='Inner Join' || character.name=='Outer Join'){
                    return `
                <div class="function draggable" draggable="true">
                    <h2>${character.name}</h2>
                    <h3 class="heartIcon" onClick="addToFav('${character.name}' )" value=${character.name}><i class="${icon}"></i></h3>
                    <a title="configure" href="#"  name="Open" class="EBhide EbOverlay" id="open-overlay" data-element_id="${uniqueid_join}" data-element_comp="datamgm" onClick="popupOpen();takeFuncInput('${character.name}','${uniqueid_join}','${counter}',this)">&#11167;</a>
                    <span title="delete" style="display:none;" class="deleteitem" data-element_id="${uniqueid_join}"   onClick="deleteElement(this)">&#10006;</span>
                </div>
            `;
                }else if(character.name=='Round'){
                return `
                <div class="function draggable" draggable="true">
                    <h2>${character.name}</h2>
                    <h3 class="heartIcon" onClick="addToFav('${character.name}' )" value=${character.name}>oO</h3>
                    <a title="configure" href="#"  name="Open" class="EBhide EbOverlay" id="open-overlay" data-element_id="${uniqueid_maths}" data-element_comp="datamgm" onClick="popupOpen();takeFuncInput('${character.name}','${uniqueid_maths}','${counter}',this)">&#11167;</a>
                    <span title="delete" style="display:none;" class="deleteitem" data-element_id="${uniqueid_maths}"   onClick="deleteElement(this)">&#10006;</span>
                </div>
            `;
                }else if(character.name=='Log'){
                return `
                <div class="function draggable" draggable="true">
                    <h2>${character.name}</h2>
                    <h3 class="heartIcon" onClick="addToFav('${character.name}' )" value=${character.name}>&#13266;</h3>
                    <a title="configure" href="#"  name="Open" class="EBhide EbOverlay" id="open-overlay" data-element_id="${uniqueid_maths}" data-element_comp="datamgm" onClick="popupOpen();takeFuncInput('${character.name}','${uniqueid_maths}','${counter}',this)">&#11167;</a>
                    <span title="delete" style="display:none;" class="deleteitem" data-element_id="${uniqueid_maths}"   onClick="deleteElement(this)">&#10006;</span>
                </div>
            `;
                }else if(character.name=='Rename and Drop'){
                return `
                <div class="function draggable" draggable="true">
                    <h2>${character.name}</h2>
                    <h3 class="heartIcon" onClick="addToFav('${character.name}' )" value=${character.name}>&#13266;</h3>
                    <a title="configure" href="#"  name="Open" class="EBhide EbOverlay" id="open-overlay" data-element_id="${uniqueid_rename}" data-element_comp="datamgm" onClick="popupOpen();takeFuncInput('${character.name}','${uniqueid_rename}','${counter}',this)">&#11167;</a>
                    <span title="delete" style="display:none;" class="deleteitem" data-element_id="${uniqueid_rename}"   onClick="deleteElement(this)">&#10006;</span>
                </div>
            `;
                }else{
                return `
                <div class="function draggable" draggable="true">
                    <h2>${character.name}</h2>
                    <h3 class="heartIcon" onClick="addToFav('${character.name}' )" value=${character.name}><i class="${icon}"></i></h3>
                    <a title="configure" href="#"  name="Open" class="EBhide EbOverlay" id="open-overlay" data-element_id="${uniqueid_maths}" data-element_comp="datamgm" onClick="popupOpen();takeFuncInput('${character.name}','${uniqueid_maths}','${counter}',this)">&#11167;</a>
                    <span title="delete" style="display:none;" class="deleteitem" data-element_id="${uniqueid_maths}"   onClick="deleteElement(this)">&#10006;</span>
                </div>
            `;
                }
            })
            .join('');
        functionsList.innerHTML = htmlString;

        draggables = document.querySelectorAll('.draggable')
            draggables.forEach(draggable => {
                draggable.addEventListener('dragstart', (e) => {
                draggable.classList.add('dragging')

                })

                draggable.addEventListener('dragend', (e) => {
                draggable.classList.remove('dragging')
                displayPreviews()
                displayCharacters(funcDic)

                })
            });

        $.ajax({
                url: `/users/${app_code2}/${current_dev_mode2}/computationModule/`,
                data: {
                    'model_name': mod_name,
                    'operation': 'eq_reload_config',
                    'data_id':'datamgm',
                },
                type: "POST",
                dataType: "json",
                success: function (data) {
                    counter = Object.keys(data.func_data).length
                    index_count = counter
                    func_list = []
                    var export_elem_id = ""

                    for(let [key,value] of Object.entries(data.func_data) ){
                        if(value.text != 'Export data'){
                            if(value.text == 'Ceiling' || value.text == 'Floor' || value.text == 'Floor'
                            || value.text == 'Odd' || value.text == 'Even' || value.text == 'Round'
                            || value.text == 'Round_Up' || value.text == 'Round_Down' || value.text == 'Truncate'
                            ){
                                value.text = 'Round'
                                func_list.push(value.text)
                            }else if(value.text == 'Log_base' || value.text == 'Exponential' || value.text == 'Natural_Log'){
                                value.text = 'Log'
                                func_list.push(value.text)
                            }else if(value.text == 'Power' ){
                                value.text = 'Square root'
                                func_list.push(value.text)
                            }else if(value.text == 'left' ){
                                value.text = 'Left Join'
                                func_list.push(value.text)
                            }else if(value.text == 'right' ){
                                value.text = 'Right Join'
                                func_list.push(value.text)
                            }else if(value.text == 'inner' ){
                                value.text = 'Inner Join'
                                func_list.push(value.text)
                            }else if(value.text == 'outer' ){
                                value.text = 'Outer Join'
                                func_list.push(value.text)
                            }else {
                                func_list.push(value.text)
                            }

                            $('.ebFunctions').append(`
                                    <div class="function draggable" draggable="true">
                                    <h2>${value.text}</h2>
                                    <h3 class="EBhide" onclick="addToFav('${value.text}')" value="${value.text}"><i class="fas fa-thumbs-up"></i></h3>
                                    <a title="configure" href="#" name="Open" class="EBshow" id="open-overlay" data-element_id="${value.ele_id}" data-element_comp="datamgm" onclick="popupOpen();takeFuncInput('${value.text}','${value.ele_id}','${value.order}')">⮟</a>
                                    <span title="delete" style="display:none;" class="deleteitem" data-element_id="${value.ele_id}" data-element_comp="datamgm"  onClick="deleteElement(this)">&#10006;</span>
                                    </div>
                                    `)

                            $('#stepNumsEb').append(`
                            <h2 class="stepNumberEB">${value.order+1}</h2>
                            `)

                            var minm = 1000000000000;
                            var maxm = 9999999999999;
                            uniqueid_maths = "applyMathOps"+(Math.floor(Math.random() * (maxm - minm + 1)) + minm).toString()
                            uniqueid_join = "mergeAndJoin"+(Math.floor(Math.random() * (maxm - minm + 1)) + minm).toString()
                            uniqueid_rename = "renameColumn"+(Math.floor(Math.random() * (maxm - minm + 1)) + minm).toString()

                            const htmlString = funcDic
                                .map((character) => {

                                  if(character.name == 'Column division' || character.name == 'Row division'){
                                      icon = "fas fa-divide"
                                  }else if(character.name == 'Column multiplication' || character.name == 'Row multiplication'){
                                      icon = "fas fa-times"
                                  }else if(character.name == 'Column subtraction' || character.name == 'Row subtraction'){
                                      icon = "fas fa-minus"
                                  }else if(character.name == 'Column sum' || character.name == 'Row sum'){
                                      icon = "fas fa-plus"
                                  }else if(character.name == 'Square root'){
                                      icon = "fas fa-square-root-alt"
                                  }else if((character.name == 'Inner Join' || character.name == 'Left Join' || character.name == 'Right Join' || character.name == 'Outer Join')){
                                      icon = "fas fa-coins"
                                  }else if(character.name == 'Round'){
                                      icon = "far fa-circle"
                                  }else{
                                      icon = "fas fa-thumbs-up"
                                  }

                                    if(character.name=='Left Join' || character.name=='Right Join' || character.name=='Inner Join' || character.name=='Outer Join'){
                                        return `
                                    <div class="function draggable" draggable="true">
                                        <h2>${character.name}</h2>
                                        <h3 class="heartIcon" onClick="addToFav('${character.name}' )" value=${character.name}><i class="${icon}"></i></h3>
                                        <a title="configure" href="#"  name="Open" class="EBhide EbOverlay" id="open-overlay" data-element_id="${uniqueid_join}" data-element_comp="datamgm" onClick="popupOpen();takeFuncInput('${character.name}','${uniqueid_join}','${counter}',this)">&#11167;</a>
                                        <span title="delete" style="display:none;" class="deleteitem" data-element_id="${uniqueid_join}"   onClick="deleteElement(this)">&#10006;</span>
                                    </div>
                                `;
                                    }else if(character.name == 'Round'){
                                    return `
                                    <div class="function draggable" draggable="true">
                                        <h2>${character.name}</h2>
                                        <h3 class="heartIcon" onClick="addToFav('${character.name}' )" value=${character.name}>oO</h3>
                                        <a title="configure" href="#"  name="Open" class="EBhide EbOverlay" id="open-overlay" data-element_id="${uniqueid_maths}" data-element_comp="datamgm" onClick="popupOpen();takeFuncInput('${character.name}','${uniqueid_maths}','${counter}',this)">&#11167;</a>
                                        <span title="delete" style="display:none;" class="deleteitem" data-element_id="${uniqueid_maths}"   onClick="deleteElement(this)">&#10006;</span>
                                    </div>
                                `;
                                    }else if(character.name == 'Log'){
                                    return `
                                    <div class="function draggable" draggable="true">
                                        <h2>${character.name}</h2>
                                        <h3 class="heartIcon" onClick="addToFav('${character.name}' )" value=${character.name}>&#13266;</h3>
                                        <a title="configure" href="#"  name="Open" class="EBhide EbOverlay" id="open-overlay" data-element_id="${uniqueid_maths}" data-element_comp="datamgm" onClick="popupOpen();takeFuncInput('${character.name}','${uniqueid_maths}','${counter}',this)">&#11167;</a>
                                        <span title="delete" style="display:none;" class="deleteitem" data-element_id="${uniqueid_maths}"   onClick="deleteElement(this)">&#10006;</span>
                                    </div>
                                `;
                                    }else if(character.name == 'Rename and Drop'){
                                    return `
                                    <div class="function draggable" draggable="true">
                                        <h2>${character.name}</h2>
                                        <h3 class="heartIcon" onClick="addToFav('${character.name}' )" value=${character.name}>&#13266;</h3>
                                        <a title="configure" href="#"  name="Open" class="EBhide EbOverlay" id="open-overlay" data-element_id="${uniqueid_rename}" data-element_comp="datamgm" onClick="popupOpen();takeFuncInput('${character.name}','${uniqueid_rename}','${counter}',this)">&#11167;</a>
                                        <span title="delete" style="display:none;" class="deleteitem" data-element_id="${uniqueid_maths}"   onClick="deleteElement(this)">&#10006;</span>
                                    </div>
                                `;
                                    }else{
                                    return `
                                    <div class="function draggable" draggable="true">
                                        <h2>${character.name}</h2>
                                        <h3 class="heartIcon" onClick="addToFav('${character.name}' )" value=${character.name}><i class="${icon}"></i></h3>
                                        <a title="configure" href="#"  name="Open" class="EBhide EbOverlay" id="open-overlay" data-element_id="${uniqueid_maths}" data-element_comp="datamgm" onClick="popupOpen();takeFuncInput('${character.name}','${uniqueid_maths}','${counter}',this)">&#11167;</a>
                                        <span title="delete" style="display:none;" class="deleteitem" data-element_id="${uniqueid_maths}"   onClick="deleteElement(this)">&#10006;</span>
                                    </div>
                                `;
                                    }
                                })
                                .join('');
                            functionsList.innerHTML = htmlString;

                            draggables = document.querySelectorAll('.draggable')
                                draggables.forEach(draggable => {
                                    draggable.addEventListener('dragstart', (e) => {
                                    draggable.classList.add('dragging')

                                    })

                                    draggable.addEventListener('dragend', (e) => {
                                    draggable.classList.remove('dragging')
                                    displayPreviews()
                                    displayCharacters(funcDic)

                                    })
                                });
                        }else if (value.text == 'Export data'){
                            export_elem_id = value.ele_id
                            if(export_elem_id){
                                $('#exportEqData').attr('data-element_id',export_elem_id)
                            }

                        }

                    }

                    if(idenFlag != 'attr'){

                      if(counter == 1){
                              $('.ebFunctions').find('div').eq(counter-1).find('span').css('display','block')
                      }else{
                              $('.ebFunctions').find('div').eq(counter-1).find('span').css('display','block')
                              $('.ebFunctions').find('div').eq(counter-2).find('span').css('display','none')
                      }
                    }

                    for(let [key,value] of Object.entries(data.fav_data) ){

                      favFunctionList = data.fav_data[0].text.slice()
                      $('#favouriteList').attr('data-element_id',data.fav_data[0].ele_id)
                      displayFav(data.fav_data[0].text)

                    }


                        for(let i=0;i<func_list.length;i++){

                            let div1 = document.createElement("div")
                            let btn = document.createElement("button");
                            div1.className="ebDataElementsDiv dragAreaPossible"
                            btn.className="btn btn-primary btn-xs mx-2 rounded px-2"
                            btn.innerHTML = "Data";
                            var restrict_flag = 0
                            btn.addEventListener("click", function () {

                                            columnss_list = []
                                            columns_list = []
                                            s_table_name = []
                                            t_ele_id = []
                                            table1=[]
                                            table2=[]

                                            var table_name = new Set();
                                            var ele_id = new Set();

                                            b=$(this).parent('.ebDataElementsDiv').find('.ColumnItem')
                                            for(let i=0;i<b.length;i++){
                                                table_name.add(b[i].getAttribute('data-table'))
                                                ele_id.add(b[i].getAttribute('data-element_id'))
                                            }

                                            s_table_name = Array.from(table_name);
                                            t_ele_id = Array.from(ele_id);

                                            if (idenFlag != "add" && idenFlag != "edit"){
                                              curr_table1 = $('#tname').val()
                                              tt_name = $('#tname').val()
                                            }else if(idenFlag == "add" || idenFlag == "edit") {
                                              curr_table1 = $(".dataElements").find("p").text()
                                              tt_name = $(".dataElements").find("p").text()
                                            }



                                            bb=$(this).parent('.ebDataElementsDiv').find('.ColumnItem')

                                            if(s_table_name.length >1){

                                                for(let i=0;i<s_table_name.length-1;i++){

                                                    curr_table = s_table_name[i]

                                                    for(let j=0;j<bb.length;j++){
                                                        if(bb[j].getAttribute('data-table') == curr_table){
                                                            table1.push(bb[j].querySelector('p').innerText)
                                                        }else{
                                                            table2.push(bb[j].querySelector('p').innerText)
                                                        }

                                                    }

                                                    columnss_list.push(table1)
                                                    columnss_list.push(table2)

                                                }

                                            }else{

                                                a = $(this).parent('.ebDataElementsDiv').find('.ColumnItem').find('p')
                                                for(let i=0;i<a.length;i++){
                                                    columns_list.push(a[i].innerText)
                                                }
                                                columnss_list.push(columns_list)
                                            }

                                            for(let j=0;j<s_table_name.length;j++){

                                              if(s_table_name[j] == curr_table1){
                                                  current_table = "Yes"
                                              }else{
                                                  current_table = "No"
                                              }


                                                var configDict_t={
                                                    'function':'Import Data',
                                                    'data_mapper': {'current_element_name':s_table_name[j]},
                                                    'inputs':{'Data_source': "Database",
                                                            'Table': s_table_name[j],
                                                            'Columns': columnss_list[j],
                                                            'global_var': "",
                                                            "parent_table_column": "",
                                                            "current_table_column": "",
                                                            'show_foreignKey_value':false,
                                                            "current_table":current_table,
                                                            },
                                                            'condition':{},
                                                            }
                                                    configDict_t['outputs'] = {
                                                                                    'name': "",
                                                                                    'save': "",
                                                                                };

                                                $.ajax({
                                                    url: `/users/${app_code2}/${current_dev_mode2}/computationModule/`,
                                                    data: {
                                                        'configList': JSON.stringify({data1:tt_name,
                                                                                    data2:t_ele_id[j],
                                                                                    data3:configDict_t,
                                                                                    elementName:tt_name + selectedCol + Math.floor((Math.random() * 10000000000) + 1),
                                                                                    data_id:'datamgm',
                                                                                    }),
                                                        'operation': 'save_import_data',
                                                        'data_source': "Database"
                                                    },
                                                    type: "POST",
                                                    dataType: "json",
                                                    success: function (context) {
                                                      Swal.fire({icon: 'success',text: 'Data import configuration saved successfully!'});

                                                    },
                                                    error: function () {
                                                      Swal.fire({icon: 'error',text: 'Error! Failure in saving data import configuration. Please try again.'});
                                                    }
                                                    });


                                            }


                                            });
                            div1.append(btn)
                            dataElementParent.append(div1)

                            const dragAreas = document.querySelectorAll('.dragAreaPossible')

                            dragAreas.forEach(dragArea => {
                                dragArea.addEventListener('dragover', e => {

                                    e.preventDefault()
                                    const afterElement = getDragAfterElement1(dragArea, e.clientY)
                                    const draggable = document.querySelector('.dragging')

                                    if (afterElement == null) {
                                        dragArea.appendChild(draggable)

                                        if(dragArea.querySelector('.EbOverlay')){
                                            dragArea.querySelector('.EbOverlay').className="EBshow"
                                        }

                                        if(dragArea.querySelector('.heartIcon')){
                                            dragArea.querySelector('.heartIcon').className="EBhide"
                                        }



                                    } else {
                                        dragArea.insertBefore(draggable, afterElement)

                                        if(dragArea.querySelector('.EbOverlay')){
                                            dragArea.querySelector('.EbOverlay').className="EBshow"
                                        }

                                        if(dragArea.querySelector('.heartIcon')){
                                            dragArea.querySelector('.heartIcon').className="EBhide"
                                        }

                                    }

                                })
                            })


                            function getDragAfterElement1(container, y) {
                                const draggableElements = [...container.querySelectorAll('.draggable:not(.dragging)')]

                                return draggableElements.reduce((closest, child) => {
                                const box = child.getBoundingClientRect()
                                const offset = y - box.top - box.height / 2
                                if (offset < 0 && offset > closest.offset) {
                                    return { offset: offset, element: child }
                                } else {
                                    return closest
                                }
                                }, { offset: Number.POSITIVE_INFINITY }).element
                            }

                            var join_first_count = 0
                            var joint_count = 0
                            if(i==0){
                                if(func_list[i]=='Left Join' || func_list[i]=='Right Join' || func_list[i]=='Inner Join' || func_list[i]=='Outer Join'){

                                    for(let [key,value] of Object.entries(data.import_data) ){

                                        if(join_first_count == 2) break;

                                        for(let [k,v] of Object.entries(value.columns) ){

                                            $('.ebDataElementsDiv').eq(i).append(`
                                            <div class="ColumnItem draggable" draggable="true" data-table="${value.table_name}" data-element_id="${value.ele_id}" data-element_comp="datamgm">
                                                            <p>${v}</p>
                                                        </div>
                                            `)

                                            draggables = document.querySelectorAll('.draggable')
                                            draggables.forEach(draggable => {
                                                draggable.addEventListener('dragstart', (e) => {
                                                draggable.classList.add('dragging')

                                                })

                                                draggable.addEventListener('dragend', (e) => {
                                                draggable.classList.remove('dragging')
                                                displayPreviews()
                                                displayCharacters(funcDic)

                                                })
                                            });

                                        }
                                        delete data.import_data[join_first_count]
                                        join_first_count = join_first_count +1
                                    }
                                }else{

                                    for(let [key,value] of Object.entries(data.import_data) ){

                                        if(joint_count == 1) break;

                                        for(let [k,v] of Object.entries(value.columns) ){

                                            $('.ebDataElementsDiv').eq(i).append(`
                                            <div class="ColumnItem draggable" draggable="true" data-table="${value.table_name}" data-element_id="${value.ele_id}" data-element_comp="datamgm">
                                                            <p>${v}</p>
                                                        </div>
                                            `)



                                            draggables = document.querySelectorAll('.draggable')
                                            draggables.forEach(draggable => {
                                                draggable.addEventListener('dragstart', (e) => {
                                                draggable.classList.add('dragging')

                                                })

                                                draggable.addEventListener('dragend', (e) => {
                                                draggable.classList.remove('dragging')
                                                displayPreviews()
                                                displayCharacters(funcDic)

                                                })
                                            });

                                        }
                                            delete data.import_data[joint_count]
                                            joint_count = joint_count +1
                                        }
                                }
                            }else{

                                if(func_list[i]=='Left Join' || func_list[i]=='Right Join' || func_list[i]=='Inner Join' || func_list[i]=='Outer Join'){
                                        for(let [key,value] of Object.entries(data.import_data) ){
                                            if(joint_count == 1) break;

                                            for(let [k,v] of Object.entries(value.columns) ){

                                                $('.ebDataElementsDiv').eq(i).append(`
                                                <div class="ColumnItem draggable" draggable="true" data-table="${value.table_name}" data-element_id="${value.ele_id}" data-element_comp="datamgm">
                                                                <p>${v}</p>
                                                            </div>
                                                `)

                                                draggables = document.querySelectorAll('.draggable')
                                                draggables.forEach(draggable => {
                                                    draggable.addEventListener('dragstart', (e) => {
                                                    draggable.classList.add('dragging')

                                                    })

                                                    draggable.addEventListener('dragend', (e) => {
                                                    draggable.classList.remove('dragging')
                                                    displayPreviews()
                                                    displayCharacters(funcDic)

                                                    })
                                                });

                                            }
                                            delete data.import_data[joint_count]
                                            joint_count = joint_count +1
                                        }
                                }


                            }

                        }


                        var functionDiv = document.querySelector(".ebFunctions");
                        var functions = functionDiv.querySelectorAll(".function")
                        var listOfFunctions = [];
                        functions.forEach(item=>{
                            listOfFunctions.push(item.querySelector('h2').innerText)
                        })

                        for(let [key,value] of Object.entries(data.func_data) ){
                            if(value.text != 'Export data'){
                                var myString = ""
                                $('#functionPreviews').append(
                                        `
                                        <div class="function" onclick="">

                                            <h2></h2>
                                            <p style="display:none;"></p>

                                        </div>
                                    `);

                                    if(value.prevString.length >30){
                                        myString  = value.prevString.substring(0,30)+'...'
                                        $('#functionPreviews').find('.function').eq(value.order).find('p').text(value.prevString)
                                        $('#functionPreviews').find('.function').eq(value.order).attr('onclick', `popupOpen();takeFuncInput('${value.text}','${value.ele_id}','${value.order}',this)`);
                                    }else{
                                        myString = value.prevString
                                        $('#functionPreviews').find('.function').eq(value.order).find('p').text(value.prevString)
                                        $('#functionPreviews').find('.function').eq(value.order).attr('onclick', "");

                                    }

                                    $('#functionPreviews').find('.function').eq(value.order).find('h2').text(myString)
                                }
                            }

                      if(idenFlag == 'attr'){
                        $("[draggable]").removeAttr('draggable')
                        $('.draggable').removeClass('draggable')
                        $('.dragAreaPossible').removeClass('dragAreaPossible')
                        $('.heartIcon').removeClass('heartIcon')
                      }

                      var table_name11 = new Set();
                      var ele_id11 = new Set();

                      bce12=$('#dataElementParent').find('.ebDataElementsDiv').eq(0).find('.ColumnItem')
                      for(let i=0;i<bce12.length;i++){
                          table_name11.add(bce12[i].getAttribute('data-table'))
                          ele_id11.add(bce12[i].getAttribute('data-element_id'))
                      }

                      s_table_name12 = Array.from(table_name11);
                      t_ele_id12 = Array.from(ele_id11);

                      let taew={}
                      for (let i=0;i<s_table_name12.length;i++){
                          taew[s_table_name12[i]] =  t_ele_id12[i]
                      }
                      tempdd = taew

                },
                error: function () {
                    Swal.fire({icon: 'error',text: 'Error! Please try again.'});
                }
            });


    });


    $(document).on("click", ".attr_equ_btn", function(){

      idenFlag = 'attr'
      mod_name = $(".dataElements").find("p").text() + $('#selectedElement').text()
      $("#EBDisplayModel").modal('show');

    });
 var uuid_obj;
 function edit_uuid_modal(obj) {
  //  $("#editattr_modal").modal('hide')
    uuid_obj = obj
 }
 function uuid_modal(obj) {
  $("#id_type").val("").change()
   $("#serial").val("").change()
   $("#id_length").val("")
   $("#id_text").val("")
   $("#position").val("").change()
   if(obj.getAttribute("name") != "") {
    let u = JSON.parse(obj.getAttribute("name"))
    $("#id_type").val(u["id_type"]).change()
   $("#serial").val(u["serial"]).change()
   $("#id_length").val(u["id_length"])
   $("#id_text").val(u["id_text"])
   $("#position").val(u["position"]).change()
  }
   uuid_obj = obj
  }

  function uuid_settings_save() {
    var modal_fields = $("#uuid_settings_modal")
    uuid_dict = {}
    modal_fields.find("select").each(function() {
      uuid_dict[$(this).attr("id")] = $(this).val()
    });
    uuid_dict["id_length"] = $("#id_length").val()
    if ($('option:selected', `#id_type`).val() == "Alphanumeric") {
      uuid_dict["id_text"] = $("#id_text").val()
    }
    else {
      delete uuid_dict["position"]
    }
    // $("#uuid_config").attr("name", JSON.stringify(uuid_dict))
    $(uuid_obj).attr("name", JSON.stringify(uuid_dict))
    modal_fields.modal('hide')
  }

  var file_obj;
 function file_modal(obj) {
   file_obj = obj
    if ($(file_obj).attr("name") != "") {
      $("#extension").val($(file_obj).attr("name")).change()
    }
    else {
      $("#extension").val("Any").change()
    }
 }
 function video_modal(obj){
  file_obj = obj
  if ($(file_obj).attr("name") != "") {
    $("#extension_video").val($(file_obj).attr("name")).change()
  }
  else {
    $("#extension_video").val("external_link").change()
  }
 }

 var card_obj;
 var create_access = false
 function card_modal(obj) {

  $("#cvv_field_create").prop('checked', false)
  $("#expiryDate_field_create").prop('checked', false)
  $("#cardtype_field_create").prop('checked', false)

  $("#cvv_field_create_fname").val("").change()
  $("#expiryDate_field_create_fname").val("").change()
  $("#cardtype_field_create_fname").val("").change()

  $("#cvv_field_create_vname").val("").change()
  $("#expiryDate_field_create_vname").val("").change()
  $("#cardtype_field_create_vname").val("").change()

  $("#cvv_field_create_null").val("").change()
  $("#expiryDate_field_create_null").val("").change()
  $("#cardtype_field_create_null").val("").change()

  $('.card_enclass').val('None').trigger('change')

   if(obj.getAttribute("name") != "") {
    let u = JSON.parse(obj.getAttribute("name"))

    $("#card_field_create_enclass").val(u["card_field_create_enclass"]).trigger("change")
    $("#card_field_create_kclass").val(u["card_field_create_kclass"]).trigger("change")

    if(u.hasOwnProperty("cvv_field_create")){
      if(u["cvv_field_create"]){
        $("#cvv_field_create").trigger('click')
        $("#cvv_field_create_fname").val(u["cvv_field_create_fname"]).trigger("change")
        $("#cvv_field_create_null").val(u["cvv_field_create_null"]).trigger("change")
        $("#cvv_field_create_vname").val(u["cvv_field_create_vname"]).trigger("change")
        $("#cvv_field_create_enclass").val(u["cvv_field_create_enclass"]).trigger("change")
        $("#cvv_field_create_kclass").val(u["cvv_field_create_kclass"]).trigger("change")
      }
    }

    if(u.hasOwnProperty("expiryDate_field_create")){
      if(u["expiryDate_field_create"]){
        $("#expiryDate_field_create").trigger('click')
        $("#expiryDate_field_create_fname").val(u["expiryDate_field_create_fname"]).trigger("change")
        $("#expiryDate_field_create_null").val(u["expiryDate_field_create_null"]).trigger("change")
        $("#expiryDate_field_create_vname").val(u["expiryDate_field_create_vname"]).trigger("change")
        $("#expiryDate_field_create_enclass").val(u["expiryDate_field_create_enclass"]).trigger("change")
        $("#expiryDate_field_create_kclass").val(u["expiryDate_field_create_kclass"]).trigger("change")
      }
    }

    if(u.hasOwnProperty("cardtype_field_create")){
      if(u["cardtype_field_create"]){
        $("#cardtype_field_create").trigger('click')
        $("#cardtype_field_create_fname").val(u["cardtype_field_create_fname"]).trigger("change")
        $("#cardtype_field_create_null").val(u["cardtype_field_create_null"]).trigger("change")
        $("#cardtype_field_create_vname").val(u["cardtype_field_create_vname"]).trigger("change")
        $("#cardtype_field_create_enclass").val(u["cardtype_field_create_enclass"]).trigger("change")
        $("#cardtype_field_create_kclass").val(u["cardtype_field_create_kclass"]).trigger("change")
      }
    }

  }
    card_obj = obj
  }

  function card_settings_save() {
    var modal_fields = $("#card_settings_modal")
    let k=0
    card_dict = {}
    let cap_fields_val = []
    let cap_status = ""
    let space_status = ""
    let val_msg = ""
    let allow_field_create = true
    modal_fields.find("select,input").filter(':visible').each(function() {
        if($(this).is(':checkbox')){
            if($(this).is(':checked')){
              card_dict[$(this).attr("id")] = true
            }else if($(this).is(':not(:checked)')){
              card_dict[$(this).attr("id")] = false
            }
				}else{
          if($(this).attr("id") == "cardtype_field_create_fname" || $(this).attr("id") == "cvv_field_create_fname" || $(this).attr("id") == "expiryDate_field_create_fname" ){
            cap_status =  (/[A-Z]/.test($(this).val()))
            space_status =  (/\s/.test($(this).val()))
            if(cap_status == true){
              cap_fields_val.push({"Capital":$(this).val()})
            }
            if(space_status == true){
              cap_fields_val.push({"Space":$(this).val()})
            }
            card_dict[$(this).attr("id")] = $(this).val()
          }else{
            card_dict[$(this).attr("id")] = $(this).val()
          }
				}
    });
    $(card_obj).attr("name", JSON.stringify(card_dict))

    if(cap_fields_val.length >0){
      allow_field_create = false
    }

    let fields = []
    for(let [key,value] of Object.entries(card_dict)){
      if(value === true){
        fields.push(key.split("_")[0])
      }
    }

    if(allow_field_create){
      if(fields.length > 0){
          create_access = true
          for(let i in fields){
            $('#addFieldRow').trigger('click')
            if(fields[i] == "cardtype"){
              $('#table').find('.hide').last().find('td').eq(0).find('span').text(card_dict['cardtype_field_create_fname'])
              $('#table').find('.hide').last().find('td').eq(1).find('select').val("CardTypeField").trigger("change")
              $('#table').find('.hide').last().find('td').eq(1).find('select').val("CardTypeField").trigger("click")
              $('#table').find('.hide').last().find('td').eq(3).find('span').text(card_dict['cardtype_field_create_vname'])
              $('#table').find('.hide').last().find('td').eq(4).find('select').val(card_dict['cardtype_field_create_null']).trigger("change")
              $('#table').find('.hide').last().find('td').eq(15).find('#ctype_config').attr("name", JSON.stringify(card_dict))
            }else if(fields[i] == "cvv"){
              $('#table').find('.hide').last().find('td').eq(0).find('span').text(card_dict['cvv_field_create_fname'])
              $('#table').find('.hide').last().find('td').eq(1).find('select').val("CardCvvField").trigger("change")
              $('#table').find('.hide').last().find('td').eq(1).find('select').val("CardCvvField").trigger("click")
              $('#table').find('.hide').last().find('td').eq(3).find('span').text(card_dict['cvv_field_create_vname'])
              $('#table').find('.hide').last().find('td').eq(4).find('select').val(card_dict['cvv_field_create_null']).trigger("change")
              $('#table').find('.hide').last().find('td').eq(15).find('#cvv_config').attr("name", JSON.stringify(card_dict))
            }else if(fields[i] == "expiryDate"){
              $('#table').find('.hide').last().find('td').eq(0).find('span').text(card_dict['expiryDate_field_create_fname'])
              $('#table').find('.hide').last().find('td').eq(1).find('select').val("CardExpiryField").trigger("change")
              $('#table').find('.hide').last().find('td').eq(1).find('select').val("CardExpiryField").trigger("click")
              $('#table').find('.hide').last().find('td').eq(3).find('span').text(card_dict['expiryDate_field_create_vname'])
              $('#table').find('.hide').last().find('td').eq(4).find('select').val(card_dict['expiryDate_field_create_null']).trigger("change")
              $('#table').find('.hide').last().find('td').eq(15).find('#exp_config').attr("name", JSON.stringify(card_dict))
            }
          }
          create_access = false
          modal_fields.modal('hide')
      }else{
        modal_fields.modal('hide')
      }
    }else{
      Swal.fire({icon: 'warning',text: 'Please check the field names are either not in capital letters and should not have spaces'});
    }

  }

  function edit_card_modal(obj) {
    card_obj = obj
 }

 var privacy_obj;
 function privacy_modal(obj) {

  $(".privacyf_selectop").val("").trigger("change")

   if(obj.getAttribute("name") != "") {
    let u = JSON.parse(obj.getAttribute("name"))

    $(".privacyf_selectop").val(u["privacy_option"]).trigger("change")
    $(".privacyf_selectop").val(u["privacy_option"]).trigger("select2:select")

    if(u.hasOwnProperty("master_table")){
      $(".privacy_master_table").val(u["master_table"]).trigger("change")
      $(".privacy_master_table").val(u["master_table"]).trigger("select2:select")

      $(".privacy_master_groupf").attr("data-reload",u["group_field"])
      $(".privacy_master_userf").attr("data-reload",u["user_field"])
    }
  }
    privacy_obj = obj
  }

  function privacy_settings_save() {
    var modal_fields = $("#privacy_settings_modal")
    privacy_dict = {}

    modal_fields.find("select:visible").each(function() {
      privacy_dict[$(this).attr("name")] = $(this).val()
    });

    $(privacy_obj).attr("name", JSON.stringify(privacy_dict))
    modal_fields.modal("hide")
  }

  function edit_privacy_modal(obj) {
    privacy_obj = obj
 }


 var table_obj;
 function table_modal(obj) {

  $(".table_master_class").val("").change()

   if(obj.getAttribute("name") != "") {
    let u = JSON.parse(obj.getAttribute("name"))
    $(".table_master_class").val(u["table_field_master"]).trigger("change")
  }
    table_obj = obj
  }

  function table_settings_save() {
    var modal_fields = $("#table_settings_modal")
    table_dict = {}
    modal_fields.find("select,input").filter(':visible').each(function() {
      table_dict[$(this).attr("id")] = $(this).val()
    });
    $(table_obj).attr("name", JSON.stringify(table_dict))
    modal_fields.modal('hide')
  }

  function edit_table_modal(obj) {
    table_obj = obj
 }

  function file_settings_save() {
    $(file_obj).attr("name", $("#extension").val())
    $("#file_settings_modal").modal('hide')
   }
function video_settings_save(obj){
  $(file_obj).attr("name", $("#extension_video").val())
  $('#video_settings_modal').modal('hide')
}

var mulsel_obj;
 function mulsel_modal(obj) {
    fld_name = $(obj).parent().parent().find(".fld_name").text()
    $('.multipleSelectedColumn').val(fld_name)

    $('.selectMultipleFormTable').val('').trigger('change')
    $(".def_values_opt").empty()
    columnForTables = []
    $('.defaultValue').prop('checked',false)
    $('.plus').prop('checked',false)
    $('.option_popup').prop('checked',false)
    $('#multiselectConditionModal').find('.mainCont').empty()

   if(obj.getAttribute("name") != "") {
    let u = JSON.parse(obj.getAttribute("name"))

    $('.selectMultipleFormTable').val(u["value"][0]).trigger('change')
    if(u["plusBtn"][fld_name]){
      $('.plus').prop("checked",true)
    }
    if(u["popUpOption"][fld_name]["popupCheckbox"]=="true"){
      $('.option_popup').prop("checked",true)
    }

    for(let t = 0; t < u.checkBox.length; t++) {
      if (u.checkBox[t] == 1) {
        $('.defaultValue').eq(t).prop('checked',true);
      } else {
        $('.defaultValue').eq(t).prop('checked',false);
      }
      if (u["condition"].length > 0){
        $(".multiselectButton").eq(t).attr("data-data",JSON.stringify(u["condition"][t]));
      } else {
        $(".multiselectButton").eq(t).attr("data-data",JSON.stringify([]));
      }
    }

    var ok = u.masterColumn;
    var ok1 = u.add;
    var m = u.master;
    var ok2 = [];
    if(Object.prototype.hasOwnProperty.call(u, 'def_MulVal')){
      ok2 = u.def_MulVal;
    }

    $.ajax({
      url:`/users/${urlPath}/processGraphModule/`,

      data: {
        'operation': 'formTableMiltipleFieldsUnique',
        'tablesForm': JSON.stringify(u["value"]),
      },
      type: "POST",
      dataType: "json",
      success: function (data) {
          $('.selectTableColumns').empty()
          for (j in data.finalFieldList) {
            $('.selectTableColumns').append(
              `<option value="${data.finalFieldList[j]['fieldName']}">${data.finalFieldList[j]['fieldVerbose']}</option>`
            );
          }

        $('.selectTableColumns').off('change').on('change',fillcolvalMul)

            $('.selectTableColumns').attr("data-data",JSON.stringify(ok2[0]))

          $('.selectTableColumns').val(ok[0]).trigger('change');
      },
      error: function () {
        Swal.fire({icon: 'error',text: 'Error! Please try again.'});
      }
    })

    $.ajax({
      url: `/users/${urlPath}/processGraphModule/`,

      data: {
        'operation': 'formTableMiltipleFields',
        'tablesForm': JSON.stringify(u["value"]),
      },
      type: "POST",
      dataType: "json",
      success: function (data) {

          $('.additional').empty();
          for (j in data.finalFieldList) {
            $('.additional').append(
              `<option value="${data.finalFieldList[j]['fieldName']}">${data.finalFieldList[j]['fieldVerbose']}</option>`
            )
          }

        for(j_ in ok1) {
          $('.additional').val(ok1[j_]).trigger('change');
        }
      },
      error: function () {
        Swal.fire({icon: 'error',text: 'Error! Please try again.'});
      }
    })

  }
    mulsel_obj = obj
  }

  function mulsel_settings_save() {
    var modal_fields = $("#mulsel_settings_modal")

    masterTableName = [$('.selectMultipleFormTable').val()]
    masterTableColumn = [$('.selectTableColumns').val()]
    columnForTable = columnForTables
    master = [$('.multipleSelectedColumn').val()]
    add = [$(".additional").val()]
    def_MulVal = [$(".def_values_opt").val()]
    toCheck = []
    $('.defaultValue').each(function() {
      if ($(this).prop('checked') == true) {
        toCheck.push(1);
      } else {
        toCheck.push(0);
      }
    })
    plusBtn = {}
    plusBtn[$('.multipleSelectedColumn').val()] = $('.plus').prop('checked')
    var additionalInfoBtn = $('#additionalInfoCB').prop('checked')
    popUpOption = {}
    var propChecked = 'false'
    if ($('.option_popup').prop('checked') == true){
      propChecked = 'true'
    }
    popUpOption[$('.multipleSelectedColumn').val()] = {
      'popupCheckbox':propChecked,
      'linkedTable':$('.selectMultipleFormTable').val(),
      'linkedColumn':$('.selectTableColumns').val(),
      'linkedAddColumns':$('.additional').val(),
    }
    multiselectCond = []
    $('.multiselectButton').each(function() {
      if($(this).attr("data-data") != undefined){
        multiselectCond.push(JSON.parse($(this).attr("data-data")))
      } else{
        multiselectCond.push([]);
      }
    })

    mulsel_dict = {
          "Category_attr": "MultiSelect_Choice",
          "value": masterTableName,
          "masterColumn": masterTableColumn,
          "char_column": columnForTable,
          "master": master,
          "add":add,
          "def_MulVal": def_MulVal,
          "checkBox":toCheck,
          "plusBtn":plusBtn,
          "popUpOption":popUpOption,
          "condition":multiselectCond,
          "additionalInfoBtn":additionalInfoBtn
        }

    $(mulsel_obj).attr("name", JSON.stringify(mulsel_dict))
    $("#mulsel_settings_modal").modal('hide')
  }

  function edit_mulsel_modal(obj) {
    mulsel_obj = obj
 }

    $('.comp_cbox').change(
    function(){
        if ($(this).is(':checked')) {
            $('.equationBuilder1').css('display','block')

            $('.equationBuilder1').find('a').off('click').on('click', function(){
                selectedCol = $('#fieldmdl').val().toLowerCase();
                idenFlag = "add"
                mod_name = $(".dataElements").find("p").text() + selectedCol
                $("#EBDisplayModel").modal('show');
            });

        }else{
            $('.equationBuilder1').css('display','none')
        }
    });



    $('#ComputedValue2').on('change', function(){
        if ($(this).is(':checked')) {
            $('.equationBuilder2').css('display','block')

            $('.equationBuilder2').find('#EBDisplayButtonID').off('click').on('click', function(){

                edit_col_list = []

                att_list = $('#myList').find('button')
                att_index = ""
                for(let i=0;i<att_list.length;i++){

                  edit_col_list.push(att_list[i].innerText)

                  if(att_list[i].innerText == $('#selectedElement').text()){
                      att_index = i
                      break;
                  }

                }

                tb_index = att_index

                if(att_index == 0){
                  Swal.fire({icon: 'warning',text: 'Computation logic cannot be configured in the ID element.'});
                  $("#ComputedValue2").prop('checked', false).trigger("change");
                }else if(att_index == 1){
                  Swal.fire({icon: 'warning',text: 'Computation logic cannot be configured in the first field.'});
                  $("#ComputedValue2").prop('checked', false).trigger("change");
                }else{

                  selectedCol = $('#selectedElement').text()
                  idenFlag = "edit"
                  mod_name = $(".dataElements").find("p").text() + selectedCol
                  $("#EBDisplayModel").modal('show');
                }

            });

        }else{
            $('.equationBuilder2').css('display','none')
        }
    });

//Exisiting Schema Replicate Code
$('#replicate_tableSchema').on('change',function(){
  if($(this).prop('checked') == true){
    $('#exisitingSchemaRow').css('display','block')
    $('#exisitingSchemaTables').select2({ width: '12rem' });
    $.ajax({
      url: window.location.pathname,
      data: {'operation': 'userdefined_table_schemas' },
      type: "POST",
      dataType: "json",
      success: function(data){
        if(data.hasOwnProperty('tableList')){
          let tableList = JSON.parse(data['tableList'])
          if(tableList.length > 0){
            $('#exisitingSchemaTables').empty()
            $('#exisitingSchemaTables').append(`<option value=''>Select Table</option>`)
            for(let i=0;i<tableList.length;i++){
              $('#exisitingSchemaTables').append(`<option value='${tableList[i]}'>${tableList[i]}</option>`)
            }
          }
        }
      },
      error: function () {
        Swal.fire({icon: 'error',text: 'Error! Please try again.'});
      }
    })

  }else{
    $('#exisitingSchemaRow').css('display','none')
  }
})


$('#populate_exisiting_schema').on('click',function(){
  let selectedTable = $('#exisitingSchemaTables').val()
  if($('#replicate_tableSchema').prop('checked') == true){
    if(selectedTable && selectedTable != ''){

    $.ajax({
      url: window.location.pathname,
      data: {'selectTable':selectedTable,'operation': 'replicatedTable_fields'},
      type: "POST",
      dataType: "json",
      success: function(data){
        let field_list = JSON.parse(data['front_dict'])
        $("#example11").find('tbody').empty()
        if(Object.keys(field_list).length > 0 ){
          for(let fieldName in field_list){

            let index = Object.keys(field_list).indexOf(fieldName);
            if(index <= Object.keys(field_list).length-1){
              $('#addFieldRow').click()
            }
            $("#example11").find('tbody').find('tr').eq(-1).find('td').find('.fld_name').text(fieldName)
            if(field_list[fieldName]['fieldselect'] == 'ForeignKey'){
              $("#example11").find('tbody').find('tr').eq(-1).find('td').find('.fieldselect').parent().html(`<select class="table_datatype browser-default custom-select select2 form-control fieldselect" style="width:179.325px !important">
                              <option value="" disabled >Select</option>
                              <option value="AutoField">AutoField (Primary key)</option>
                              <option value="CharField">CharField (Text,numbers,special characters,etc.)</option>
                              <option value="TextField">TextField (Large text)</option>
                              <option value="BooleanField">BooleanField (Yes or No,True or False,etc.</option>
                              <option value="FileField">FileField (File/Document upload)</option>
                              <option value="VideoField">VideoField</option>
                              <option value="ImageField">ImageField (image upload)</option>
                              <option value="IntegerField">IntegerField (Integer numbers)</option>
                              <option value="BigIntegerField">BigIntegerField (Big Integer numbers)</option>
                              <option value="FloatField">FloatField (Integer or decimal numbers)</option>
                              <option value="DateField">DateField (Date)</option>
                              <option value="DateTimeField">DateTimeField (Date and Time)</option>
                              <option value="TimeField">TimeField (Time)</option>
                              <option selected value="ForeignKey">ForeignKey</option>
                            </select>`)
                $("#example11").find('tbody').find('tr').eq(-1).find('td').find('.fieldselect').click()
                $("#example11").find('tbody').find('tr').eq(-1).find('td').find('.fieldselect').select2()
                $("#example11").find('tbody').find('tr').eq(-1).find('td').find(`#prnt_tbl`).text(String(field_list[fieldName]['prnt_tbl']))
            }else{
              $("#example11").find('tbody').find('tr').eq(-1).find('td').find('.fieldselect').val(field_list[fieldName]['fieldselect']).trigger('change')
            $("#example11").find('tbody').find('tr').eq(-1).find('td').find('.fieldselect').click()
            }
              for(let fieldconfig in field_list[fieldName]){
              if(fieldconfig != "fieldselect"){
                if($("#example11").find('tbody').find('tr').eq(-1).find('td').find(`#${fieldconfig}`).is('select') == true && fieldconfig != 'uuid_config'){

                    if(String(field_list[fieldName][fieldconfig]) === '0'){
                    $("#example11").find('tbody').find('tr').eq(-1).find('td').find(`#${fieldconfig}`).val('2').trigger('change')
                  }else if(String(field_list[fieldName][fieldconfig]) === '1'){
                    $("#example11").find('tbody').find('tr').eq(-1).find('td').find(`#${fieldconfig}`).val('1').trigger('change')
                  }
                }else if(fieldconfig == 'select2_multiplechoices'){
                     for(let [key,val] of Object.entries(field_list[fieldName][fieldconfig])){
                      $("#example11").find('tbody').find('tr').eq(-1).find('td').find(`.${fieldconfig}`).append(`<option val='${val}' selected>${val}</option>`)
                     }
                }else if(fieldconfig == 'multipleform'){
                     for(let [key,val] of Object.entries(field_list[fieldName][fieldconfig])){
                      $("#example11").find('tbody').find('tr').eq(-1).find('td').find(`.${fieldconfig}`).append(`<option val='${val}' selected>${val}</option>`)
                     }
                     $("#example11").find('tbody').find('tr').eq(-1).find('td').find(`.divideroption`).val(field_list[fieldName]['divideroption']).trigger('change')
                    $("#example11").find('tbody').find('tr').eq(-1).find('td').find(`.divideroption`).click()
                }else if(fieldconfig == 'uuid_config'){
                  $("#example11").find('tbody').find('tr').eq(-1).find('td').find(`#${fieldconfig}`).attr('name',field_list[fieldName][fieldconfig])
                }else{
                  $("#example11").find('tbody').find('tr').eq(-1).find('td').find(`#${fieldconfig}`).text(String(field_list[fieldName][fieldconfig]))
                }
              }
            }


          }

        }
      },
      error: function () {
        Swal.fire({icon: 'error',text: 'Error! Please try again.'});
      }
    })
    }
  }
})

    $('#datamgmt_uploadFileBtn').on('click',function(){
      let Fileinput = $('#datamgmt_uploadFile').val()
      if (Fileinput != ""){
        let formData = new FormData($("#datamgmt_table_form")[0]);
        formData.append("operation", "datamgmt_tablefile_creation");
        $.ajax({
          url:window.location.pathname,
          data: formData,
          type: 'POST',
          cache: false,
          contentType: false,
          processData: false,
          success: function (data) {
            if(data.hasOwnProperty('Error')){
              Swal.fire({icon: 'error',text: data.Error});
            }else if(data.hasOwnProperty('Table_names')){
              Swal.fire({icon: 'success',text: 'Data Table/s created successfully!'});
              window.location.reload()
            }

          },
          error: ()=>{
            Swal.fire({icon: 'error',text: 'Error! Failure while creating Data Table/s.'});
          }
        });
      }else{
        Swal.fire({icon: 'error',text: 'Error! File not found. Please try again.'});
      }
    })

  function checkChangedConfig(tableName,message,button,modalName,type){
    $("#generateReport").attr("data-type",`${type}`)
    typeStringValue = `${type}`.charAt(0).toUpperCase() + `${type}`.slice(1);
    $("#generateReport").html(`${typeStringValue} column`)
    let url_string = window.location.pathname
    let f_occ = url_string.indexOf('/', url_string.indexOf('/') + 1)
    let s_occ = url_string.indexOf('/', url_string.indexOf('/') + f_occ +1)
    let t_occ = url_string.indexOf('/', url_string.indexOf('/') + s_occ +1)
    let app_code2 = url_string.substring(f_occ+1,s_occ)
    let current_dev_mode2 = url_string.substring(s_occ+1,t_occ)
    if(current_dev_mode2 != "Build" && current_dev_mode2 != "Edit"){
      current_dev_mode2 = "User"
    }
    $.ajax({
      url: `/users/${app_code2}/${current_dev_mode2}/DataManagement/`,
      data: {
        'operation': 'fetchConfig' ,
        "table_name":tableName,
        "message":message,
      },
      type: "POST",
      dataType: "json",
      success: function(data){
        prgPrCode = {}
        $("#errorDetail").find(".modal-body").empty()
        if (data.config.length == 0){
          $("#errorDetail").find(".modal-body").html(`No changes required in the configuration`)
        }
        dic = {}
        for(let i in data.config){
          dic[data.code[data.config[i]["related_item_code"]]] = []
          prgPrCode[data.code[data.config[i]["related_item_code"]]] = []
        }
        for(let i in data.config){
          dic[data.code[data.config[i]["related_item_code"]]].push(data.config[i]);
          if(!prgPrCode[data.code[data.config[i]["related_item_code"]]].includes(data.code_name[String(data.config[i]["related_item_code"])])){
            prgPrCode[data.code[data.config[i]["related_item_code"]]].push(data.code_name[String(data.config[i]["related_item_code"])])
          }
        }
        let ind = -1
        for(let [key,value] of Object.entries(dic)){
          ind++
          $("#errorDetail").find(".modal-body").append(`
            <div class="card indError collapsed-card">
              <div class="card-header">
                <p class="card-title" style="color:var(--primary-color)">${data.code_name[key]}</p>
                <div class="card-tools float-right">
                  <button type="button" class="btn btn-tool" data-card-widget="collapse" onclick="columnAdjust.call(this,'errorTable${ind}')"><i class="fas fa-plus" style="color:var(--primary-color);"></i></button>
                </div>
              </div>
              <div class="card-body">
                <div class='card-body errorDetailBody'>
                  <table class="display errorTable" id="errorTable${ind}" style="width:100%;overflow-x: scroll;overflow-y:scroll;">
                  </table>
                </div>
              </div>
            </div>
          `)
          dicName = {
            "tab_header_name":"Element name",
            "related_item_code": "Subprocess",
            "computation_name":"Computation name",
            "tab_type": "Element type"
          }
          html_head = `<thead><row>`
          for(let [key1,value1] of Object.entries(value[0])){
            if(!["id","id__","Id","transaction_id"].includes(key1)){
              html_head = html_head + `<th>${dicName[key1]}</th>`
            }
          }
          html_head = html_head + `<th>Message</th>`
          html_head = html_head + `<th>Action required</th>`
          html_head = html_head + `</row></thead>`
          $(".errorTable").eq(-1).append(html_head)
          html_body = `<tbody>`
          for(let i = 0; i < value.length; i++){
            html_body = html_body + `<tr>`
            for(let [key1,value1] of Object.entries(value[i])){
              if(!["id","id__","Id","transaction_id"].includes(key1)){
                if(key1 == "related_item_code"){
                  html_body = html_body + `<td>${data.code_name[String(value1)]}</td>`
                } else {
                  html_body = html_body + `<td>${value1}</td>`
                }
              }
            }
            html_body = html_body + `<td>${message}</td>`
            html_body = html_body + `<td>Reconfigure element</td>`
            html_body = html_body + '</row>'
          }
          html_body = html_body + `</tbody>`
          $(".errorTable").eq(-1).append(html_body)
          datatablesFunc(`errorTable${ind}`)
        }
        $("#errorDetail").modal("show")
        if(type != "delete"){
          $(button).html("Save")
        } else {
          $(button).html(`<i class="fa fa-minus-square ihover javaSC thin-icon" aria-hidden="true" style="font-size:18px"></i>`)
        }
        $("#"+modalName).modal("hide")
      },
      error: function () {
        Swal.fire({icon: 'error',text: 'Error! Please try again.'});
        $("#generateReport").trigger("click");
      }
    })
  }
  function datatablesFunc(id) {
    $('#'+id).DataTable( {
      "autoWidth": true,
      "scrollY": "40vh",
      "scrollCollapse": true,
      "order":[[ 0, 'asc' ]],
      "scrollX": true,
      // "serverSide":true,
      orderCellsTop: true,
      //fixedHeader: true,
      responsive: true,
      // stateSave: true,
      "deferRender": true,
      "paging": true,
      "searching": true,
      "info": true,
      "lengthMenu": [[1, 5, 50, -1], [1, 5, 50, "All"]],
      "stripeClasses": false,
      "pageLength": 50,
      dom: 'lfBrtip',
      "sScrollX": "100%",
      "scrollX": true,
      buttons: [
            {
                extend: 'collection',
                text: 'Export',
                buttons: [
                {
                    extend: 'copy', title: '', exportOptions: {
                    }
                },
                {
                    extend: 'excel', title: '', exportOptions: {
                    }
                },
                {
                    extend: 'csv', title: '', exportOptions: {
                    }
                },
                {
                    extend: 'pdf', title: '', exportOptions: {
                    }
                },
                ],
            },

          ],
          columnDefs: [
          {
              targets: "_all",
              className: 'dt-center allColumnClass all'
          },
          {
              targets: 0,
              width: "20%",
              className: 'noVis'
          }
      ],

      }).columns.adjust();
    }
let prgPrCode = {}
function columnAdjust(id) {
  setTimeout(() => {
    $("#"+id).DataTable().columns.adjust()
  },500)
}

$(".cardspace_error").on("blur",function(){
    fieldNameValidation(this);
});

function fieldNameValidation(This) {

  let fieldName = $(This).val();

  let cap_fields_val = []
  let cap_status = ""
  let space_status = ""

  cap_status =  (/[A-Z]/.test(fieldName))
  space_status =  (/\s/.test(fieldName))

  if(cap_status == true){
    cap_fields_val.push({"Capital":fieldName})
  }
  if(space_status == true){
    cap_fields_val.push({"Space":fieldName})
  }

  if(cap_fields_val.length >0){
    $(This).parent().find('small').css("display","block")
  }else{
    $(This).parent().find('small').css("display","none")
  }

}

$("#generateReport").on("click",function() {
  if($(this).attr("data-type") == "edit"){
    $(".editSave").html(`Save`)
    editattributes1()
  } else if ($(this).attr("data-type") == "delete"){
    $("#delete_att_det").html(`<i class="fa fa-minus-square ihover javaSC thin-icon" aria-hidden="true" style="font-size:18px;margin-bottom:5px;"></i>`)
    deleteColumn()
  } else if ($(this).attr("data-type") == "add"){
    $(".addSave").html(`Save`)
    $(".addSave1").trigger("click")
    resetAddElementModal()
  }
  $("#errorDetail").modal("hide")
})
function regenrateHtml(){
  Swal.fire({
              icon:'question',
              text:"Do you want to regenerate the impacted processes? Click 'Yes' to confirm or click 'No' if you do not wish to regenerate them.",
              showDenyButton: true,
              showCancelButton: true,
              confirmButtonText: 'Yes',
              denyButtonText: 'No',
            }).then((result) => {
              if (result.isConfirmed) {
                let url_string = window.location.pathname
                let f_occ = url_string.indexOf('/', url_string.indexOf('/') + 1)
                let s_occ = url_string.indexOf('/', url_string.indexOf('/') + f_occ +1)
                let t_occ = url_string.indexOf('/', url_string.indexOf('/') + s_occ +1)
                let app_code2 = url_string.substring(f_occ+1,s_occ)
                let current_dev_mode2 = url_string.substring(s_occ+1,t_occ)
                if(current_dev_mode2 != "Build" && current_dev_mode2 != "Edit"){
                  current_dev_mode2 = "User"
                }
                $.ajax({
                    url: `/users/${app_code2}/${current_dev_mode2}/DataManagement/`,
                    data: {'operation': 'regenerateHtml', "prgPrCode":JSON.stringify(prgPrCode) },
                    type: "POST",
                    dataType: "json",
                    success: function(data){
                      Swal.fire({icon: 'info',text: 'Impacted processes are being regenerated.'});
                      var jobId = data.job_id;
                      var jobConnection = new WebSocket(
                          'ws://' + window.location.host +
                          `/ws/queued_job_output/${jobId}/`);

                      jobConnection.onmessage = function(event){
                        jobConnection.close(1000);
                      }
                      jobConnection.onerror = function() {
                          jobConnection.close(1000);
                      }
                    },
                    error: function () {
                      Swal.fire({icon: 'error',text: 'Error! Failure in regenarating impacted processes. Please try again.'});
                    }
                  })
                          }
                 })
}


  $('#dataele_dataAccess').on('click', function(){
    if ($(this).attr('data-config')) {
      let config = JSON.parse($(this).attr('data-config'))
      let accessType = config['access_type'];
      $('#selectAccessControlType').val(accessType).trigger('select2:select');
      $('#selectAccessControlType').val(accessType).trigger('change');
      if (accessType == "custom") {
        $("#selectCustomAccessControlType").val(config['additional_config']['controlMeasure']).trigger('change');
        $("#selectAccessControlCustomField").val(config['additional_config']['fields']).trigger('change');
        $("#selectAccessControlCustomField").attr('data-config', JSON.stringify(config['additional_config']['fields']));
      }
    } else {
      $('#selectAccessControlType').val('').trigger('change');
    };
    $("#dataAccessModal").modal('show');
  });

  $('#selectAccessControlType').on('select2:select', function () {
    if ($(this).val() === 'custom') {
      $('#customControlContainer').css('display', '');
      $.ajax({
        url: window.location.pathname,
        data: {
          'model_name': $(".dataElements").find("p").text(),
          'operation': 'fetchFieldDetails',
        },
        type: "POST",
        dataType: "json",
        success: function (data) {
          $("#selectAccessControlCustomField").empty();
          for (let [key,value] of Object.entries(data)) {
            $("#selectAccessControlCustomField").append(`<option value='${key}'>${value}</option>`);
          }
          if ($("#selectAccessControlCustomField").attr('data-config')) {
            $("#selectAccessControlCustomField").val(JSON.parse($("#selectAccessControlCustomField").attr('data-config'))).trigger('change');
          }
        },
        error: function () {
          Swal.fire({icon: 'error',text: 'Error! Failure in saving Data Access Controls. Please try again.'});
        }
      });
    } else {
      $('#customControlContainer').css('display', 'none');
    }
  });

 </script>

 {% endblock %}