
      <style>
        .buttonstyling{
          margin-bottom:10px;
        }
      </style>
     <script>
      var dashboardSave_ = true;
      function editNameIndex(){
        let id_ = $(this).attr("id").replace("tabHeader","indextab");
        $(`#${id_}`).find("a").html($(this).text());
      }
      const gotoTab = (parent, index) => {
          let id = '#analysis' + index;
          $(id).trigger('click');
        }</script>
    <script>
        let activeElement = "no";        var None = 'None';        var listViewTableDict={};        var listViewEditTemplate = {};        var createViewIdList = [];        var elementIDList=[];        var chartConfigDict={};        var crossFilterDict={};        var element_table_IDList = [];        var computationElementIdsArray = [];        var previousRunComputeElementIdArray = [];        var element_page = [];        var names = {};
        var app_code_home = '';        var user_home = '';        var item_code_list = [];        var grapejs = 1;        var m_col_basefilter = {};        var globalFuncList_scenario = [];        var variableList_scenario = [];        var analysiselementIDList=[];        var mColBasefilter = {};        var chartSaveEleIdList = [];        var chartSaveEleId = "";        var slicerTabConfigDict = {};        var sharedConfig = {"element_id":"", "config":[]};        var editType = "Enable";        var button_ids = ["savebutton_","saveDraftbutton_","customValidationList","calculateComp","viewHistory_","button-id-back","resetDraft_","previewDraft_","rejectedRecords","viewTransactions"];        function enableSaveButton () {        
 $(this).find('button[value=Save]').prop('disabled',false);      
};

      function bta_apply() {
            let lba_data = {{lba_data | safe}};
            for (var key of Object.keys(lba_data)) {
              if(Object.keys(lba_data[key]).length != 0) {
              e_id = key;
              if (e_id.startsWith("whiteSpacewrap")) {
                if (!lba_data[key].includes("CreateView - Save")) {
                  $(`#savebutton_${e_id}`).attr("disabled", "true");
                  $(`#compare_existing_${e_id}`).attr("disabled", "true");
                }

                if (!lba_data[key].includes("CreateView - Save as Draft")) {
                  $(`#saveDraftbutton_${e_id}`).attr("disabled", "true");
                  $(`#resetDraft_${e_id}`).attr("disabled", "true");
                  $(`#previewDraft_${e_id}`).attr("disabled", "true");
                }

                if (!lba_data[key].includes("CreateView - Custom Validation")) {
                  $(`#customValidationList${e_id}`).attr("disabled", "true");
                  $(`#customValidation${e_id}`).attr("disabled", "true");
                }

                if (!lba_data[key].includes("CreateView - Refresh Computation")) {
                  $(`#calCompVal_${e_id}`).attr("disabled", "true");
                }

                if (!lba_data[key].includes("CreateView - Back")) {
                  $(`#button-id-back${e_id}`).attr("disabled", "true");
                }

                if (!lba_data[key].includes("CreateView - View History")) {
                  $(`#viewHistory_${e_id}`).attr("disabled", "true");
                }
                if (!lba_data[key].includes("CreateView - View Rejected Records")) {
                  $(`#rejectedRecords${e_id}`).attr("disabled", "true");
                }

                if (!lba_data[key].includes("CreateView - View Transaction Status")) {
                  $(`#showTransactions${e_id}`).attr("disabled", "true");
                  $(`#viewTransactions${e_id}`).attr("disabled", "true");
                }
              }
              if (e_id.startsWith("ellipse")) {
                if (!lba_data[key].includes("Analysis - Previous Versions")) {
                  $(`#previousVersion${e_id}`).attr("disabled", "true");
                }
                if (!lba_data[key].includes("Analysis - Save and Share")) {
                  $(`#saveShare${e_id}`).attr("disabled", "true");
                }
                if (!lba_data[key].includes("Analysis - Plot charts")) {
                  $(`#plotCharts${e_id}`).attr("disabled", "true");
                }
                if (!lba_data[key].includes("Analysis - PDF")) {
                  $(`#analysisPDF${e_id}`).attr("disabled", "true");
                }
                if (!lba_data[key].includes("Analysis - Save")) {
                  $(`#saveChartConfigButton${e_id}`).attr("disabled", "true");
                }
                if (!lba_data[key].includes("Analysis - Global Settings")) {
                  $(`#globalButton${e_id}`).attr("disabled", "true");
                }
                if (!lba_data[key].includes("Analysis - Add tab")) {
                  $(`#analysisAddTab${e_id}`).attr("disabled", "true");
                }
                if (!lba_data[key].includes("Analysis - Tab config")) {
                  $(`#TabSettings${e_id}`).attr("disabled", "true");
                }
                if (!lba_data[key].includes("Analysis - Import dashboard")) {
                  $(`#importDashboard${e_id}`).attr("disabled", "true");
                }
                if (!lba_data[key].includes("Analysis - Publish")) {
                  $(`#publishDashboard${e_id}`).attr("disabled", "true");
                }
              }

              if (e_id.startsWith("parallelogram")) {
                if (!lba_data[key].includes("Computation - Run Model")) {
                  $(`#runModel_${e_id}`).attr("disabled", "true");
                }

                if (!lba_data[key].includes("Computation - Configure Scenario")) {
                  $(`#scenarios_${e_id}`).attr("disabled", "true");
                }

                if (!lba_data[key].includes("Computation - Filter")) {
                  $(`#filter_button_prev_run_computation${e_id}`).attr(
                    "disabled",
                    "true"
                  );
                  $(`#freezepane_button_prev_run_computation${e_id}`).attr(
                    "disabled",
                    "true"
                  );
                }
              }
              if (e_id.startsWith("document")) {
                if (!lba_data[key].includes("UploadView - Upload")) {
                  $(`#uploadFile${e_id}`).attr("disabled", "true");
                  $(`#downloadButton${e_id}`).attr("disabled", "true");
                }

                if (!lba_data[key].includes("UploadView - Map Columns")) {
                  $(`#columnMapperButton${e_id}`).attr("disabled", "true");
                }
                if (!lba_data[key].includes("UploadView - Custom Validation")) {
                  $(`#customValidationButton${e_id}`).attr("disabled", "true");
                }
                if (!lba_data[key].includes("UploadView - Add computation logic")) {
                  $(`#computedFieldMapperButton${e_id}`).attr("disabled", "true");
                }
                if (!lba_data[key].includes("UploadView - Download data")) {
                  $(`#downloadData${e_id}`).attr("disabled", "true");
                }
                if (!lba_data[key].includes("UploadView - Upload history")) {
                  $(`#downloadHistory${e_id}`).attr("disabled", "true");
                }
                if (!lba_data[key].includes("UploadView - Last upload errors")) {
                  $(`#downloadLastUploadErrors${e_id}`).attr("disabled", "true");
                }
                if (!lba_data[key].includes("UploadView - Detailed error log")) {
                  $(`#downloadErrorLog${e_id}`).attr("disabled", "true");
                }
                if (!lba_data[key].includes("UploadView - Transaction status")) {
                  $(`#showTransactions${e_id}`).attr("disabled", "true");
                }
                if (!lba_data[key].includes("UploadView - SFTP connectors")) {
                  $(`#sftpUploadButton${e_id}`).attr("disabled", "true");
                }
              }
              if (e_id.startsWith("process")) {
                if (!lba_data[key].includes("ListView - Upload")) {
                  $(`#uploadButton${e_id}`).attr("disabled", "true");
                }
                if (!lba_data[key].includes("ListView - Save template")) {
                  $(`#saveTemplateButton${e_id}`).attr("disabled", "true");
                }
                if (!lba_data[key].includes("ListView - Set Alerts")) {
                  $(`#displayalert${e_id}`).attr("disabled", "true");
                }
                if (!lba_data[key].includes("ListView - Paste Tabular Data")) {
                  $(`#tablegenerator_${e_id}`).attr("disabled", "true");
                }
                if (!lba_data[key].includes("ListView - Edit Mode")) {
                  $(`#editListView${e_id}`).attr("disabled", "true");
                }
                if (!lba_data[key].includes("ListView - Delete all data")) {
                  $(`#listview_clearall_${e_id}`).attr("disabled", "true");
                }
                if (!lba_data[key].includes("ListView - Find and replace")) {
                  $(`#find_replace_${e_id}`).attr("disabled", "true");
                }
                if (!lba_data[key].includes("ListView - Freeze Panes")) {
                  $(`#freeze_pane_${e_id}`).attr("disabled", "true");
                }
                if (!lba_data[key].includes("ListView - Formatters")) {
                  $(`#formatter_${e_id}`).attr("disabled", "true");
                }
                if (!lba_data[key].includes("ListView - Transactions Status")) {
                  $(`#showTransactions${e_id}`).attr("disabled", "true");
                }
                if (!lba_data[key].includes("ListView - Plot Charts")) {
                  $(`#plotCharts${e_id}`).attr("disabled", "true");
                }
                if (!lba_data[key].includes("ListView - Filter")) {
                  $(`#filter_button_list_view${e_id}`).attr("disabled", "true");
                }
                if (!lba_data[key].includes("ListView - Add Computed Fields")) {
                  $(`#addComp_field_${e_id}`).attr("disabled", "true");
                }
                if (!lba_data[key].includes("ListView - Expand")) {
                  $(`#example1_expand${e_id}`).attr("disabled", "true");
                }
                if (!lba_data[key].includes("ListView - Extract Data")) {
                  $(`#extract_data_${e_id}`).attr("disabled", "true");
                }
                if (!lba_data[key].includes("ListView - Bulk Update")) {
                  $(`#bulk_update_${e_id}`).attr("disabled", "true");
                }
                if (!lba_data[key].includes("ListView - Conditional Delete")) {
                  $(`#conditional_delete_${e_id}`).attr("disabled", "true");
                }
                if (!lba_data[key].includes("ListView - Approve all")) {
                  $(`#approve_all_ApprovalTemplate_${e_id}`).attr("disabled", "true");
                }
                if (!lba_data[key].includes("ListView - Reject all")) {
                  $(`#reject_all_ApprovalTemplate_${e_id}`).attr("disabled", "true");
                }
                if (!lba_data[key].includes("ListView - Approve Multiple")) {
                  $(`#approve_multiple_ApprovalTemplate_${e_id}`).attr("disabled", "true");
                }
                if (!lba_data[key].includes("ListView - Reject Multiple")) {
                  $(`#reject_multiple_ApprovalTemplate_${e_id}`).attr("disabled", "true");
                }
              }
              $("section").addClass('visible-section')
          }else{
            $("section").addClass('visible-section')
          }
        }
      }
      $(document).ready(bta_apply);
    </script>
  

        <script>
          computationElementIdsArray.push("parallelogram06294754053258678");
        
          previousRunComputeElementIdArray.push("parallelogram06294754053258678")
          
        $(".custom-file-input").on("change", function() {
          var fileName = $(this).val().split("\\").pop();
          $(this).siblings(".custom-file-label").addClass("selected").html(fileName);
        });
        if ($('form').find("input[name='csrfmiddlewaretoken']").attr('value') != undefined) {
            var ctoken = $('form').find("input[name='csrfmiddlewaretoken']").attr('value')
            $.ajaxSetup({
                beforeSend: function (xhr, settings) {
                    xhr.setRequestHeader("X-CSRFToken", ctoken);
                }
            });
        }
        function flowUICreator(elementsArray,container,element_id,data,configs) {
          var count = 0
          for (let k in elementsArray){
            if (elementsArray[k]['group'] =='nodes'){
              if (elementsArray[k]['data']['id'] in configs){
                elementsArray[k]['data']['text'] = configs[elementsArray[k]['data']['id']]
              }
              count ++
            }
          }
          if (count >= 5){
            container.css('height','20rem');
          }
          if (configs['shapes_options_text'] =='inside'){
            var styles = {
              'shape': configs['shapes_options'],
              'label': 'data(text)',
              'text-valign': 'center',
              'font-size': configs['font-size'],
              'color':configs['font-color'],
              'width': configs['shape_width'],
              'height': configs['shape_height'],
              'text-wrap': 'wrap',
              'text-max-width': `${String(configs['shape_width'])}px`,
            }
          }else{
            var styles = {
              'shape': configs['shapes_options'],
              'label': 'data(text)',
              'font-size': configs['font-size'],
              'color':configs['font-color'],
              'width': configs['shape_width'],
              'height': configs['shape_height'],
              'text-wrap': 'wrap',
              'text-max-width': `${String(configs['shape_width'])}px`,
            }
          }
          var cy = cytoscape({
            container: container,
            zoomingEnabled: false,
            userZoomingEnabled: false,
            elements: elementsArray,
            style: [
              {
                selector: 'node',
                style: styles,
              },
              {
                selector: 'edge',
                style: {
                  width: 1
                }
              }
            ],
            layout: {
              name: "dagre",
              rankDir: "LR",
              padding: 10,
              spacingFactor: 1.25,
              fit: true,
              nodeDimensionsIncludeLabels: true,
              avoidOverlap: true,
              pan: { x: 200, y: 100 }
            }
          });
          if (data != undefined){
            cy.nodes().forEach(function(ele, i, eles){
              for (let k in data){
                if (data[k]['element_id'] == ele.id()){
                  if (data[k]['current_status'] == 'Pass'){
                    ele.css('background-color','#4bb543')
                  }
                }
              }
            });
          }else{
            flag = true
            cy.nodes().forEach(function(ele, i, eles){
              if(flag){
                ele.css('background-color','#4bb543')
              }
              if (element_id == ele.id()){
                flag = false
              }
            });
          }
        }
        function processDesignDiv_compute(obj){
          var eleId = $(obj).attr('data-id')
          $(obj).parent().parent().find('.processflowdiv').toggleClass("displaynone")

          if ($(obj).parent().parent().find('.processflowdiv').hasClass("displaynone") == false){
            $(obj).prev().find('.stepper-wrapper').empty()
            if ($(obj).attr('data-trans')!= undefined){
              if ($(obj).attr('data-trans')!=''){
                var trans_code = $(obj).attr('data-trans')
                var flag = true
                if (trans_code.startsWith("[")){
                  trans_code = JSON.parse(trans_code)
                  trans_code = trans_code[0]
                  flag = true
                }else if (trans_code == "NULL") {
                  trans_code = ''
                  flag = false
                }
                if (flag){
                  $.ajax({
                    url:`/users/${urlPath}/dynamicVal/`,
                    data: {
                    "operation":"fetch_process_flow_model_trans",
                    'trans_code':trans_code,
                    },
                    type: "POST",
                    dataType: "json",
                    success: function (data) {
                    flowUICreator(data.data,$(obj).closest('.modal-body').find('.processflowdiv'),eleId,data.flow,JSON.parse($(obj).attr('data-list')))
                    },
                    failure: function () {
                      Swal.fire({icon: 'error',text: 'Error! Please try again.'});
                    },
                  })
                }

              }
            }else{
              $.ajax({
                url:`/users/${urlPath}/dynamicVal/`,
                data: {
                "operation":"fetch_process_flow_model_xml",
                'sub_pr_code':$(obj).attr('data-sub-process'),
                'pr_code':$(obj).attr('data-process'),
                },
                type: "POST",
                dataType: "json",
                success: function (data) {
                  flowUICreator(data.elements_list,$(obj).closest('.card-body').find('.processflowdiv'),eleId,undefined,JSON.parse($(obj).attr('data-list')))
                },
                failure: function () {
                  Swal.fire({icon: 'error',text: 'Error! Please try again.'});
                },
              })
            }

          }

          $(obj).toggleClass("rotate")
        }
            $.ajax({
              url: `/users/${urlPath}/computationModule/`,
              data: {
                'model': $("#modelName_parallelogram06294754053258678").attr("data-model_name"),
                'operation': 'fetch_saved_scenarios',
              },
              type: "POST",
              dataType: "json",
              success: function (data) {
                if (Object.keys(data.scenarios).length>0) {
                  for (let scn of data.scenarios) {
                    $("#savedScenarioTable_parallelogram06294754053258678").append(
                      `<tr>
                        <td style="text-align: center;" data-scenario_id="${scn.scenario_id}">${scn.scenario_name}</td>
                        <td style="text-align: center;">
                          <i class="fas fa-trash deleteSavedScenario text-primary" data-scenario_id="${scn.scenario_id}" data-element_id='parallelogram06294754053258678' data-title="Delete scenario"></i>
                          <i class="fa fa-eye text-primary"" onclick="viewCompScenario.call(this)" data-scenario_id="${scn.scenario_id}" data-element_id='parallelogram06294754053258678' data-title="View scenario"></i>
                        </td>
                      </tr>`
                    );
                    $(".deleteSavedScenario").off("click").on("click", function(){
                      deleteCompScenario(this);
                    });
                  }
                }
              },
              error: ()=>{
                Swal.fire({icon: 'error',text: 'Error! Failure in fetching the saved scenarios. Please try again.'});
              }
            });
            function deleteCompScenario(This) {
              var scenario_id = $(This).attr("data-scenario_id");

              $.ajax({
                url: `/users/${urlPath}/computationModule/`,
                data: {
                  'scenario_id': scenario_id,
                  'operation': 'delete_saved_scenarios',
                },
                type: "POST",
                dataType: "json",
                success: function (data) {
                  $(This).parent().closest("tr").remove();
                  Swal.fire({icon: 'success',text: 'Scenario deleted successfully!'});
                },
                error: ()=>{
                  Swal.fire({icon: 'error',text: 'Error! Failure in deleting the saved scenario. Please try again.'});
                }
              });
            }

            function initialise_table_results(table_id,element_id){
              data_table = $(`#${table_id}_${element_id}`).DataTable({
              "autoWidth": true,
              "scrollY": 400,
              "scrollX": 300,
              "scrollCollapse": true,
              "sScrollXInner": "100%",
              "ordering":false,
              orderCellsTop: true,
              responsive: true,
              colReorder: {
              fixedColumnsLeft: 1
              },
              // stateSave: true,
              "deferRender": true,
              "paging": true,
              "lengthMenu": [[1, 5, 50, -1], [1, 5, 50, "All"]],
              stripeClasses: false,
              "pageLength": 50,
              dom: 'lfBrtip',
              buttons: [
                  {
                  extend: 'collection',
                  text: 'Export',
                  buttons: [
                      {
                      extend: 'copy', title: '', exportOptions: {
                          columns: ':visible:not(.noVis)'
                      }
                      },
                      {
                      extend: 'excel', title: '', exportOptions: {
                          columns: ':visible:not(.noVis)'
                      }
                      },
                      {
                      extend: 'csv', title: '', exportOptions: {
                          columns: ':visible:not(.noVis)'
                      }
                      },
                      {
                      extend: 'pdf', title: '', exportOptions: {
                          columns: ':visible:not(.noVis)'
                      }
                      },
                  ],
                  },
                  {
                  extend: 'colvis',
                  className: "scroller",
                  }
                  ],
                  columnDefs: [
              {
                  targets: "_all",
                  className: 'dt-center allColumnClass all'
              },
              ],
            });
            }

            $("#scenarios_parallelogram06294754053258678").click(function(){
              var computationScenarioButtonText = $("#scenarios_parallelogram06294754053258678").html()
              $("#remove_1").remove();
              var model_element_id = $(this).attr('data-element_id')
              var model_name = $(`#modelName_${model_element_id}`).attr("data-model_name")
              $('#runModel_parallelogram06294754053258678').attr("data-scenario_part","yes");
              var show_error = false
              for(let i = 0; i < variableList_scenario.length; i++){
                if(variableList_scenario[i]["inputValue"] == ""){
                  show_error = true
                }
              }
              if(show_error == false) {

              $('#scenarios_parallelogram06294754053258678').empty()
              $('#scenarios_parallelogram06294754053258678').append(`<i class="fa fa-circle-notch fa-spin"></i> Loading`)
              $('#runModel_parallelogram06294754053258678').removeAttr("data-scenario_part");

              $.ajax({
                  url: `/users/${urlPath}/computationModule/`,
                  data: {
                    'model': model_name,
                    'type' : "new_scenario",
                    'operation': 'computation_scenario_tree',
                  },
                  type: "POST",
                  dataType: "json",
                  success: function (data) {
                    $('#scenarios_parallelogram06294754053258678').empty()
                    $('#scenarios_parallelogram06294754053258678').append(computationScenarioButtonText)
                    $("#remove_").remove();
                    $("#configure_comparative_"+model_element_id).parent().append(`<i id="remove_" style="font-size:40px;text-align:center;margin:10px;" class="fa fa-circle-notch fa-spin"></i>`)
                    var scenario_name = $(`#scenario_name_${model_element_id}`).val()
                    var variableList = [];
                    var elementIDGVar;
                    $(`#computationForm_${model_element_id}`).find("div.form-row").each(function(){
                      elementIDGVar = $(this).attr('data-parent_element_id');
                      $(this).find("div.form-group").each(function(){
                        if($(this).find('select').length === 0 ){
                          var varDict = {
                          varName:$(this).find("label").text(),
                          inputValue:$(this).find(`input`).val(),
                          };
                        }else{
                          var varDict = {
                          varName:$(this).find("label").text(),
                          inputValue:$(this).find(`select`).val(),
                          };
                        }
                        variableList.push(varDict);
                      });
                    });
                    if (scenario_name!=null){

                      $.ajax({
                        url: `/users/${urlPath}/computationModule/`,
                        data: {
                          'config': JSON.stringify({
                            model: $(`#modelName_${model_element_id}`).attr("data-model_name"),
                            configGlobalDict: variableList,
                            configGlobalFunc: [],
                          }),
                          'comparative_bool':"Yes",
                          'scenario_name': scenario_name,
                          'operation': 'run_scenario',
                        },
                        type: "POST",
                        dataType: "json",
                        success: function (data) {
                          $('#scenarios_parallelogram06294754053258678').empty()
                        $('#scenarios_parallelogram06294754053258678').append(computationScenarioButtonText)
                        $("#remove_").remove()

                                if (Object.keys(data).includes('inter_output_export_message_list')) {
                                    for (let i of data.inter_output_export_message_list) {
                                        if (i) {
                                            Swal.fire({icon: 'info',text: i});
                                        }
                                    }
                                };

                                if (data.element_error_message == 'Success') {
                                  $("#configure_comparative_"+model_element_id).attr("data-data",JSON.stringify(data.content))
                                  $("#configure_comparative_"+model_element_id).attr("data-model_name",model_name)
                                  $("#configure_comparative_"+model_element_id).attr("data-model_element_id",model_element_id)
                                  $("#remove_").remove()
                                  $("#configure_comparative_"+model_element_id).css("display","flex");
                                  $("#save_comparative_"+model_element_id).parent().css("display","block");
                                  $("#config_type_"+model_element_id).val("column_level").trigger("change")
                                  $("#identifier_column_"+model_element_id).attr("data-output_columns",data.output_columns)
                                  $("#identifier_column_"+model_element_id).empty()
                                  $("#comparative_column_"+model_element_id).empty()
                                  for(let [key,value] of Object.entries(data.content[0])){
                                    $("#identifier_column_"+model_element_id).append(`<option value="${key}">${key}</option>`);
                                    $("#comparative_column_"+model_element_id).append(`<option value="${key}">${key}</option>`);
                                  }
                                  let model__ = model_name

                                  $.ajax({
                                    url: `/users/${urlPath}/dynamicVal/`,
                                    data: {
                                      "operation":"fetchComparative",
                                      "model_name": model__,
                                    },
                                    type: "POST",
                                    dataType: "json",
                                    success: function (data) {
                                      if(!["NULL","None",undefined,null].includes(data.data)){
                                        $("#identifier_column_"+model_element_id).val(data.data.identifier).trigger("change");
                                        $("#comparative_column_"+model_element_id).val(data.data.comparative).trigger("change");
                                        let value = data.data.parameters
                                        for(j in data.data.identifier){
                                          for(let i = 0; i < value[data.data.identifier[j]].length; i++){
                                            $("#configure_parameter_"+model_element_id).find("#"+data.data.identifier[j]+"_"+model_element_id).val(value[data.data.identifier[j]]).trigger("change");
                                          }
                                        }
                                      }
                                    },
                                    failure: function () {
                                      Swal.fire({icon: 'warning',text: 'No process or subprocess exist.'});
                                    },
                                  });

                                } else {
                                  $("#remove_").remove()
                                  $("#configure_comparative_"+model_element_id).parent().append(`<span id="remove_" style="font-size:17.25px;text-align:center;margin:10px;">Model output table not detected.</span>`);
                                }
                        },
                        error: function () {
                          Swal.fire({icon: 'error',text: 'Error! Failure in running the scenario. Please try again.'});
                        }
                      })
                    } else {
                      $("#remove_").remove()
                      $("#configure_comparative_"+model_element_id).parent().append(`<span id="remove_" style="font-size:17.25px;text-align:center;margin:10px;">Model output table not detected.</span>`);
                    }
                    $(`.EBDisplayButtonIDDiv`).empty();
                    $(`#scenario_name_${model_element_id}`).val("").trigger("change");
                    $(`#element_incremental_data_${model_element_id}`).empty();
                    $(`#runWithBaseModel_${model_element_id}`).prop("checked", false);
                    $(`#scenario_configuration_date_${model_element_id}`).val("").trigger("change");
                    $(`#scenarioConfModal_${model_element_id}`).modal({backdrop: 'static', keyboard: false});
                    $(`#scenarioConfModal_${model_element_id}`).modal('show');
                    var chart_config = {
                      chart: {
                          container: `#model_inputs_scenario_${model_element_id}`,
                          levelSeparation: 50,
                          siblingSeparation: 60,
                          subTeeSeparation: 60,
                          nodeAlign: "CENTER",
                          connectors: {
                              type: 'step'
                          },
                          node: {
                              HTMLclass: 'nodeExample1',
                          }
                      },
                      nodeStructure: data.nodes,
                    };
                    var chart = new Treant(chart_config);
                    $('.nodeExample1').css('background','black')
                    $('.nodeExample1').css('color','white')
                    $('.nodeExample1').css('border-radius','0.5rem')
                    $(".data_model_input_new_scenario").hover(
                      function() {
                        $(this).addClass('shadow').css('cursor', 'pointer');
                      }, function() {
                        $(this).removeClass('shadow');
                      }
                    );
                    $('.csv_input').css('background','grey')
                    $('.node-title').css('margin','1rem')
                    $('.node-name').css('margin','1rem')
                    $('.model_names').css('background','var(--primary-color)')

                    $('.data_model_input_new_scenario').click(function(){
                      var element_identifier = $(this).attr('data-element_id');
                      var element_name_component = $(this).attr('data-element_name');
                      var scenario_name = $(`#scenario_name_${model_element_id}`).val();
                      if(scenario_name != ""){

                        $.ajax({
                            url: `/users/${urlPath}/computationModule/`,
                            data: {
                              'model': $(this).attr('data-model_name'),
                              'element_id': element_identifier,
                              'operation': 'computation_element_data',
                            },
                            type: "POST",
                            dataType: "json",
                            success: function (data) {
                              $(".existingDataHeader").text("Existing Data")
                              $(`#viewScenarioData_${model_element_id}`).empty()
                              $(`#viewScenarioData_${model_element_id}`).append(
                                `<div class="card shadow-sm  bg-white rounded;">
                                  <div class="card-body" style="padding:0.9rem;max-height:90">
                                      <table id="exampledataResultsScenario_${model_element_id}" class="display compact" style="width:100%;">
                                          <thead>
                                              <tr></tr>
                                          </thead>
                                          <tbody>
                                          </tbody>
                                      </table>
                                  </div>
                                </div>
                                <div class="card shadow-sm  bg-white rounded;">
                                <form id="incremental_data_${model_element_id}">
                                  <div class="card-header" style="">
                                    <h5 class="mb-0" style="text-align:center;">
                                      Configure Scenario Data
                                    </h5>
                                  </div>
                                  <div class="card-body" style="padding:0.9rem;">
                                    <div class="row">
                                      <div class="form-group col-4">
                                          <label for="selectScenarioDataType_${model_element_id}">Select scenario data type:</label>
                                          <select id="selectScenarioDataType_${model_element_id}" class="select2 form-control" name="selectScenarioDataType_${model_element_id}">
                                            <option value="upload_data">Upload data</option>
                                            <option value="equation_builder">Create with equation builder</option>
                                          </select>
                                        </div>
                                      </div>
                                    </div>
                                    <div class="row">
                                      <div class="form-group col-4" id="uploadData_${model_element_id}">
                                        <div class="custom-file" style="margin-left: 0.5rem;">
                                          <input type="file" class="custom-file-input"  accept=".csv" name="customFile">
                                          <label class="custom-file-label" for="customFile">Choose file</label>
                                        </div>
                                        <br>
                                        <br>
                                      </div>
                                      <div class="form-group col-4 EBDisplayButtonIDDiv" id="equationBuilder_${model_element_id}" style="display:none">
                                        <button style="color:aliceblue; margin-left: 0.5rem;" type="button" id="EBDisplayButtonID" class="btn btn-primary btn-md rounded">Equation builder</button>
                                      </div>
                                    </div>
                                    <div class="form-group col-4" style="display:flex">
                                      <label style="margin-left: 0.5rem;">Scenario type : </label>
                                      <div id="" class="custom-control custom-checkbox" style="margin-left:1%;">
                                        <input type="checkbox" name="defaultValueConfig" data-scenario_type="append" id="append${model_element_id}" class="checkboxinput custom-control-input" value="0">
                                        <label for="append${model_element_id}" class="custom-control-label">
                                          Append
                                        </label>
                                      </div>
                                      <div id="" class="custom-control custom-checkbox" style="margin-left:1%;">
                                        <input type="checkbox" name="defaultValueConfig" data-scenario_type="replace" id="replace${model_element_id}" class="checkboxinput custom-control-input" value="0">
                                        <label for="replace${model_element_id}" class="custom-control-label">
                                          Replace
                                        </label>
                                      </div>
                                    </div>
                                  <div class="form-group col-4" style="margin-left:0.4rem;display:None;">
                                      <label for="selectIdentifierColumns_${model_element_id}">Select identifier columns:</label>
                                      <select id="selectIdentifierColumns_${model_element_id}" class="select2 form-control" name="selectIdentifierColumns_${model_element_id}" multiple>
                                      </select>
                                  </div>
                                  <div class="form-group col-4" style="margin-left:0.4rem;display:None;">
                                    <label for="selectUpdateColumns_${model_element_id}">Select columns to update:</label>
                                    <select id="selectUpdateColumns_${model_element_id}" class="select2 form-control" name="selectUpdateColumns_${model_element_id}" multiple>
                                    </select>
                                  </div>
                                  </div>
                                  <div style="float:right;">
                                    <button type="button" id="addScenarioData_${model_element_id}" data-element_id = "${model_element_id}"  data-form_id = "incremental_data_${model_element_id}" data-element_id_component = "${element_identifier}" data-scenario_name = "${scenario_name}" data-element_name = "${element_name_component}" class="btn btn-primary btn-md mx-1 my-1 rounded px-2">Add scenario &nbsp;<i class="fas fa-plus"></i></button>
                                    <button type="button" id="quitScenarioData_${model_element_id}" class="btn btn-primary btn-md mx-2 rounded px-2" data-dismiss="modal">Close</button>
                                  </div>
                                </form>
                                </div>
                                `
                              );
                              $('select.select2:not(.modal select.select2)').each(function(){
                                parent = $(this).parent()
                                $(this).select2({dropdownParent:parent})
                              })
                              $('.modal select.select2').each(function(){
                                  $(this).select2()
                              })
                              for(i in data.columns_list){
                                $(`#selectIdentifierColumns_${model_element_id}`).append(`<option value="${data.columns_list[i]}">${data.columns_list[i]}</option>`)
                                $(`#selectUpdateColumns_${model_element_id}`).append(`<option value="${data.columns_list[i]}">${data.columns_list[i]}</option>`)
                              }
                              $(`#selectIdentifierColumns_${model_element_id}`).off('select2:select select2:unselect').on('select2:select select2:unselect', function(){
                                  $(`#selectUpdateColumns_${model_element_id}`).empty();
                                  let selIdentifier = $(this).val();
                                  for (i in data.columns_list) {
                                      if (selIdentifier.includes(data.columns_list[i]) == false){
                                          $(`#selectUpdateColumns_${model_element_id}`).append(new Option(data.columns_list[i], data.columns_list[i], false, false));
                                      };
                                  };
                              });
                              $(`#selectScenarioDataType_${model_element_id}`).select2();
                              $(`#selectScenarioDataType_${model_element_id}`).off("select2:select").on("select2:select", function(){
                                if ($(this).val() == "upload_data") {
                                  $(`#uploadData_${model_element_id}`).css("display", "");
                                  $(`#equationBuilder_${model_element_id}`).css("display", "none");
                                } else {
                                  $(`#uploadData_${model_element_id}`).css("display", "none");
                                  $(`#equationBuilder_${model_element_id}`).css("display", "");
                                }
                              });
                              $('[name="defaultValueConfig"]').change(function(){
                                if($(this).attr('data-scenario_type') == "replace"){
                                  $(`#selectIdentifierColumns_${model_element_id}`).parent().css('display','')
                                  $(`#selectUpdateColumns_${model_element_id}`).parent().css('display','')
                                }
                                else{
                                  $(`#selectIdentifierColumns_${model_element_id}`).parent().css('display','none')
                                  $(`#selectUpdateColumns_${model_element_id}`).parent().css('display','none')
                                }
                                if(this.checked){
                                  $('[name="defaultValueConfig"]').not(this).prop('checked', false);
                                }
                              });
                              $('#EBDisplayButtonID').attr('data-name',scenario_name+element_identifier)
                              eqBuilder(scenario_name,element_identifier,model_element_id)
                              
                              $(".custom-file-input").on("change", function() {
                                var fileName = $(this).val().split("\\").pop();
                                $(this).siblings(".custom-file-label").addClass("selected").html(fileName);
                              });
                              for (var i = 0; i < data.table[data.table_headers[0]].length; i++) {
                                  string=`<tr>`
                                  for(j in data.table_headers){
                                      string+=`<td style="text-align:center;">${data.table[data.table_headers[j]][i]}</td>`
                                  }
                                  string+=`</tr>`
                                  $(`#exampledataResultsScenario_${model_element_id}`).find('tbody').append(string)
                                  }

                              $(`#exampledataResultsScenario_${model_element_id} thead tr`).empty()
                              for(j in data.table_headers){
                                  $(`#exampledataResultsScenario_${model_element_id}`).find('thead tr').eq(0).append(`<th style="text-align:center;">${data.table_headers[j]}</th>`)
                              }
                              $(`#scenarioDataOutputModal_${model_element_id}`).modal('show')
                              initialise_table_results("exampledataResultsScenario",model_element_id)
                              $(`#addScenarioData_${model_element_id}`).attr('data-scenario_data_source','new_scenario')
                              $(`#addScenarioData_${model_element_id}`).attr('data-scenario_id','None')
                              $(`#addScenarioData_${model_element_id}`).click(saveIncrementalData)
                            },
                            error: function () {
                              Swal.fire({icon: 'error',text: 'Error! Failure in fetching the data from the Table. Please try again.'});
                          }
                        })
                      }
                      else{
                        Swal.fire({icon: 'warning',text: 'Please enter a scenario name.'});
                      }
                    })
                  },
                  error: function () {
                    Swal.fire({icon: 'error',text: 'Error! Failure in loading the scenario configuration. Please check your configuration and try again.'});
                      $('#scenarios_parallelogram06294754053258678').empty()
                      $('#scenarios_parallelogram06294754053258678').append(computationScenarioButtonText)
                  }
                })
                } else{
                  $("#computationForm_"+model_element_id).closest(".card-body").append(`<span id="remove_1" style="color:red;">Enter global variable</span>`);
                }
              })


              $("#run_scenario_parallelogram06294754053258678").click(function(){
                $("#run_scenario_parallelogram06294754053258678").html(`Loading &nbsp;<i class="fa fa-circle-notch fa-spin"></i>`)
                var model_element_id = $(this).attr('data-element_id')
                var scenario_name = $(`#scenario_name_${model_element_id}`).val()
                var variableList = [];
                var elementIDGVar;
                $(`#computationForm_${model_element_id}`).find("div.form-row").each(function(){
                  elementIDGVar = $(this).attr('data-parent_element_id');
                  $(this).find("div.form-group").each(function(){
                    if($(this).find('select').length === 0 ){
                      var varDict = {
                      varName:$(this).find("label").text(),
                      inputValue:$(this).find(`input`).val(),
                      };
                    }else{
                      var varDict = {
                      varName:$(this).find("label").text(),
                      inputValue:$(this).find(`select`).val(),
                      };
                    }
                    variableList.push(varDict);
                  });
                });
                $(`#computationForm_${model_element_id}`).find("div.form-row").each(function(){
                  elementIDGVar = $(this).attr('data-parent_element_id');
                  $(this).find("div.form-group").each(function(){
                    if ($(this).find(`input[name=gVarFileRM]`).attr("type") === 'file') {
                      let formData = new FormData($(this).find(`form.gVarFileInput`)[0]);
                      formData.append("operation", "gVarFileRunModel");
                      formData.append("gVarName", $(this).find("label.gVarNameLabel").text());
                      formData.append("elementID", elementIDGVar);

                      $.ajax({
                        url:`/users/${urlPath}/computationModule/`,
                        data: formData,
                        type: 'POST',
                        cache: false,
                        contentType: false,
                        processData: false,
                        success: function (data) {
                        },
                        error: ()=>{
                            Swal.fire({icon: 'error',text: 'Error! Please try again.'});
                        }
                      });
                    };
                  });
                });
                if (scenario_name!=null){
                  $.ajax({
                    url: `/users/${urlPath}/computationModule/`,
                    data: {
                      'config': JSON.stringify({
                        model: $(`#modelName_${model_element_id}`).attr("data-model_name"),
                        configGlobalDict: variableList,
                        configGlobalFunc: [],
                      }),
                      'scenario_name': scenario_name,
                      'operation': 'run_scenario',
                    },
                    type: "POST",
                    dataType: "json",
                    success: function (data) {
                      $(`#viewRunScenarioData_${model_element_id}`).empty()
                      $("#run_scenario_parallelogram06294754053258678").html(`Run Scenario &nbsp;<i class="fas fa-play"></i>`)
                      $(`#viewRunScenarioData_${model_element_id}`).append(
                        `<div class="card shadow-sm  bg-white rounded;">
                          <div class="card-body" style="padding:0.9rem;">
                              <table id="exampledataResultsScenarioRun_${model_element_id}" class="display compact" style="width:100%;">
                                  <thead>
                                      <tr></tr>
                                  </thead>
                                  <tbody>
                                  </tbody>
                              </table>
                          </div>
                        </div>
                        <div style="float:right;">
                            <button type="button" id="quitRunScenarioData_${model_element_id}" class="btn btn-primary btn-md mx-2 rounded px-2" data-dismiss="modal">Close</button>
                        </div>
                        `)
                        $(`#exampledataResultsScenarioRun_${model_element_id} tbody`).empty();
                        $(`#exampledataResultsScenarioRun_${model_element_id} thead tr`).empty()
                        for(let [key,value] of Object.entries(data.content[0]) ){
                            $(`#exampledataResultsScenarioRun_${model_element_id}`).find('thead tr').eq(0).append(`<th>${key}</th>`)
                        };
                        for (var i = 0; i < data.content.length; i++) {
                            string=`<tr>`
                            for(let [key,value] of Object.entries(data.content[i]) ){
                                string+=`<td>${value}</td>`
                                }
                            string+=`</tr>`
                            $(`#exampledataResultsScenarioRun_${model_element_id}`).find('tbody').append(string)
                        };
                        $(`#runscenarioDataOutputModal_${model_element_id}`).modal('show')
                        initialise_table_results("exampledataResultsScenarioRun",model_element_id)
                    },
                    error: function () {
                      Swal.fire({icon: 'error',text: 'Error! Failure in running the scenario. Please try again.'});
                    }
                  })
                }
              })

              $("#scenario_name_parallelogram06294754053258678").on('change',function(){
                var model_element_id = $(this).attr('data-element_id')
                var scenario_name = $(this).val();
                if (scenario_name!=""){
                  $.ajax({
                    url: `/users/${urlPath}/computationModule/`,
                    data: {
                      'model': $(`#modelName_${model_element_id}`).attr("data-model_name"),
                      'scenario_name': scenario_name,
                      'operation': 'validate_scenario_name',
                    },
                    type: "POST",
                    dataType: "json",
                    success: function (data) {
                      if (data.message == "exists") {
                        Swal.fire({icon: 'warning',text:"Scenario with the same name already exists. Please choose a unique name to proceed." });
                        $(`#scenario_name_${model_element_id}`).val("");
                      }
                    },
                    error: function () {
                      Swal.fire({icon: 'error',text: 'Error! Failure in validating the scenario name. Please check and try again.'});
                    }
                  });
                }
              });

              $("#save_scenario_parallelogram06294754053258678").click(saveScenario)
              $('#save_edited_scenario').off("click").on("click",saveScenario)
              function saveScenario(){
                var scenario_id = $(this).attr('data-scenario_id')
                var model_element_id = $(this).attr('data-element_id')
                if (scenario_id!='None'){
                  var scenario_name = $(`#scenario_name_`).val();
                  var runScenarioWithBaseModel = $(`#runWithBaseModel_`).prop("checked");
                  var scenario_configuration_date = $(`#scenario_configuration_date_`).val();
                }
                else{
                  var scenario_name = $(`#scenario_name_${model_element_id}`).val();
                  var runScenarioWithBaseModel = $(`#runWithBaseModel_${model_element_id}`).prop("checked");
                  var scenario_configuration_date = $(`#scenario_configuration_date_${model_element_id}`).val();
                }

                if (scenario_name!=null){
                  var scenarioArray = [];
                  if (scenario_id!='None'){
                    $(`#element_incremental_data_`).find("tr").each(function(){
                    if($(this).find("td").eq(0).attr('data-replace_identifier_list') === undefined){
                        var replace_identifier_list = []
                        var replace_column_list = []
                      }
                    else{
                      var replace_identifier_list = JSON.parse($(this).find("td").eq(0).attr('data-replace_identifier_list'))
                      var replace_column_list = JSON.parse($(this).find("td").eq(0).attr('data-replace_column_list'))
                    }
                    var scenario_config = {
                      element_id : $(this).find("td").eq(0).attr('data-element_component_id'),
                      scenario_type : $(this).find("td").eq(0).attr('data-scenario_type'),
                      scenario_type_scenarioData : $(this).find("td").eq(0).attr('data-scenario_type_scenarioData'),
                      scenario_data_type : $(this).find("td").eq(0).attr('data-scenario_data_type'),
                      replace_identifier_list: replace_identifier_list,
                      replace_column_list: replace_column_list,
                      element_name : $(this).find("td").eq(0).text(),
                    }
                    if ($(this).find("td").eq(0).attr('data-scenario_data_type') == "equation_builder"){
                      scenario_config["equation_editor_model"] = $(this).find("td").eq(0).attr('data-equation_editor_model')
                      scenario_config["base_model_name"] = $(`#modelName_${model_element_id}`).attr("data-model_name")
                    }
                    scenarioArray.push(scenario_config);
                  });
                  }
                  else{
                    $(`#element_incremental_data_${model_element_id}`).find("tr").each(function(){
                    var scenario_config = {
                        element_id : $(this).find("td").eq(0).attr('data-element_component_id'),
                        scenario_type : $(this).find("td").eq(0).attr('data-scenario_type'),
                        scenario_type_scenarioData : $(this).find("td").eq(0).attr('data-scenario_type_scenarioData'),
                        scenario_data_type : $(this).find("td").eq(0).attr('data-scenario_data_type'),
                        replace_identifier_list: JSON.parse($(this).find("td").eq(0).attr('data-replace_identifier_list')),
                        replace_column_list: JSON.parse($(this).find("td").eq(0).attr('data-replace_column_list')),
                        element_name : $(this).find("td").eq(0).text(),
                    }
                    if ($(this).find("td").eq(0).attr('data-scenario_data_type') == "equation_builder"){
                      scenario_config["equation_editor_model"] = $(this).find("td").eq(0).attr('data-equation_editor_model')
                      scenario_config["base_model_name"] = $(`#modelName_${model_element_id}`).attr("data-model_name")
                    }
                    scenarioArray.push(scenario_config);
                  });
                  }

                  $.ajax({
                    url: `/users/${urlPath}/computationModule/`,
                    data: {
                      'model': $(`#modelName_${model_element_id}`).attr("data-model_name"),
                      'scenarioList': JSON.stringify(scenarioArray),
                      'scenario_name': scenario_name,
                      'scenario_id': scenario_id,
                      'configuration_date': scenario_configuration_date,
                      'run_with_base': runScenarioWithBaseModel,
                      'operation': 'save_scenario',
                    },
                    type: "POST",
                    dataType: "json",
                    success: function (data) {
                      if (data.message != "success") {
                        Swal.fire({icon: 'info',text: data.message});
                      } else {
                        $(`#savedScenarioTable_${model_element_id}`).find("tr").each(function(){
                          if ($(this).find("td").eq(0).attr('data-scenario_id') == scenario_id) {
                            $(this).find("td").eq(0).text(scenario_name)
                          }
                        });
                        if(scenario_id =='None'){
                          $(`#savedScenarioTable_${model_element_id}`).append(
                            `<tr>
                              <td style="text-align: center;" data-element_id="${model_element_id}" data-scenario_id="${data.scenario_id}">${scenario_name}</td>
                              <td style="text-align: center;">
                                <i class="fas fa-trash deleteSavedScenario text-primary" data-scenario_id="${data.scenario_id}" data-element_id="${model_element_id}" data-title="Delete scenario"></i>
                                <i class="fa fa-eye text-primary"" onclick="viewCompScenario.call(this)" data-scenario_id="${data.scenario_id}" data-element_id="${model_element_id}" data-title="View scenario"></i>
                              </td>
                            </tr>`
                          );
                          $(".deleteSavedScenario").off("click").on("click", function(){
                            deleteCompScenario(this);
                          });
                        }
                        Swal.fire({icon: 'success',text: 'Scenario saved successfully!'});
                        $('#viewCompScenario').modal('hide')
                      }
                    },
                    error: function () {
                      Swal.fire({icon: 'error',text: 'Error! Failure in saving the scenario. Please try again.'});
                    }
                  })
                } else {
                  Swal.fire({icon: 'warning',text:'Scenario name connot be left blank. Please fill in a scenario name.' });
                }
              };

              $(document).on('show.bs.modal', '.modal', function () {
                var zIndex = 1040 + (10 * $('.modal:visible').length);
                $(this).css('z-index', zIndex);
                setTimeout(function() {
                    $('.modal-backdrop').not('.modal-stack').css('z-index', zIndex - 1).addClass('modal-stack');
                }, 0);
              });
            </script>
            
          <script>
          $('.span_content_editable').each(function () {
          $(this).on('click', function () {
            $(this).attr('data-currentName', $(this).text());
          $(this).attr("contenteditable", "true")
          $(this).focus()
          })
          $(this).focusout(function () {
          var tab_header = this.innerText
          tab_header = tab_header.trim()
          if (tab_header.length == 0){
              this.innerText = "Set Name"
              $(this).removeAttr("contenteditable");
              $(this).addClass("bg-danger")
              $(this).trigger("click")

          }
          else{
          $(this).removeAttr("contenteditable");
          $(this).removeClass("bg-danger")
          if (tab_header != $(this).attr('data-currentName')) {
            $(this).removeAttr("data-currentName");
            $.ajax({
                url: `/users/${urlPath}/ajax/tabConfig/`,

                data: {
                'operation': "update_tab_header_name_populate",
                'id': $(this).parent().parent().attr('data-tab_pk'),
                'user_name':'{{ user.get_username }}',
                'tab_header_name': tab_header,

                },
                type: "POST",
                dataType: "json",
                success: function (data) {


                },
                error: function () {
                Swal.fire({icon: 'error',text: 'Error! Please try again.'});
                }
            });
          }
          }

          })
      })
      var populateTabFuctionalities = function() {
      var tab_data = JSON.parse($(this).attr('data-data_list'));
      var tab_data_ordered = {};
      var count = 0;
      for(let [key,value] of Object.entries(tab_data)) {
        count++;
        for(let [key1,value1] of Object.entries(tab_data)) {
          if(count == parseInt(value1["order"])) {
            tab_data_ordered[key1] = {}
            tab_data_ordered[key1]["order"] = count
            tab_data_ordered[key1]["show"] = value1["show"]
          }
        }
      };
      $('#tabsMultiFuncBodyTable').find('tbody').empty();

      html_tab = ''
      id_gen = 0
      for(let [key,value] of Object.entries(tab_data_ordered)) {
        id_gen++
        html_tab = html_tab + `<tr style="text-align:center;background:#f3f3f3;cursor: move;" data-element_id='${key}'>`
        html_tab = html_tab +`<td minimum=1 maximum='${count}' data-value="${value["order"]}"><span class="ui-icon ui-icon-arrowthick-2-n-s mt-1" data-toggle="tooltip" title="Drag Up/ Down to reorder"></span></td>`
        if(value["show"] == "1") {
          html_tab = html_tab + `
          <td>
            <div class="d-flex">
              <div class="switch-container">
                <input class="float-right switch" type="checkbox" id="input${id_gen}" style="margin-right: 20rem;" name="input${id_gen}" value="input${id_gen}" checked>
                <div class="switch-color"><label class="trigger-label" for="input${id_gen}"></label></div>
                <label class="switch-label" for="input${id_gen}"></label>
              </div>
            </div>
          </td>`
        } else {
          html_tab = html_tab + `
          <td>
            <div class="d-flex">
              <div class="switch-container">
                <input class="float-right switch" type="checkbox" id="input${id_gen}" style="margin-right: 20rem;" name="input${id_gen}" value="input${id_gen}">
                <div class="switch-color"><label class="trigger-label" for="input${id_gen}"></label></div>
                <label class="switch-label" for="input${id_gen}"></label>
              </div>
            </div>
          </td>`
        }
        html_tab = html_tab + `<td><span class="tab_name_config" style="word-break:break-word;white-space:break-spaces;text-align:left;display:block;margin-left:10px;">${$('#'+key+'-tab').text()}</span></td></tr>`


      }
      $('#tabsMultiFuncBodyTable').find('tbody').append(html_tab)

      $("#tabsMultiFuncBodyTable tbody").disableSelection();

      $("#tabsMultiFuncBodyTable tbody").sortable({
        axis: "y",
        containment: "parent",
        cursor: "grabbing",
        handle: "td",
        helper: "original",
        opacity: 0.6,
        update: function(event, ui) {
          var sortedItems = $(this).find("tr");
          sortedItems.each(function(index) {
            $(this).find('td').eq(0).attr("data-value",index + 1);
          });
        },
      });

      $("#tabsMultiFuncBodyTable tbody tr").draggable({
        connectToSortable: "#tabsMultiFuncBodyTable tbody",
        helper: "original",
        revert: "invalid"
      }).draggable("enable");

    }
    var validation = function() {
      if(parseInt($(this).val()) < 1) {
        $(this).val(1).trigger('change')
      }
      if(parseInt($(this).val()) > parseInt($(this).attr('maximum'))) {
        $(this).val(parseInt($(this).attr('maximum'))).trigger('change')
      }
    }
    var saveTabsFunc = function() {
      $('#tabsMultiFunc').find('.modal-footer').find('button').html(`<i class="fa fa-circle-notch fa-spin"></i>`)
      var order_data = {}
      var validation = 0
      var len = $('#tabsMultiFuncBodyTable').find('tbody').find('tr').length;
      for(let j = 0; j < len; j++) {
        validation = 0
        var dummy = parseInt($('#tabsMultiFuncBodyTable').find('tbody').find('tr').eq(j).find('td').eq(0).attr('data-value'));
        for(let i = 0; i < len; i++) {
          var dummy1 = parseInt($('#tabsMultiFuncBodyTable').find('tbody').find('tr').eq(i).find('td').eq(0).attr('data-value'))
          if (dummy == dummy1) {
            validation = validation + 1;
            if(validation > 1) {
              break;
            }
          }
        }
        if(validation > 1) {
          break;
        }
        if(!dummy){
          validation = 2;
          break;
        }
      }
      if(validation < 2) {
        $('#tabsMultiFuncBodyTable').find('tbody').find('tr').each(function() {
          var ele_ids = $(this).attr('data-element_id')
          var show
          if ($(this).find('td').eq(1).find('input').prop('checked')){
            show = "1"
          } else {
            show = "0"
          }
          order_data[ele_ids] = {'tab_name':$(this).find('td').eq(2).text(),
              'data': {
                'order': String($(this).find('td').eq(0).attr('data-value')),
                'show': show
              }
          }
        });
        $.ajax({
        url: `/users/${urlPath}/processGraphModule/`,
        data: {
            'operation': 'saveTabOrder',
            'order_data': JSON.stringify(order_data),
            'pr_code':windowLocation.split('/')[4],
          },
          type: "POST",
          dataType:"json",
          success:function(data){
            $('#tabsMultiFunc').find('.modal-footer').html(`<button onclick="saveTabsFunc.call(this)" type="button" class="btn btn-primary">Save</button>`)
            window.location.reload();
          },
          error: function () {
            $('#tabsMultiFunc').find('.modal-footer').html(`<button onclick="saveTabsFunc.call(this)" type="button" class="btn btn-primary">Save</button>`)
            Swal.fire({icon: 'error',text: 'Error! Please try again.'});
          }
        })
      } else {
        $('#tabsMultiFunc').find('.modal-footer').html(`<button onclick="saveTabsFunc.call(this)" type="button" class="btn btn-primary">Save</button>`)
        Swal.fire({icon: 'warning',text: 'Order cannot be left blank or cannot be the same.'});
      }

    }
      </script>
          
        <script type="text/javascript" src="{% static 'js/Kore_TI_js/computation/computation.min.js' %}"></script>
        <script>
          var globalVariableID = []
          var process_level_filter_checks = {}
          var dependencies_check = {}
          $('.gVarDropDown').each(function() {
            var id = $(this).closest('.form-row').attr('data-parent_element_id');
            globalVariableID.push(id);
            let dropdown_var = $(this).parent().find('label').text().trim()
            if($(this).attr('has_process_level_filters')){
              process_level_filter_checks[dropdown_var] = $(this).attr('has_process_level_filters')
            }else{
              process_level_filter_checks[dropdown_var] = "no"
            }
            let dependencies = $(this).attr("dependencies")
            if(dependencies){
              if(JSON.parse(dependencies).length>0){
                dependencies_check[dropdown_var] = true
              }else{
                dependencies_check[dropdown_var] = false
              }
            }
          })
          if (globalVariableID.length) {
            var tab_element_id = $('.gVarDropDown:first').parent().parent().parent().attr('id').slice(16)
            $.ajax({
              url:`/users/${urlPath}/dynamicVal/`,
              data: {
                'operation':'popuplateGlobalVariable',
                'element_id_list': JSON.stringify(globalVariableID),
                'process_level_filter_checks': JSON.stringify(process_level_filter_checks),
                'tab_element_id': tab_element_id,
                'dependencies_check':JSON.stringify(dependencies_check)
              },
              type: 'POST',
              dataType: "json",
              success: function (data) {
                $('.gVarDropDown').each(function() {
                  var idGV = $(this).attr('name').split('gVar_')[1];
                  var listGV = data[idGV]
                  $(this).find('select').empty();
                  $(this).find('select').append('<option value="">---------</option>');
                  for(let i = 0; i < listGV.length; i++) {
                    $(this).find('select').append(`<option value="${listGV[i]}">${listGV[i]}</option>`);
                  }
                })
              },
              error: ()=>{
                Swal.fire({icon: 'error',text: 'Error! Please try again.'});
              }
            });
          }
        </script>
        <script>masterComputeExecutionHandler(computationElementIdsArray)</script>
        <script>masterComputePreviousRunDisplayHandler(previousRunComputeElementIdArray)</script>
        <script fetchpriority="low" type="text/javascript" src="{%static 'js/ebjavascript.min.js'%}" defer></script>
        