{% extends extend_template %}

{% block content %}
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.2/jspdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.5.0-beta4/html2canvas.min.js"></script>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/printThis/1.15.0/printThis.min.js"></script>
<script src='https://api.mapbox.com/mapbox-gl-js/v1.11.1/mapbox-gl.js'></script>
<link href='https://api.mapbox.com/mapbox-gl-js/v1.11.1/mapbox-gl.css' rel='stylesheet' />
<link rel="stylesheet" type="text/css" href="http://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css" />
<script src='https://cdnjs.cloudflare.com/ajax/libs/crossfilter/1.3.12/crossfilter.min.js'></script>
<link href="https://unpkg.com/tabulator-tables@4.3.0/dist/css/tabulator.min.css" rel="stylesheet">
<script type="text/javascript" src="https://unpkg.com/tabulator-tables@4.3.0/dist/js/tabulator.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.1.0-beta.1/js/select2.full.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.1.0-beta.1/css/select2.min.css" rel="stylesheet">
<script type="text/javascript" src="https://oss.sheetjs.com/sheetjs/xlsx.full.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.15/js/bootstrap-multiselect.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.15/css/bootstrap-multiselect.css" type="text/css"/>



<style>
    /* Dropdown Button */

    select.form-control option {
    color: black;
    font-weight: 300;
    font-family:Arial
    }

    .modal-dialog {
        max-width: 1300px;
        margin: 0.75rem auto;
    }

    .analysisDashboardmove {
        background-color: white;
    }

    .tabulator .tabulator-header .tabulator-col {
        background-color: var(--primary-color);
        color: white;
    }


    .dropbtn {
        background-color: white;
        color: black;
        padding: 1px;
        font-size: 30px;
        border: none;
    }

    .xaxislayer-above {
        /* cursor: pointer; */
        pointer-events: all;
    }

    .yaxislayer-above {
        /* cursor: pointer; */
        pointer-events: all;
    }

    /* The container <div> - needed to position the dropdown content */
    .dropdown {
        position: relative;
        display: inline-block;
    }

    /* Dropdown Content (Hidden by Default) */
    .dropdown-content {
        display: none;
        position: absolute;
        background-color: white;
        min-width: 110px;
        box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
        z-index: 1000;
    }

    .dropdown2-tab {
        position: relative;
        display: inline-block;
    }

    /* Dropdown Content (Hidden by Default) */
    .dropdown2-content-tab {
        display: none;
        position: absolute;
        background-color: white;
        min-width: 110px;
        box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
        z-index: 1000;
    }

    /* Links inside the dropdown */
    .dropdown-content div {
        color: black;
        padding: 2px 1px;
        text-decoration: none;
        display: block;
    }

    /* Change color of dropdown links on hover */
    .dropdown-content a:hover {
        background-color: #ddd;
    }

    /* Show the dropdown menu on hover */
    .dropdown:hover .dropdown-content {
        display: block;
    }

    .dropdown2-content-tab div {
        color: black;
        padding: 2px 1px;
        text-decoration: none;
        display: block;
    }

    /* Change color of dropdown links on hover */
    .dropdown2-content-tab a:hover {
        background-color: #ddd;
    }


    .modal-body {
            max-width: 100%;
            overflow-x: auto;
        }
</style>

<script>
    var crossFilterlist=[];


    $('#graph_subtype').on('change', function Dropdownrow() {

        var graph_subtype2 = document.getElementById("graph_subtype").value.split("|")[0]
        var graph_type2 = document.getElementById("graph_type").value.split("|")[0]
         // console.log(graph_subtype2)

        if (graph_subtype2 == "Nested Table"){
            console.log($('#tablecolumns'))

            $('#tablecolumnrow').empty()
            $("#tablecolumnrow").append(`<select id="tablecolumns" class="select2 form-control" name="tablecolumns" multiple></select>`)
            $("#tablegroupbyrow").append(`<select id="tablegroupby" class="select2 form-control" name="tablegroupby" multiple></select>`)
            $('select.select2:not(.modal select.select2)').each(function(){
                parent = $(this).parent()
                $(this).select2({dropdownParent:parent})
            })
            $('.modal select.select2').each(function(){
                $(this).select2()
            })
            document.getElementById('Datatabledropdowns').style.display = "block"
            $.ajax({
            url: '/graph_api/table_api',
            data: {"table_name":"report_mart"},
            type: "POST",
            dataType: "json",
            success: function (data) {
                console.log(data)
                for (var i = 0; i < data.length; i++) {
                    console.log(data[i])
                    $('#tablecolumns').append(new Option(data[i], data[i]));
                    $('#tablegroupby').append(new Option(data[i], data[i]));
                    console.log(new Option(data[i], data[i]))
                    console.log($('#tablecolumns'))
                   }
            }
            })

            $(`.select2-search__field`)[0].style.width = "100%"
            $(`.select2-search__field`)[1].style.width = "100%"
        }

    });
    var chartsavedata = []

    $('#plotButton').on('click', plotData);
    function plotData() {
        var graph_subtype2 = document.getElementById("graph_subtype").value.split("|")[0]
        var graph_type2 = document.getElementById("graph_type").value.split("|")[0]

        if (graph_subtype2 == "Vertical Bar" || graph_subtype2 == "Vertical Waterfall" || graph_subtype2 == "Horizontal Waterfall" || graph_subtype2 == "Funnel" || graph_subtype2 == "Funnel Area" || graph_subtype2 == "Horizontal Bar" || graph_subtype2 == "Line" || graph_subtype2 == "Stepped Line Graph" || graph_subtype2 == "Area" || graph_subtype2 == "Horizontal Area") {
            var entity = document.getElementById("entity_id").value;
            var date = document.getElementById("date_id").value;
            var model = document.getElementById("model_id").value;
            var x_axis = document.getElementById("x_axis").value;
            var y_axis = document.getElementById("y_axis").value;
            var second_column = document.getElementById("y_axis").value;
            var operation = document.getElementById("operation").value;
            var graph_type = document.getElementById("graph_type").value;
            var graph_subtype = document.getElementById("graph_subtype").value;
        }
        if (graph_subtype2 == "Vertical Histogram" || graph_subtype2 == "Horizontal Histogram" || graph_subtype2 == "Cumulative Histogram") {
            var entity = document.getElementById("entity_id").value;
            var date = document.getElementById("date_id").value;
            var model = document.getElementById("model_id").value;
            var x_axis = document.getElementById("x_axis_hist").value;
            var y_axis = document.getElementById("x_axis_hist").value;
            var second_column = document.getElementById("x_axis_hist").value;
            var operation = document.getElementById("x_axis_hist").value;
            var graph_type = document.getElementById("graph_type").value;
            var graph_subtype = document.getElementById("graph_subtype").value;
        }
        if (graph_subtype2 == "Stacked Histogram") {
            var entity = document.getElementById("entity_id").value;
            var date = document.getElementById("date_id").value;
            var model = document.getElementById("model_id").value;
            var x_axis = document.getElementById("x_axis_stackhist").value;
            var y_axis = document.getElementById("x_axis_stackhist2").value;
            var second_column = document.getElementById("x_axis_stackhist").value;
            var operation = document.getElementById("x_axis_stackhist").value;
            var graph_type = document.getElementById("graph_type").value;
            var graph_subtype = document.getElementById("graph_subtype").value;
        }
        if (graph_type2 == "Aggregation") {
            var entity = document.getElementById("entity_id").value;
            var date = document.getElementById("date_id").value;
            var model = document.getElementById("model_id").value;
            var x_axis = document.getElementById("x_axis_agg").value;
            var y_axis = document.getElementById("y_axis_agg").value;
            var second_column = document.getElementById("y_axis_agg2").value;
            var operation = document.getElementById("graph_subtype").value;
            var graph_type = document.getElementById("graph_type").value;
            var graph_subtype = document.getElementById("graph_subtype").value;
        }
        if (graph_subtype2 == "Angular Gauge" || graph_subtype2 == "Bullet Gauge") {
            var entity = document.getElementById("entity_id").value;
            var date = document.getElementById("date_id").value;
            var model = document.getElementById("model_id").value;
            var x_axis = document.getElementById("x_axisgauge").value;
            var y_axis = document.getElementById("y_axisgauge").value;
            var second_column = document.getElementById("y_axisgauge2").value;
            var operation = document.getElementById("operation_gauge").value;
            var graph_type = document.getElementById("graph_type").value;
            var graph_subtype = document.getElementById("graph_subtype").value;
        }
        if (graph_subtype2 == "Pie Chart" || graph_subtype2 == "Donut Chart" || graph_subtype2 == 'Treemap') {
            var entity = document.getElementById("entity_id").value;
            var date = document.getElementById("date_id").value;
            var model = document.getElementById("model_id").value;
            var x_axis = document.getElementById("x_axispie").value;
            var y_axis = document.getElementById("y_axispie").value;
            var second_column = document.getElementById("y_axispie").value;
            var operation = document.getElementById("operationpie").value;
            var graph_type = document.getElementById("graph_type").value;
            var graph_subtype = document.getElementById("graph_subtype").value;
        }
        if (graph_subtype2 == "Scatter" || graph_subtype2 == "2D Histogram Contour" || graph_subtype2 == "Vertical Box" || graph_subtype2 == "Horizontal Box" || graph_subtype2 == "Horizontal Dot Plot" || graph_subtype2 == "Scatter with Straight Lines and Markers" || graph_subtype2 == "Vertical Violin" || graph_subtype2 == "Horizontal Violin") {
            var entity = document.getElementById("entity_id").value;
            var date = document.getElementById("date_id").value;
            var model = document.getElementById("model_id").value;
            var x_axis = document.getElementById("x_axisscatter").value;
            var y_axis = document.getElementById("y_axisscatter").value;
            var second_column = document.getElementById("y_axisscatter").value;
            var graph_type = document.getElementById("graph_type").value;
            var graph_subtype = document.getElementById("graph_subtype").value;
        }
        if (graph_subtype2 == "Vertical Bar Stacked" || graph_subtype2 == "Vertical Grouped Violin" || graph_subtype2 == "Vertical Grouped Box" || graph_subtype2 == "Vertical Bar Grouped" || graph_subtype2 == "Vertical Line Stacked" || graph_subtype2 == "Vertical Area Stacked" || graph_subtype2 == "Vertical Waterfall Grouped") {
            var entity = document.getElementById("entity_id").value;
            var date = document.getElementById("date_id").value;
            var model = document.getElementById("model_id").value;
            var x_axis = document.getElementById("x_axis2").value;
            var y_axis = document.getElementById("y_axis2").value;
            var second_column = document.getElementById("y_axis3").value;
            var operation = document.getElementById("operation2").value;
            var graph_type = document.getElementById("graph_type").value;
            var graph_subtype = document.getElementById("graph_subtype").value;
        }
        if (graph_subtype2 == "Horizontal Bar Stacked" || graph_subtype2 == "Horizontal Grouped Violin" || graph_subtype2 == "Horizontal Area Stacked" || graph_subtype2 == "Horizontal Grouped Box" || graph_subtype2 == "Horizontal Bar Grouped" || graph_subtype2 == "Horizontal Waterfall Grouped" || graph_subtype2 == 'Funnel Stacked') {
            var entity = document.getElementById("entity_id").value;
            var date = document.getElementById("date_id").value;
            var model = document.getElementById("model_id").value;
            var x_axis = document.getElementById("x_axish").value;
            var y_axis = document.getElementById("y_axish").value;
            var second_column = document.getElementById("x_axis2h").value;
            var operation = document.getElementById("operation4").value;
            var graph_type = document.getElementById("graph_type").value;
            var graph_subtype = document.getElementById("graph_subtype").value;
        }
        if (graph_subtype2 == "Sunburst" || graph_subtype2 == "Bubble Map" || graph_subtype2 == "Chloropeth Map") {
            var entity = document.getElementById("entity_id").value;
            var date = document.getElementById("date_id").value;
            var model = document.getElementById("model_id").value;
            var x_axis = document.getElementById("x_axissunburst").value;
            var y_axis = document.getElementById("y_axissunburst").value;
            var second_column = document.getElementById("y_axissunburst2").value;
            var operation = document.getElementById("operationsunburst").value;
            var graph_type = document.getElementById("graph_type").value;
            var graph_subtype = document.getElementById("graph_subtype").value;
        }
        if (graph_subtype2 == "3D Scatter Plot" || graph_subtype2 == "3D Mesh Plot") {
            var entity = document.getElementById("entity_id").value;
            var date = document.getElementById("date_id").value;
            var model = document.getElementById("model_id").value;
            var x_axis = document.getElementById("x_axis3D").value;
            var y_axis = document.getElementById("y_axis3D").value;
            var second_column = document.getElementById("z_axis3D").value;
            var operation = document.getElementById("z_axis3D").value;
            var graph_type = document.getElementById("graph_type").value;
            var graph_subtype = document.getElementById("graph_subtype").value;
        }
        if (graph_subtype2 == "Nested Table"){
            var entity = document.getElementById("entity_id").value;
            var date = document.getElementById("date_id").value;
            var model = document.getElementById("model_id").value;
            var x_axis = JSON.stringify($("#tablecolumns").val());
            var y_axis = JSON.stringify($('#tablegroupby').val());
            var second_column = $('#graph_type').val();
            var operation = $("#graph_type").val();
            var graph_type = document.getElementById("graph_type").value;
            var graph_subtype = document.getElementById("graph_subtype").value;
        }
        color = '#b8860b'
        var plotDict = { 'second_column': second_column, 'entity': entity, 'date': date, 'model': model, 'color': color, 'x_axis': x_axis, 'y_axis': y_axis, 'operation': operation, "graph_type": graph_type, "graph_subtype": graph_subtype };
        console.log(plotDict)
        plotFunction(plotDict)
    };

    function plotFunction(plotDict) {

         // console.log(plotDict)
        if (plotDict.graph_type === undefined) {
            var ajaxdata = {
                "plotDict": JSON.stringify(plotDict),
                'entity': plotDict.entity,
                'date': plotDict.date,
                'model': plotDict.model,
                'x_axis': plotDict.x_axis,
                'y_axis': plotDict.y_axis,
                'second_column': plotDict.second_column,
                'operation': plotDict.operation,
                'graph_subtype': plotDict.graph_subtype,
            }
             // console.log("undefined2")
             // console.log(ajaxdata)
        }
        else {
            var ajaxdata = {
                'entity': plotDict.entity,
                'date': plotDict.date,
                'model': plotDict.model,
                'x_axis': plotDict.x_axis,
                'y_axis': plotDict.y_axis,
                'second_column': plotDict.second_column,
                'operation': plotDict.operation,
                'graph_type': plotDict.graph_type,
                'graph_subtype': plotDict.graph_subtype,
                'color': plotDict.color,

            }
        }

        $.ajax({
            url: '/dashboard/render_plot',

            data: ajaxdata,
            type: "POST",
            dataType: "json",
            success: function (data) {
                 // console.log('success')
                 // console.log(data)
                try {
                    $('.modalgraphs').each(function () {
                        $(this)[0].style.display = "none"
                         // console.log($(this))
                    })

                }
                catch (err) {
                    ;
                }
                var chartDivId = data.chartDivId + (Math.random()).replace('.','')
                var graph_subtype = data.graph_subtype
                var entity = data.entity
                var model = data.model
                var date = data.date
                var x_axis = data.x_axis
                var operation = data.operation
                var y_axis = data.y_axis
                var second_column = data.second_column

                var id = chartDivId
                var id1 = chartDivId + 'color'
                var id2 = chartDivId + 'x_range'
                var id3 = chartDivId + 'y_range'
                var id4 = chartDivId + 'color2'
                var id5 = chartDivId + 'cancel'
                var id6 = chartDivId + 'card'
                var id7 = chartDivId + 'modal'
                var id8 = chartDivId + 'edit'
                var id9 = chartDivId + 'gridlines'
                var id10 = chartDivId + 'modalclose'
                var id11 = chartDivId + 'xtitle'
                var id12 = chartDivId + 'ytitle'
                var id13 = chartDivId + 'labeledit'
                var id14 = chartDivId + 'legend1'
                var id15 = chartDivId + 'legend2'
                var id16 = chartDivId + 'tabbutton'
                var id17 = chartDivId + 'tabdropdown'
                var id18 = chartDivId + 'resetlabels'
                var id19 = chartDivId + 'hiddendiv'
                var id_labels = chartDivId + 'labels'
                var id_table = chartDivId + 'table'
                var id_tableshow = chartDivId + 'id_tableshow'
                var id_tableicon = chartDivId + 'id_tableicon'

                 // console.log(data.plotDict)
                 // console.log(graph_subtype)

                if (data.plotDict === undefined) {
                    var outerCard = $(`<div class="card col-5 m-4 charts" id=${id6}>
<div class="card-header" style="padding: 0.2rem 0.2rem; margin : 0.2 rem">
    <div class="row">
<div class = "col-md-11"  style = "padding-right: 0.1rem">
<h5 class"card-title" style="margin-top: 0.5rem; line-height: 1.2"><span class="contentEditable">${data.chartHeader}</span></h5>  </div>
<div class = "col-md-1" style = "padding-left:0px; padding-right: 1rem;padding-top: 0.5rem">
        <div class="dropdown">
            <i class="fa fa-cog" style="font-size:20px"></i>
  <div class="dropdown-content" style="right: 0rem; top: 1.5rem">
  <div class="row" style="font-size:1rem; padding-left:0.95rem" id=${id8}> <button type="button" style="border-width:0px;padding: 1px 1px;background-color: white;"> &nbsp; <i class="fa fa-edit fa-lg"  id=${id8} style="font-size:1.3rem;padding-top: 0.1rem;color:var(--primary-color)"></i> Configure</button></div>
  <div class="row handle_for_draggable_charts" style="font-size:1rem; padding-left:0.8rem">&nbsp; <i class="fa fa-arrows fa-lg" style="font-size:1.2rem ; padding-top: 0.3rem; color:var(--primary-color)"></i>&nbsp; Move</div>
  <div class="row" style="font-size:1rem; padding-left:0.95rem" id=${id_tableshow}> <button type="button" style="border-width:0px;padding: 1px 1px;background-color: white;"> &nbsp; <i class="fa fa-table fa-lg" style="font-size:1.3rem;padding-top: 0.5rem;color:var(--primary-color)"></i> <span id=${id_tableicon}> Table</span></button></div>
  <div class="row" id=${id5} style="font-size:1rem; padding-left:1rem"><button type="button" style="border-width:0px;padding: 1px 1px;background-color: white;"> &nbsp;<i class="fa fa-times fa-lg"  style="font-size:1.4rem;color:var(--primary-color)"></i>&nbsp; Delete</button></div>
  <div class="row" id=${id16} style="font-size:1rem; padding-left:1.3rem"><div class="dropdown2-tab"><button type="button" style="border-width:0px;padding: 1px 1px;background-color: white;"> <i class="fa fa-copy fa-lg" style="font-size:1.2rem;color:var(--primary-color)"></i>&nbsp; Copy </button>  <div class="dropdown2-content-tab" id = ${id17} style="right: 8rem; top: 0rem; display:none; z-index:1100; min-width: 80px;">
</div>
</div>
</div>
  </div>
</div>
  </div>
</div>

                  <div style="height:10px"></div>


</div>

<div class="graphcontainerdiv"><div class="card-body-graph" id=${id}></div>
    </div>
<div class="tablecontainerdiv"><div class="card-body-table" id=${id_table} style="display:none"></div>
    </div>
</div>`)

                }
                else {
                    var width = data.plotDict.width + "px"
                    var height = data.plotDict.height + "px"
                    var styletop = data.plotDict.position.top + "px"
                    var left = data.plotDict.position.left + "px"
                    var chartheader = data.plotDict.chartheader
                    var outerCard = $(`<div class="card charts" id=${id6} style="position:absolute;width:${width};height:${height};top:${styletop};left:${left}">
<div class="card-header" style="padding: 0.2rem 0.2rem; margin : 0.2 rem">
    <div class="row">
<div class = "col-md-11"  style = "padding-right: 0.1rem">
<h5 class"card-title" style="margin-top: 0.5rem; line-height: 1.2"><span class="contentEditable">${chartheader}</span></h5>  </div>
<div class = "col-md-1" style = "padding-left:0px;padding-right: 1rem;padding-top: 0.5rem"">
        <div class="dropdown">
            <i class="fa fa-cog" style="font-size:20px"></i>
  <div class="dropdown-content" style="right: 0rem; top: 1.5rem">
  <div class="row" style="font-size:1rem; padding-left:0.95rem" id=${id8}> <button type="button" style="border-width:0px;padding: 1px 1px;background-color: white;"> &nbsp; <i class="fa fa-edit fa-lg"  id=${id8} style="font-size:1.3rem;padding-top: 0.1rem;color:var(--primary-color)"></i> Configure</button></div>
  <div class="row handle_for_draggable_charts" style="font-size:1rem; padding-left:0.8rem">&nbsp; <i class="fa fa-arrows fa-lg" style="font-size:1.2rem ; padding-top: 0.3rem; color:var(--primary-color)"></i>&nbsp; Move</div>
  <div class="row" style="font-size:1rem; padding-left:0.95rem" id=${id_tableshow}> <button type="button" style="border-width:0px;padding: 1px 1px;background-color: white;"> &nbsp; <i class="fa fa-table fa-lg" style="font-size:1.3rem;padding-top: 0.5rem;color:var(--primary-color)"></i> <span id=${id_tableicon}> Table</span></button></div>
  <div class="row" id=${id5} style="font-size:1rem; padding-left:1rem"><button type="button" style="border-width:0px;padding: 1px 1px;background-color: white;"> &nbsp;<i class="fa fa-times fa-lg"  style="font-size:1.4rem;color:var(--primary-color)"></i>&nbsp; Delete</button></div>
  <div class="row" id=${id16} style="font-size:1rem; padding-left:1.3rem"><div class="dropdown2-tab"><button type="button" style="border-width:0px;padding: 1px 1px;background-color: white;"> <i class="fa fa-copy fa-lg" style="font-size:1.2rem;color:var(--primary-color)"></i>&nbsp; Copy </button>  <div class="dropdown2-content-tab" id = ${id17} style="right: 8rem; top: 0rem; display:none; z-index:1100; min-width: 80px;">
</div>
</div>
</div>
  </div>
</div>
  </div>
</div>

                  <div style="height:10px"></div>


</div>

<div class="graphcontainerdiv"><div class="card-body-graph" id=${id}></div>
    </div>
<div class="tablecontainerdiv"><div class="card-body-table" id=${id_table} style="display:none"></div>
    </div>
</div>`)
                    // var outerCardhidden = $(`<div class="card duplicate" id=${id19} style="visibility:hidden;opacity:0; width:${width};height:${height};top:${styletop};left:${left}">`)
                }


                if (graph_subtype == 'Vertical_Bar') {


                    var outermodalCard = $(`

  <div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
  right: 0 ;top : 10px;z-index: 1050">


    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
        <button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <label style="font-size:1.1rem">Change the graph color:</label>
    <input type="color" id=${id1} name="favcolor" value="#b8860b"><br><br>
    <label style="font-size:1.1rem">Change the color or an element:</label>
    <input type="color" id=${id4} name="favcolor1" value="#b8860b"><br><br><label style="font-size:1.1rem">Change X and Y axis gridlines:</label>
        <button type="button" class="btn btn-primary" id="${id9}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" value="show_gridlines" style="line-height: 1.1;">Show Gridlines</button><br><br>
                        <label style="font-size:1.1rem">Change the range of the axis:</label>
    <input type="text" placeholder="Y Axis Start" id=${id2} size="7">
    <input type="text" placeholder="Y Axis End " id=${id3} size="7">
<br><br>
<label style="font-size:1.1rem">Change the title of the axes:</label>
    <input type="text" placeholder="X Axis Title" id=${id11} size="7">
    <input type="text" placeholder="Y Axis Title" id=${id12} size="7">
    <br><br>
<label style="font-size:1.1rem">Change the label of an element:</label><br>
    <input type="text" placeholder="X Axis Label" id=${id13} size="9"> &nbsp;&nbsp;
    <button type="button" class="btn btn-primary" id="${id18}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" style="line-height: 1.1;">Reset Axis Labels</button><br><br>
                        <label style="font-size:1.1rem">Change Plot Labels:</label>
        <button type="button" class="btn btn-primary" id="${id_labels}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" value="show_labels" style="line-height: 1.1;">Show Labels</button>
    </div>
</div>
 `)
                    if (data.plotDict === undefined) {

                        outerCard.appendTo('#card')
                        var tab_id = 'main_page'
                        outermodalCard.appendTo('#card')

                        var colorlength = data.x_axisdata.length
                        var colordata = [];
                        var x_axis = data.x_axis
                        var y_axis = data.y_axis
                        var x_axisdata2 = JSON.parse(JSON.stringify(data.x_axisdata))

                        for (var i = 0; i < colorlength; i++) {
                            colordata.push('#b8860b');
                        }
                         // console.log(colordata)
                        var tabledata = []
                        var tableheaders = [`<b>${x_axis}</b>`,`<b>${y_axis}</b>`]

                        tabledata.push(data.x_axisdata)
                        tabledata.push(data.y_axisdata)

                        var trace1 = {
                            x: data.x_axisdata,
                            y: data.y_axisdata,
                            type: 'bar',
                            marker: {
                                color: colordata
                            }
                        };

                        var dataplot = [trace1]
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)

                        var layout = {
                            margin: { l: 40, r: 0, b: 20, t: 10, pad: 4 },
                            yaxis: {
                                title: {
                                    standoff: 20,
                                    text: y_axis, font: {
                                        family: "Arial"
                                    }
                                }, showgrid: false, 'automargin': true, font: {
                                    family: "Arial"
                                }
                            },
                            xaxis: {
                                title: {
                                    standoff: 20,
                                    text: x_axis, font: {
                                        family: "Arial"
                                    }
                                },
                                showgrid: false, 'automargin': true, font: {
                                    family: "Arial"
                                }
                            },
                            autosize: true
                        }

                        var trace2 = {
                            domain : {x : [0, 1], y:[0, 1]},
                            header:{
                                align: "center",
                                values:tableheaders,
                                font: {family: "Arial", size: 13, color: ["white"]},
                                fill: {color: 'var(--primary-color)'}
                            },
                            cells: {
                                align: "center",
                                values: tabledata,
                                font: {family: "Arial", size: 13, color: ["black"]}
                            },
                            type: 'table'
                        };
                        var layout2 = {
                            margin: { l: 10, r: 10, b: 10, t: 10, pad: 1 },
                        }
                        var datatable = [trace2]
                    }
                    else {
                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tab_id = data.plotDict.tab_id
                        outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                        // var d3 = Plotly.d3;
                        // var img_jpg= d3.select(`#${id}`);
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)
                        var dataplot = data.plotDict.data
                        var tableheaders = [`<b>${data.x_axis}</b>`,`<b>${data.y_axis}</b>`]
                        var tabledata = []

                        tabledata.push(data.x_axisdata)
                        tabledata.push(data.y_axisdata)
                        console.log(tableheaders)
                        console.log(tabledata)
                        var trace2 = {
                            domain : {x : [0, 1], y:[0, 1]},
                            header:{
                                align: "center",
                                values:tableheaders,
                                font: {family: "Arial", size: 13, color: ["white"]},
                                fill: {color: 'var(--primary-color)'}
                            },
                            cells: {
                                align: "center",
                                values: tabledata,
                                font: {family: "Arial", size: 13, color: ["black"]}
                            },
                            type: 'table'
                        };
                        var layout2 = {
                            margin: { l: 10, r: 10, b: 10, t: 10, pad: 1 },
                        }
                        var datatable = [trace2]

                        dataplot[0].x = data.x_axisdata
                        dataplot[0].y = data.y_axisdata
                        delete dataplot[0]["selectedpoints"]
                         // console.log(dataplot)

                        var x_axisdata2 = JSON.parse(JSON.stringify(data.x_axisdata))
                        var layout = data.plotDict.layout

                        var width = width.split("p")
                        var height = height.split("p")

                        var graph_height = height[0] * 0.876
                        var graph_width = width[0] * 0.9481

                        layout["height"] = graph_height
                        layout["width"] = graph_width

                         // console.log(layout)
                        var colorlength = data.x_axis.length
                    }
                    var config = { responsive: true, displaylogo: false}
                    Plotly.newPlot(tester, dataplot, layout, config)

    //                 .then(
    //                 function(gd)
    //                 {
    //                 Plotly.toImage(gd,{
    //                 format:'svg'})
    //                     .then(
    //                         function(url)
    //                     {
    //                         img_jpg.attr("src", url);
    //                     }
    //                     )
    // });
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype,'tab_id':tab_id})

                    var y_axis_end = tester.layout.yaxis.range[1]
                    var y_axis_start = tester.layout.yaxis.range[0]

                    document.getElementById(id_tableshow).onclick = function () {
                        console.log(document.getElementById(id_tableicon).innerText)
                    if (document.getElementById(id_tableicon).innerText == 'Table'){
                        document.getElementById(id_tableicon).innerText = 'Graph'
                        console.log($(`#${id_tableicon}`))
                        document.getElementById(id).style.display = "none"
                        document.getElementById(id_table).style.display = "block"
                        console.log(datatable)
                        var datatablediv = document.getElementById(id_table)
                        Plotly.newPlot(datatablediv, datatable, layout2,config);
                    }
                    else{
                        document.getElementById(id_tableicon).innerText = 'Table'
                        document.getElementById(id).style.display = "block"
                        document.getElementById(id_table).style.display = "none"
                    }
                    }

                    document.getElementById(id1).onchange = function () {
                        var colorlength = data.x_axis.length
                         // console.log(colorlength)
                        var colordata2 = [];
                        var backRGB = this.value;

                        for (var i = 0; i < colorlength; i++) {
                            colordata2.push(backRGB);
                        }
                         // console.log(colordata2)

                        var update = { 'marker': { color: colordata2 } };

                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }

                    document.getElementById(id2).onchange = function () {
                        var textbox2length = document.getElementById(id3).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var y_axis_end = tester.layout.yaxis.range[1]
                        var gridlines_value = tester.layout.yaxis.showgrid
                        var y_axis_title = tester.layout.yaxis.title.text

                         // console.log(textbox2length)
                         // console.log(y_axis_end)

                        if (textbox2length == 0) {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, y_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        }
                        else {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))
                    }
                    document.getElementById(id3).onchange = function () {
                        var textbox1length = document.getElementById(id2).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var gridlines_value = tester.layout.yaxis.showgrid
                        var y_axis_title = tester.layout.yaxis.title.text
                         // console.log(gridlines_value)

                        if (textbox1length == 0) {
                            var layout = {
                                yaxis: {
                                    range: [y_axis_start, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        }
                        else {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id11).onchange = function () {
                        var xaxistitlevalue = document.getElementById(id11).value;

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(xaxistitlevalue)
                         // console.log(tester.layout.xaxis.title)

                        var layout = {
                            xaxis: {
                                showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: xaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }


                        }
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }

                    document.getElementById(id12).onchange = function () {
                        var yaxistitlevalue = document.getElementById(id12).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var y_axis_end = tester.layout.yaxis.range[1]

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(yaxistitlevalue)
                         // console.log(tester.layout.yaxis.title)

                        var layout = {
                            yaxis: {
                                range: [y_axis_start, y_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: yaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }
                        }

                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }

                    myPlot.on('plotly_click', function (data) {
                        var filter = data.points[0].label
                        var filtercolumn = x_axis
                        $( "#drilldowncontainer" ).empty();
                        document.getElementById("drilldowncontainer").style.height = ""
                        $("#drilldownmodal").modal("show")

                        $.ajax({
                            url: '/dashboard/drilldown_plot',

                            data: {
                                "filter" : filter,
                                "filtercolumn" : filtercolumn,
                                "entity" : entity,
                                "model" : model,
                                "date" : date,
                            },
                            type: "POST",
                            dataType: "json",
                            success: function (data) {

                                var CLICK_TIME = Date.now()
                                // console.log(data)
                                // var columnwidth = []
                                // for (var i = 0; i <data.tableheaders.length; i++) {
                                //     columnwidth.push(1000)
                                // }
                                // var drilldowndiv = document.getElementById("drilldowncontainer")
                                // var trace = {
                                //     columnwidth: columnwidth ,
                                //     header:{
                                //         align: "center",
                                //         values:data.tableheaders,
                                //         font: {family: "Arial", size: 13, color: ["white"]},
                                //         fill: {color: 'var(--primary-color)'}
                                //     },
                                //     cells: {
                                //         align: "center",
                                //         values: data.tablevalues,
                                //         font: {family: "Arial", size: 13, color: ["black"]}
                                //     },
                                //     type: 'table'
                                // };
                                // var layout = {
                                //     margin: { l: 10, r: 10, b: 10, t: 10, pad: 1 },
                                //     width: 1800,
                                // }
                                // var datatable = [trace]
                                // var config = { responsive: true, displaylogo: false}
                                // console.log(drilldowndiv)
                                // Plotly.newPlot(drilldowndiv, datatable, layout, config)
                                // console.log(drilldowndiv.data)
                                var fieldEl = document.getElementById("filter-field");
                                var typeEl = document.getElementById("filter-type");
                                var valueEl = document.getElementById("filter-value");

                                //Custom filter example
                                function customFilter(data){
                                    return data.car && data.rating < 3;
                                }

                                //Trigger setFilter function with correct parameters
                                function updateFilter(){
                                var filterVal = fieldEl.options[fieldEl.selectedIndex].value;
                                var typeVal = typeEl.options[typeEl.selectedIndex].value;

                                var filter = filterVal == "function" ? customFilter : filterVal;

                                if(filterVal == "function" ){
                                    typeEl.disabled = true;
                                    valueEl.disabled = true;
                                }else{
                                    typeEl.disabled = false;
                                    valueEl.disabled = false;
                                }

                                if(filterVal){
                                    table.setFilter(filter,typeVal, valueEl.value);
                                }
                                }

                                //Update filters on value change
                                document.getElementById("filter-field").addEventListener("change", updateFilter);
                                document.getElementById("filter-type").addEventListener("change", updateFilter);
                                document.getElementById("filter-value").addEventListener("keyup", updateFilter);

                                //Clear filters on "Clear Filters" button click
                                document.getElementById("filter-clear").addEventListener("click", function(){
                                // fieldEl.value = "";
                                // typeEl.value = "=";
                                // valueEl.value = "";

                                // table.clearFilter();
                                table.download("xlsx", "data.xlsx", {sheetName:"MyData"});
                                });

                                var table = new Tabulator("#drilldowncontainer", {
                                    data:data.tablevalues,             //load row data from array
                                    layout:"fitColumns",      //fit columns to width of table
                                    height:500,       //allow row order to be changed
                                    width:1000,
                                    virtualDom:true,
                                    paginationSize:20,
                                //     groupBy:["portfolio_code", "product_group"],
                                //     groupStartOpen:[false, false],
                                //     groupToggleElement:"header",
                                //     groupHeader:[
                                //     function(value, count, data){ //generate header contents for gender groups
                                //         return value + "<span style='color:black'>(" + count + " items)</span>";
                                //     },
                                //     function(value, count, data){ //generate header contents for color groups
                                //         return value + "<span style='color:black'>(" + count + " items)</span>";
                                //     },
                                // ],
                                    pagination:"local", // send parameters to the server as a JSON encoded string   //allow row order to be changed
                                    columns:[                 //define the table columns
                                        {title:"entity", field:"entity",headerFilter:"input"},
                                        {title:"from_date", field:"from_date",headerFilter:"input"} ,
                                        {title:"model_name", field:"model_name",headerFilter:"input"},
                                        {title:"instu_id", field:"instu_id",headerFilter:"input"},
                                        {title:"product_group", field:"product_group",headerFilter:"input"},
                                        {title:"outstanding_LCY", field:"outstanding_LCY",headerFilter:"input"},
                                        {title:"portfolio_code", field:"portfolio_code",headerFilter:"input"},
                                    ],
                                });

                                console.log(Date.now() - CLICK_TIME)

                            },
                            error: function () {
                                console.log("Error");
                            }
                        })
                        var pn = '',
                            tn = '',
                            colors = [];
                        for (var i = 0; i < data.points.length; i++) {
                            pn = data.points[i].pointNumber;
                            tn = data.points[i].curveNumber;
                            colors = data.points[i].data.marker.color;
                        };
                         // console.log(colors)

                        var color = document.getElementById(id4).value
                        colors[pn] = color;
                         // console.log(pn)
                         // console.log(tn)
                         // console.log(colors)
                        var update = { 'marker': { color: colors } };
                        Plotly.restyle(tester, update, [tn])
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    });
                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id
                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"

                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };

                    document.getElementById(id9).onclick = function () {
                        var gridlinesvalue = document.getElementById(id9).value
                        var y_axis_title = tester.layout.yaxis.title.text
                        var x_axis_title = tester.layout.xaxis.title.text

                         // console.log(gridlinesvalue)
                        if (gridlinesvalue == "show_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    showgrid: true, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: true, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "hide_gridlines"
                            document.getElementById(id9).innerHTML = "Hide Gridlines"
                        }
                        if (gridlinesvalue == "hide_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    showgrid: false, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: false, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "show_gridlines"
                            document.getElementById(id9).innerHTML = "Show Gridlines"

                        }
                        Plotly.relayout(tester, layout2)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    };

                    document.getElementById(id_labels).onclick = function () {
                        var labelsvalue = document.getElementById(id_labels).value

                        if (labelsvalue == "show_labels") {
                            var y_axisdata = tester.data[0].y
                             // console.log(y_axisdata)
                            y_axisdata = y_axisdata.map(function(each_element){
                                return Number(each_element.toFixed(2));
                            });
                             // console.log(y_axisdata)
                            var update = tester.data
                            update[0]['text'] = y_axisdata.map(String),
                            update[0]['textposition'] = 'outside'

                            document.getElementById(id_labels).value = "hide_labels"
                            document.getElementById(id_labels).innerHTML = "Hide Labels"
                        }
                        if (labelsvalue == "hide_labels") {
                            var update = tester.data
                             // console.log(update)
                            delete update[0]["text"]
                            delete update[0]["textposition"]
                            document.getElementById(id_labels).value = "show_labels"
                            document.getElementById(id_labels).innerHTML = "Show Labels"
                        }
                         // console.log(update)
                        Plotly.redraw(tester, update)
                         // console.log(tester.data)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))
                    };

                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };
                    try {
                        var changed_text = data.plotDict.changed_text
                    }
                    catch (err) {
                        var changed_text = []

                    }
                    myPlot.on('plotly_afterplot', function () {
                        Plotly.d3.selectAll(".xaxislayer-above").selectAll('text')
                            .on("click", function (d) {
                                 // console.log(d)
                                var labels = tester.data[0].x
                                var position = d.x
                                var text = d.text
                                var labeleditvalue = document.getElementById(id13).value;

                                var dict = {}
                                dict[text] = labeleditvalue
                                changed_text.push(dict)
                                labels[position] = labeleditvalue;
                                 // console.log(position)
                                 // console.log(labels)

                                var update = { "x": [labels] };

                                Plotly.restyle(tester, update)
                                $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))


                                $(`#${id6}`).attr("data-changed_text", JSON.stringify(changed_text))
                                 // console.log(changed_text)

                            });
                    });
                    document.getElementById(id18).onclick = function () {
                         // console.log(x_axisdata2)
                         // console.log(data)
                        var update = { "x": [JSON.parse(JSON.stringify(x_axisdata2))] }
                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }
                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }
                             // console.log(graph_height)
                             // console.log(graph_width)

                            Plotly.relayout(tester, layout)
                            $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                        },
                    });
                    myPlot.on('plotly_selected', function(data){
                        try {
                        points_array = data.points
                         // console.log(points_array)

                        var points = []
                        for(let i = 0; i < points_array.length; i++){
                            points.push(points_array[i].label)
                            }
                         // console.log(points)
                        var crossfilterdict = { 'points':points,'id':chartDivId}
                        crossfilter_function(crossfilterdict)
                        }
                        catch(err){
                                ;
                        }
                        })
                    // var LAST_CLICK = null;

                    myPlot.on('plotly_deselect', function(){
                        //  // console.log('hi')
                        // var CLICK_TIME = Date.now()

                        // if(CLICK_TIME - LAST_CLICK < 10000) {
                        var resetdict = {'id':chartDivId}
                        reset_function(resetdict)
                        // } else {
                        //     LAST_CLICK = CLICK_TIME
                        //      // console.log('single click')
                        // }


                    })
                }

                if (graph_subtype == 'Vertical_Histogram') {

                    var outermodalCard = $(`

  <div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
  right: 0 ;top : 10px;z-index: 1050">


    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
        <button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <label style="font-size:1.1rem">Change the graph color:</label>
    <input type="color" id=${id1} name="favcolor" value="#b8860b"><br><br>
    <label style="font-size:1.1rem">Change X and Y axis gridlines:</label>
        <button type="button" class="btn btn-primary" id="${id9}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" value="show_gridlines" style="line-height: 1.1;">Show Gridlines</button><br><br>
                        <label style="font-size:1.1rem">Change the range of the axis:</label>
    <input type="text" placeholder="Y Axis Start" id=${id2} size="7">
    <input type="text" placeholder="Y Axis End " id=${id3} size="7">
<br><br>
<label style="font-size:1.1rem">Change the title of the axes:</label>
    <input type="text" placeholder="X Axis Title" id=${id11} size="7">
    <input type="text" placeholder="Y Axis Title" id=${id12} size="7">
    <br><br>
<label style="font-size:1.1rem">Change the label of an element:</label><br>
    <input type="text" placeholder="X Axis Label" id=${id13} size="9"> &nbsp;&nbsp;
    <button type="button" class="btn btn-primary" id="${id18}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" style="line-height: 1.1;">Reset Axis Labels</button><br><br>
    </div>
</div>
 `)
                    if (data.plotDict === undefined) {

                        outerCard.appendTo('#card')
                        var tab_id = 'main_page'
                        outermodalCard.appendTo('#card')

                        var colorlength = data.x_axisdata.length
                        var colordata = [];
                        var x_axis = data.x_axis
                        var y_axis = data.y_axis
                        var x_axisdata2 = JSON.parse(JSON.stringify(data.x_axisdata))

                        for (var i = 0; i < colorlength; i++) {
                            colordata.push('#b8860b');
                        }
                         // console.log(colordata)

                        var trace1 = {
                            x: data.x_axisdata,
                            type: 'histogram',
                            marker: {
                                color: '#b8860b'
                            }
                        };

                        var dataplot = [trace1]
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)

                        var layout = {
                            margin: { l: 40, r: 0, b: 20, t: 10, pad: 4 },
                            yaxis: {
                                title: {
                                    standoff: 20,
                                    text: y_axis, font: {
                                        family: "Arial"
                                    }
                                }, showgrid: false, 'automargin': true, font: {
                                    family: "Arial"
                                }
                            },
                            xaxis: {
                                title: {
                                    standoff: 20,
                                    text: x_axis, font: {
                                        family: "Arial"
                                    }
                                },
                                showgrid: false, 'automargin': true, font: {
                                    family: "Arial"
                                }
                            },
                            autosize: true
                        }
                    }
                    else {
                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tab_id = data.plotDict.tab_id
                                                 outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)
                        var dataplot = data.plotDict.data
                        dataplot[0].x = data.x_axisdata
                        var x_axisdata2 = JSON.parse(JSON.stringify(data.x_axisdata))

                        var layout = data.plotDict.layout

                        var width = width.split("p")
                        var height = height.split("p")

                        var graph_height = height[0] * 0.876
                        var graph_width = width[0] * 0.9481

                        layout["height"] = graph_height
                        layout["width"] = graph_width

                         // console.log(layout)
                        var colorlength = data.x_axisdata.length
                    }
                    var config = { responsive: true, displaylogo: false }
                    Plotly.newPlot(tester, dataplot, layout, config)
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})
                    var y_axis_end = tester.layout.yaxis.range[1]
                    var y_axis_start = tester.layout.yaxis.range[0]

                     // console.log(tester.data2)


                    document.getElementById(id1).onchange = function () {
                        var colorlength = data.x_axisdata.length
                         // console.log(colorlength)
                        var colordata2 = [];
                        var backRGB = this.value;

                        for (var i = 0; i < colorlength; i++) {
                            colordata2.push(backRGB);
                        }
                         // console.log(colordata2)

                        var update = { 'marker': { color: colordata2 } };


                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }

                    document.getElementById(id2).onchange = function () {
                        var textbox2length = document.getElementById(id3).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var y_axis_end = tester.layout.yaxis.range[1]
                        var gridlines_value = tester.layout.yaxis.showgrid
                        var y_axis_title = tester.layout.yaxis.title.text

                         // console.log(textbox2length)
                         // console.log(y_axis_end)

                        if (textbox2length == 0) {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, y_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        }
                        else {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id3).onchange = function () {
                        var textbox1length = document.getElementById(id2).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var gridlines_value = tester.layout.yaxis.showgrid
                        var y_axis_title = tester.layout.yaxis.title.text
                         // console.log(gridlines_value)

                        if (textbox1length == 0) {
                            var layout = {
                                yaxis: {
                                    range: [y_axis_start, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        }
                        else {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id11).onchange = function () {
                        var xaxistitlevalue = document.getElementById(id11).value;

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(xaxistitlevalue)
                         // console.log(tester.layout.xaxis.title)

                        var layout = {
                            xaxis: {
                                showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: xaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }


                        }
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }

                    document.getElementById(id12).onchange = function () {
                        var yaxistitlevalue = document.getElementById(id12).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var y_axis_end = tester.layout.yaxis.range[1]

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(yaxistitlevalue)
                         // console.log(tester.layout.yaxis.title)

                        var layout = {
                            yaxis: {
                                range: [y_axis_start, y_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: yaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }
                        }

                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }

                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id
                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };

                    document.getElementById(id9).onclick = function () {
                        var gridlinesvalue = document.getElementById(id9).value
                        var y_axis_title = tester.layout.yaxis.title.text
                        var x_axis_title = tester.layout.xaxis.title.text

                         // console.log(gridlinesvalue)
                        if (gridlinesvalue == "show_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    showgrid: true, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: true, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "hide_gridlines"
                            document.getElementById(id9).innerHTML = "Hide Gridlines"
                        }
                        if (gridlinesvalue == "hide_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    showgrid: false, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: false, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "show_gridlines"
                            document.getElementById(id9).innerHTML = "Show Gridlines"

                        }
                        Plotly.relayout(tester, layout2)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    };
                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };
                    myPlot.on('plotly_afterplot', function () {
                        Plotly.d3.selectAll(".xaxislayer-above").selectAll('text')
                            .on("click", function (d) {
                                 // console.log(d)
                                var labels = tester.data[0].x
                                var position = d.x
                                var labeleditvalue = document.getElementById(id13).value;

                                $.each(labels, function (k, v) {
                                    if (v == text) {
                                        labels[k] = labeleditvalue;
                                    }
                                });

                                var update = { "x": [labels] };

                                Plotly.restyle(tester, update)

                                $(`#${id6}`).attr("data-changed_text", JSON.stringify(changed_text))
                                 // console.log(changed_text)

                            });
                    });
                    document.getElementById(id18).onclick = function () {
                         // console.log(x_axisdata2)
                         // console.log(data)
                        var update = { "x": [JSON.parse(JSON.stringify(x_axisdata2))] }
                        Plotly.restyle(tester, update)

                    }
                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }
                             // console.log(graph_height)
                             // console.log(graph_width)

                            Plotly.relayout(tester, layout)
                            $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                        },
                    });
                }
                if (graph_subtype == 'Cumulative_Histogram') {

                    var outermodalCard = $(`

  <div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
  right: 0 ;top : 10px;z-index: 1050">


    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
        <button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <label style="font-size:1.1rem">Change the graph color:</label>
    <input type="color" id=${id1} name="favcolor" value="#b8860b"><br><br>
    <label style="font-size:1.1rem">Change X and Y axis gridlines:</label>
        <button type="button" class="btn btn-primary" id="${id9}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" value="show_gridlines" style="line-height: 1.1;">Show Gridlines</button><br><br>
                        <label style="font-size:1.1rem">Change the range of the axis:</label>
    <input type="text" placeholder="Y Axis Start" id=${id2} size="7">
    <input type="text" placeholder="Y Axis End " id=${id3} size="7">
<br><br>
<label style="font-size:1.1rem">Change the title of the axes:</label>
    <input type="text" placeholder="X Axis Title" id=${id11} size="7">
    <input type="text" placeholder="Y Axis Title" id=${id12} size="7">
    <br><br>
<label style="font-size:1.1rem">Change the label of an element:</label><br>
    <input type="text" placeholder="X Axis Label" id=${id13} size="9"> &nbsp;&nbsp;
    <button type="button" class="btn btn-primary" id="${id18}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" style="line-height: 1.1;">Reset Axis Labels</button><br><br>
    </div>
</div>
 `)
                    if (data.plotDict === undefined) {

                        outerCard.appendTo('#card')
                        var tab_id = 'main_page'
                        outermodalCard.appendTo('#card')

                        var colorlength = data.x_axisdata.length
                        var colordata = [];
                        var x_axis = data.x_axis
                        var y_axis = data.y_axis
                        var x_axisdata2 = JSON.parse(JSON.stringify(data.x_axisdata))

                        for (var i = 0; i < colorlength; i++) {
                            colordata.push('#b8860b');
                        }
                         // console.log(colordata)

                        var trace1 = {
                            x: data.x_axisdata,
                            type: 'histogram',
                            cumulative: { enabled: true },
                            marker: {
                                color: '#b8860b'
                            }
                        };

                        var dataplot = [trace1]
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)

                        var layout = {
                            margin: { l: 40, r: 0, b: 20, t: 10, pad: 4 },
                            yaxis: {
                                title: {
                                    standoff: 20,
                                    text: y_axis, font: {
                                        family: "Arial"
                                    }
                                }, showgrid: false, 'automargin': true, font: {
                                    family: "Arial"
                                }
                            },
                            xaxis: {
                                title: {
                                    standoff: 20,
                                    text: x_axis, font: {
                                        family: "Arial"
                                    }
                                },
                                showgrid: false, 'automargin': true, font: {
                                    family: "Arial"
                                }
                            },
                            autosize: true
                        }
                    }
                    else {
                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tab_id = data.plotDict.tab_id
                                                             outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)
                        var dataplot = data.plotDict.data
                        dataplot[0].x = data.x_axisdata
                        var x_axisdata2 = JSON.parse(JSON.stringify(data.x_axisdata))

                        var layout = data.plotDict.layout

                        var width = width.split("p")
                        var height = height.split("p")

                        var graph_height = height[0] * 0.876
                        var graph_width = width[0] * 0.9481

                        layout["height"] = graph_height
                        layout["width"] = graph_width

                         // console.log(layout)
                        var colorlength = data.x_axisdata.length
                    }
                    var config = { responsive: true, displaylogo: false }
                    Plotly.newPlot(tester, dataplot, layout, config)
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})
                    var y_axis_end = tester.layout.yaxis.range[1]
                    var y_axis_start = tester.layout.yaxis.range[0]

                     // console.log(tester.data2)

                    document.getElementById(id1).onchange = function () {
                        var colorlength = data.x_axisdata.length
                         // console.log(colorlength)
                        var colordata2 = [];
                        var backRGB = this.value;

                        for (var i = 0; i < colorlength; i++) {
                            colordata2.push(backRGB);
                        }
                         // console.log(colordata2)

                        var update = { 'marker': { color: colordata2 } };


                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }

                    document.getElementById(id2).onchange = function () {
                        var textbox2length = document.getElementById(id3).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var y_axis_end = tester.layout.yaxis.range[1]
                        var gridlines_value = tester.layout.yaxis.showgrid
                        var y_axis_title = tester.layout.yaxis.title.text

                         // console.log(textbox2length)
                         // console.log(y_axis_end)

                        if (textbox2length == 0) {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, y_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        }
                        else {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id3).onchange = function () {
                        var textbox1length = document.getElementById(id2).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var gridlines_value = tester.layout.yaxis.showgrid
                        var y_axis_title = tester.layout.yaxis.title.text
                         // console.log(gridlines_value)

                        if (textbox1length == 0) {
                            var layout = {
                                yaxis: {
                                    range: [y_axis_start, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        }
                        else {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id11).onchange = function () {
                        var xaxistitlevalue = document.getElementById(id11).value;

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(xaxistitlevalue)
                         // console.log(tester.layout.xaxis.title)

                        var layout = {
                            xaxis: {
                                showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: xaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }


                        }
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }

                    document.getElementById(id12).onchange = function () {
                        var yaxistitlevalue = document.getElementById(id12).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var y_axis_end = tester.layout.yaxis.range[1]

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(yaxistitlevalue)
                         // console.log(tester.layout.yaxis.title)

                        var layout = {
                            yaxis: {
                                range: [y_axis_start, y_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: yaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }
                        }

                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }

                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id
                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };

                    document.getElementById(id9).onclick = function () {
                        var gridlinesvalue = document.getElementById(id9).value
                        var y_axis_title = tester.layout.yaxis.title.text
                        var x_axis_title = tester.layout.xaxis.title.text

                         // console.log(gridlinesvalue)
                        if (gridlinesvalue == "show_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    showgrid: true, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: true, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "hide_gridlines"
                            document.getElementById(id9).innerHTML = "Hide Gridlines"
                        }
                        if (gridlinesvalue == "hide_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    showgrid: false, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: false, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "show_gridlines"
                            document.getElementById(id9).innerHTML = "Show Gridlines"

                        }
                        Plotly.relayout(tester, layout2)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    };
                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };
                    myPlot.on('plotly_afterplot', function () {
                        Plotly.d3.selectAll(".xaxislayer-above").selectAll('text')
                            .on("click", function (d) {
                                 // console.log(d)
                                var labels = tester.data[0].x
                                var position = d.x
                                var labeleditvalue = document.getElementById(id13).value;

                                $.each(labels, function (k, v) {
                                    if (v == text) {
                                        labels[k] = labeleditvalue;
                                    }
                                });

                                var update = { "x": [labels] };

                                Plotly.restyle(tester, update)
                                $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                                $(`#${id6}`).attr("data-changed_text", JSON.stringify(changed_text))
                                 // console.log(changed_text)

                            });
                    });
                    document.getElementById(id18).onclick = function () {
                         // console.log(x_axisdata2)
                         // console.log(data)
                        var update = { "x": [JSON.parse(JSON.stringify(x_axisdata2))] }
                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }
                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }
                             // console.log(graph_height)
                             // console.log(graph_width)

                            Plotly.relayout(tester, layout)
                            $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                        },
                    });
                }
                if (graph_subtype == 'Vertical_Waterfall') {

                    var outermodalCard = $(`

  <div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
  right: 0 ;top : 10px;z-index: 1050">


    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
        <button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
       <label style="font-size:1.1rem">Change X and Y axis gridlines:</label>
        <button type="button" class="btn btn-primary" id="${id9}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" value="show_gridlines" style="line-height: 1.1;">Show Gridlines</button><br><br>
                        <label style="font-size:1.1rem">Change the range of the axis:</label>
    <input type="text" placeholder="Y Axis Start" id=${id2} size="7">
    <input type="text" placeholder="Y Axis End " id=${id3} size="7">
<br><br>
<label style="font-size:1.1rem">Change the title of the axes:</label>
    <input type="text" placeholder="X Axis Title" id=${id11} size="7">
    <input type="text" placeholder="Y Axis Title" id=${id12} size="7">
    <br><br>
<label style="font-size:1.1rem">Change the label of an element:</label><br>
    <input type="text" placeholder="X Axis Label" id=${id13} size="9"> &nbsp;&nbsp;
    <button type="button" class="btn btn-primary" id="${id18}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" style="line-height: 1.1;">Reset Axis Labels</button><br><br>
                        <label style="font-size:1.1rem">Change Plot Labels:</label>
        <button type="button" class="btn btn-primary" id="${id_labels}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" value="show_labels" style="line-height: 1.1;">Show Labels</button>
    </div>
</div>
 `)
                    if (data.plotDict === undefined) {

                        outerCard.appendTo('#card')
                        var tab_id = 'main_page'
                        outermodalCard.appendTo('#card')

                        var colorlength = data.y_axisdata.length
                        var colordata = [];
                        var measure = [];

                        var x_axis = data.x_axis
                        var y_axis = data.y_axis
                        var x_axisdata = data.x_axisdata
                        var y_axisdata = data.y_axisdata
                        var x_axisdata2 = JSON.parse(JSON.stringify(data.x_axisdata))
                        x_axisdata2.push('Total')

                        x_axisdata.push('Total')
                        y_axisdata.push(0)

                        for (var i = 0; i < colorlength; i++) {
                            colordata.push('#b8860b');
                        }
                        for (var i = 0; i < colorlength; i++) {
                            measure.push('relative');
                        }
                        measure.push('total')

                         // console.log(colordata)

                        var trace1 = {
                            x: x_axisdata,
                            y: y_axisdata,
                            type: "waterfall",
                            orientation: "v",
                            measure: measure,
                            marker: {
                                color: colordata
                            }
                        };

                        var dataplot = [trace1]
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)

                        var layout = {
                            margin: { l: 40, r: 0, b: 20, t: 10, pad: 4 },
                            yaxis: {
                                title: {
                                    standoff: 20,
                                    text: y_axis, font: {
                                        family: "Arial"
                                    }
                                }, showgrid: false, 'automargin': true, font: {
                                    family: "Arial"
                                }
                            },
                            xaxis: {
                                title: {
                                    standoff: 20,
                                    text: x_axis, font: {
                                        family: "Arial"
                                    }
                                },
                                showgrid: false, 'automargin': true, font: {
                                    family: "Arial"
                                }
                            },
                        }
                    }
                    else {
                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                       var tab_id = data.plotDict.tab_id
                                      outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)
                        var dataplot = data.plotDict.data
                        var colorlength = data.x_axisdata.length
                        var measure = [];

                        for (var i = 0; i < colorlength; i++) {
                            measure.push('relative');
                        }
                        var x_axisdata = data.x_axisdata
                        var y_axisdata = data.y_axisdata
                        var x_axisdata2 = JSON.parse(JSON.stringify(data.x_axisdata))
                        x_axisdata2.push('Total')

                        x_axisdata.push('Total')
                        y_axisdata.push(0)
                        measure.push('total')
                        dataplot[0].x = x_axisdata
                        dataplot[0].y = y_axisdata
                        dataplot[0].measure = measure
                         // console.log(dataplot)
                        var layout = data.plotDict.layout

                        var width = width.split("p")
                        var height = height.split("p")

                        var graph_height = height[0] * 0.876
                        var graph_width = width[0] * 0.9481

                        layout["height"] = graph_height
                        layout["width"] = graph_width

                         // console.log(layout)
                    }
                    var config = { responsive: true, displaylogo: false }
                    Plotly.newPlot(tester, dataplot, layout, config)
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})
                    var y_axis_end = tester.layout.yaxis.range[1]
                    var y_axis_start = tester.layout.yaxis.range[0]

                     // console.log(tester.data2)


                    // document.getElementById(id1).onchange = function () {
                    //      // console.log(colordata.length)
                    //     var colorlength = colordata.length
                    //      // console.log(colorlength)
                    //     var colordata2 = [];
                    //     var backRGB = this.value;

                    //     for (var i = 0; i < colorlength; i++) {
                    //         colordata2.push(backRGB);
                    //     }
                    //      // console.log(colordata2)

                    //     var update = { 'marker': { color: colordata2 } };


                    //     Plotly.restyle(tester, update)
                    // }

                    document.getElementById(id2).onchange = function () {
                        var textbox2length = document.getElementById(id3).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var y_axis_end = tester.layout.yaxis.range[1]
                        var gridlines_value = tester.layout.yaxis.showgrid
                        var y_axis_title = tester.layout.yaxis.title.text

                         // console.log(textbox2length)
                         // console.log(y_axis_end)

                        if (textbox2length == 0) {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, y_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        }
                        else {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id_labels).onclick = function () {
                        var labelsvalue = document.getElementById(id_labels).value

                        if (labelsvalue == "show_labels") {
                            var y_axisdata = tester.data[0].y
                             // console.log(y_axisdata)
                            y_axisdata = y_axisdata.map(function(each_element){
                                return Number(each_element.toFixed(2));
                            });
                             // console.log(y_axisdata)
                            var update = tester.data
                            update[0]['text'] = y_axisdata.map(String),
                            update[0]['textposition'] = 'outside'

                            document.getElementById(id_labels).value = "hide_labels"
                            document.getElementById(id_labels).innerHTML = "Hide Labels"
                        }
                        if (labelsvalue == "hide_labels") {
                            var update = tester.data
                             // console.log(update)
                            delete update[0]["text"]
                            delete update[0]["textposition"]
                            document.getElementById(id_labels).value = "show_labels"
                            document.getElementById(id_labels).innerHTML = "Show Labels"
                        }
                         // console.log(update)
                        Plotly.redraw(tester, update)
                         // console.log(tester.data)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))
                    };
                    document.getElementById(id3).onchange = function () {
                        var textbox1length = document.getElementById(id2).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var gridlines_value = tester.layout.yaxis.showgrid
                        var y_axis_title = tester.layout.yaxis.title.text
                         // console.log(gridlines_value)

                        if (textbox1length == 0) {
                            var layout = {
                                yaxis: {
                                    range: [y_axis_start, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        }
                        else {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id11).onchange = function () {
                        var xaxistitlevalue = document.getElementById(id11).value;

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(xaxistitlevalue)
                         // console.log(tester.layout.xaxis.title)

                        var layout = {
                            xaxis: {
                                showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: xaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }


                        }
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }

                    document.getElementById(id12).onchange = function () {
                        var yaxistitlevalue = document.getElementById(id12).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var y_axis_end = tester.layout.yaxis.range[1]

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(yaxistitlevalue)
                         // console.log(tester.layout.yaxis.title)

                        var layout = {
                            yaxis: {
                                range: [y_axis_start, y_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: yaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }
                        }

                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }

                    // myPlot.on('plotly_click', function (data) {
                    //      // console.log(data.points[0].x)
                    //      // console.log(data.points)
                    //      // console.log(x_axisdata2)

                    //     var pn = '',
                    //         tn = '',
                    //         colors = [];
                    //     for (var i = 0; i < data.points.length; i++) {
                    //         pn = data.points[i].pointNumber;
                    //         tn = data.points[i].curveNumber;
                    //         colors = data.points[i].data.marker.color;
                    //     };
                    //      // console.log(colors)

                    //     var color = document.getElementById(id4).value
                    //     colors[pn] = color;
                    //      // console.log(pn)
                    //      // console.log(tn)
                    //      // console.log(colors)
                    //     var update = { 'marker': { color: colors } };
                    //     Plotly.restyle(tester, update, [tn])
                    // });
                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id
                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };

                    document.getElementById(id9).onclick = function () {
                        var gridlinesvalue = document.getElementById(id9).value
                        var y_axis_title = tester.layout.yaxis.title.text
                        var x_axis_title = tester.layout.xaxis.title.text

                         // console.log(gridlinesvalue)
                        if (gridlinesvalue == "show_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    showgrid: true, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: true, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "hide_gridlines"
                            document.getElementById(id9).innerHTML = "Hide Gridlines"
                        }
                        if (gridlinesvalue == "hide_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    showgrid: false, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: false, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "show_gridlines"
                            document.getElementById(id9).innerHTML = "Show Gridlines"

                        }
                        Plotly.relayout(tester, layout2)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    };
                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };
                    try {
                        var changed_text = data.plotDict.changed_text
                    }
                    catch (err) {
                        var changed_text = []

                    }
                    myPlot.on('plotly_afterplot', function () {
                        Plotly.d3.selectAll(".xaxislayer-above").selectAll('text')
                            .on("click", function (d) {
                                 // console.log(d)
                                var labels = tester.data[0].x
                                var position = d.x
                                var text = d.text
                                var labeleditvalue = document.getElementById(id13).value;

                                var dict = {}
                                dict[text] = labeleditvalue
                                changed_text.push(dict)
                                labels[position] = labeleditvalue;
                                 // console.log(position)
                                 // console.log(labels)

                                var update = { "x": [labels] };

                                Plotly.restyle(tester, update)
                                $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                                $(`#${id6}`).attr("data-changed_text", JSON.stringify(changed_text))
                                 // console.log(changed_text)

                            });
                    });
                    document.getElementById(id18).onclick = function () {
                         // console.log(x_axisdata2)
                         // console.log(data)
                        var update = { "x": [JSON.parse(JSON.stringify(x_axisdata2))] }
                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }
                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }
                             // console.log(graph_height)
                             // console.log(graph_width)

                            Plotly.relayout(tester, layout)
                            $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                        },
                    });
                }
                if (graph_subtype == 'Horizontal_Waterfall') {

                    var outermodalCard = $(`

  <div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
  right: 0 ;top : 10px;z-index: 1050">


    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
        <button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
       <label style="font-size:1.1rem">Change X and Y axis gridlines:</label>
        <button type="button" class="btn btn-primary" id="${id9}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" value="show_gridlines" style="line-height: 1.1;">Show Gridlines</button><br><br>
                        <label style="font-size:1.1rem">Change the range of the axis:</label>
    <input type="text" placeholder="Y Axis Start" id=${id2} size="7">
    <input type="text" placeholder="Y Axis End " id=${id3} size="7">
<br><br>
<label style="font-size:1.1rem">Change the title of the axes:</label>
    <input type="text" placeholder="X Axis Title" id=${id11} size="7">
    <input type="text" placeholder="Y Axis Title" id=${id12} size="7">
    <br><br>
<label style="font-size:1.1rem">Change the label of an element:</label><br>
    <input type="text" placeholder="X Axis Label" id=${id13} size="9"> &nbsp;&nbsp;
    <button type="button" class="btn btn-primary" id="${id18}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" style="line-height: 1.1;">Reset Axis Labels</button><br><br>
                        <label style="font-size:1.1rem">Change Plot Labels:</label>
        <button type="button" class="btn btn-primary" id="${id_labels}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" value="show_labels" style="line-height: 1.1;">Show Labels</button>
    </div>
</div>
 `)
                    if (data.plotDict === undefined) {

                        outerCard.appendTo('#card')
                        var tab_id = 'main_page'
                        outermodalCard.appendTo('#card')

                        var colorlength = data.y_axisdata.length
                        var colordata = [];
                        var measure = [];

                        var x_axis = data.x_axis
                        var y_axis = data.y_axis
                        var x_axisdata = data.x_axisdata
                        var y_axisdata = data.y_axisdata
                        var y_axisdata2 = JSON.parse(JSON.stringify(data.y_axisdata))
                        y_axisdata2.push('Total')

                        y_axisdata.push('Total')
                        x_axisdata.push(0)

                        for (var i = 0; i < colorlength; i++) {
                            colordata.push('#b8860b');
                        }
                        for (var i = 0; i < colorlength; i++) {
                            measure.push('relative');
                        }
                        measure.push('total')

                         // console.log(colordata)

                        var trace1 = {
                            x: x_axisdata,
                            y: y_axisdata,
                            type: "waterfall",
                            orientation: "h",
                            measure: measure,
                            marker: {
                                color: colordata
                            }
                        };

                        var dataplot = [trace1]
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)

                        var layout = {
                            margin: { l: 40, r: 0, b: 20, t: 10, pad: 4 },
                            yaxis: {
                                title: {
                                    standoff: 20,
                                    text: y_axis, font: {
                                        family: "Arial"
                                    }
                                }, showgrid: false, 'automargin': true, font: {
                                    family: "Arial"
                                }
                            },
                            xaxis: {
                                title: {
                                    standoff: 20,
                                    text: x_axis, font: {
                                        family: "Arial"
                                    }
                                },
                                showgrid: false, 'automargin': true, font: {
                                    family: "Arial"
                                }
                            },
                        }
                    }
                    else {
                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tab_id = data.plotDict.tab_id
                                                                  outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)
                        var dataplot = data.plotDict.data
                        var colorlength = data.x_axisdata.length
                        var measure = [];
                        var x_axisdata = data.x_axisdata
                        var y_axisdata = data.y_axisdata
                        var y_axisdata2 = JSON.parse(JSON.stringify(data.y_axisdata))
                        y_axisdata2.push('Total')

                        y_axisdata.push('Total')
                        x_axisdata.push(0)

                        for (var i = 0; i < colorlength; i++) {
                            measure.push('relative');
                        }
                        var y_axisdata2 = JSON.parse(JSON.stringify(data.y_axisdata))

                        measure.push('total')
                        dataplot[0].x = x_axisdata
                        dataplot[0].y = data.y_axisdata
                        dataplot[0].measure = measure

                        var layout = data.plotDict.layout

                        var width = width.split("p")
                        var height = height.split("p")

                        var graph_height = height[0] * 0.876
                        var graph_width = width[0] * 0.9481

                        layout["height"] = graph_height
                        layout["width"] = graph_width

                         // console.log(layout)
                    }
                    var config = { responsive: true, displaylogo: false }
                    Plotly.newPlot(tester, dataplot, layout, config)
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})
                    var x_axis_end = tester.layout.yaxis.range[1]
                    var x_axis_start = tester.layout.yaxis.range[0]

                     // console.log(tester.data2)


                    // document.getElementById(id1).onchange = function () {
                    //      // console.log(colordata.length)
                    //     var colorlength = colordata.length
                    //      // console.log(colorlength)
                    //     var colordata2 = [];
                    //     var backRGB = this.value;

                    //     for (var i = 0; i < colorlength; i++) {
                    //         colordata2.push(backRGB);
                    //     }
                    //      // console.log(colordata2)

                    //     var update = { 'marker': { color: colordata2 } };


                    //     Plotly.restyle(tester, update)
                    // }

                    document.getElementById(id2).onchange = function () {
                        var textbox2length = document.getElementById(id3).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var x_axis_end = tester.layout.xaxis.range[1]
                        var gridlines_value = tester.layout.xaxis.showgrid
                        var x_axis_title = tester.layout.xaxis.title.text

                         // console.log(textbox2length)
                         // console.log(x_axis_end)

                        if (textbox2length == 0) {
                            var layout = {
                                xaxis: {
                                    range: [textbox1value, x_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        }
                        else {
                            var layout = {
                                xaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id_labels).onclick = function () {
                        var labelsvalue = document.getElementById(id_labels).value

                        if (labelsvalue == "show_labels") {
                            var x_axisdata = tester.data[0].x
                             // console.log(x_axisdata)
                            x_axisdata = x_axisdata.map(function(each_element){
                                return Number(each_element.toFixed(2));
                            });
                             // console.log(x_axisdata)
                            var update = tester.data
                            update[0]['text'] = x_axisdata.map(String),
                            update[0]['textposition'] = 'outside'
                            update[0]['textangle'] = 90
                            document.getElementById(id_labels).value = "hide_labels"
                            document.getElementById(id_labels).innerHTML = "Hide Labels"
                        }
                        if (labelsvalue == "hide_labels") {
                            var update = tester.data
                             // console.log(update)
                            delete update[0]["text"]
                            delete update[0]["textposition"]
                            document.getElementById(id_labels).value = "show_labels"
                            document.getElementById(id_labels).innerHTML = "Show Labels"
                        }
                         // console.log(update)
                        Plotly.redraw(tester, update)
                         // console.log(tester.data)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))
                    };
                    document.getElementById(id3).onchange = function () {
                        var textbox1length = document.getElementById(id2).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var x_axis_start = tester.layout.xaxis.range[0]
                        var gridlines_value = tester.layout.xaxis.showgrid
                         // console.log(gridlines_value)
                        var x_axis_title = tester.layout.xaxis.title.text

                        if (textbox1length == 0) {
                            var layout = {
                                xaxis: {
                                    range: [x_axis_start, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        }
                        else {
                            var layout = {
                                xaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id11).onchange = function () {
                        var xaxistitlevalue = document.getElementById(id11).value;

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(xaxistitlevalue)
                         // console.log(tester.layout.xaxis.title)

                        var layout = {
                            xaxis: {
                                showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: xaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }


                        }
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }

                    document.getElementById(id12).onchange = function () {
                        var yaxistitlevalue = document.getElementById(id12).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var y_axis_end = tester.layout.yaxis.range[1]

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(yaxistitlevalue)
                         // console.log(tester.layout.yaxis.title)

                        var layout = {
                            yaxis: {
                                range: [y_axis_start, y_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: yaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }
                        }

                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }

                    // myPlot.on('plotly_click', function (data) {
                    //      // console.log(data.points[0].x)
                    //      // console.log(data.points)
                    //      // console.log(x_axisdata2)

                    //     var pn = '',
                    //         tn = '',
                    //         colors = [];
                    //     for (var i = 0; i < data.points.length; i++) {
                    //         pn = data.points[i].pointNumber;
                    //         tn = data.points[i].curveNumber;
                    //         colors = data.points[i].data.marker.color;
                    //     };
                    //      // console.log(colors)

                    //     var color = document.getElementById(id4).value
                    //     colors[pn] = color;
                    //      // console.log(pn)
                    //      // console.log(tn)
                    //      // console.log(colors)
                    //     var update = { 'marker': { color: colors } };
                    //     Plotly.restyle(tester, update, [tn])
                    // });
                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id
                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };

                    document.getElementById(id9).onclick = function () {
                        var gridlinesvalue = document.getElementById(id9).value
                        var y_axis_title = tester.layout.yaxis.title.text
                        var x_axis_title = tester.layout.xaxis.title.text

                         // console.log(gridlinesvalue)
                        if (gridlinesvalue == "show_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    showgrid: true, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: true, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "hide_gridlines"
                            document.getElementById(id9).innerHTML = "Hide Gridlines"
                        }
                        if (gridlinesvalue == "hide_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    showgrid: false, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: false, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "show_gridlines"
                            document.getElementById(id9).innerHTML = "Show Gridlines"

                        }
                        Plotly.relayout(tester, layout2)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    };
                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };
                    myPlot.on('plotly_afterplot', function () {
                        Plotly.d3.selectAll(".yaxislayer-above").selectAll('text')
                            .on("click", function (d) {
                                 // console.log(d)
                                var labels = tester.data[0].y
                                var position = d.x
                                var text = d.text
                                var labeleditvalue = document.getElementById(id13).value;

                                var dict = {}
                                dict[text] = labeleditvalue
                                changed_text.push(dict)
                                labels[position] = labeleditvalue;
                                 // console.log(position)
                                 // console.log(labels)

                                var update = { "y": [labels] };

                                Plotly.restyle(tester, update)
                                $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                                $(`#${id6}`).attr("data-changed_text", JSON.stringify(changed_text))
                                 // console.log(changed_text)

                            });
                    });
                    document.getElementById(id18).onclick = function () {
                         // console.log(y_axisdata2)
                         // console.log(data)
                        var update = { "y": [JSON.parse(JSON.stringify(y_axisdata2))] }
                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }
                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }
                             // console.log(graph_height)
                             // console.log(graph_width)

                            Plotly.relayout(tester, layout)
                            $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                        },
                    });
                }
                if (graph_subtype == 'Scatter') {


                    var outermodalCard = $(`

<div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
right: 0 ;top : 10px;z-index: 1050">


  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
      <button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <label style="font-size:1.1rem">Change the graph color:</label>
  <input type="color" id=${id1} name="favcolor" value="#b8860b"><br><br>
  <label style="font-size:1.1rem">Change the color or an element:</label>
  <input type="color" id=${id4} name="favcolor1" value="#b8860b"><br><br><label style="font-size:1.1rem">Change X and Y axis gridlines:</label>
      <button type="button" class="btn btn-primary" id="${id9}" data-toggle="button" role="tab"
                      aria-pressed="false" autocomplete="off" value="show_gridlines" style="line-height: 0.7;">Show Gridlines</button><br><br>
                      <label style="font-size:1.1rem">Change the range of the axis:</label>
  <input type="text" placeholder="Y Axis Start" id=${id2} size="7">
  <input type="text" placeholder="Y Axis End " id=${id3} size="7">
<br><br>
<label style="font-size:1.1rem">Change the title of the axes:</label>
    <input type="text" placeholder="X Axis Title" id=${id11} size="7">
    <input type="text" placeholder="Y Axis Title" id=${id12} size="7">
    <br><br>
<label style="font-size:1.1rem">Change the label of an element:</label><br>
    <input type="text" placeholder="X Axis Label" id=${id13} size="9"> &nbsp;&nbsp;
    <button type="button" class="btn btn-primary" id="${id18}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" style="line-height: 1.1;">Reset Axis Labels</button><br><br>
  </div>
</div>
`)
                    if (data.plotDict === undefined) {

                        outerCard.appendTo('#card')
                        var tab_id = 'main_page'
                        outermodalCard.appendTo('#card')
                        var colorlength = data.x_axisdata.length
                        var colordata = [];
                        var x_axis = data.x_axis
                        var y_axis = data.y_axis
                        var x_axisdata2 = JSON.parse(JSON.stringify(data.x_axisdata))

                        for (var i = 0; i < colorlength; i++) {
                            colordata.push('#b8860b');
                        }
                         // console.log(colordata)
                        var trace1 = {
                            x: data.x_axisdata,
                            y: data.y_axisdata,
                            mode: 'markers',
                            marker: {
                                color: colordata
                            }
                        };

                        var dataplot = [trace1]
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)

                        var layout = {
                            margin: { l: 40, r: 0, b: 20, t: 10, pad: 4 },
                            hovermode: 'closest',

                            yaxis: {
                                title: {
                                    standoff: 20,
                                    text: y_axis, font: {
                                        family: "Arial"
                                    }
                                }, showgrid: false, 'automargin': true, font: {
                                    family: "Arial"
                                }
                            },
                            xaxis: {
                                title: {
                                    standoff: 20,
                                    text: x_axis, font: {
                                        family: "Arial"
                                    }
                                },
                                showgrid: false, 'automargin': true, font: {
                                    family: "Arial"
                                }
                            },
                        }
                    }
                    else {
                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tab_id = data.plotDict.tab_id
                                        outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)
                        var dataplot = data.plotDict.data
                        dataplot[0].x = data.x_axisdata
                        dataplot[0].y = data.y_axisdata
                        var colorlength = data.x_axisdata.length
                        var colordata = [];
                        var x_axisdata2 = JSON.parse(JSON.stringify(data.x_axisdata))
                        for (var i = 0; i < colorlength; i++) {
                            colordata.push('#b8860b');
                        }
                        dataplot[0].marker.color = colordata
                         // console.log(dataplot)
                        var layout = data.plotDict.layout

                        var width = width.split("p")
                        var height = height.split("p")

                        var graph_height = height[0] * 0.876
                        var graph_width = width[0] * 0.9481

                        layout["height"] = graph_height
                        layout["width"] = graph_width

                         // console.log(layout)
                    }

                    var config = { responsive: true, displaylogo: false }

                    Plotly.newPlot(tester, dataplot, layout, config)
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})
                    var y_axis_end = tester.layout.yaxis.range[1]
                    var y_axis_start = tester.layout.yaxis.range[0]

                     // console.log(tester.layout)


                    document.getElementById(id1).onchange = function () {
                         // console.log(colordata.length)
                        var colorlength = colordata.length
                         // console.log(colorlength)
                        var colordata2 = [];
                        var backRGB = this.value;

                        for (var i = 0; i < colorlength; i++) {
                            colordata2.push(backRGB);
                        }
                         // console.log(colordata2)

                        var update = { 'marker': { color: colordata2 } };


                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }

                    document.getElementById(id2).onchange = function () {
                        var textbox2length = document.getElementById(id3).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var y_axis_end = tester.layout.yaxis.range[1]
                        var gridlines_value = tester.layout.yaxis.showgrid
                        var y_axis_title = tester.layout.yaxis.title.text

                         // console.log(textbox2length)
                         // console.log(y_axis_end)

                        if (textbox2length == 0) {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, y_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        }
                        else {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id3).onchange = function () {
                        var textbox1length = document.getElementById(id2).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var gridlines_value = tester.layout.yaxis.showgrid
                         // console.log(gridlines_value)
                        var y_axis_title = tester.layout.yaxis.title.text

                        if (textbox1length == 0) {
                            var layout = {
                                yaxis: {
                                    range: [y_axis_start, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        }
                        else {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    myPlot.on('plotly_click', function (data) {
                         // console.log(data.points[0].x)
                         // console.log(data.points)

                        var pn = '',
                            tn = '',
                            colors = [];
                        for (var i = 0; i < data.points.length; i++) {
                            pn = data.points[i].pointNumber;
                            tn = data.points[i].curveNumber;
                            colors = data.points[i].data.marker.color;
                        };
                         // console.log(colors)

                        var color = document.getElementById(id4).value
                        colors[pn] = color;
                         // console.log(pn)
                         // console.log(tn)
                         // console.log(colors)
                        var update = { 'marker': { color: colors } };
                        Plotly.restyle(tester, update, [tn])
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    });
                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id

                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };
                    document.getElementById(id9).onclick = function () {
                        var gridlinesvalue = document.getElementById(id9).value
                         // console.log(gridlinesvalue)
                        var y_axis_title = tester.layout.yaxis.title.text
                        var x_axis_title = tester.layout.xaxis.title.text
                        if (gridlinesvalue == "show_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    automargin: true,
                                    showgrid: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: true, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "hide_gridlines"
                            document.getElementById(id9).innerHTML = "Hide Gridlines"
                        }
                        if (gridlinesvalue == "hide_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    automargin: true,
                                    showgrid: false, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: false, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "show_gridlines"
                            document.getElementById(id9).innerHTML = "Show Gridlines"

                        }
                        Plotly.relayout(tester, layout2)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    };
                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };
                    document.getElementById(id11).onchange = function () {
                        var xaxistitlevalue = document.getElementById(id11).value;

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(xaxistitlevalue)
                         // console.log(tester.layout.xaxis.title)

                        var layout = {
                            xaxis: {
                                showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: xaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }


                        }
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }

                    document.getElementById(id12).onchange = function () {
                        var yaxistitlevalue = document.getElementById(id12).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var y_axis_end = tester.layout.yaxis.range[1]

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(yaxistitlevalue)
                         // console.log(tester.layout.yaxis.title)

                        var layout = {
                            yaxis: {
                                range: [y_axis_start, y_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: yaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }
                        }

                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }

                    try {
                        var changed_text = data.plotDict.changed_text
                    }
                    catch (err) {
                        var changed_text = []

                    }
                    myPlot.on('plotly_afterplot', function () {
                        Plotly.d3.selectAll(".xaxislayer-above").selectAll('text')
                            .on("click", function (d) {
                                 // console.log(d)
                                var labels = tester.data[0].x
                                var position = d.x
                                var text = d.text
                                var labeleditvalue = document.getElementById(id13).value;

                                var dict = {}
                                dict[text] = labeleditvalue
                                changed_text.push(dict)
                                $.each(labels, function (k, v) {
                                    if (v == text) {
                                        labels[k] = labeleditvalue;
                                    }
                                });

                                var update = { "x": [labels] };

                                Plotly.restyle(tester, update)
                                $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))


                                $(`#${id6}`).attr("data-changed_text", JSON.stringify(changed_text))
                                 // console.log(changed_text)

                            });
                    });
                    document.getElementById(id18).onclick = function () {
                         // console.log(x_axisdata2)
                         // console.log(data)
                        var update = { "x": [JSON.parse(JSON.stringify(x_axisdata2))] }
                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))


                    }
                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }
                             // console.log(graph_height)
                             // console.log(graph_width)

                            Plotly.relayout(tester, layout)
                            $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                        },
                    });
                }
                if (graph_subtype == '3D_Scatter_Plot') {


                    var outermodalCard = $(`

<div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
right: 0 ;top : 10px;z-index: 1050">


  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
      <button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <label style="font-size:1.1rem">Change the graph color:</label>
  <input type="color" id=${id1} name="favcolor" value="#b8860b"><br><br>
  <br><br><label style="font-size:1.1rem">Change X and Y axis gridlines:</label>
      <button type="button" class="btn btn-primary" id="${id9}" data-toggle="button" role="tab"
                      aria-pressed="false" autocomplete="off" value="show_gridlines" style="line-height: 0.7;">Show Gridlines</button><br><br>
                      <label style="font-size:1.1rem">Change the range of the axis:</label>
  <input type="text" placeholder="Y Axis Start" id=${id2} size="7">
  <input type="text" placeholder="Y Axis End " id=${id3} size="7">
<br><br>
<label style="font-size:1.1rem">Change the title of the axes:</label>
    <input type="text" placeholder="X Axis Title" id=${id11} size="7">
    <input type="text" placeholder="Y Axis Title" id=${id12} size="7">
    <br><br>
<label style="font-size:1.1rem">Change the label of an element:</label><br>
    <input type="text" placeholder="X Axis Label" id=${id13} size="9"> &nbsp;&nbsp;
    <button type="button" class="btn btn-primary" id="${id18}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" style="line-height: 1.1;">Reset Axis Labels</button><br><br>
  </div>
</div>
`)
                    if (data.plotDict === undefined) {

                        outerCard.appendTo('#card')
                        var tab_id = 'main_page'
                        outermodalCard.appendTo('#card')
                        var colorlength = data.x_axisdata.length
                        var colordata = [];
                        var x_axis = data.x_axis
                        var y_axis = data.y_axis
                        var x_axisdata2 = JSON.parse(JSON.stringify(data.x_axisdata))

                        for (var i = 0; i < colorlength; i++) {
                            colordata.push('#b8860b');
                        }
                         // console.log(colordata)
                        var trace1 = {
                            x: data.x_axisdata,
                            y: data.y_axisdata,
                            z: data.second_columndata,
                            type: 'scatter3d',
                            mode: 'markers',
                            marker: {
                                color: colordata
                            }
                        };

                        var dataplot = [trace1]
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)

                        var layout = {
                            margin: { l: 40, r: 60, b: 60, t: 10, pad: 4 },
                            hovermode: 'closest',

                            yaxis: {
                                title: {
                                    standoff: 20,
                                    text: y_axis, font: {
                                        family: "Arial"
                                    }
                                }, showgrid: false, 'automargin': true, font: {
                                    family: "Arial"
                                }
                            },
                            xaxis: {
                                title: {
                                    standoff: 20,
                                    text: x_axis, font: {
                                        family: "Arial"
                                    }
                                },
                                showgrid: false, 'automargin': true, font: {
                                    family: "Arial"
                                }
                            },
                        }
                    }
                    else {
                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tab_id = data.plotDict.tab_id
                                               outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)
                        var dataplot = data.plotDict.data
                        dataplot[0].x = data.x_axisdata
                        dataplot[0].y = data.y_axisdata
                        dataplot[0].z = data.second_columndata
                        var colorlength = data.x_axisdata.length
                        var colordata = []
                        for (var i = 0; i < colorlength; i++) {
                            colordata.push('#b8860b');
                        }
                        dataplot[0].marker.color = colordata

                        var layout = data.plotDict.layout

                        var width = width.split("p")
                        var height = height.split("p")

                        var graph_height = height[0] * 0.876
                        var graph_width = width[0] * 0.9481

                        layout["height"] = graph_height
                        layout["width"] = graph_width

                         // console.log(layout)
                    }
                    var config = { responsive: true, displaylogo: false }

                    Plotly.newPlot(tester, dataplot, layout, config)
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})
                    // var y_axis_end = tester.layout.yaxis.range[1]
                    // var y_axis_start = tester.layout.yaxis.range[0]

                     // console.log(tester.layout)

                    document.getElementById(id1).onchange = function () {
                         // console.log(colordata.length)
                        var colorlength = colordata.length
                         // console.log(colorlength)
                        var colordata2 = [];
                        var backRGB = this.value;

                        for (var i = 0; i < colorlength; i++) {
                            colordata2.push(backRGB);
                        }
                         // console.log(colordata2)

                        var update = { 'marker': { color: colordata2 } };


                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }

                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id

                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };
                    document.getElementById(id9).onclick = function () {
                        var gridlinesvalue = document.getElementById(id9).value
                         // console.log(gridlinesvalue)
                        var y_axis_title = tester.layout.yaxis.title.text
                        var x_axis_title = tester.layout.xaxis.title.text
                        if (gridlinesvalue == "show_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    automargin: true,
                                    showgrid: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: true, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "hide_gridlines"
                            document.getElementById(id9).innerHTML = "Hide Gridlines"
                        }
                        if (gridlinesvalue == "hide_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    automargin: true,
                                    showgrid: false, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: false, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "show_gridlines"
                            document.getElementById(id9).innerHTML = "Show Gridlines"

                        }
                        Plotly.relayout(tester, layout2)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    };
                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };
                    document.getElementById(id11).onchange = function () {
                        var xaxistitlevalue = document.getElementById(id11).value;

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(xaxistitlevalue)
                         // console.log(tester.layout.xaxis.title)

                        var layout = {
                            xaxis: {
                                showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: xaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }


                        }
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }

                    document.getElementById(id12).onchange = function () {
                        var yaxistitlevalue = document.getElementById(id12).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var y_axis_end = tester.layout.yaxis.range[1]

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(yaxistitlevalue)
                         // console.log(tester.layout.yaxis.title)

                        var layout = {
                            yaxis: {
                                range: [y_axis_start, y_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: yaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }
                        }

                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }

                    try {
                        var changed_text = data.plotDict.changed_text
                    }
                    catch (err) {
                        var changed_text = []

                    }
                    myPlot.on('plotly_afterplot', function () {
                        Plotly.d3.selectAll(".xaxislayer-above").selectAll('text')
                            .on("click", function (d) {
                                 // console.log(d)
                                var labels = tester.data[0].x
                                var position = d.x
                                var text = d.text
                                var labeleditvalue = document.getElementById(id13).value;

                                var dict = {}
                                dict[text] = labeleditvalue
                                changed_text.push(dict)
                                $.each(labels, function (k, v) {
                                    if (v == text) {
                                        labels[k] = labeleditvalue;
                                    }
                                });

                                var update = { "x": [labels] };

                                Plotly.restyle(tester, update)
                                $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))


                                $(`#${id6}`).attr("data-changed_text", JSON.stringify(changed_text))
                                 // console.log(changed_text)

                            });
                    });
                    document.getElementById(id18).onclick = function () {
                         // console.log(x_axisdata2)
                         // console.log(data)
                        var update = { "x": [JSON.parse(JSON.stringify(x_axisdata2))] }
                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }
                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }
                             // console.log(graph_height)
                             // console.log(graph_width)

                            Plotly.relayout(tester, layout)
                            $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                        },
                    });
                }
                if (graph_subtype == '3D_Mesh_Plot') {


                    var outermodalCard = $(`

<div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
right: 0 ;top : 10px;z-index: 1050">


<div class="modal-content">
<div class="modal-header">
<h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
<button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
</div>
<div class="modal-body">
<label style="font-size:1.1rem">Change the graph color:</label>
<input type="color" id=${id1} name="favcolor" value="#b8860b">
<br><br><label style="font-size:1.1rem">Change X and Y axis gridlines:</label>
<button type="button" class="btn btn-primary" id="${id9}" data-toggle="button" role="tab"
  aria-pressed="false" autocomplete="off" value="show_gridlines" style="line-height: 0.7;">Show Gridlines</button><br><br>
  <label style="font-size:1.1rem">Change the range of the axis:</label>
<input type="text" placeholder="Y Axis Start" id=${id2} size="7">
<input type="text" placeholder="Y Axis End " id=${id3} size="7">
<br><br>
<label style="font-size:1.1rem">Change the title of the axes:</label>
<input type="text" placeholder="X Axis Title" id=${id11} size="7">
<input type="text" placeholder="Y Axis Title" id=${id12} size="7">
<br><br>
<label style="font-size:1.1rem">Change the label of an element:</label><br>
<input type="text" placeholder="X Axis Label" id=${id13} size="9"> &nbsp;&nbsp;
<button type="button" class="btn btn-primary" id="${id18}" data-toggle="button" role="tab"
    aria-pressed="false" autocomplete="off" style="line-height: 1.1;">Reset Axis Labels</button><br><br>
</div>
</div>
`)
                    if (data.plotDict === undefined) {

                        outerCard.appendTo('#card')
                        var tab_id = 'main_page'
                        outermodalCard.appendTo('#card')
                        var colorlength = data.x_axisdata.length
                        var colordata = [];
                        var x_axis = data.x_axis
                        var y_axis = data.y_axis
                        var x_axisdata2 = JSON.parse(JSON.stringify(data.x_axisdata))

                        for (var i = 0; i < colorlength; i++) {
                            colordata.push('#b8860b');
                        }
                         // console.log(colordata)
                        var trace1 = {
                            x: data.x_axisdata,
                            y: data.y_axisdata,
                            z: data.second_columndata,
                            type: 'mesh3d',
                            color: '#b8860b',
                        };

                        var dataplot = [trace1]
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)

                        var layout = {
                            margin: { l: 40, r: 60, b: 60, t: 10, pad: 4 },
                            hovermode: 'closest',

                            yaxis: {
                                title: {
                                    standoff: 20,
                                    text: y_axis, font: {
                                        family: "Arial"
                                    }
                                }, showgrid: false, 'automargin': true, font: {
                                    family: "Arial"
                                }
                            },
                            xaxis: {
                                title: {
                                    standoff: 20,
                                    text: x_axis, font: {
                                        family: "Arial"
                                    }
                                },
                                showgrid: false, 'automargin': true, font: {
                                    family: "Arial"
                                }
                            },
                        }
                    }
                    else {
                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tab_id = data.plotDict.tab_id
                                                outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)
                        var dataplot = data.plotDict.data
                        dataplot[0].x = data.x_axisdata
                        dataplot[0].y = data.y_axisdata
                        dataplot[0].z = data.second_columndata
                        var colorlength = data.x_axisdata.length
                        var colordata = []
                        for (var i = 0; i < colorlength; i++) {
                            colordata.push('#b8860b');
                        }

                        var layout = data.plotDict.layout

                        var width = width.split("p")
                        var height = height.split("p")

                        var graph_height = height[0] * 0.876
                        var graph_width = width[0] * 0.9481

                        layout["height"] = graph_height
                        layout["width"] = graph_width

                         // console.log(layout)
                    }
                    var config = { responsive: true, displaylogo: false }

                    Plotly.newPlot(tester, dataplot, layout, config)
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})
                    // var y_axis_end = tester.layout.yaxis.range[1]
                    // var y_axis_start = tester.layout.yaxis.range[0]

                     // console.log(tester.layout)

                    document.getElementById(id1).onchange = function () {
                         // console.log(colordata.length)
                        var colorlength = colordata.length
                         // console.log(colorlength)
                        var colordata2 = [];
                        var backRGB = this.value;

                        for (var i = 0; i < colorlength; i++) {
                            colordata2.push(backRGB);
                        }
                         // console.log(colordata2)

                        var update = { "color": backRGB }

                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }

                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id

                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };
                    document.getElementById(id9).onclick = function () {
                        var gridlinesvalue = document.getElementById(id9).value
                         // console.log(gridlinesvalue)
                        var y_axis_title = tester.layout.yaxis.title.text
                        var x_axis_title = tester.layout.xaxis.title.text
                        if (gridlinesvalue == "show_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    automargin: true,
                                    showgrid: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: true, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "hide_gridlines"
                            document.getElementById(id9).innerHTML = "Hide Gridlines"
                        }
                        if (gridlinesvalue == "hide_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    automargin: true,
                                    showgrid: false, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: false, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "show_gridlines"
                            document.getElementById(id9).innerHTML = "Show Gridlines"

                        }
                        Plotly.relayout(tester, layout2)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    };
                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };
                    document.getElementById(id11).onchange = function () {
                        var xaxistitlevalue = document.getElementById(id11).value;

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(xaxistitlevalue)
                         // console.log(tester.layout.xaxis.title)

                        var layout = {
                            xaxis: {
                                showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: xaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }


                        }
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }

                    document.getElementById(id12).onchange = function () {
                        var yaxistitlevalue = document.getElementById(id12).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var y_axis_end = tester.layout.yaxis.range[1]

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(yaxistitlevalue)
                         // console.log(tester.layout.yaxis.title)

                        var layout = {
                            yaxis: {
                                range: [y_axis_start, y_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: yaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }
                        }

                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }

                    try {
                        var changed_text = data.plotDict.changed_text
                    }
                    catch (err) {
                        var changed_text = []

                    }
                    myPlot.on('plotly_afterplot', function () {
                        Plotly.d3.selectAll(".xaxislayer-above").selectAll('text')
                            .on("click", function (d) {
                                 // console.log(d)
                                var labels = tester.data[0].x
                                var position = d.x
                                var text = d.text
                                var labeleditvalue = document.getElementById(id13).value;

                                var dict = {}
                                dict[text] = labeleditvalue
                                changed_text.push(dict)
                                $.each(labels, function (k, v) {
                                    if (v == text) {
                                        labels[k] = labeleditvalue;
                                    }
                                });

                                var update = { "x": [labels] };

                                Plotly.restyle(tester, update)
                                $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))


                                $(`#${id6}`).attr("data-changed_text", JSON.stringify(changed_text))
                                 // console.log(changed_text)

                            });
                    });
                    document.getElementById(id18).onclick = function () {
                         // console.log(x_axisdata2)
                         // console.log(data)
                        var update = { "x": [JSON.parse(JSON.stringify(x_axisdata2))] }
                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }
                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }
                             // console.log(graph_height)
                             // console.log(graph_width)

                            Plotly.relayout(tester, layout)
                            $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                        },
                    });
                }
                if (graph_subtype == '2D_Histogram_Contour') {


                    var outermodalCard = $(`

<div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
right: 0 ;top : 10px;z-index: 1050">


  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
      <button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <label style="font-size:1.1rem">Change the graph color:</label>
  <input type="color" id=${id1} name="favcolor" value="#b8860b"><br><br>
                      <label style="font-size:1.1rem">Change the range of the axis:</label>
  <input type="text" placeholder="Y Axis Start" id=${id2} size="7">
  <input type="text" placeholder="Y Axis End " id=${id3} size="7">
<br><br>
<label style="font-size:1.1rem">Change the title of the axes:</label>
    <input type="text" placeholder="X Axis Title" id=${id11} size="7">
    <input type="text" placeholder="Y Axis Title" id=${id12} size="7">
    <br><br>
<label style="font-size:1.1rem">Change the label of an element:</label><br>
    <input type="text" placeholder="X Axis Label" id=${id13} size="9"> &nbsp;&nbsp;
    <button type="button" class="btn btn-primary" id="${id18}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" style="line-height: 1.1;">Reset Axis Labels</button><br><br>  </div>
</div>
`)
                    if (data.plotDict === undefined) {

                        outerCard.appendTo('#card')
                        var tab_id = 'main_page'
                        outermodalCard.appendTo('#card')
                        var colorlength = data.x_axisdata.length
                        var colordata = data.colordata;
                        var x_axis = data.x_axis
                        var y_axis = data.y_axis
                        var x_axisdata2 = JSON.parse(JSON.stringify(data.x_axisdata))

                        var trace1 = {
                            x: data.x_axisdata,
                            y: data.y_axisdata,
                            type: 'histogram2d',
                            colorscale: colordata
                        };

                        var dataplot = [trace1]
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)

                        var layout = {
                            margin: { l: 40, r: 0, b: 20, t: 10, pad: 4 },
                            hovermode: 'closest',

                            yaxis: {
                                title: {
                                    standoff: 20,
                                    text: y_axis, font: {
                                        family: "Arial"
                                    }
                                }, 'automargin': true, font: {
                                    family: "Arial"
                                }
                            },
                            xaxis: {
                                title: {
                                    standoff: 20,
                                    text: x_axis, font: {
                                        family: "Arial"
                                    }
                                },
                                'automargin': true, font: {
                                    family: "Arial"
                                }
                            },
                        }
                    }
                    else {
                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tab_id = data.plotDict.tab_id
                                                outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)
                        var dataplot = data.plotDict.data
                        dataplot[0].x = data.x_axisdata
                        dataplot[0].y = data.y_axisdata

                        var layout = data.plotDict.layout

                        var width = width.split("p")
                        var height = height.split("p")

                        var graph_height = height[0] * 0.876
                        var graph_width = width[0] * 0.9481

                        layout["height"] = graph_height
                        layout["width"] = graph_width

                         // console.log(layout)
                        var colorlength = data.x_axis.length
                        var colordata = data.colordata
                    }
                    var config = { responsive: true, displaylogo: false }

                    Plotly.newPlot(tester, dataplot, layout, config)
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})
                    var y_axis_end = tester.layout.yaxis.range[1]
                    var y_axis_start = tester.layout.yaxis.range[0]

                     // console.log(tester.layout)

                    document.getElementById(id1).onchange = function () {
                         // console.log(colordata.length)
                        var colorlength = colordata.length
                         // console.log(colorlength)
                        var colorList = [];
                        var backRGB = this.value;
                        var backRGB = this.value;

                        colorList.push(backRGB)
                        for (i = 0; i < colorlength - 1; i++) {
                            var previousHex = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(colorList[colorList.length - 1]);
                            var r = parseInt(previousHex[1], 16) * 0.8;
                            var g = parseInt(previousHex[2], 16) * 0.8;
                            var b = parseInt(previousHex[3], 16) * 0.8;
                            function componentToHex(c) {
                                var hex = c.toString(16);
                                return hex.length == 1 ? "0" + hex : hex;
                            }
                            var newHex = '#' + componentToHex(Math.round(r)) + componentToHex(Math.round(g)) + componentToHex(Math.round(b));
                            colorList.push(newHex)
                        }
                        var update = { colorscale: backRGB };
                         // console.log(tester.data)

                        Plotly.restyle(tester, update)
                    }

                    document.getElementById(id2).onchange = function () {
                        var textbox2length = document.getElementById(id3).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var y_axis_end = tester.layout.yaxis.range[1]
                        var gridlines_value = tester.layout.yaxis.showgrid
                        var y_axis_title = tester.layout.yaxis.title.text

                         // console.log(textbox2length)
                         // console.log(y_axis_end)

                        if (textbox2length == 0) {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, y_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        }
                        else {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)

                    }
                    document.getElementById(id3).onchange = function () {
                        var textbox1length = document.getElementById(id2).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var gridlines_value = tester.layout.yaxis.showgrid
                         // console.log(gridlines_value)
                        var y_axis_title = tester.layout.yaxis.title.text

                        if (textbox1length == 0) {
                            var layout = {
                                yaxis: {
                                    range: [y_axis_start, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        }
                        else {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)

                    }

                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id

                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };

                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };
                    document.getElementById(id11).onchange = function () {
                        var xaxistitlevalue = document.getElementById(id11).value;

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(xaxistitlevalue)
                         // console.log(tester.layout.xaxis.title)

                        var layout = {
                            xaxis: {
                                showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: xaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }


                        }
                        Plotly.relayout(tester, layout)

                    }

                    document.getElementById(id12).onchange = function () {
                        var yaxistitlevalue = document.getElementById(id12).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var y_axis_end = tester.layout.yaxis.range[1]

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(yaxistitlevalue)
                         // console.log(tester.layout.yaxis.title)

                        var layout = {
                            yaxis: {
                                range: [y_axis_start, y_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: yaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }
                        }

                        Plotly.relayout(tester, layout)

                    }
                    myPlot.on('plotly_afterplot', function () {
                        Plotly.d3.selectAll(".xaxislayer-above").selectAll('text')
                            .on("click", function (d) {
                                 // console.log(d)
                                var labels = tester.data[0].x
                                var position = d.x
                                var text = d.text
                                var labeleditvalue = document.getElementById(id13).value;

                                var dict = {}
                                dict[text] = labeleditvalue
                                changed_text.push(dict)
                                $.each(labels, function (k, v) {
                                    if (v == text) {
                                        labels[k] = labeleditvalue;
                                    }
                                });

                                var update = { "x": [labels] };

                                Plotly.restyle(tester, update)

                                $(`#${id6}`).attr("data-changed_text", JSON.stringify(changed_text))
                                 // console.log(changed_text)

                            });
                    });
                    document.getElementById(id18).onclick = function () {
                         // console.log(x_axisdata2)
                         // console.log(data)
                        var update = { "x": [JSON.parse(JSON.stringify(x_axisdata2))] }
                        Plotly.restyle(tester, update)

                    }

                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }
                             // console.log(graph_height)
                             // console.log(graph_width)

                            Plotly.relayout(tester, layout)
                        },
                    });
                }
                if (graph_subtype == 'Vertical_Box') {

                    var outermodalCard = $(`

<div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
right: 0 ;top : 10px;z-index: 1050">


  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
      <button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <label style="font-size:1.1rem">Change the graph color:</label>
  <input type="color" id=${id1} name="favcolor" value="#b8860b"><br><br>
  <label style="font-size:1.1rem">Change X and Y axis gridlines:</label>
      <button type="button" class="btn btn-primary" id="${id9}" data-toggle="button" role="tab"
                      aria-pressed="false" autocomplete="off" value="show_gridlines" style="line-height: 0.7;">Show Gridlines</button><br><br>
                      <label style="font-size:1.1rem">Change the range of the axis:</label>
  <input type="text" placeholder="Y Axis Start" id=${id2} size="7">
  <input type="text" placeholder="Y Axis End " id=${id3} size="7">
<br><br>
<label style="font-size:1.1rem">Change the title of the axes:</label>
    <input type="text" placeholder="X Axis Title" id=${id11} size="7">
    <input type="text" placeholder="Y Axis Title" id=${id12} size="7">
    <br><br>
<label style="font-size:1.1rem">Change the label of an element:</label><br>
    <input type="text" placeholder="X Axis Label" id=${id13} size="9"> &nbsp;&nbsp;
    <button type="button" class="btn btn-primary" id="${id18}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" style="line-height: 1.1;">Reset Axis Labels</button><br><br>  </div>
</div>
`)
                    if (data.plotDict === undefined) {

                        outerCard.appendTo('#card')
                        var tab_id = 'main_page'
                        outermodalCard.appendTo('#card')
                        var colorlength = data.x_axisdata.length
                        var colordata = [];
                        var x_axis = data.x_axis
                        var y_axis = data.y_axis
                        var x_axisdata2 = JSON.parse(JSON.stringify(data.x_axisdata))
                         // console.log(data.y_axisdata)

                        var trace1 = {
                            x: data.x_axisdata,
                            y: data.y_axisdata,
                            type: 'box',
                            boxpoints: false,
                            marker: {
                                color: '#b8860b'
                            }
                        };

                        var dataplot = [trace1]
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)

                        var layout = {
                            margin: { l: 40, r: 0, b: 20, t: 10, pad: 4 },
                            hovermode: 'closest',

                            yaxis: {
                                title: {
                                    standoff: 20,
                                    text: y_axis, font: {
                                        family: "Arial"
                                    }
                                }, showgrid: false, 'automargin': true, font: {
                                    family: "Arial"
                                }
                            },
                            xaxis: {
                                title: {
                                    standoff: 20,
                                    text: x_axis, font: {
                                        family: "Arial"
                                    }
                                },
                                showgrid: false, 'automargin': true, font: {
                                    family: "Arial"
                                }
                            },
                        }
                    }
                    else {
                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tab_id = data.plotDict.tab_id
                                                outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)
                        var dataplot = data.plotDict.data
                        dataplot[0].x = data.x_axisdata
                        dataplot[0].y = data.y_axisdata

                        var x_axisdata2 = JSON.parse(JSON.stringify(data.x_axisdata))
                        var layout = data.plotDict.layout

                        var width = width.split("p")
                        var height = height.split("p")

                        var graph_height = height[0] * 0.876
                        var graph_width = width[0] * 0.9481

                        layout["height"] = graph_height
                        layout["width"] = graph_width

                         // console.log(layout)
                        var colorlength = data.x_axisdata.length
                    }
                    var config = { responsive: true, displaylogo: false }

                    Plotly.newPlot(tester, dataplot, layout, config)
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})
                    var y_axis_end = tester.layout.yaxis.range[1]
                    var y_axis_start = tester.layout.yaxis.range[0]

                     // console.log(tester.layout)


                    document.getElementById(id1).onchange = function () {
                        var colorlength = data.x_axisdata.length
                        var colordata2 = [];
                        var backRGB = this.value;

                        for (var i = 0; i < colorlength; i++) {
                            colordata2.push(backRGB);
                        }
                         // console.log(colordata2)

                        var update = { 'marker': { color: backRGB } };


                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }

                    document.getElementById(id2).onchange = function () {
                        var textbox2length = document.getElementById(id3).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var y_axis_end = tester.layout.yaxis.range[1]
                        var gridlines_value = tester.layout.yaxis.showgrid
                        var y_axis_title = tester.layout.yaxis.title.text

                         // console.log(textbox2length)
                         // console.log(y_axis_end)

                        if (textbox2length == 0) {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, y_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        }
                        else {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id3).onchange = function () {
                        var textbox1length = document.getElementById(id2).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var gridlines_value = tester.layout.yaxis.showgrid
                         // console.log(gridlines_value)
                        var y_axis_title = tester.layout.yaxis.title.text

                        if (textbox1length == 0) {
                            var layout = {
                                yaxis: {
                                    range: [y_axis_start, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        }
                        else {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id

                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };
                    document.getElementById(id9).onclick = function () {
                        var gridlinesvalue = document.getElementById(id9).value
                         // console.log(gridlinesvalue)
                        var y_axis_title = tester.layout.yaxis.title.text
                        var x_axis_title = tester.layout.xaxis.title.text
                        if (gridlinesvalue == "show_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    automargin: true,
                                    showgrid: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: true, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "hide_gridlines"
                            document.getElementById(id9).innerHTML = "Hide Gridlines"
                        }
                        if (gridlinesvalue == "hide_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    automargin: true,
                                    showgrid: false, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: false, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "show_gridlines"
                            document.getElementById(id9).innerHTML = "Show Gridlines"

                        }
                        Plotly.relayout(tester, layout2)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    };
                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };
                    document.getElementById(id11).onchange = function () {
                        var xaxistitlevalue = document.getElementById(id11).value;

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(xaxistitlevalue)
                         // console.log(tester.layout.xaxis.title)

                        var layout = {
                            xaxis: {
                                showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: xaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }


                        }
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }

                    document.getElementById(id12).onchange = function () {
                        var yaxistitlevalue = document.getElementById(id12).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var y_axis_end = tester.layout.yaxis.range[1]

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(yaxistitlevalue)
                         // console.log(tester.layout.yaxis.title)

                        var layout = {
                            yaxis: {
                                range: [y_axis_start, y_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: yaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }
                        }

                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    try {
                        var changed_text = data.plotDict.changed_text
                    }
                    catch (err) {
                        var changed_text = []

                    }
                    myPlot.on('plotly_afterplot', function () {
                        Plotly.d3.selectAll(".xaxislayer-above").selectAll('text')
                            .on("click", function (d) {
                                 // console.log(d)
                                var labels = tester.data[0].x
                                var position = d.x
                                var text = d.text
                                var labeleditvalue = document.getElementById(id13).value;

                                var dict = {}
                                dict[text] = labeleditvalue
                                changed_text.push(dict)
                                $.each(labels, function (k, v) {
                                    if (v == text) {
                                        labels[k] = labeleditvalue;
                                    }
                                });
                                var update = { "x": [labels] };

                                Plotly.restyle(tester, update)
                                $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))


                                $(`#${id6}`).attr("data-changed_text", JSON.stringify(changed_text))
                                 // console.log(changed_text)

                            });
                    });
                    document.getElementById(id18).onclick = function () {
                         // console.log(x_axisdata2)
                         // console.log(data)
                        var update = { "x": [JSON.parse(JSON.stringify(x_axisdata2))] }
                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }

                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }
                             // console.log(graph_height)
                             // console.log(graph_width)

                            Plotly.relayout(tester, layout)
                            $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                        },
                    });
                }
                if (graph_subtype == 'Vertical_Violin') {


                    var outermodalCard = $(`

<div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
right: 0 ;top : 10px;z-index: 1050">


  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
      <button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <label style="font-size:1.1rem">Change the graph color:</label>
  <input type="color" id=${id1} name="favcolor" value="#b8860b"><br><br>
  <label style="font-size:1.1rem">Change the color or an element:</label>
  <input type="color" id=${id4} name="favcolor1" value="#b8860b"><br><br><label style="font-size:1.1rem">Change X and Y axis gridlines:</label>
      <button type="button" class="btn btn-primary" id="${id9}" data-toggle="button" role="tab"
                      aria-pressed="false" autocomplete="off" value="show_gridlines" style="line-height: 0.7;">Show Gridlines</button><br><br>
                      <label style="font-size:1.1rem">Change the range of the axis:</label>
  <input type="text" placeholder="Y Axis Start" id=${id2} size="7">
  <input type="text" placeholder="Y Axis End " id=${id3} size="7">
<br><br>
<label style="font-size:1.1rem">Change the title of the axes:</label>
    <input type="text" placeholder="X Axis Title" id=${id11} size="7">
    <input type="text" placeholder="Y Axis Title" id=${id12} size="7">
    <br><br>
<label style="font-size:1.1rem">Change the label of an element:</label><br>
    <input type="text" placeholder="X Axis Label" id=${id13} size="9"> &nbsp;&nbsp;
    <button type="button" class="btn btn-primary" id="${id18}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" style="line-height: 1.1;">Reset Axis Labels</button><br><br>
  </div>
</div>
`)
                    if (data.plotDict === undefined) {

                        outerCard.appendTo('#card')
                        var tab_id = 'main_page'
                        outermodalCard.appendTo('#card')
                        var colorlength = data.x_axisdata.length
                        var colordata = [];
                        var x_axis = data.x_axis
                        var y_axis = data.y_axis
                        var x_axisdata2 = JSON.parse(JSON.stringify(data.x_axisdata))
                         // console.log(data.y_axisdata)

                        var trace1 = {
                            x: data.x_axisdata,
                            y: data.y_axisdata,
                            type: 'violin',
                            boxpoints: false,
                            marker: {
                                color: '#b8860b'
                            }
                        };

                        var dataplot = [trace1]
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)

                        var layout = {
                            margin: { l: 40, r: 0, b: 20, t: 10, pad: 4 },
                            hovermode: 'closest',

                            yaxis: {
                                title: {
                                    standoff: 20,
                                    text: y_axis, font: {
                                        family: "Arial"
                                    }
                                }, showgrid: false, 'automargin': true, font: {
                                    family: "Arial"
                                }
                            },
                            xaxis: {
                                title: {
                                    standoff: 20,
                                    text: x_axis, font: {
                                        family: "Arial"
                                    }
                                },
                                showgrid: false, 'automargin': true, font: {
                                    family: "Arial"
                                }
                            },
                        }
                    }
                    else {
                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tab_id = data.plotDict.tab_id
                                                outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)
                        var dataplot = data.plotDict.data
                        dataplot[0].x = data.x_axisdata
                        dataplot[0].y = data.y_axisdata
                        var x_axisdata2 = JSON.parse(JSON.stringify(data.x_axisdata))
                        var layout = data.plotDict.layout

                        var width = width.split("p")
                        var height = height.split("p")

                        var graph_height = height[0] * 0.876
                        var graph_width = width[0] * 0.9481

                        layout["height"] = graph_height
                        layout["width"] = graph_width

                         // console.log(layout)
                        var colorlength = data.x_axis.length
                        var colordata = data.colordata
                    }
                    var config = { responsive: true, displaylogo: false }

                    Plotly.newPlot(tester, dataplot, layout, config)
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})
                    var y_axis_end = tester.layout.yaxis.range[1]
                    var y_axis_start = tester.layout.yaxis.range[0]

                     // console.log(tester.layout)


                    document.getElementById(id1).onchange = function () {
                        var colorlength = data.x_axisdata.length
                         // console.log(colorlength)
                        var colordata2 = [];
                        var backRGB = this.value;

                        for (var i = 0; i < colorlength; i++) {
                            colordata2.push(backRGB);
                        }
                         // console.log(colordata2)

                        var update = { 'marker': { color: backRGB } };


                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }

                    document.getElementById(id2).onchange = function () {
                        var textbox2length = document.getElementById(id3).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var y_axis_end = tester.layout.yaxis.range[1]
                        var gridlines_value = tester.layout.yaxis.showgrid
                        var y_axis_title = tester.layout.yaxis.title.text

                         // console.log(textbox2length)
                         // console.log(y_axis_end)

                        if (textbox2length == 0) {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, y_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        }
                        else {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))


                    }
                    document.getElementById(id3).onchange = function () {
                        var textbox1length = document.getElementById(id2).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var gridlines_value = tester.layout.yaxis.showgrid
                         // console.log(gridlines_value)
                        var y_axis_title = tester.layout.yaxis.title.text

                        if (textbox1length == 0) {
                            var layout = {
                                yaxis: {
                                    range: [y_axis_start, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        }
                        else {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))


                    }
                    myPlot.on('plotly_click', function (data) {
                         // console.log(data.points[0].x)
                         // console.log(data.points)

                        var pn = '',
                            tn = '',
                            colors = [];
                        for (var i = 0; i < data.points.length; i++) {
                            pn = data.points[i].pointNumber;
                            tn = data.points[i].curveNumber;
                            colors = data.points[i].data.marker.color;
                        };
                         // console.log(colors)

                        var color = document.getElementById(id4).value
                        colors[pn] = color;
                         // console.log(pn)
                         // console.log(tn)
                         // console.log(colors)
                        var update = { 'marker': { color: colors } };
                        Plotly.restyle(tester, update, [tn])
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    });
                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id

                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };
                    document.getElementById(id9).onclick = function () {
                        var gridlinesvalue = document.getElementById(id9).value
                         // console.log(gridlinesvalue)
                        var y_axis_title = tester.layout.yaxis.title.text
                        var x_axis_title = tester.layout.xaxis.title.text
                        if (gridlinesvalue == "show_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    automargin: true,
                                    showgrid: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: true, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "hide_gridlines"
                            document.getElementById(id9).innerHTML = "Hide Gridlines"
                        }
                        if (gridlinesvalue == "hide_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    automargin: true,
                                    showgrid: false, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: false, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "show_gridlines"
                            document.getElementById(id9).innerHTML = "Show Gridlines"

                        }
                        Plotly.relayout(tester, layout2)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))


                    };
                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };
                    document.getElementById(id11).onchange = function () {
                        var xaxistitlevalue = document.getElementById(id11).value;

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(xaxistitlevalue)
                         // console.log(tester.layout.xaxis.title)

                        var layout = {
                            xaxis: {
                                showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: xaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }


                        }
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))


                    }

                    document.getElementById(id12).onchange = function () {
                        var yaxistitlevalue = document.getElementById(id12).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var y_axis_end = tester.layout.yaxis.range[1]

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(yaxistitlevalue)
                         // console.log(tester.layout.yaxis.title)

                        var layout = {
                            yaxis: {
                                range: [y_axis_start, y_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: yaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }
                        }

                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))


                    }

                    try {
                        var changed_text = data.plotDict.changed_text
                    }
                    catch (err) {
                        var changed_text = []

                    }
                    myPlot.on('plotly_afterplot', function () {
                        Plotly.d3.selectAll(".xaxislayer-above").selectAll('text')
                            .on("click", function (d) {
                                 // console.log(d)
                                var labels = tester.data[0].x
                                var position = d.x
                                var text = d.text
                                var labeleditvalue = document.getElementById(id13).value;

                                var dict = {}
                                dict[text] = labeleditvalue
                                changed_text.push(dict)
                                $.each(labels, function (k, v) {
                                    if (v == text) {
                                        labels[k] = labeleditvalue;
                                    }
                                });
                                var update = { "x": [labels] };

                                Plotly.restyle(tester, update)
                                $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))


                                $(`#${id6}`).attr("data-changed_text", JSON.stringify(changed_text))
                                 // console.log(changed_text)

                            });
                    });
                    document.getElementById(id18).onclick = function () {
                         // console.log(x_axisdata2)
                         // console.log(data)
                        var update = { "x": [JSON.parse(JSON.stringify(x_axisdata2))] }
                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }
                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }
                             // console.log(graph_height)
                             // console.log(graph_width)

                            Plotly.relayout(tester, layout)
                            $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                        },
                    });
                }
                if (graph_subtype == 'Horizontal_Dot_Plot') {


                    var outermodalCard = $(`

<div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
right: 0 ;top : 10px;z-index: 1050">


  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
      <button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <label style="font-size:1.1rem">Change the graph color:</label>
  <input type="color" id=${id1} name="favcolor" value="#b8860b"><br><br>
  <label style="font-size:1.1rem">Change the color or an element:</label>
  <input type="color" id=${id4} name="favcolor1" value="#b8860b"><br><br><label style="font-size:1.1rem">Change X and Y axis gridlines:</label>
      <button type="button" class="btn btn-primary" id="${id9}" data-toggle="button" role="tab"
                      aria-pressed="false" autocomplete="off" value="show_gridlines" style="line-height: 0.7;">Show Gridlines</button><br><br>
                      <label style="font-size:1.1rem">Change the range of the axis:</label>
  <input type="text" placeholder="Y Axis Start" id=${id2} size="7">
  <input type="text" placeholder="Y Axis End " id=${id3} size="7">
<br><br>
<label style="font-size:1.1rem">Change the title of the axes:</label>
    <input type="text" placeholder="X Axis Title" id=${id11} size="7">
    <input type="text" placeholder="Y Axis Title" id=${id12} size="7">
    <br><br>
<label style="font-size:1.1rem">Change the label of an element:</label><br>
    <input type="text" placeholder="Y Axis Label" id=${id13} size="9"> &nbsp;&nbsp;
    <button type="button" class="btn btn-primary" id="${id18}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" style="line-height: 1.1;">Reset Axis Labels</button><br><br>
  </div>
</div>
`)
                    if (data.plotDict === undefined) {

                        outerCard.appendTo('#card')
                        var tab_id = 'main_page'
                        outermodalCard.appendTo('#card')
                        var colorlength = data.x_axisdata.length
                        var colordata = [];
                        var x_axis = data.x_axis
                        var y_axis = data.y_axis
                        var y_axisdata2 = JSON.parse(JSON.stringify(data.y_axisdata))

                        for (var i = 0; i < colorlength; i++) {
                            colordata.push('#b8860b');
                        }
                         // console.log(colordata)
                        var trace1 = {
                            x: data.x_axisdata,
                            y: data.y_axisdata,
                            mode: 'markers',
                            marker: {
                                color: colordata,
                                symbol: 'circle',
                            }
                        };

                        var dataplot = [trace1]
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)

                        var layout = {
                            margin: { l: 40, r: 0, b: 20, t: 10, pad: 4 },
                            hovermode: 'closest',

                            yaxis: {
                                title: {
                                    standoff: 20,
                                    text: y_axis, font: {
                                        family: "Arial"
                                    }
                                }, showgrid: false, 'automargin': true, font: {
                                    family: "Arial"
                                }
                            },
                            xaxis: {
                                title: {
                                    standoff: 20,
                                    text: x_axis, font: {
                                        family: "Arial"
                                    }
                                },
                                showgrid: false, 'automargin': true, font: {
                                    family: "Arial"
                                }
                            },
                        }
                    }
                    else {

                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tab_id = data.plotDict.tab_id
                                                outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)
                        var dataplot = data.plotDict.data
                        dataplot[0].x = data.x_axisdata
                        dataplot[0].y = data.y_axisdata
                        var y_axisdata2 = JSON.parse(JSON.stringify(data.y_axisdata))

                        var colorlength = data.x_axisdata.length
                        var colordata = [];
                        for (var i = 0; i < colorlength; i++) {
                            colordata.push('#b8860b');
                        }
                        dataplot[0].marker.color = colordata
                        var layout = data.plotDict.layout

                        var width = width.split("p")
                        var height = height.split("p")

                        var graph_height = height[0] * 0.876
                        var graph_width = width[0] * 0.9481

                        layout["height"] = graph_height
                        layout["width"] = graph_width

                         // console.log(layout)
                    }
                    var config = { responsive: true, displaylogo: false }

                    Plotly.newPlot(tester, dataplot, layout, config)
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})
                    var x_axis_end = tester.layout.xaxis.range[1]
                    var x_axis_start = tester.layout.xaxis.range[0]

                     // console.log(tester.layout)

                    document.getElementById(id1).onchange = function () {
                        var colorlength = data.x_axisdata.length
                         // console.log(colorlength)
                        var colordata2 = [];
                        var backRGB = this.value;

                        for (var i = 0; i < colorlength; i++) {
                            colordata2.push(backRGB);
                        }
                         // console.log(colordata2)

                        var update = { 'marker': { color: colordata2 } };


                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }

                    document.getElementById(id2).onchange = function () {
                        var textbox2length = document.getElementById(id3).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var x_axis_end = tester.layout.xaxis.range[1]
                        var gridlines_value = tester.layout.yaxis.showgrid
                        var x_axis_title = tester.layout.xaxis.title.text

                         // console.log(textbox2length)
                         // console.log(x_axis_end)

                        if (textbox2length == 0) {
                            var layout = {
                                xaxis: {
                                    range: [textbox1value, x_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        }
                        else {
                            var layout = {
                                xaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))


                    }
                    document.getElementById(id3).onchange = function () {
                        var textbox1length = document.getElementById(id2).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var x_axis_start = tester.layout.xaxis.range[0]
                        var gridlines_value = tester.layout.xaxis.showgrid
                         // console.log(gridlines_value)
                        var x_axis_title = tester.layout.xaxis.title.text

                        if (textbox1length == 0) {
                            var layout = {
                                xaxis: {
                                    range: [x_axis_start, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        }
                        else {
                            var layout = {
                                xaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))


                    }
                    myPlot.on('plotly_click', function (data) {
                         // console.log(data.points[0].x)
                         // console.log(data.points)

                        var pn = '',
                            tn = '',
                            colors = [];
                        for (var i = 0; i < data.points.length; i++) {
                            pn = data.points[i].pointNumber;
                            tn = data.points[i].curveNumber;
                            colors = data.points[i].data.marker.color;
                        };
                         // console.log(colors)

                        var color = document.getElementById(id4).value
                        colors[pn] = color;
                         // console.log(pn)
                         // console.log(tn)
                         // console.log(colors)
                        var update = { 'marker': { color: colors } };
                        Plotly.restyle(tester, update, [tn])
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    });
                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id

                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };
                    document.getElementById(id9).onclick = function () {
                        var gridlinesvalue = document.getElementById(id9).value
                         // console.log(gridlinesvalue)
                        var y_axis_title = tester.layout.yaxis.title.text
                        var x_axis_title = tester.layout.xaxis.title.text
                        if (gridlinesvalue == "show_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    automargin: true,
                                    showgrid: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: true, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "hide_gridlines"
                            document.getElementById(id9).innerHTML = "Hide Gridlines"
                        }
                        if (gridlinesvalue == "hide_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    automargin: true,
                                    showgrid: false, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: false, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "show_gridlines"
                            document.getElementById(id9).innerHTML = "Show Gridlines"

                        }
                        Plotly.relayout(tester, layout2)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    };
                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };
                    document.getElementById(id11).onchange = function () {
                        var xaxistitlevalue = document.getElementById(id11).value;

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(xaxistitlevalue)
                         // console.log(tester.layout.xaxis.title)

                        var layout = {
                            xaxis: {
                                showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: xaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }


                        }
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }

                    document.getElementById(id12).onchange = function () {
                        var yaxistitlevalue = document.getElementById(id12).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var y_axis_end = tester.layout.yaxis.range[1]

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(yaxistitlevalue)
                         // console.log(tester.layout.yaxis.title)

                        var layout = {
                            yaxis: {
                                range: [y_axis_start, y_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: yaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }
                        }

                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }

                    myPlot.on('plotly_afterplot', function () {
                        Plotly.d3.selectAll(".yaxislayer-above").selectAll('text')
                            .on("click", function (d) {
                                 // console.log(d)
                                var labels = tester.data[0].y
                                var position = d.x
                                var text = d.text
                                var labeleditvalue = document.getElementById(id13).value;

                                var dict = {}
                                dict[text] = labeleditvalue
                                changed_text.push(dict)
                                labels[position] = labeleditvalue;
                                 // console.log(position)
                                 // console.log(labels)

                                var update = { "y": [labels] };

                                Plotly.restyle(tester, update)
                                $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))


                                $(`#${id6}`).attr("data-changed_text", JSON.stringify(changed_text))
                                 // console.log(changed_text)

                            });
                    });
                    document.getElementById(id18).onclick = function () {
                         // console.log(y_axisdata2)
                         // console.log(data)
                        var update = { "y": [JSON.parse(JSON.stringify(y_axisdata2))] }
                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))


                    }
                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }
                             // console.log(graph_height)
                             // console.log(graph_width)

                            Plotly.relayout(tester, layout)
                            $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                        },
                    });
                }
                if (graph_subtype == 'Horizontal_Box') {

                    var outermodalCard = $(`

<div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
right: 0 ;top : 10px;z-index: 1050">


  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
      <button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <label style="font-size:1.1rem">Change the graph color:</label>
  <input type="color" id=${id1} name="favcolor" value="#b8860b"><br><br>
  <label style="font-size:1.1rem">Change the color or an element:</label>
  <input type="color" id=${id4} name="favcolor1" value="#b8860b"><br><br><label style="font-size:1.1rem">Change X and Y axis gridlines:</label>
      <button type="button" class="btn btn-primary" id="${id9}" data-toggle="button" role="tab"
                      aria-pressed="false" autocomplete="off" value="show_gridlines" style="line-height: 0.7;">Show Gridlines</button><br><br>
                      <label style="font-size:1.1rem">Change the range of the axis:</label>
  <input type="text" placeholder="Y Axis Start" id=${id2} size="7">
  <input type="text" placeholder="Y Axis End " id=${id3} size="7">
<br><br>
<label style="font-size:1.1rem">Change the title of the axes:</label>
    <input type="text" placeholder="X Axis Title" id=${id11} size="7">
    <input type="text" placeholder="Y Axis Title" id=${id12} size="7">
    <br><br>
<label style="font-size:1.1rem">Change the label of an element:</label><br>
    <input type="text" placeholder="Y Axis Label" id=${id13} size="9"> &nbsp;&nbsp;
    <button type="button" class="btn btn-primary" id="${id18}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" style="line-height: 1.1;">Reset Axis Labels</button><br><br>
  </div>
</div>
`)
                    if (data.plotDict === undefined) {

                        outerCard.appendTo('#card')
                        var tab_id = 'main_page'
                        outermodalCard.appendTo('#card')
                        var colorlength = data.x_axisdata.length
                        var colordata = [];
                        var x_axis = data.x_axis
                        var y_axis = data.y_axis
                        var y_axisdata2 = JSON.parse(JSON.stringify(data.y_axisdata))
                         // console.log(data.x_axisdata)
                        var trace1 = {
                            x: data.x_axisdata,
                            y: data.y_axisdata,
                            type: 'box',
                            boxpoints: false,
                            marker: {
                                color: '#b8860b'
                            },
                            orientation: 'h'
                        };

                        var dataplot = [trace1]
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)

                        var layout = {
                            margin: { l: 40, r: 0, b: 20, t: 10, pad: 4 },
                            hovermode: 'closest',

                            yaxis: {
                                title: {
                                    standoff: 20,
                                    text: y_axis, font: {
                                        family: "Arial"
                                    }
                                }, showgrid: false, 'automargin': true, font: {
                                    family: "Arial"
                                }
                            },
                            xaxis: {
                                title: {
                                    standoff: 20,
                                    text: x_axis, font: {
                                        family: "Arial"
                                    }
                                },
                                showgrid: false, 'automargin': true, font: {
                                    family: "Arial"
                                }
                            },
                        }
                    }
                    else {
                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tab_id = data.plotDict.tab_id
                                                outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)
                        var dataplot = data.plotDict.data
                        dataplot[0].x = data.x_axisdata
                        dataplot[0].y = data.y_axisdata
                        var y_axisdata2 = JSON.parse(JSON.stringify(data.y_axisdata))

                        var layout = data.plotDict.layout

                        var width = width.split("p")
                        var height = height.split("p")

                        var graph_height = height[0] * 0.876
                        var graph_width = width[0] * 0.9481

                        layout["height"] = graph_height
                        layout["width"] = graph_width

                         // console.log(layout)
                        var colorlength = data.x_axisdata.length
                    }
                    var config = { responsive: true, displaylogo: false }

                    Plotly.newPlot(tester, dataplot, layout, config)
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})
                    var x_axis_end = tester.layout.xaxis.range[1]
                    var x_axis_start = tester.layout.xaxis.range[0]

                     // console.log(tester.layout)

                    document.getElementById(id1).onchange = function () {
                        var colorlength = data.x_axisdata.length
                         // console.log(colorlength)
                        var colordata2 = [];
                        var backRGB = this.value;

                        var update = { 'marker': { color: backRGB } };


                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }

                    document.getElementById(id2).onchange = function () {
                        var textbox2length = document.getElementById(id3).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var x_axis_end = tester.layout.xaxis.range[1]
                        var gridlines_value = tester.layout.yaxis.showgrid
                        var x_axis_title = tester.layout.xaxis.title.text

                         // console.log(textbox2length)
                         // console.log(x_axis_end)

                        if (textbox2length == 0) {
                            var layout = {
                                xaxis: {
                                    range: [textbox1value, x_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        }
                        else {
                            var layout = {
                                xaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id3).onchange = function () {
                        var textbox1length = document.getElementById(id2).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var x_axis_start = tester.layout.xaxis.range[0]
                        var gridlines_value = tester.layout.xaxis.showgrid
                         // console.log(gridlines_value)
                        var x_axis_title = tester.layout.xaxis.title.text

                        if (textbox1length == 0) {
                            var layout = {
                                xaxis: {
                                    range: [x_axis_start, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        }
                        else {
                            var layout = {
                                xaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    myPlot.on('plotly_click', function (data) {
                         // console.log(data.points[0].x)
                         // console.log(data.points)

                        var pn = '',
                            tn = '',
                            colors = [];
                        for (var i = 0; i < data.points.length; i++) {
                            pn = data.points[i].pointNumber;
                            tn = data.points[i].curveNumber;
                            colors = data.points[i].data.marker.color;
                        };
                         // console.log(colors)

                        var color = document.getElementById(id4).value
                        colors[pn] = color;
                         // console.log(pn)
                         // console.log(tn)
                         // console.log(colors)
                        var update = { 'marker': { color: colors } };
                        Plotly.restyle(tester, update, [tn])
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    });
                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id

                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };
                    document.getElementById(id9).onclick = function () {
                        var gridlinesvalue = document.getElementById(id9).value
                         // console.log(gridlinesvalue)
                        var y_axis_title = tester.layout.yaxis.title.text
                        var x_axis_title = tester.layout.xaxis.title.text
                        if (gridlinesvalue == "show_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    automargin: true,
                                    showgrid: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: true, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "hide_gridlines"
                            document.getElementById(id9).innerHTML = "Hide Gridlines"
                        }
                        if (gridlinesvalue == "hide_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    automargin: true,
                                    showgrid: false, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: false, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "show_gridlines"
                            document.getElementById(id9).innerHTML = "Show Gridlines"

                        }
                        Plotly.relayout(tester, layout2)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    };
                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };
                    document.getElementById(id11).onchange = function () {
                        var xaxistitlevalue = document.getElementById(id11).value;

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(xaxistitlevalue)
                         // console.log(tester.layout.xaxis.title)

                        var layout = {
                            xaxis: {
                                showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: xaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }


                        }
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }

                    document.getElementById(id12).onchange = function () {
                        var yaxistitlevalue = document.getElementById(id12).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var y_axis_end = tester.layout.yaxis.range[1]

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(yaxistitlevalue)
                         // console.log(tester.layout.yaxis.title)

                        var layout = {
                            yaxis: {
                                range: [y_axis_start, y_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: yaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }
                        }

                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }

                    myPlot.on('plotly_afterplot', function () {
                        Plotly.d3.selectAll(".yaxislayer-above").selectAll('text')
                            .on("click", function (d) {
                                 // console.log(d)
                                var labels = tester.data[0].y
                                var position = d.x
                                var text = d.text
                                var labeleditvalue = document.getElementById(id13).value;

                                var dict = {}
                                dict[text] = labeleditvalue
                                changed_text.push(dict)
                                $.each(labels, function (k, v) {
                                    if (v == text) {
                                        labels[k] = labeleditvalue;
                                    }
                                });
                                 // console.log(position)
                                 // console.log(labels)

                                var update = { "y": [labels] };

                                Plotly.restyle(tester, update)
                                $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))


                                $(`#${id6}`).attr("data-changed_text", JSON.stringify(changed_text))
                                 // console.log(changed_text)

                            });
                    });
                    document.getElementById(id18).onclick = function () {
                         // console.log(y_axisdata2)
                         // console.log(data)
                        var update = { "y": [JSON.parse(JSON.stringify(y_axisdata2))] }
                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))


                    }
                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }
                             // console.log(graph_height)
                             // console.log(graph_width)

                            Plotly.relayout(tester, layout)
                            $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                        },
                    });
                }
                if (graph_subtype == 'Horizontal_Violin') {


                    var outermodalCard = $(`

<div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
right: 0 ;top : 10px;z-index: 1050">


  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
      <button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <label style="font-size:1.1rem">Change the graph color:</label>
  <input type="color" id=${id1} name="favcolor" value="#b8860b"><br><br>
  <label style="font-size:1.1rem">Change the color or an element:</label>
  <input type="color" id=${id4} name="favcolor1" value="#b8860b"><br><br><label style="font-size:1.1rem">Change X and Y axis gridlines:</label>
      <button type="button" class="btn btn-primary" id="${id9}" data-toggle="button" role="tab"
                      aria-pressed="false" autocomplete="off" value="show_gridlines" style="line-height: 0.7;">Show Gridlines</button><br><br>
                      <label style="font-size:1.1rem">Change the range of the axis:</label>
  <input type="text" placeholder="Y Axis Start" id=${id2} size="7">
  <input type="text" placeholder="Y Axis End " id=${id3} size="7">
<br><br>
<label style="font-size:1.1rem">Change the title of the axes:</label>
    <input type="text" placeholder="X Axis Title" id=${id11} size="7">
    <input type="text" placeholder="Y Axis Title" id=${id12} size="7">
    <br><br>
<label style="font-size:1.1rem">Change the label of an element:</label><br>
    <input type="text" placeholder="Y Axis Label" id=${id13} size="9"> &nbsp;&nbsp;
    <button type="button" class="btn btn-primary" id="${id18}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" style="line-height: 1.1;">Reset Axis Labels</button><br><br>
  </div>
</div>
`)
                    if (data.plotDict === undefined) {

                        outerCard.appendTo('#card')
                        var tab_id = 'main_page'
                        outermodalCard.appendTo('#card')
                        var colorlength = data.x_axisdata.length
                        var colordata = [];
                        var x_axis = data.x_axis
                        var y_axis = data.y_axis
                        var y_axisdata2 = JSON.parse(JSON.stringify(data.y_axisdata))
                         // console.log(data.x_axisdata)
                        var trace1 = {
                            x: data.x_axisdata,
                            y: data.y_axisdata,
                            type: 'violin',
                            boxpoints: false,
                            marker: {
                                color: '#b8860b'
                            },
                            orientation: 'h'
                        };

                        var dataplot = [trace1]
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)

                        var layout = {
                            margin: { l: 40, r: 0, b: 20, t: 10, pad: 4 },
                            hovermode: 'closest',

                            yaxis: {
                                title: {
                                    standoff: 20,
                                    text: y_axis, font: {
                                        family: "Arial"
                                    }
                                }, showgrid: false, 'automargin': true, font: {
                                    family: "Arial"
                                }
                            },
                            xaxis: {
                                title: {
                                    standoff: 20,
                                    text: x_axis, font: {
                                        family: "Arial"
                                    }
                                },
                                showgrid: false, 'automargin': true, font: {
                                    family: "Arial"
                                }
                            },
                        }
                    }
                    else {
                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tab_id = data.plotDict.tab_id
                                                outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)
                        var dataplot = data.plotDict.data
                        dataplot[0].x = data.x_axisdata
                        dataplot[0].y = data.y_axisdata

                        var y_axisdata2 = JSON.parse(JSON.stringify(data.y_axisdata))
                        var layout = data.plotDict.layout

                        var width = width.split("p")
                        var height = height.split("p")

                        var graph_height = height[0] * 0.876
                        var graph_width = width[0] * 0.9481

                        layout["height"] = graph_height
                        layout["width"] = graph_width

                         // console.log(layout)
                        var colorlength = data.x_axisdata.length
                    }
                    var config = { responsive: true, displaylogo: false }

                    Plotly.newPlot(tester, dataplot, layout, config)
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})
                    var x_axis_end = tester.layout.xaxis.range[1]
                    var x_axis_start = tester.layout.xaxis.range[0]

                     // console.log(tester.layout)

                    document.getElementById(id1).onchange = function () {
                        var colorlength = data.x_axisdata.length
                         // console.log(colorlength)
                        var colordata2 = [];
                        var backRGB = this.value;

                        var update = { 'marker': { color: backRGB } };


                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }

                    document.getElementById(id2).onchange = function () {
                        var textbox2length = document.getElementById(id3).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var x_axis_end = tester.layout.xaxis.range[1]
                        var gridlines_value = tester.layout.yaxis.showgrid
                        var x_axis_title = tester.layout.xaxis.title.text

                         // console.log(textbox2length)
                         // console.log(x_axis_end)

                        if (textbox2length == 0) {
                            var layout = {
                                xaxis: {
                                    range: [textbox1value, x_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        }
                        else {
                            var layout = {
                                xaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id3).onchange = function () {
                        var textbox1length = document.getElementById(id2).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var x_axis_start = tester.layout.xaxis.range[0]
                        var gridlines_value = tester.layout.xaxis.showgrid
                         // console.log(gridlines_value)
                        var x_axis_title = tester.layout.xaxis.title.text

                        if (textbox1length == 0) {
                            var layout = {
                                xaxis: {
                                    range: [x_axis_start, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        }
                        else {
                            var layout = {
                                xaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    myPlot.on('plotly_click', function (data) {
                         // console.log(data.points[0].x)
                         // console.log(data.points)

                        var pn = '',
                            tn = '',
                            colors = [];
                        for (var i = 0; i < data.points.length; i++) {
                            pn = data.points[i].pointNumber;
                            tn = data.points[i].curveNumber;
                            colors = data.points[i].data.marker.color;
                        };
                         // console.log(colors)

                        var color = document.getElementById(id4).value
                        colors[pn] = color;
                         // console.log(pn)
                         // console.log(tn)
                         // console.log(colors)
                        var update = { 'marker': { color: colors } };
                        Plotly.restyle(tester, update, [tn])
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    });
                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id

                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };
                    document.getElementById(id9).onclick = function () {
                        var gridlinesvalue = document.getElementById(id9).value
                         // console.log(gridlinesvalue)
                        var y_axis_title = tester.layout.yaxis.title.text
                        var x_axis_title = tester.layout.xaxis.title.text
                        if (gridlinesvalue == "show_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    automargin: true,
                                    showgrid: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: true, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "hide_gridlines"
                            document.getElementById(id9).innerHTML = "Hide Gridlines"
                        }
                        if (gridlinesvalue == "hide_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    automargin: true,
                                    showgrid: false, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: false, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "show_gridlines"
                            document.getElementById(id9).innerHTML = "Show Gridlines"

                        }
                        Plotly.relayout(tester, layout2)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    };
                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };
                    document.getElementById(id11).onchange = function () {
                        var xaxistitlevalue = document.getElementById(id11).value;

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(xaxistitlevalue)
                         // console.log(tester.layout.xaxis.title)

                        var layout = {
                            xaxis: {
                                showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: xaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }


                        }
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }

                    document.getElementById(id12).onchange = function () {
                        var yaxistitlevalue = document.getElementById(id12).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var y_axis_end = tester.layout.yaxis.range[1]

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(yaxistitlevalue)
                         // console.log(tester.layout.yaxis.title)

                        var layout = {
                            yaxis: {
                                range: [y_axis_start, y_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: yaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }
                        }

                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }

                    myPlot.on('plotly_afterplot', function () {
                        Plotly.d3.selectAll(".yaxislayer-above").selectAll('text')
                            .on("click", function (d) {
                                 // console.log(d)
                                var labels = tester.data[0].y
                                var position = d.x
                                var text = d.text
                                var labeleditvalue = document.getElementById(id13).value;

                                var dict = {}
                                dict[text] = labeleditvalue
                                changed_text.push(dict)
                                $.each(labels, function (k, v) {
                                    if (v == text) {
                                        labels[k] = labeleditvalue;
                                    }
                                });
                                 // console.log(position)
                                 // console.log(labels)

                                var update = { "y": [labels] };

                                Plotly.restyle(tester, update)
                                $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))


                                $(`#${id6}`).attr("data-changed_text", JSON.stringify(changed_text))
                                 // console.log(changed_text)

                            });
                    });
                    document.getElementById(id18).onclick = function () {
                         // console.log(y_axisdata2)
                         // console.log(data)
                        var update = { "y": [JSON.parse(JSON.stringify(y_axisdata2))] }
                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))


                    }
                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }
                             // console.log(graph_height)
                             // console.log(graph_width)

                            Plotly.relayout(tester, layout)
                            $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                        },
                    });
                }
                if (graph_subtype == 'Scatter_with_Straight_Lines_and_Markers') {


                    var outermodalCard = $(`

<div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
right: 0 ;top : 10px;z-index: 1050">


  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
      <button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <label style="font-size:1.1rem">Change the graph color:</label>
  <input type="color" id=${id1} name="favcolor" value="#b8860b"><br><br>
  <label style="font-size:1.1rem">Change the color or an element:</label>
  <input type="color" id=${id4} name="favcolor1" value="#b8860b"><br><br><label style="font-size:1.1rem">Change X and Y axis gridlines:</label>
      <button type="button" class="btn btn-primary" id="${id9}" data-toggle="button" role="tab"
                      aria-pressed="false" autocomplete="off" value="show_gridlines" style="line-height: 0.7;">Show Gridlines</button><br><br>
                      <label style="font-size:1.1rem">Change the range of the axis:</label>
  <input type="text" placeholder="Y Axis Start" id=${id2} size="7">
  <input type="text" placeholder="Y Axis End " id=${id3} size="7">

<br><br>
<label style="font-size:1.1rem">Change the title of the axes:</label>
    <input type="text" placeholder="X Axis Title" id=${id11} size="7">
    <input type="text" placeholder="Y Axis Title" id=${id12} size="7">
    <br><br>
<label style="font-size:1.1rem">Change the label of an element:</label><br>
    <input type="text" placeholder="X Axis Label" id=${id13} size="9"> &nbsp;&nbsp;
    <button type="button" class="btn btn-primary" id="${id18}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" style="line-height: 1.1;">Reset Axis Labels</button><br><br>
  </div>
</div>
`)
                    if (data.plotDict === undefined) {

                        outerCard.appendTo('#card')
                        var tab_id = 'main_page'
                                           outermodalCard.appendTo('#card')

                        var colorlength = data.x_axisdata.length
                        var colordata = [];
                        var x_axis = data.x_axis
                        var y_axis = data.y_axis
                        var x_axisdata2 = JSON.parse(JSON.stringify(data.x_axisdata))

                        for (var i = 0; i < colorlength; i++) {
                            colordata.push('#b8860b');
                        }
                         // console.log(colordata)
                        var trace1 = {
                            x: data.x_axisdata,
                            y: data.y_axisdata,
                            mode: 'lines+markers',
                            marker: {
                                color: colordata
                            },
                            line: {
                                color: '#b8860b',
                                width: 2
                            }
                        };

                        var dataplot = [trace1]
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)

                        var layout = {
                            margin: { l: 40, r: 0, b: 20, t: 10, pad: 4 },
                            hovermode: 'closest',

                            yaxis: {
                                title: {
                                    standoff: 20,
                                    text: y_axis, font: {
                                        family: "Arial"
                                    }
                                }, showgrid: false, 'automargin': true, font: {
                                    family: "Arial"
                                }
                            },
                            xaxis: {
                                title: {
                                    standoff: 20,
                                    text: x_axis, font: {
                                        family: "Arial"
                                    }
                                },
                                showgrid: false, 'automargin': true, font: {
                                    family: "Arial"
                                }
                            },
                        }
                    }
                    else {

                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tab_id = data.plotDict.tab_id
                                                outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)
                        var dataplot = data.plotDict.data
                        dataplot[0].x = data.x_axisdata
                        dataplot[0].y = data.y_axisdata
                        var colorlength = data.x_axisdata.length
                        var colordata = [];
                        var x_axisdata2 = JSON.parse(JSON.stringify(data.x_axisdata))
                         // console.log(dataplot)

                        for (var i = 0; i < colorlength; i++) {
                            colordata.push(dataplot[0].line.color);
                        }
                        dataplot[0].marker.color = colordata

                         // console.log(dataplot)
                        var layout = data.plotDict.layout

                        var width = width.split("p")
                        var height = height.split("p")

                        var graph_height = height[0] * 0.876
                        var graph_width = width[0] * 0.9481

                        layout["height"] = graph_height
                        layout["width"] = graph_width

                         // console.log(layout)
                    }
                    var config = { responsive: true, displaylogo: false }

                    Plotly.newPlot(tester, dataplot, layout, config)
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})
                    var y_axis_end = tester.layout.yaxis.range[1]
                    var y_axis_start = tester.layout.yaxis.range[0]

                     // console.log(tester.layout)


                    document.getElementById(id1).onchange = function () {
                         // console.log(colordata.length)
                        var colorlength = colordata.length
                         // console.log(colorlength)
                        var colordata2 = [];
                        var backRGB = this.value;

                        for (var i = 0; i < colorlength; i++) {
                            colordata2.push(backRGB);
                        }
                         // console.log(colordata2)

                        var update = {
                            'marker': { color: colordata2 }, line: {
                                color: backRGB,
                                width: 2
                            }
                        };


                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }

                    document.getElementById(id2).onchange = function () {
                        var textbox2length = document.getElementById(id3).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var y_axis_end = tester.layout.yaxis.range[1]
                        var gridlines_value = tester.layout.yaxis.showgrid
                        var y_axis_title = tester.layout.yaxis.title.text

                         // console.log(textbox2length)
                         // console.log(y_axis_end)

                        if (textbox2length == 0) {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, y_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        }
                        else {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id3).onchange = function () {
                        var textbox1length = document.getElementById(id2).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var gridlines_value = tester.layout.yaxis.showgrid
                         // console.log(gridlines_value)
                        var y_axis_title = tester.layout.yaxis.title.text

                        if (textbox1length == 0) {
                            var layout = {
                                yaxis: {
                                    range: [y_axis_start, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        }
                        else {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    myPlot.on('plotly_click', function (data) {
                         // console.log(data.points[0].x)
                         // console.log(data.points)

                        var pn = '',
                            tn = '',
                            colors = [];
                        for (var i = 0; i < data.points.length; i++) {
                            pn = data.points[i].pointNumber;
                            tn = data.points[i].curveNumber;
                            colors = data.points[i].data.marker.color;
                        };
                         // console.log(colors)

                        var color = document.getElementById(id4).value
                        colors[pn] = color;
                         // console.log(pn)
                         // console.log(tn)
                         // console.log(colors)
                        var update = { 'marker': { color: colors } };
                        Plotly.restyle(tester, update, [tn])
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    });
                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id
                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };

                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };
                    document.getElementById(id9).onclick = function () {
                        var gridlinesvalue = document.getElementById(id9).value
                         // console.log(gridlinesvalue)
                        var y_axis_title = tester.layout.yaxis.title.text
                        var x_axis_title = tester.layout.xaxis.title.text
                        if (gridlinesvalue == "show_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    automargin: true,
                                    showgrid: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: true, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "hide_gridlines"
                            document.getElementById(id9).innerHTML = "Hide Gridlines"
                        }
                        if (gridlinesvalue == "hide_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    automargin: true,
                                    showgrid: false, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: false, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "show_gridlines"
                            document.getElementById(id9).innerHTML = "Show Gridlines"

                        }
                        Plotly.relayout(tester, layout2)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    };
                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };
                    document.getElementById(id11).onchange = function () {
                        var xaxistitlevalue = document.getElementById(id11).value;

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(xaxistitlevalue)
                         // console.log(tester.layout.xaxis.title)

                        var layout = {
                            xaxis: {
                                showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: xaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }


                        }
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }

                    document.getElementById(id12).onchange = function () {
                        var yaxistitlevalue = document.getElementById(id12).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var y_axis_end = tester.layout.yaxis.range[1]

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(yaxistitlevalue)
                         // console.log(tester.layout.yaxis.title)

                        var layout = {
                            yaxis: {
                                range: [y_axis_start, y_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: yaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }
                        }

                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }

                    try {
                        var changed_text = data.plotDict.changed_text
                    }
                    catch (err) {
                        var changed_text = []

                    }
                    myPlot.on('plotly_afterplot', function () {
                        Plotly.d3.selectAll(".xaxislayer-above").selectAll('text')
                            .on("click", function (d) {
                                 // console.log(d)
                                var labels = tester.data[0].x
                                var text = d.text
                                var labeleditvalue = document.getElementById(id13).value;
                                var dict = {}
                                dict[text] = labeleditvalue
                                changed_text.push(dict)

                                $.each(labels, function (k, v) {
                                    if (v == text) {
                                        labels[k] = labeleditvalue;
                                    }
                                });
                                var update = { "x": [labels] };
                                 // console.log(changed_text)

                                Plotly.restyle(tester, update)
                                $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))
                                $(`#${id6}`).attr("data-changed_text", JSON.stringify(changed_text))
                                 // console.log(changed_text)


                            });
                    });
                    document.getElementById(id18).onclick = function () {
                         // console.log(x_axisdata2)
                         // console.log(data)
                        var update = { "x": [JSON.parse(JSON.stringify(x_axisdata2))] }
                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))


                    }
                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }
                             // console.log(graph_height)
                             // console.log(graph_width)

                            Plotly.relayout(tester, layout)
                            $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                        },
                    });
                }
                if (graph_subtype == 'Pie_Chart') {


                    var outermodalCard = $(`

<div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
right: 0 ;top : 10px;z-index: 1050">


  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
      <button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <label style="font-size:1.1rem">Change the graph color:</label>
  <input type="color" id=${id1} name="favcolor" value="#b8860b"><br><br>
  <label style="font-size:1.1rem">Change the color or an element:</label>
  <input type="color" id=${id4} name="favcolor1" value="#b8860b">
<br><br>

  </div>
</div>
`)
                    if (data.plotDict === undefined) {
                         // console.log('new')
                        outerCard.appendTo('#card')
                        var tab_id = 'main_page'
                         outermodalCard.appendTo('#card')
                        var colorlength = data.x_axisdata.length
                        var colordata = data.colordata
                        var x_axis = data.x_axis
                        var y_axis = data.y_axis

                         // console.log(colordata)
                        var trace1 = {
                            values: data.y_axisdata,
                            labels: data.x_axisdata,
                            type: 'pie',
                            marker: {
                                colors: colordata
                            }
                        };

                        var dataplot = [trace1]
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)

                        var layout = {
                            legend: { "orientation": "h" },
                            margin: { l: 40, r: 0, b: 40, t: 10, pad: 4 },
                        }
                    }
                    else {
                         // console.log('load')
                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tab_id = data.plotDict.tab_id
                                                outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)
                        var dataplot = data.plotDict.data
                        dataplot[0].labels = data.x_axisdata
                        dataplot[0].values = data.y_axisdata


                        var layout = data.plotDict.layout

                        var width = width.split("p")
                        var height = height.split("p")

                        var graph_height = height[0] * 0.876
                        var graph_width = width[0] * 0.9481

                        layout["height"] = graph_height
                        layout["width"] = graph_width

                         // console.log(layout)
                        var colorlength = data.x_axis.length
                        var colordata = data.colordata

                    }
                    var config = { responsive: true, displaylogo: false }

                    Plotly.newPlot(tester, dataplot, layout, config)
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})

                    $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))
                     // console.log(tester.layout)

                    document.getElementById(id1).onchange = function () {
                         // console.log(colordata.length)
                        var colorlength = colordata.length
                         // console.log(colorlength)
                        var colorList = [];
                        var backRGB = this.value;
                        var backRGB = this.value;

                        colorList.push(backRGB)
                        for (i = 0; i < colorlength - 1; i++) {
                             // console.log("inside here")
                             // console.log(colorList[colorList.length - 1])
                            var previousHex = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(colorList[colorList.length - 1]);
                            var r = parseInt(previousHex[1], 16) * 0.8;
                            var g = parseInt(previousHex[2], 16) * 0.8;
                            var b = parseInt(previousHex[3], 16) * 0.8;
                            function componentToHex(c) {
                                var hex = c.toString(16);
                                return hex.length == 1 ? "0" + hex : hex;
                            }
                            var newHex = '#' + componentToHex(Math.round(r)) + componentToHex(Math.round(g)) + componentToHex(Math.round(b));
                            colorList.push(newHex)
                        }
                         // console.log(colorList)
                        var update = { 'marker': { colors: colorList } };

                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))
                    }


                    myPlot.on('plotly_click', function (data) {
                         // console.log(data.points[0])
                         // console.log(data.points[0].fullData.marker.colors)

                        var pn = '',
                            tn = '',
                            colors = [],
                            pn = data.points[0].pointNumber,
                            tn = data.points[0].curveNumber;
                         // console.log(pn)
                         // console.log(tn)

                        for (var i = 0; i < data.points.length; i++) {

                            colors = data.points[0].data.marker.colors;
                        };
                         // console.log(colors)

                        var color = document.getElementById(id4).value
                        colors[pn] = color;
                         // console.log(pn)
                         // console.log(tn)
                         // console.log(colors)
                        var update = { 'marker': { colors: colors } };
                        Plotly.restyle(tester, update, [tn])
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))
                    });
                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id
                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };
                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };

                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }

                            Plotly.relayout(tester, layout)
                            $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                        },
                    });
                    myPlot.on('plotly_relayout', function(data){
                         // console.log(data)
                        if (data.hiddenlabels.length == 0){
                        var resetdict = {'id':chartDivId}
                        reset_function(resetdict)
                        }
                        else{
                            var pie_data = tester.data[0].labels
                            var points = pie_data.filter(n => !data.hiddenlabels.includes(n))
                        var crossfilterdict = { 'points':points,'id':chartDivId}
                        crossfilter_function(crossfilterdict)
                        }
                    })
                }
                if (graph_subtype == 'Bubble_Map') {

                    var outermodalCard = $(`

<div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
right: 0 ;top : 10px;z-index: 1050">


<div class="modal-content">
<div class="modal-header">
<h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
<button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
</div>
<div class="modal-body">
<label style="font-size:1.1rem">Change the graph color:</label>
<input type="color" id=${id1} name="favcolor" value="#b8860b"><br><br>
<label style="font-size:1.1rem">Change the color or an element:</label>
<input type="color" id=${id4} name="favcolor1" value="#b8860b">
<br><br>

</div>
</div>
`)
                    if (data.plotDict === undefined) {
                         // console.log('new')
                        outerCard.appendTo('#card')
                        var tab_id = 'main_page'
                                           outermodalCard.appendTo('#card')
                        var colorlength = data.x_axisdata.length
                        var colordata = data.colordata
                        var x_axis = data.x_axis
                        var y_axis = data.y_axis

                         // console.log(colordata)
                        var dataplot = [{
                            type: 'scattergeo',
                            mode: 'markers',
                            locations: ['KWT', 'ARE', 'EGY'],
                            hoverinfo: 'text',
                            text: [20, 30, 15],
                            marker: {
                                size: [20, 30, 15],
                                color: colordata,
                                line: {
                                    color: 'black'
                                }
                            },
                        }];

                        var layout = {
                            geo: {
                                'resolution': 110,
                                'showcountries': true,
                                'showocean': true,
                                'oceancolor': "#D6F1FF",
                                'center': { 'lat': 23, 'lon': 45 },
                                'projection': { 'scale': 2.5 }
                            },
                            margin: { l: 0, r: 10, b: 5, t: 5, pad: 2 },
                        };

                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)

                    }
                    else {
                         // console.log('load')
                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tab_id = data.plotDict.tab_id
                                                outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)
                        var dataplot = data.plotDict.data
                        dataplot[0].labels = data.x_axisdata
                        dataplot[0].values = data.y_axisdata


                        var layout = data.plotDict.layout

                        var width = width.split("p")
                        var height = height.split("p")

                        var graph_height = height[0] * 0.876
                        var graph_width = width[0] * 0.9481

                        layout["height"] = graph_height
                        layout["width"] = graph_width

                         // console.log(layout)
                        var colorlength = data.x_axis.length
                        var colordata = data.colordata

                    }
                    var config = { responsive: true, displaylogo: false }

                    Plotly.newPlot(tester, dataplot, layout, config)
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})

                    $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))
                     // console.log(tester.layout)

                    document.getElementById(id1).onchange = function () {
                         // console.log(colordata.length)
                        var colorlength = colordata.length
                         // console.log(colorlength)
                        var colorList = [];
                        var backRGB = this.value;
                        var backRGB = this.value;

                        colorList.push(backRGB)
                        for (i = 0; i < colorlength - 1; i++) {
                             // console.log("inside here")
                             // console.log(colorList[colorList.length - 1])
                            var previousHex = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(colorList[colorList.length - 1]);
                            var r = parseInt(previousHex[1], 16) * 0.8;
                            var g = parseInt(previousHex[2], 16) * 0.8;
                            var b = parseInt(previousHex[3], 16) * 0.8;
                            function componentToHex(c) {
                                var hex = c.toString(16);
                                return hex.length == 1 ? "0" + hex : hex;
                            }
                            var newHex = '#' + componentToHex(Math.round(r)) + componentToHex(Math.round(g)) + componentToHex(Math.round(b));
                            colorList.push(newHex)
                        }
                         // console.log(colorList)
                        var update = { 'marker': { colors: colorList } };

                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))
                    }


                    myPlot.on('plotly_click', function (data) {
                         // console.log(data.points[0])
                         // console.log(data.points[0].fullData.marker.colors)

                        var pn = '',
                            tn = '',
                            colors = [],
                            pn = data.points[0].pointNumber,
                            tn = data.points[0].curveNumber;
                         // console.log(pn)
                         // console.log(tn)

                        for (var i = 0; i < data.points.length; i++) {

                            colors = data.points[0].data.marker.colors;
                        };
                         // console.log(colors)

                        var color = document.getElementById(id4).value
                        colors[pn] = color;
                         // console.log(pn)
                         // console.log(tn)
                         // console.log(colors)
                        var update = { 'marker': { colors: colors } };
                        Plotly.restyle(tester, update, [tn])
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))
                    });
                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id
                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };
                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };

                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }

                            Plotly.relayout(tester, layout)
                            $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                        },
                    });
                }
                if (graph_subtype == 'Chloropeth_Map') {


                    var outermodalCard = $(`

<div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
right: 0 ;top : 10px;z-index: 1050">


<div class="modal-content">
<div class="modal-header">
<h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
<button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
</div>
<div class="modal-body">
<label style="font-size:1.1rem">Change the graph color:</label>
<input type="color" id=${id1} name="favcolor" value="#b8860b"><br><br>
<label style="font-size:1.1rem">Change the color or an element:</label>
<input type="color" id=${id4} name="favcolor1" value="#b8860b">
<br><br>

</div>
</div>
`)
                    if (data.plotDict === undefined) {
                         // console.log('new')
                        outerCard.appendTo('#card')
                        var tab_id = 'main_page'
                                           outermodalCard.appendTo('#card')
                        var colordata = data.colordata
                        var x_axis = data.x_axis
                        var y_axis = data.y_axis

                         // console.log(colordata)

                        var dataplot = [{
                            type: 'choropleth',
                            zmin: 0,
                            zmax: 50,
                            colorscale: [
                                [0, colordata[0]], [0.2, colordata[1]],
                                [0.4, colordata[2]], [0.6, colordata[3]],
                                [0.8, colordata[4]], [1, colordata[5]]
                            ],
                            locations: ['KWT', 'ARE', 'EGY'],
                            z: [20, 30, 15],
                        }];
                        var layout = {
                            geo: {
                                'resolution': 110,
                                'showcountries': true,
                                'showocean': true,
                                'oceancolor': "#D6F1FF",
                                'center': { 'lat': 23, 'lon': 45 },
                                'projection': { 'scale': 2.5 }
                            },
                            margin: { l: 0, r: 10, b: 5, t: 5, pad: 2 },
                        };

                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)

                    }
                    else {
                         // console.log('load')
                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tab_id = data.plotDict.tab_id
                                                outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)
                        var dataplot = data.plotDict.data
                        dataplot[0].labels = data.x_axisdata
                        dataplot[0].values = data.y_axisdata


                        var layout = data.plotDict.layout

                        var width = width.split("p")
                        var height = height.split("p")

                        var graph_height = height[0] * 0.876
                        var graph_width = width[0] * 0.9481

                        layout["height"] = graph_height
                        layout["width"] = graph_width

                         // console.log(layout)
                        var colorlength = data.x_axis.length
                        var colordata = data.colordata

                    }
                    var config = { responsive: true, displaylogo: false }

                    Plotly.newPlot(tester, dataplot, layout, config)
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})

                    $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))
                     // console.log(tester.layout)

                    document.getElementById(id1).onchange = function () {
                         // console.log(colordata.length)
                        var colorlength = colordata.length
                         // console.log(colorlength)
                        var colorList = [];
                        var backRGB = this.value;
                        var backRGB = this.value;

                        colorList.push(backRGB)
                        for (i = 0; i < colorlength - 1; i++) {
                             // console.log("inside here")
                             // console.log(colorList[colorList.length - 1])
                            var previousHex = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(colorList[colorList.length - 1]);
                            var r = parseInt(previousHex[1], 16) * 0.8;
                            var g = parseInt(previousHex[2], 16) * 0.8;
                            var b = parseInt(previousHex[3], 16) * 0.8;
                            function componentToHex(c) {
                                var hex = c.toString(16);
                                return hex.length == 1 ? "0" + hex : hex;
                            }
                            var newHex = '#' + componentToHex(Math.round(r)) + componentToHex(Math.round(g)) + componentToHex(Math.round(b));
                            colorList.push(newHex)
                        }
                         // console.log(colorList)
                        var update = { 'marker': { colors: colorList } };

                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))
                    }


                    myPlot.on('plotly_click', function (data) {
                         // console.log(data.points[0])
                         // console.log(data.points[0].fullData.marker.colors)

                        var pn = '',
                            tn = '',
                            colors = [],
                            pn = data.points[0].pointNumber,
                            tn = data.points[0].curveNumber;
                         // console.log(pn)
                         // console.log(tn)

                        for (var i = 0; i < data.points.length; i++) {

                            colors = data.points[0].data.marker.colors;
                        };
                         // console.log(colors)

                        var color = document.getElementById(id4).value
                        colors[pn] = color;
                         // console.log(pn)
                         // console.log(tn)
                         // console.log(colors)
                        var update = { 'marker': { colors: colors } };
                        Plotly.restyle(tester, update, [tn])
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))
                    });
                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id
                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };
                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };

                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }

                            Plotly.relayout(tester, layout)
                            $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                        },
                    });
                }
                if (graph_subtype == 'Sunburst') {

                    var outermodalCard = $(`

<div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
right: 0 ;top : 10px;z-index: 1050">


  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
      <button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <label style="font-size:1.1rem">Change the graph color:</label>
  <input type="color" id=${id1} name="favcolor" value="#b8860b"><br><br>
  <label style="font-size:1.1rem">Change the color or an element:</label>
  <input type="color" id=${id4} name="favcolor1" value="#b8860b">
<br><br>

  </div>
</div>
`)
                    if (data.plotDict === undefined) {

                        outerCard.appendTo('#card')
                        var tab_id = 'main_page'
                                           outermodalCard.appendTo('#card')
                        var colorlength = data.x_axisdata.length
                        var colordata = data.colordata
                        var x_axis = data.x_axis
                        var y_axis = data.y_axis
                        var second_column = data.second_column


                         // console.log(colordata)
                        var trace1 = {
                            values: data.second_columndata,
                            labels: data.y_axisdata,
                            parents: data.x_axisdata,
                            ids: data.sunburst_id,
                            type: 'sunburst',
                            branchvalues: "total",
                            marker: { colors: colordata }
                        };

                        var dataplot = [trace1]
                         // console.log(data)
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)

                        var layout = {
                            legend: { "orientation": "h" },
                            margin: { l: 40, r: 0, b: 20, t: 10, pad: 4 },
                        }
                    }
                    else {
                         // console.log('load')
                         // console.log(data)

                        // append_tab = "analysisrow" + data.tab_name
                        //  // console.log(append_tab)
                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tab_id = data.plotDict.tab_id
                                                // outerCardhidden.appendTo(`#${data.tab_id}`)
                        outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)
                        var dataplot = data.plotDict.data
                        dataplot[0].labels = data.y_axisdata
                        dataplot[0].values = data.second_columndata
                        dataplot[0].parents = data.x_axisdata
                        dataplot[0].ids = data.sunburst_id

                         // console.log(data.y_axisdata)
                         // console.log(data.x_axisdata)

                         // console.log(dataplot)
                        var colordata = data.colordata

                        var layout = data.plotDict.layout

                        var width = width.split("p")
                        var height = height.split("p")
                         // console.log(height)
                         // console.log(width)
                        var graph_height = height[0] * 0.876
                        var graph_width = width[0] * 0.9481
                         // console.log(graph_height)
                         // console.log(graph_width)
                        layout["height"] = graph_height
                        layout["width"] = graph_width

                         // console.log(layout)
                        var colorlength = data.x_axis.length
                    }
                    var config = { responsive: true, displaylogo: false }

                    Plotly.newPlot(tester, dataplot, layout, config)
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})

                     // console.log(tester.layout)


                    document.getElementById(id1).onchange = function () {
                         // console.log(colordata.length)
                        var colorlength = colordata.length
                         // console.log(colorlength)
                        var colorList = [];
                        var backRGB = this.value;
                        var backRGB = this.value;

                        colorList.push(backRGB)
                        for (i = 0; i < colorlength - 1; i++) {
                             // console.log("inside here")
                             // console.log(colorList[colorList.length - 1])
                            var previousHex = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(colorList[colorList.length - 1]);
                            var r = parseInt(previousHex[1], 16) * 0.8;
                            var g = parseInt(previousHex[2], 16) * 0.8;
                            var b = parseInt(previousHex[3], 16) * 0.8;
                            function componentToHex(c) {
                                var hex = c.toString(16);
                                return hex.length == 1 ? "0" + hex : hex;
                            }
                            var newHex = '#' + componentToHex(Math.round(r)) + componentToHex(Math.round(g)) + componentToHex(Math.round(b));
                            colorList.push(newHex)
                        }
                         // console.log(colorList)
                        var update = { 'marker': { colors: colorList } };


                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }


                    myPlot.on('plotly_click', function (data) {
                         // console.log(data.points[0])
                         // console.log(data.points[0].fullData.marker.colors)

                        var pn = '',
                            tn = '',
                            colors = [],
                            pn = data.points[0].pointNumber,
                            tn = data.points[0].curveNumber;
                         // console.log(pn)
                         // console.log(tn)

                        for (var i = 0; i < data.points.length; i++) {

                            colors = data.points[0].data.marker.colors;
                        };
                         // console.log(colors)

                        var color = document.getElementById(id4).value
                        colors[pn] = color;
                         // console.log(pn)
                         // console.log(tn)
                         // console.log(colors)
                        var update = { 'marker': { colors: colors } };
                        Plotly.restyle(tester, update, [tn])
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    });
                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id
                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };
                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };

                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }
                             // console.log(graph_height)
                             // console.log(graph_width)

                            Plotly.relayout(tester, layout)
                            $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                        },
                    });
                    myPlot.on('plotly_relayout', function(data){
                         // console.log(data)
                        if (data.hiddenlabels.length == 0){
                        var resetdict = {'id':chartDivId}
                        reset_function(resetdict)
                        }
                        else{
                            var pie_data = tester.data[0].labels
                            var points = pie_data.filter(n => !data.hiddenlabels.includes(n))
                        var crossfilterdict = { 'points':points,'id':chartDivId}
                        crossfilter_function(crossfilterdict)
                        }
                    })
                }
                if (graph_subtype == 'Donut_Chart') {

                    var outermodalCard = $(`

<div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
right: 0 ;top : 10px;z-index: 1050">


  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
      <button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <label style="font-size:1.1rem">Change the graph color:</label>
  <input type="color" id=${id1} name="favcolor" value="#b8860b"><br><br>
  <label style="font-size:1.1rem">Change the color or an element:</label>
  <input type="color" id=${id4} name="favcolor1" value="#b8860b">
<br><br>

  </div>
</div>
`)


                    if (data.plotDict === undefined) {
                        outerCard.appendTo('#card')
                        var tab_id = 'main_page'
                                           outermodalCard.appendTo('#card')
                        var colorlength = data.x_axisdata.length
                        var colordata = data.colordata
                        var x_axis = data.x_axis
                        var y_axis = data.y_axis


                         // console.log(colordata)
                        var trace1 = {
                            values: data.y_axisdata,
                            labels: data.x_axisdata,
                            type: 'pie',
                            hole: .5,
                            marker: {
                                colors: colordata
                            }
                        };

                        var dataplot = [trace1]
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)

                        var layout = {
                            legend: { "orientation": "h" },
                            margin: { l: 60, r: 10, b: 20, t: 10, pad: 4 },
                        }
                    }
                    else {
                         // console.log('load')

                        // append_tab = "analysisrow" + data.tab_name
                        //  // console.log(append_tab)
                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tab_id = data.plotDict.tab_id
                                                // outerCardhidden.appendTo(`#${data.tab_id}`)
                        outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)
                        var dataplot = data.plotDict.data
                        dataplot[0].labels = data.x_axisdata
                        dataplot[0].values = data.y_axisdata
                        colordata = data.colordata
                         // console.log(data.y_axisdata)
                         // console.log(data.x_axisdata)

                         // console.log(dataplot)

                        var layout = data.plotDict.layout

                        var width = width.split("p")
                        var height = height.split("p")
                         // console.log(height)
                         // console.log(width)
                        var graph_height = height[0] * 0.876
                        var graph_width = width[0] * 0.9481
                         // console.log(graph_height)
                         // console.log(graph_width)
                        layout["height"] = graph_height
                        layout["width"] = graph_width
                        var colorlength = data.x_axis.length
                    }
                    var config = { responsive: true, displaylogo: false }

                    Plotly.newPlot(tester, dataplot, layout, config)
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})

                     // console.log(tester.layout)

                    document.getElementById(id1).onchange = function () {
                         // console.log(colordata.length)
                        var colorlength = colordata.length
                         // console.log(colorlength)
                        var colorList = [];
                        var backRGB = this.value;
                        var backRGB = this.value;

                        colorList.push(backRGB)
                        for (i = 0; i < colorlength - 1; i++) {
                             // console.log("inside here")
                             // console.log(colorList[colorList.length - 1])
                            var previousHex = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(colorList[colorList.length - 1]);
                            var r = parseInt(previousHex[1], 16) * 0.8;
                            var g = parseInt(previousHex[2], 16) * 0.8;
                            var b = parseInt(previousHex[3], 16) * 0.8;
                            function componentToHex(c) {
                                var hex = c.toString(16);
                                return hex.length == 1 ? "0" + hex : hex;
                            }
                            var newHex = '#' + componentToHex(Math.round(r)) + componentToHex(Math.round(g)) + componentToHex(Math.round(b));
                            colorList.push(newHex)
                        }
                         // console.log(colorList)
                        var update = { 'marker': { colors: colorList } };


                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }



                    myPlot.on('plotly_click', function (data) {
                         // console.log(data.points[0])
                         // console.log(data.points[0].fullData.marker.colors)

                        var pn = '',
                            tn = '',
                            colors = [],
                            pn = data.points[0].pointNumber,
                            tn = data.points[0].curveNumber;
                         // console.log(pn)
                         // console.log(tn)

                        for (var i = 0; i < data.points.length; i++) {

                            colors = data.points[0].data.marker.colors;
                        };
                         // console.log(colors)

                        var color = document.getElementById(id4).value
                        colors[pn] = color;
                         // console.log(pn)
                         // console.log(tn)
                         // console.log(colors)
                        var update = { 'marker': { colors: colors } };
                        Plotly.restyle(tester, update, [tn])
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    });


                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id
                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };
                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };

                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }
                             // console.log(graph_height)
                             // console.log(graph_width)

                            Plotly.relayout(tester, layout)
                            $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                        },
                    });
                    myPlot.on('plotly_relayout', function(data){
                         // console.log(data)
                        if (data.hiddenlabels.length == 0){
                        var resetdict = {'id':chartDivId}
                        reset_function(resetdict)
                        }
                        else{
                            var pie_data = tester.data[0].labels
                            var points = pie_data.filter(n => !data.hiddenlabels.includes(n))
                        var crossfilterdict = { 'points':points,'id':chartDivId}
                        crossfilter_function(crossfilterdict)
                        }
                    })
                }
                if (graph_subtype == 'Treemap') {

                    var outermodalCard = $(`

<div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
right: 0 ;top : 10px;z-index: 1050">


  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
      <button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <label style="font-size:1.1rem">Change the graph color:</label>
  <input type="color" id=${id1} name="favcolor" value="#b8860b"><br><br>
  <label style="font-size:1.1rem">Change the color or an element:</label>
  <input type="color" id=${id4} name="favcolor1" value="#b8860b">
<br><br>

  </div>
</div>
`)
                    if (data.plotDict === undefined) {

                        outerCard.appendTo('#card')
                        var tab_id = 'main_page'
                                           outermodalCard.appendTo('#card')
                        var colorlength = data.x_axisdata.length
                        var colordata = data.colordata
                        var parents = []
                        var x_axis = data.x_axis
                        var y_axis = data.y_axis
                        for (var i = 0; i < colorlength; i++) {
                            parents.push("");
                        }

                         // console.log(colordata)
                        var trace1 = {
                            values: data.y_axisdata,
                            labels: data.x_axisdata,
                            parents: parents,
                            type: 'treemap',
                            marker: {
                                colors: colordata
                            },
                            textinfo: "label+value "
                        };

                        var dataplot = [trace1]
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)

                        var layout = {
                            legend: { "orientation": "h" },
                            margin: { l: 40, r: 0, b: 20, t: 10, pad: 4 },
                        }
                    }
                    else {
                         // console.log('load')

                        // append_tab = "analysisrow" + data.tab_name
                        //  // console.log(append_tab)
                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tab_id = data.plotDict.tab_id
                                                // outerCardhidden.appendTo(`#${data.tab_id}`)
                        outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)
                        var dataplot = data.plotDict.data
                        dataplot[0].labels = data.x_axisdata
                        dataplot[0].values = data.y_axisdata
                        colordata = data.colordata
                         // console.log(data.y_axisdata)
                         // console.log(data.x_axisdata)

                         // console.log(dataplot)

                        var layout = data.plotDict.layout

                        var width = width.split("p")
                        var height = height.split("p")
                         // console.log(height)
                         // console.log(width)
                        var graph_height = height[0] * 0.876
                        var graph_width = width[0] * 0.9481
                         // console.log(graph_height)
                         // console.log(graph_width)
                        layout["height"] = graph_height
                        layout["width"] = graph_width
                        var colorlength = data.x_axis.length
                    }
                    var config = { responsive: true, displaylogo: false }

                    Plotly.newPlot(tester, dataplot, layout, config)
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})

                     // console.log(tester.layout)


                    document.getElementById(id1).onchange = function () {
                         // console.log(colordata.length)
                        var colorlength = colordata.length
                         // console.log(colorlength)
                        var colorList = [];
                        var backRGB = this.value;
                        var backRGB = this.value;

                        colorList.push(backRGB)
                        for (i = 0; i < colorlength - 1; i++) {
                             // console.log("inside here")
                             // console.log(colorList[colorList.length - 1])
                            var previousHex = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(colorList[colorList.length - 1]);
                            var r = parseInt(previousHex[1], 16) * 0.8;
                            var g = parseInt(previousHex[2], 16) * 0.8;
                            var b = parseInt(previousHex[3], 16) * 0.8;
                            function componentToHex(c) {
                                var hex = c.toString(16);
                                return hex.length == 1 ? "0" + hex : hex;
                            }
                            var newHex = '#' + componentToHex(Math.round(r)) + componentToHex(Math.round(g)) + componentToHex(Math.round(b));
                            colorList.push(newHex)
                        }
                         // console.log(colorList)
                        var update = { 'marker': { colors: colorList } };


                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }


                    myPlot.on('plotly_click', function (data) {
                         // console.log(data.points[0])
                         // console.log(data.points[0].fullData.marker.colors)

                        var pn = '',
                            tn = '',
                            colors = [],
                            pn = data.points[0].pointNumber,
                            tn = data.points[0].curveNumber;
                         // console.log(pn)
                         // console.log(tn)

                        for (var i = 0; i < data.points.length; i++) {

                            colors = data.points[0].data.marker.colors;
                        };
                         // console.log(colors)

                        var color = document.getElementById(id4).value
                        colors[pn] = color;
                         // console.log(pn)
                         // console.log(tn)
                         // console.log(colors)
                        var update = { 'marker': { colors: colors } };
                        Plotly.restyle(tester, update, [tn])
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    });
                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id
                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };
                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };

                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }
                             // console.log(graph_height)
                             // console.log(graph_width)

                            Plotly.relayout(tester, layout)
                            $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                        },
                    });
                    myPlot.on('plotly_relayout', function(data){
                         // console.log(data)
                        if (data.hiddenlabels.length == 0){
                        var resetdict = {'id':chartDivId}
                        reset_function(resetdict)
                        }
                        else{
                            var pie_data = tester.data[0].labels
                            var points = pie_data.filter(n => !data.hiddenlabels.includes(n))
                        var crossfilterdict = { 'points':points,'id':chartDivId}
                        crossfilter_function(crossfilterdict)
                        }
                    })
                }
                if (graph_subtype == 'Line') {

                    var outermodalCard = $(`

<div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
right: 0 ;top : 10px;z-index: 1050">


  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
      <button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <label style="font-size:1.1rem">Change the graph color:</label>
  <input type="color" id=${id1} name="favcolor" value="#b8860b"><br><br>
  <label style="font-size:1.1rem">Change X and Y axis gridlines:</label>
      <button type="button" class="btn btn-primary" id="${id9}" data-toggle="button" role="tab"
                      aria-pressed="false" autocomplete="off" value="show_gridlines" style="line-height: 0.7;">Show Gridlines</button><br><br>
                      <label style="font-size:1.1rem">Change the range of the axis:</label>
  <input type="text" placeholder="Y Axis Start" id=${id2} size="7">
  <input type="text" placeholder="Y Axis End " id=${id3} size="7">
<br><br>
<label style="font-size:1.1rem">Change the title of the axes:</label>
    <input type="text" placeholder="X Axis Title" id=${id11} size="7">
    <input type="text" placeholder="Y Axis Title" id=${id12} size="7">
    <br><br>
<label style="font-size:1.1rem">Change the label of an element:</label><br>
    <input type="text" placeholder="X Axis Label" id=${id13} size="9"> &nbsp;&nbsp;
    <button type="button" class="btn btn-primary" id="${id18}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" style="line-height: 1.1;">Reset Axis Labels</button>
  </div>
</div>
`)
                    if (data.plotDict === undefined) {

                        outerCard.appendTo('#card')

                                       outermodalCard.appendTo('#card')

                        var colorlength = data.x_axisdata.length
                        var colordata = [];
                        var x_axis = data.x_axis
                        var y_axis = data.y_axis
                        var x_axisdata2 = JSON.parse(JSON.stringify(data.x_axisdata))

                        for (var i = 0; i < colorlength; i++) {
                            colordata.push('#b8860b');
                        }
                         // console.log(colordata)
                        var trace1 = {
                            x: data.x_axisdata,
                            y: data.y_axisdata,
                            mode: 'lines',
                            marker: {
                                color: '#b8860b'
                            }
                        };

                        var dataplot = [trace1]
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)

                        var layout = {
                            margin: { l: 40, r: 0, b: 20, t: 10, pad: 4 },
                            yaxis: {
                                title: {
                                    standoff: 20,
                                    text: y_axis, font: {
                                        family: "Arial"
                                    }
                                }, showgrid: false, automargin: true, font: {
                                    family: "Arial"
                                }
                            },
                            xaxis: {
                                title: {
                                    standoff: 20,
                                    text: x_axis, font: {
                                        family: "Arial"
                                    }
                                },
                                showgrid: false, automargin: true, font: {
                                    family: "Arial"
                                }
                            },
                        }
                    }
                    else {
                         // console.log('load')
                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tab_id = data.plotDict.tab_id
                                                outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)
                        var dataplot = data.plotDict.data
                        dataplot[0].x = data.x_axisdata
                        dataplot[0].y = data.y_axisdata

                        var layout = data.plotDict.layout

                        var width = width.split("p")
                        var height = height.split("p")

                        var graph_height = height[0] * 0.876
                        var graph_width = width[0] * 0.9481

                        layout["height"] = graph_height
                        layout["width"] = graph_width

                         // console.log(layout)
                        var colorlength = data.x_axis.length
                        var colordata = data.colordata
                    }
                    var config = { responsive: true, displaylogo: false }

                    Plotly.newPlot(tester, dataplot, layout, config)
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})
                    var y_axis_end = tester.layout.yaxis.range[1]
                    var y_axis_start = tester.layout.yaxis.range[0]

                     // console.log(tester)

                    document.getElementById(id1).onchange = function () {
                        var backRGB = this.value;

                        var update = { 'marker': { color: backRGB } };


                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }

                    document.getElementById(id2).onchange = function () {
                        var textbox2length = document.getElementById(id3).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var y_axis_end = tester.layout.yaxis.range[1]
                        var gridlines_value = tester.layout.yaxis.showgrid
                        var y_axis_title = tester.layout.yaxis.title.text

                         // console.log(textbox2length)
                         // console.log(y_axis_end)

                        if (textbox2length == 0) {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, y_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        }
                        else {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id3).onchange = function () {
                        var textbox1length = document.getElementById(id2).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var gridlines_value = tester.layout.yaxis.showgrid
                         // console.log(gridlines_value)
                        var y_axis_title = tester.layout.yaxis.title.text

                        if (textbox1length == 0) {
                            var layout = {
                                yaxis: {
                                    range: [y_axis_start, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        }
                        else {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    myPlot.on('plotly_click', function (data) {
                         // console.log(data.points[0].x)
                         // console.log(data.points)

                        var pn = '',
                            tn = '',
                            colors = [];
                        for (var i = 0; i < data.points.length; i++) {
                            pn = data.points[i].pointNumber;
                            tn = data.points[i].curveNumber;
                            colors = data.points[i].data.marker.color;
                        };
                         // console.log(colors)

                        var color = document.getElementById(id4).value
                        colors[pn] = color;
                         // console.log(pn)
                         // console.log(tn)
                         // console.log(colors)
                        var update = { 'marker': { color: colors } };
                        Plotly.restyle(tester, update, [tn])
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    });

                    document.getElementById(id9).onclick = function () {
                        var gridlinesvalue = document.getElementById(id9).value
                         // console.log(gridlinesvalue)
                        var y_axis_title = tester.layout.yaxis.title.text
                        var x_axis_title = tester.layout.xaxis.title.text
                        if (gridlinesvalue == "show_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    automargin: true,
                                    showgrid: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: true, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "hide_gridlines"
                            document.getElementById(id9).innerHTML = "Hide Gridlines"
                        }
                        if (gridlinesvalue == "hide_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    automargin: true,
                                    showgrid: false, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: false, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "show_gridlines"
                            document.getElementById(id9).innerHTML = "Show Gridlines"

                        }
                        Plotly.relayout(tester, layout2)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    };

                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id
                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };
                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };
                    document.getElementById(id11).onchange = function () {
                        var xaxistitlevalue = document.getElementById(id11).value;

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(xaxistitlevalue)
                         // console.log(tester.layout.xaxis.title)

                        var layout = {
                            xaxis: {
                                showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: xaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }


                        }
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }

                    document.getElementById(id12).onchange = function () {
                        var yaxistitlevalue = document.getElementById(id12).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var y_axis_end = tester.layout.yaxis.range[1]

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(yaxistitlevalue)
                         // console.log(tester.layout.yaxis.title)

                        var layout = {
                            yaxis: {
                                range: [y_axis_start, y_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: yaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }
                        }

                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    try {
                        var changed_text = data.plotDict.changed_text
                    }
                    catch (err) {
                        var changed_text = []

                    }
                    myPlot.on('plotly_afterplot', function () {
                        Plotly.d3.selectAll(".xaxislayer-above").selectAll('text')
                            .on("click", function (d) {
                                 // console.log(d)
                                var labels = tester.data[0].x
                                var position = d.x
                                var text = d.text
                                var labeleditvalue = document.getElementById(id13).value;

                                var dict = {}
                                dict[text] = labeleditvalue
                                changed_text.push(dict)
                                labels[position] = labeleditvalue;
                                 // console.log(position)
                                 // console.log(labels)

                                var update = { "x": [labels] };

                                Plotly.restyle(tester, update)
                                $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                                $(`#${id6}`).attr("data-changed_text", JSON.stringify(changed_text))
                                 // console.log(changed_text)

                            });
                    });
                    document.getElementById(id18).onclick = function () {
                         // console.log(x_axisdata2)
                         // console.log(data)
                        var update = { "x": [JSON.parse(JSON.stringify(x_axisdata2))] }
                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }
                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }
                             // console.log(graph_height)
                             // console.log(graph_width)

                            Plotly.relayout(tester, layout)
                            $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                        },
                    });
                }
                if (graph_subtype == 'Area') {

                    var outermodalCard = $(`

<div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
right: 0 ;top : 10px;z-index: 1050">


  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
      <button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <label style="font-size:1.1rem">Change the graph color:</label>
  <input type="color" id=${id1} name="favcolor" value="#b8860b"><br><br>
  <label style="font-size:1.1rem">Change X and Y axis gridlines:</label>
      <button type="button" class="btn btn-primary" id="${id9}" data-toggle="button" role="tab"
                      aria-pressed="false" autocomplete="off" value="show_gridlines" style="line-height: 0.7;">Show Gridlines</button><br><br>
                      <label style="font-size:1.1rem">Change the range of the axis:</label>
  <input type="text" placeholder="Y Axis Start" id=${id2} size="7">
  <input type="text" placeholder="Y Axis End " id=${id3} size="7">
<br><br>
<label style="font-size:1.1rem">Change the title of the axes:</label>
    <input type="text" placeholder="X Axis Title" id=${id11} size="7">
    <input type="text" placeholder="Y Axis Title" id=${id12} size="7">
    <br><br>
<label style="font-size:1.1rem">Change the label of an element:</label><br>
    <input type="text" placeholder="X Axis Label" id=${id13} size="9"> &nbsp;&nbsp;
    <button type="button" class="btn btn-primary" id="${id18}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" style="line-height: 1.1;">Reset Axis Labels</button><br><br>
  </div>
</div>
`)

                    if (data.plotDict === undefined) {

                        outerCard.appendTo('#card')

                                       outermodalCard.appendTo('#card')

                        var colorlength = data.x_axisdata.length
                        var colordata = [];
                        var x_axis = data.x_axis
                        var y_axis = data.y_axis
                        var x_axisdata2 = JSON.parse(JSON.stringify(data.x_axisdata))

                        for (var i = 0; i < colorlength; i++) {
                            colordata.push('#b8860b');
                        }
                         // console.log(colordata)
                        var trace1 = {
                            x: data.x_axisdata,
                            y: data.y_axisdata,
                            mode: 'lines',
                            fill: 'tozeroy',
                            marker: {
                                color: '#b8860b'
                            }
                        };

                        var dataplot = [trace1]
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)

                        var layout = {
                            margin: { l: 40, r: 0, b: 20, t: 10, pad: 4 },
                            yaxis: {
                                title: {
                                    standoff: 20,
                                    text: y_axis, font: {
                                        family: "Arial"
                                    }
                                }, showgrid: false, automargin: true, font: {
                                    family: "Arial"
                                }
                            },
                            xaxis: {
                                title: {
                                    standoff: 20,
                                    text: x_axis, font: {
                                        family: "Arial"
                                    }
                                },
                                showgrid: false, automargin: true, font: {
                                    family: "Arial"
                                }
                            },
                        }
                    }
                    else {
                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tab_id = data.plotDict.tab_id
                                                outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)
                        var dataplot = data.plotDict.data
                        dataplot[0].x = data.x_axisdata
                        dataplot[0].y = data.y_axisdata


                        var layout = data.plotDict.layout

                        var width = width.split("p")
                        var height = height.split("p")

                        var graph_height = height[0] * 0.876
                        var graph_width = width[0] * 0.9481

                        layout["height"] = graph_height
                        layout["width"] = graph_width

                         // console.log(layout)
                        var colorlength = data.x_axis.length
                    }

                    var config = { responsive: true, displaylogo: false }

                    Plotly.newPlot(tester, dataplot, layout, config)
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})
                    var y_axis_end = tester.layout.yaxis.range[1]
                    var y_axis_start = tester.layout.yaxis.range[0]

                     // console.log(tester)


                    document.getElementById(id1).onchange = function () {
                        var backRGB = this.value;

                        var update = { 'marker': { color: backRGB } };


                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }

                    document.getElementById(id2).onchange = function () {
                        var textbox2length = document.getElementById(id3).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var y_axis_end = tester.layout.yaxis.range[1]
                        var gridlines_value = tester.layout.yaxis.showgrid
                        var y_axis_title = tester.layout.yaxis.title.text

                         // console.log(textbox2length)
                         // console.log(y_axis_end)

                        if (textbox2length == 0) {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, y_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        }
                        else {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id3).onchange = function () {
                        var textbox1length = document.getElementById(id2).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var gridlines_value = tester.layout.yaxis.showgrid
                         // console.log(gridlines_value)
                        var y_axis_title = tester.layout.yaxis.title.text

                        if (textbox1length == 0) {
                            var layout = {
                                yaxis: {
                                    range: [y_axis_start, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        }
                        else {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    myPlot.on('plotly_click', function (data) {
                         // console.log(data.points[0].x)
                         // console.log(data.points)

                        var pn = '',
                            tn = '',
                            colors = [];
                        for (var i = 0; i < data.points.length; i++) {
                            pn = data.points[i].pointNumber;
                            tn = data.points[i].curveNumber;
                            colors = data.points[i].data.marker.color;
                        };
                         // console.log(colors)

                        var color = document.getElementById(id4).value
                        colors[pn] = color;
                         // console.log(pn)
                         // console.log(tn)
                         // console.log(colors)
                        var update = { 'marker': { color: colors } };
                        Plotly.restyle(tester, update, [tn])
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    });

                    document.getElementById(id9).onclick = function () {
                        var gridlinesvalue = document.getElementById(id9).value
                         // console.log(gridlinesvalue)
                        var y_axis_title = tester.layout.yaxis.title.text
                        var x_axis_title = tester.layout.xaxis.title.text
                        if (gridlinesvalue == "show_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    automargin: true,
                                    showgrid: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: true, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "hide_gridlines"
                            document.getElementById(id9).innerHTML = "Hide Gridlines"
                        }
                        if (gridlinesvalue == "hide_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    automargin: true,
                                    showgrid: false, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: false, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "show_gridlines"
                            document.getElementById(id9).innerHTML = "Show Gridlines"

                        }
                        Plotly.relayout(tester, layout2)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    };

                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id
                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };
                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };
                    document.getElementById(id11).onchange = function () {
                        var xaxistitlevalue = document.getElementById(id11).value;

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(xaxistitlevalue)
                         // console.log(tester.layout.xaxis.title)

                        var layout = {
                            xaxis: {
                                showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: xaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }


                        }
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }

                    document.getElementById(id12).onchange = function () {
                        var yaxistitlevalue = document.getElementById(id12).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var y_axis_end = tester.layout.yaxis.range[1]

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(yaxistitlevalue)
                         // console.log(tester.layout.yaxis.title)

                        var layout = {
                            yaxis: {
                                range: [y_axis_start, y_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: yaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }
                        }

                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }

                    try {
                        var changed_text = data.plotDict.changed_text
                    }
                    catch (err) {
                        var changed_text = []

                    }
                    myPlot.on('plotly_afterplot', function () {
                        Plotly.d3.selectAll(".xaxislayer-above").selectAll('text')
                            .on("click", function (d) {
                                 // console.log(d)
                                var labels = tester.data[0].x
                                var position = d.x
                                var text = d.text
                                var labeleditvalue = document.getElementById(id13).value;

                                var dict = {}
                                dict[text] = labeleditvalue
                                changed_text.push(dict)
                                labels[position] = labeleditvalue;
                                 // console.log(position)
                                 // console.log(labels)

                                var update = { "x": [labels] };

                                Plotly.restyle(tester, update)
                                $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))


                                $(`#${id6}`).attr("data-changed_text", JSON.stringify(changed_text))
                                 // console.log(changed_text)

                            });
                    });
                    document.getElementById(id18).onclick = function () {
                         // console.log(x_axisdata2)
                         // console.log(data)
                        var update = { "x": [JSON.parse(JSON.stringify(x_axisdata2))] }
                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))


                    }
                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }
                             // console.log(graph_height)
                             // console.log(graph_width)

                            Plotly.relayout(tester, layout)
                            $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                        },
                    });
                }
                if (graph_subtype == 'Horizontal_Area') {

                    var outermodalCard = $(`

<div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
right: 0 ;top : 10px;z-index: 1050">


<div class="modal-content">
<div class="modal-header">
<h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
<button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
</div>
<div class="modal-body">
<label style="font-size:1.1rem">Change the graph color:</label>
<input type="color" id=${id1} name="favcolor" value="#b8860b"><br><br>
<label style="font-size:1.1rem">Change X and Y axis gridlines:</label>
<button type="button" class="btn btn-primary" id="${id9}" data-toggle="button" role="tab"
  aria-pressed="false" autocomplete="off" value="show_gridlines" style="line-height: 0.7;">Show Gridlines</button><br><br>
  <label style="font-size:1.1rem">Change the range of the axis:</label>
<input type="text" placeholder="Y Axis Start" id=${id2} size="7">
<input type="text" placeholder="Y Axis End " id=${id3} size="7">
<br><br>
<label style="font-size:1.1rem">Change the title of the axes:</label>
<input type="text" placeholder="X Axis Title" id=${id11} size="7">
<input type="text" placeholder="Y Axis Title" id=${id12} size="7">
<br><br>
<label style="font-size:1.1rem">Change the label of an element:</label><br>
<input type="text" placeholder="Y Axis Label" id=${id13} size="9"> &nbsp;&nbsp;
<button type="button" class="btn btn-primary" id="${id18}" data-toggle="button" role="tab"
    aria-pressed="false" autocomplete="off" style="line-height: 1.1;">Reset Axis Labels</button><br><br>
</div>
</div>
`)

                    if (data.plotDict === undefined) {

                        outerCard.appendTo('#card')

                                       outermodalCard.appendTo('#card')

                        var colorlength = data.x_axisdata.length
                        var colordata = [];
                        var x_axis = data.x_axis
                        var y_axis = data.y_axis
                        var y_axisdata2 = JSON.parse(JSON.stringify(data.y_axisdata))

                        for (var i = 0; i < colorlength; i++) {
                            colordata.push('#b8860b');
                        }
                         // console.log(colordata)
                        var trace1 = {
                            x: data.x_axisdata,
                            y: data.y_axisdata,
                            mode: 'lines',
                            fill: 'tozeroy',
                            marker: {
                                color: '#b8860b'
                            }
                        };

                        var dataplot = [trace1]
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)

                        var layout = {
                            margin: { l: 40, r: 0, b: 20, t: 10, pad: 4 },
                            yaxis: {
                                title: {
                                    standoff: 20,
                                    text: y_axis, font: {
                                        family: "Arial"
                                    }
                                }, showgrid: false, automargin: true, font: {
                                    family: "Arial"
                                }
                            },
                            xaxis: {
                                title: {
                                    standoff: 20,
                                    text: x_axis, font: {
                                        family: "Arial"
                                    }
                                },
                                showgrid: false, automargin: true, font: {
                                    family: "Arial"
                                }
                            },
                        }
                    }
                    else {
                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tab_id = data.plotDict.tab_id
                                                outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)
                        var dataplot = data.plotDict.data
                        dataplot[0].x = data.x_axisdata
                        dataplot[0].y = data.y_axisdata


                        var layout = data.plotDict.layout

                        var width = width.split("p")
                        var height = height.split("p")

                        var graph_height = height[0] * 0.876
                        var graph_width = width[0] * 0.9481

                        layout["height"] = graph_height
                        layout["width"] = graph_width

                         // console.log(layout)
                        var colorlength = data.x_axis.length
                    }

                    var config = { responsive: true, displaylogo: false }

                    Plotly.newPlot(tester, dataplot, layout, config)
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})
                    var y_axis_end = tester.layout.yaxis.range[1]
                    var y_axis_start = tester.layout.yaxis.range[0]

                     // console.log(tester)


                    document.getElementById(id1).onchange = function () {
                        var backRGB = this.value;

                        var update = { 'marker': { color: backRGB } };


                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }

                    document.getElementById(id2).onchange = function () {
                        var textbox2length = document.getElementById(id3).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var x_axis_end = tester.layout.xaxis.range[1]
                        var gridlines_value = tester.layout.yaxis.showgrid
                        var x_axis_title = tester.layout.xaxis.title.text

                         // console.log(textbox2length)
                         // console.log(x_axis_end)

                        if (textbox2length == 0) {
                            var layout = {
                                xaxis: {
                                    range: [textbox1value, x_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        }
                        else {
                            var layout = {
                                xaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id3).onchange = function () {
                        var textbox1length = document.getElementById(id2).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var x_axis_start = tester.layout.xaxis.range[0]
                        var gridlines_value = tester.layout.xaxis.showgrid
                         // console.log(gridlines_value)
                        var x_axis_title = tester.layout.xaxis.title.text

                        if (textbox1length == 0) {
                            var layout = {
                                xaxis: {
                                    range: [x_axis_start, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        }
                        else {
                            var layout = {
                                xaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    myPlot.on('plotly_click', function (data) {
                         // console.log(data.points[0].x)
                         // console.log(data.points)

                        var pn = '',
                            tn = '',
                            colors = [];
                        for (var i = 0; i < data.points.length; i++) {
                            pn = data.points[i].pointNumber;
                            tn = data.points[i].curveNumber;
                            colors = data.points[i].data.marker.color;
                        };
                         // console.log(colors)

                        var color = document.getElementById(id4).value
                        colors[pn] = color;
                         // console.log(pn)
                         // console.log(tn)
                         // console.log(colors)
                        var update = { 'marker': { color: colors } };
                        Plotly.restyle(tester, update, [tn])
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    });

                    document.getElementById(id9).onclick = function () {
                        var gridlinesvalue = document.getElementById(id9).value
                         // console.log(gridlinesvalue)
                        var y_axis_title = tester.layout.yaxis.title.text
                        var x_axis_title = tester.layout.xaxis.title.text
                        if (gridlinesvalue == "show_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    automargin: true,
                                    showgrid: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: true, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "hide_gridlines"
                            document.getElementById(id9).innerHTML = "Hide Gridlines"
                        }
                        if (gridlinesvalue == "hide_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    automargin: true,
                                    showgrid: false, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: false, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "show_gridlines"
                            document.getElementById(id9).innerHTML = "Show Gridlines"

                        }
                        Plotly.relayout(tester, layout2)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    };

                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id
                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };
                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };
                    document.getElementById(id11).onchange = function () {
                        var xaxistitlevalue = document.getElementById(id11).value;

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(xaxistitlevalue)
                         // console.log(tester.layout.xaxis.title)

                        var layout = {
                            xaxis: {
                                showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: xaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }


                        }
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }

                    document.getElementById(id12).onchange = function () {
                        var yaxistitlevalue = document.getElementById(id12).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var y_axis_end = tester.layout.yaxis.range[1]

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(yaxistitlevalue)
                         // console.log(tester.layout.yaxis.title)

                        var layout = {
                            yaxis: {
                                range: [y_axis_start, y_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: yaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }
                        }

                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }

                    try {
                        var changed_text = data.plotDict.changed_text
                    }
                    catch (err) {
                        var changed_text = []

                    }
                    myPlot.on('plotly_afterplot', function () {
                        Plotly.d3.selectAll(".yaxislayer-above").selectAll('text')
                            .on("click", function (d) {
                                 // console.log(d)
                                var labels = tester.data[0].x
                                var position = d.x
                                var text = d.text
                                var labeleditvalue = document.getElementById(id13).value;

                                var dict = {}
                                dict[text] = labeleditvalue
                                changed_text.push(dict)
                                labels[position] = labeleditvalue;
                                 // console.log(position)
                                 // console.log(labels)

                                var update = { "y": [labels] };

                                Plotly.restyle(tester, update)
                                $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))


                                $(`#${id6}`).attr("data-changed_text", JSON.stringify(changed_text))
                                 // console.log(changed_text)

                            });
                    });
                    document.getElementById(id18).onclick = function () {
                         // console.log(x_axisdata2)
                         // console.log(data)
                        var update = { "y": [JSON.parse(JSON.stringify(y_axisdata2))] }
                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))


                    }
                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }
                             // console.log(graph_height)
                             // console.log(graph_width)

                            Plotly.relayout(tester, layout)
                            $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                        },
                    });
                }
                if (graph_subtype == 'Stepped_Line_Graph') {

                    var outermodalCard = $(`

<div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
right: 0 ;top : 10px;z-index: 1050">


  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
      <button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <label style="font-size:1.1rem">Change the graph color:</label>
  <input type="color" id=${id1} name="favcolor" value="#b8860b"><br><br>
  <label style="font-size:1.1rem">Change X and Y axis gridlines:</label>
      <button type="button" class="btn btn-primary" id="${id9}" data-toggle="button" role="tab"
                      aria-pressed="false" autocomplete="off" value="show_gridlines" style="line-height: 0.7;">Show Gridlines</button><br><br>
                      <label style="font-size:1.1rem">Change the range of the axis:</label>
  <input type="text" placeholder="Y Axis Start" id=${id2} size="7">
  <input type="text" placeholder="Y Axis End " id=${id3} size="7">
<br><br>
<label style="font-size:1.1rem">Change the title of the axes:</label>
    <input type="text" placeholder="X Axis Title" id=${id11} size="7">
    <input type="text" placeholder="Y Axis Title" id=${id12} size="7">
    <br><br>
<label style="font-size:1.1rem">Change the label of an element:</label><br>
    <input type="text" placeholder="X Axis Label" id=${id13} size="9"> &nbsp;&nbsp;
    <button type="button" class="btn btn-primary" id="${id18}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" style="line-height: 1.1;">Reset Axis Labels</button><br><br>
  </div>
</div>
`)

                    if (data.plotDict === undefined) {

                        outerCard.appendTo('#card')

                                       outermodalCard.appendTo('#card')

                        var colorlength = data.x_axisdata.length
                        var colordata = [];
                        var x_axis = data.x_axis
                        var y_axis = data.y_axis
                        var x_axisdata2 = JSON.parse(JSON.stringify(data.x_axisdata))

                        for (var i = 0; i < colorlength; i++) {
                            colordata.push('#b8860b');
                        }
                         // console.log(colordata)
                        var trace1 = {
                            x: data.x_axisdata,
                            y: data.y_axisdata,
                            mode: 'lines',
                            marker: {
                                color: '#b8860b'
                            },
                            line: { shape: 'hv' },
                        };


                        var dataplot = [trace1]
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)

                        var layout = {
                            margin: { l: 40, r: 0, b: 20, t: 10, pad: 4 },
                            yaxis: {
                                title: {
                                    standoff: 20,
                                    text: y_axis, font: {
                                        family: "Arial"
                                    }
                                }, showgrid: false, automargin: true, font: {
                                    family: "Arial"
                                }
                            },
                            xaxis: {
                                title: {
                                    standoff: 20,
                                    text: x_axis, font: {
                                        family: "Arial"
                                    }
                                },
                                showgrid: false, automargin: true, font: {
                                    family: "Arial"
                                }
                            },
                        }
                    }
                    else {
                         // console.log('load')
                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tab_id = data.plotDict.tab_id
                                                outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)
                        var dataplot = data.plotDict.data
                        dataplot[0].x = data.x_axisdata
                        dataplot[0].y = data.y_axisdata


                        var layout = data.plotDict.layout

                        var width = width.split("p")
                        var height = height.split("p")

                        var graph_height = height[0] * 0.876
                        var graph_width = width[0] * 0.9481

                        layout["height"] = graph_height
                        layout["width"] = graph_width

                         // console.log(layout)
                        var colorlength = data.x_axis.length
                    }
                    var config = { responsive: true, displaylogo: false }

                    Plotly.newPlot(tester, dataplot, layout, config)
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})
                    var y_axis_end = tester.layout.yaxis.range[1]
                    var y_axis_start = tester.layout.yaxis.range[0]

                     // console.log(tester)


                    document.getElementById(id1).onchange = function () {
                        var backRGB = this.value;

                        var update = { 'marker': { color: backRGB } };


                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }

                    document.getElementById(id2).onchange = function () {
                        var textbox2length = document.getElementById(id3).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var y_axis_end = tester.layout.yaxis.range[1]
                        var gridlines_value = tester.layout.yaxis.showgrid
                        var y_axis_title = tester.layout.yaxis.title.text

                         // console.log(textbox2length)
                         // console.log(y_axis_end)

                        if (textbox2length == 0) {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, y_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        }
                        else {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id3).onchange = function () {
                        var textbox1length = document.getElementById(id2).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var gridlines_value = tester.layout.yaxis.showgrid
                         // console.log(gridlines_value)
                        var y_axis_title = tester.layout.yaxis.title.text

                        if (textbox1length == 0) {
                            var layout = {
                                yaxis: {
                                    range: [y_axis_start, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        }
                        else {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    myPlot.on('plotly_click', function (data) {
                         // console.log(data.points[0].x)
                         // console.log(data.points)

                        var pn = '',
                            tn = '',
                            colors = [];
                        for (var i = 0; i < data.points.length; i++) {
                            pn = data.points[i].pointNumber;
                            tn = data.points[i].curveNumber;
                            colors = data.points[i].data.marker.color;
                        };
                         // console.log(colors)

                        var color = document.getElementById(id4).value
                        colors[pn] = color;
                         // console.log(pn)
                         // console.log(tn)
                         // console.log(colors)
                        var update = { 'marker': { color: colors } };
                        Plotly.restyle(tester, update, [tn])
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    });

                    document.getElementById(id9).onclick = function () {
                        var gridlinesvalue = document.getElementById(id9).value
                         // console.log(gridlinesvalue)
                        var y_axis_title = tester.layout.yaxis.title.text
                        var x_axis_title = tester.layout.xaxis.title.text
                        if (gridlinesvalue == "show_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    automargin: true,
                                    showgrid: true, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: true, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "hide_gridlines"
                            document.getElementById(id9).innerHTML = "Hide Gridlines"
                        }
                        if (gridlinesvalue == "hide_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    automargin: true,
                                    showgrid: false, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: false, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "show_gridlines"
                            document.getElementById(id9).innerHTML = "Show Gridlines"

                        }
                        Plotly.relayout(tester, layout2)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    };

                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id
                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };
                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };
                    document.getElementById(id11).onchange = function () {
                        var xaxistitlevalue = document.getElementById(id11).value;

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(xaxistitlevalue)
                         // console.log(tester.layout.xaxis.title)

                        var layout = {
                            xaxis: {
                                showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: xaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }


                        }
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }

                    document.getElementById(id12).onchange = function () {
                        var yaxistitlevalue = document.getElementById(id12).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var y_axis_end = tester.layout.yaxis.range[1]

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(yaxistitlevalue)
                         // console.log(tester.layout.yaxis.title)

                        var layout = {
                            yaxis: {
                                range: [y_axis_start, y_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: yaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }
                        }

                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }

                    try {
                        var changed_text = data.plotDict.changed_text
                    }
                    catch (err) {
                        var changed_text = []

                    }
                    myPlot.on('plotly_afterplot', function () {
                        Plotly.d3.selectAll(".xaxislayer-above").selectAll('text')
                            .on("click", function (d) {
                                 // console.log(d)
                                var labels = tester.data[0].x
                                var position = d.x
                                var text = d.text
                                var labeleditvalue = document.getElementById(id13).value;

                                var dict = {}
                                dict[text] = labeleditvalue
                                changed_text.push(dict)
                                labels[position] = labeleditvalue;
                                 // console.log(position)
                                 // console.log(labels)

                                var update = { "x": [labels] };

                                Plotly.restyle(tester, update)
                                $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))


                                $(`#${id6}`).attr("data-changed_text", JSON.stringify(changed_text))
                                 // console.log(changed_text)

                            });
                    });
                    document.getElementById(id18).onclick = function () {
                         // console.log(x_axisdata2)
                         // console.log(data)
                        var update = { "x": [JSON.parse(JSON.stringify(x_axisdata2))] }
                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }
                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }
                             // console.log(graph_height)
                             // console.log(graph_width)

                            Plotly.relayout(tester, layout)
                            $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                        },
                    });
                }
                if (graph_subtype == 'Vertical_Line_Stacked') {
                    var x_axis = data.x_axis
                    var y_axis = data.y_axis
                    var second_column = data.second_column

                    var outermodalCard = $(`

<div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
right: 0 ;top : 10px;z-index: 1050">


  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
      <button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <label style="font-size:1.1rem">Change the graph color:</label>
  <input type="color" id=${id1} name="favcolor" value="#b8860b"><br><br>
  <label style="font-size:1.1rem">Change X and Y axis gridlines:</label>
      <button type="button" class="btn btn-primary" id="${id9}" data-toggle="button" role="tab"
                      aria-pressed="false" autocomplete="off" value="show_gridlines" style="line-height: 0.7;">Show Gridlines</button><br><br>
                      <label style="font-size:1.1rem">Change the range of the axis:</label>
  <input type="text" placeholder="Y Axis Start" id=${id2} size="7">
  <input type="text" placeholder="Y Axis End " id=${id3} size="7">
<br><br>
<label style="font-size:1.1rem">Change the title of the axes:</label>
    <input type="text" placeholder="X Axis Title" id=${id11} size="7">
    <br><br>
    <label style="font-size:1.1rem">Change the legend labels:</label>
  <input type="text" placeholder=${y_axis} id=${id14} size="7">
  <input type="text" placeholder=${second_column} id=${id15} size="7">
  <br><br>
<label style="font-size:1.1rem">Change the label of an element:</label><br>
    <input type="text" placeholder="X Axis Label" id=${id13} size="9"> &nbsp;&nbsp;
    <button type="button" class="btn btn-primary" id="${id18}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" style="line-height: 1.1;">Reset Axis Labels</button><br><br>
  </div>
</div>
`)
                    if (data.plotDict === undefined) {

                        outerCard.appendTo('#card')

                                       outermodalCard.appendTo('#card')

                        var x_axisdata2 = JSON.parse(JSON.stringify(data.x_axisdata))

                        var trace1 = {
                            x: data.x_axisdata,
                            y: data.y_axisdata,
                            mode: 'lines',
                            marker: {
                                color: '#b8860b'
                            },
                            name: y_axis
                        };
                        var trace2 = {
                            x: data.x_axisdata,
                            y: data.second_columndata,
                            mode: 'lines',
                            marker: {
                                color: 'goldenrod'
                            },
                            name: second_column
                        };
                        var dataplot = [trace1, trace2]
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)

                        var layout = {
                            margin: { l: 40, r: 0, b: 20, t: 10, pad: 4 },
                            yaxis: {
                                showgrid: false, automargin: true, font: {
                                    family: "Arial"
                                }
                            },
                            xaxis: {
                                title: {
                                    standoff: 20,
                                    text: x_axis, font: {
                                        family: "Arial"
                                    }
                                },
                                showgrid: false, automargin: true, font: {
                                    family: "Arial"
                                }
                            },
                        }
                    }
                    else {
                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tab_id = data.plotDict.tab_id
                                                outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)
                        var dataplot = data.plotDict.data
                        dataplot[0].x = data.x_axisdata
                        dataplot[0].y = data.y_axisdata
                        dataplot[1].x = data.x_axisdata
                        dataplot[1].y = data.second_columndata
                        var layout = data.plotDict.layout

                        var width = width.split("p")
                        var height = height.split("p")

                        var graph_height = height[0] * 0.876
                        var graph_width = width[0] * 0.9481

                        layout["height"] = graph_height
                        layout["width"] = graph_width

                         // console.log(layout)
                        var colorlength = data.x_axisdata.length

                    }
                    var config = { responsive: true, displaylogo: false }

                    Plotly.newPlot(tester, dataplot, layout, config)
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})
                    var y_axis_end = tester.layout.yaxis.range[1]
                    var y_axis_start = tester.layout.yaxis.range[0]

                     // console.log(tester.data)

                    document.getElementById(id1).onchange = function () {

                        var backRGB = this.value;

                        const hexToRgb = hex =>
                            hex.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i
                                , (m, r, g, b) => '#' + r + r + g + g + b + b)
                                .substring(1).match(/.{2}/g)
                                .map(x => parseInt(x, 16))
                        var r = hexToRgb(backRGB)[0] * 0.6
                        var g = hexToRgb(backRGB)[1] * 0.6
                        var b = hexToRgb(backRGB)[2] * 0.6

                        function rgb2hex(red, green, blue) {
                            var rgb = blue | (green << 8) | (red << 16);
                            return '#' + (0x1000000 + rgb).toString(16).slice(1)
                        }
                        var newcolor = rgb2hex(r, g, b)

                        var update = { 'marker': { color: backRGB } };
                        var update2 = { 'marker': { color: newcolor } };


                        Plotly.restyle(tester, update, [0])
                        Plotly.restyle(tester, update2, [1])
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }

                    document.getElementById(id2).onchange = function () {
                        var textbox2length = document.getElementById(id3).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var y_axis_end = tester.layout.yaxis.range[1]
                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(textbox2length)
                         // console.log(y_axis_end)

                        if (textbox2length == 0) {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, y_axis_end], showgrid: gridlines_value, automargin: true
                                }
                            }
                        }
                        else {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id3).onchange = function () {
                        var textbox1length = document.getElementById(id2).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var gridlines_value = tester.layout.yaxis.showgrid
                         // console.log(gridlines_value)

                        if (textbox1length == 0) {
                            var layout = {
                                yaxis: {
                                    range: [y_axis_start, textbox2value], showgrid: gridlines_value, automargin: true
                                }
                            }
                        }
                        else {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    myPlot.on('plotly_click', function (data) {
                         // console.log(data.points[0].x)
                         // console.log(data.points)

                        var pn = '',
                            tn = '',
                            colors = [];
                        for (var i = 0; i < data.points.length; i++) {
                            pn = data.points[i].pointNumber;
                            tn = data.points[i].curveNumber;
                            colors = data.points[i].data.marker.color;
                        };
                         // console.log(colors)

                        var color = document.getElementById(id4).value
                        colors[pn] = color;
                         // console.log(pn)
                         // console.log(tn)
                         // console.log(colors)
                        var update = { 'marker': { color: colors } };
                        Plotly.restyle(tester, update, [tn])
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    });

                    document.getElementById(id9).onclick = function () {
                        var gridlinesvalue = document.getElementById(id9).value
                        var x_axis_title = tester.layout.xaxis.title.text
                         // console.log(gridlinesvalue)
                        if (gridlinesvalue == "show_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    automargin: true,
                                    showgrid: true
                                }, xaxis: {
                                    showgrid: true, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "hide_gridlines"
                            document.getElementById(id9).innerHTML = "Hide Gridlines"
                        }
                        if (gridlinesvalue == "hide_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    automargin: true,
                                    showgrid: false
                                }, xaxis: {
                                    showgrid: false, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "show_gridlines"
                            document.getElementById(id9).innerHTML = "Show Gridlines"

                        }
                        Plotly.relayout(tester, layout2)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    };
                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id
                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };
                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };
                    document.getElementById(id11).onchange = function () {
                        var xaxistitlevalue = document.getElementById(id11).value;

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(xaxistitlevalue)
                         // console.log(tester.layout.xaxis.title)

                        var layout = {
                            xaxis: {
                                showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: xaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }


                        }
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id14).onchange = function () {
                        var legendvalue1 = document.getElementById(id14).value;
                        var update = { name: legendvalue1 }

                        Plotly.restyle(tester, update, 0)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }
                    document.getElementById(id15).onchange = function () {
                        var legendvalue2 = document.getElementById(id15).value;
                        var update = { name: legendvalue2 }

                        Plotly.restyle(tester, update, 1)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }




                    try {
                        var changed_text = data.plotDict.changed_text
                    }
                    catch (err) {
                        var changed_text = []

                    }
                    myPlot.on('plotly_afterplot', function () {
                        Plotly.d3.selectAll(".xaxislayer-above").selectAll('text')
                            .on("click", function (d) {
                                 // console.log(d)
                                var labels = tester.data[0].x
                                var position = d.x
                                var text = d.text
                                var labeleditvalue = document.getElementById(id13).value;

                                var dict = {}
                                dict[text] = labeleditvalue
                                changed_text.push(dict)
                                labels[position] = labeleditvalue;
                                 // console.log(position)
                                 // console.log(labels)

                                var update = { "x": [labels] };

                                Plotly.restyle(tester, update)
                                $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                                $(`#${id6}`).attr("data-changed_text", JSON.stringify(changed_text))
                                 // console.log(changed_text)

                            });
                    });
                    document.getElementById(id18).onclick = function () {
                         // console.log(x_axisdata2)
                         // console.log(data)
                        var update = { "x": [JSON.parse(JSON.stringify(x_axisdata2))] }
                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }
                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }
                             // console.log(graph_height)
                             // console.log(graph_width)

                            Plotly.relayout(tester, layout)
                            $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                        },
                    });
                }
                if (graph_subtype == 'Vertical_Grouped_Box') {
                    var x_axis = data.x_axis
                    var y_axis = data.y_axis
                    var second_column = data.second_column

                    var outermodalCard = $(`

<div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
right: 0 ;top : 10px;z-index: 1050">


  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
      <button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <label style="font-size:1.1rem">Change the graph color:</label>
  <input type="color" id=${id1} name="favcolor" value="#b8860b"><br><br>
  <label style="font-size:1.1rem">Change X and Y axis gridlines:</label>
      <button type="button" class="btn btn-primary" id="${id9}" data-toggle="button" role="tab"
                      aria-pressed="false" autocomplete="off" value="show_gridlines" style="line-height: 0.7;">Show Gridlines</button><br><br>
                      <label style="font-size:1.1rem">Change the range of the axis:</label>
  <input type="text" placeholder="Y Axis Start" id=${id2} size="7">
  <input type="text" placeholder="Y Axis End " id=${id3} size="7">
<br><br>
<label style="font-size:1.1rem">Change the title of the axes:</label>
    <input type="text" placeholder="X Axis Title" id=${id11} size="7">
    <br><br>
    <label style="font-size:1.1rem">Change the legend labels:</label>
  <input type="text" placeholder=${y_axis} id=${id14} size="7">
  <input type="text" placeholder=${second_column} id=${id15} size="7">
  <br><br>
<label style="font-size:1.1rem">Change the label of an element:</label><br>
    <input type="text" placeholder="X Axis Label" id=${id13} size="9"> &nbsp;&nbsp;
    <button type="button" class="btn btn-primary" id="${id18}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" style="line-height: 1.1;">Reset Axis Labels</button><br><br>
  </div>
</div>
`)
                    if (data.plotDict === undefined) {

                        outerCard.appendTo('#card')
                        var tab_id = 'main_page'
                                       outermodalCard.appendTo('#card')

                        var x_axisdata2 = JSON.parse(JSON.stringify(data.x_axisdata))

                        var trace1 = {
                            x: data.x_axisdata,
                            y: data.y_axisdata,
                            type: 'box',
                            boxpoints: false,
                            marker: {
                                color: '#b8860b'
                            },
                            name: y_axis
                        };

                        var trace2 = {
                            x: data.x_axisdata,
                            y: data.second_columndata,
                            type: 'box',
                            boxpoints: false,
                            marker: {
                                color: 'goldenrod'
                            },
                            name: second_column
                        };

                        var dataplot = [trace1, trace2]
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)

                        var layout = {
                            boxmode: 'group',
                            margin: { l: 40, r: 0, b: 20, t: 10, pad: 4 },
                            yaxis: {
                                showgrid: false, automargin: true, font: {
                                    family: "Arial"
                                }
                            },
                            xaxis: {
                                title: {
                                    standoff: 20,
                                    text: x_axis, font: {
                                        family: "Arial"
                                    }
                                },
                                showgrid: false, automargin: true, font: {
                                    family: "Arial"
                                }
                            },
                        }
                    }
                    else {
                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tab_id = data.plotDict.tab_id
                                                outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)
                        var dataplot = data.plotDict.data
                        dataplot[0].x = data.x_axisdata
                        dataplot[0].y = data.y_axisdata
                        dataplot[1].x = data.x_axisdata
                        dataplot[1].y = data.second_columndata
                        var layout = data.plotDict.layout

                        var width = width.split("p")
                        var height = height.split("p")

                        var graph_height = height[0] * 0.876
                        var graph_width = width[0] * 0.9481

                        layout["height"] = graph_height
                        layout["width"] = graph_width

                         // console.log(layout)
                        var colorlength = data.x_axisdata.length
                    }
                    var config = { responsive: true, displaylogo: false }

                    Plotly.newPlot(tester, dataplot, layout, config)
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})
                    var y_axis_end = tester.layout.yaxis.range[1]
                    var y_axis_start = tester.layout.yaxis.range[0]

                     // console.log(tester.data)

                    document.getElementById(id1).onchange = function () {

                        var backRGB = this.value;

                        const hexToRgb = hex =>
                            hex.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i
                                , (m, r, g, b) => '#' + r + r + g + g + b + b)
                                .substring(1).match(/.{2}/g)
                                .map(x => parseInt(x, 16))
                        var r = hexToRgb(backRGB)[0] * 0.6
                        var g = hexToRgb(backRGB)[1] * 0.6
                        var b = hexToRgb(backRGB)[2] * 0.6

                        function rgb2hex(red, green, blue) {
                            var rgb = blue | (green << 8) | (red << 16);
                            return '#' + (0x1000000 + rgb).toString(16).slice(1)
                        }
                        var newcolor = rgb2hex(r, g, b)

                        var update = { 'marker': { color: backRGB } };
                        var update2 = { 'marker': { color: newcolor } };


                        Plotly.restyle(tester, update, [0])
                        Plotly.restyle(tester, update2, [1])
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }

                    document.getElementById(id2).onchange = function () {
                        var textbox2length = document.getElementById(id3).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var y_axis_end = tester.layout.yaxis.range[1]
                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(textbox2length)
                         // console.log(y_axis_end)

                        if (textbox2length == 0) {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, y_axis_end], showgrid: gridlines_value, automargin: true
                                }
                            }
                        }
                        else {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id3).onchange = function () {
                        var textbox1length = document.getElementById(id2).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var gridlines_value = tester.layout.yaxis.showgrid
                         // console.log(gridlines_value)

                        if (textbox1length == 0) {
                            var layout = {
                                yaxis: {
                                    range: [y_axis_start, textbox2value], showgrid: gridlines_value, automargin: true
                                }
                            }
                        }
                        else {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    myPlot.on('plotly_click', function (data) {
                         // console.log(data.points[0].x)
                         // console.log(data.points)

                        var pn = '',
                            tn = '',
                            colors = [];
                        for (var i = 0; i < data.points.length; i++) {
                            pn = data.points[i].pointNumber;
                            tn = data.points[i].curveNumber;
                            colors = data.points[i].data.marker.color;
                        };
                         // console.log(colors)

                        var color = document.getElementById(id4).value
                        colors[pn] = color;
                         // console.log(pn)
                         // console.log(tn)
                         // console.log(colors)
                        var update = { 'marker': { color: colors } };
                        Plotly.restyle(tester, update, [tn])
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    });

                    document.getElementById(id9).onclick = function () {
                        var gridlinesvalue = document.getElementById(id9).value
                        var x_axis_title = tester.layout.xaxis.title.text
                         // console.log(gridlinesvalue)
                        if (gridlinesvalue == "show_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    automargin: true,
                                    showgrid: true
                                }, xaxis: {
                                    showgrid: true, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "hide_gridlines"
                            document.getElementById(id9).innerHTML = "Hide Gridlines"
                        }
                        if (gridlinesvalue == "hide_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    automargin: true,
                                    showgrid: false
                                }, xaxis: {
                                    showgrid: false, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "show_gridlines"
                            document.getElementById(id9).innerHTML = "Show Gridlines"

                        }
                        Plotly.relayout(tester, layout2)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    };
                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id
                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };
                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };
                    document.getElementById(id11).onchange = function () {
                        var xaxistitlevalue = document.getElementById(id11).value;

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(xaxistitlevalue)
                         // console.log(tester.layout.xaxis.title)

                        var layout = {
                            xaxis: {
                                showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: xaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }


                        }
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id14).onchange = function () {
                        var legendvalue1 = document.getElementById(id14).value;
                        var update = { name: legendvalue1 }

                        Plotly.restyle(tester, update, 0)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }
                    document.getElementById(id15).onchange = function () {
                        var legendvalue2 = document.getElementById(id15).value;
                        var update = { name: legendvalue2 }

                        Plotly.restyle(tester, update, 1)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }




                    try {
                        var changed_text = data.plotDict.changed_text
                    }
                    catch (err) {
                        var changed_text = []

                    }
                    myPlot.on('plotly_afterplot', function () {
                        Plotly.d3.selectAll(".xaxislayer-above").selectAll('text')
                            .on("click", function (d) {
                                 // console.log(d)
                                var labels = tester.data[0].x
                                var position = d.x
                                var text = d.text
                                var labeleditvalue = document.getElementById(id13).value;

                                var dict = {}
                                dict[text] = labeleditvalue
                                changed_text.push(dict)
                                $.each(labels, function (k, v) {
                                    if (v == text) {
                                        labels[k] = labeleditvalue;
                                    }
                                });
                                var update = { "x": [labels] };

                                Plotly.restyle(tester, update)
                                $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                                $(`#${id6}`).attr("data-changed_text", JSON.stringify(changed_text))
                                 // console.log(changed_text)

                            });
                    });
                    document.getElementById(id18).onclick = function () {
                         // console.log(x_axisdata2)
                         // console.log(data)
                        var update = { "x": [JSON.parse(JSON.stringify(x_axisdata2))] }
                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }
                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }
                             // console.log(graph_height)
                             // console.log(graph_width)

                            Plotly.relayout(tester, layout)
                            $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                        },
                    });
                }
                if (graph_subtype == 'Vertical_Grouped_Violin') {
                    var x_axis = data.x_axis
                    var y_axis = data.y_axis
                    var second_column = data.second_column

                    var outermodalCard = $(`

<div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
right: 0 ;top : 10px;z-index: 1050">


  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
      <button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <label style="font-size:1.1rem">Change the graph color:</label>
  <input type="color" id=${id1} name="favcolor" value="#b8860b"><br><br>
  <label style="font-size:1.1rem">Change X and Y axis gridlines:</label>
      <button type="button" class="btn btn-primary" id="${id9}" data-toggle="button" role="tab"
                      aria-pressed="false" autocomplete="off" value="show_gridlines" style="line-height: 0.7;">Show Gridlines</button><br><br>
                      <label style="font-size:1.1rem">Change the range of the axis:</label>
  <input type="text" placeholder="Y Axis Start" id=${id2} size="7">
  <input type="text" placeholder="Y Axis End " id=${id3} size="7">
<br><br>
<label style="font-size:1.1rem">Change the title of the axes:</label>
    <input type="text" placeholder="X Axis Title" id=${id11} size="7">
    <br><br>
    <label style="font-size:1.1rem">Change the legend labels:</label>
  <input type="text" placeholder=${y_axis} id=${id14} size="7">
  <input type="text" placeholder=${second_column} id=${id15} size="7">
  <br><br>
<label style="font-size:1.1rem">Change the label of an element:</label><br>
    <input type="text" placeholder="X Axis Label" id=${id13} size="9"> &nbsp;&nbsp;
    <button type="button" class="btn btn-primary" id="${id18}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" style="line-height: 1.1;">Reset Axis Labels</button><br><br>
  </div>
</div>
`)
                    if (data.plotDict === undefined) {

                        outerCard.appendTo('#card')
                        var tab_id = 'main_page'
                                      outermodalCard.appendTo('#card')

                        var x_axisdata2 = JSON.parse(JSON.stringify(data.x_axisdata))

                        var trace1 = {
                            x: data.x_axisdata,
                            y: data.y_axisdata,
                            type: 'violin',
                            boxpoints: false,
                            marker: {
                                color: '#b8860b'
                            },
                            name: y_axis
                        };

                        var trace2 = {
                            x: data.x_axisdata,
                            y: data.second_columndata,
                            type: 'violin',
                            boxpoints: false,
                            marker: {
                                color: 'goldenrod'
                            },
                            name: second_column
                        };

                        var dataplot = [trace1, trace2]
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)

                        var layout = {
                            violinmode: 'group',
                            margin: { l: 40, r: 0, b: 20, t: 10, pad: 4 },
                            yaxis: {
                                showgrid: false, automargin: true, font: {
                                    family: "Arial"
                                }
                            },
                            xaxis: {
                                title: {
                                    standoff: 20,
                                    text: x_axis, font: {
                                        family: "Arial"
                                    }
                                },
                                showgrid: false, automargin: true, font: {
                                    family: "Arial"
                                }
                            },
                        }
                    }
                    else {
                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tab_id = data.plotDict.tab_id
                                                outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)
                        var dataplot = data.plotDict.data
                        dataplot[0].x = data.x_axisdata
                        dataplot[0].y = data.y_axisdata
                        dataplot[1].x = data.x_axisdata
                        dataplot[1].y = data.second_columndata
                        var layout = data.plotDict.layout

                        var width = width.split("p")
                        var height = height.split("p")

                        var graph_height = height[0] * 0.876
                        var graph_width = width[0] * 0.9481

                        layout["height"] = graph_height
                        layout["width"] = graph_width

                         // console.log(layout)
                        var colorlength = data.x_axisdata.length
                    }
                    var config = { responsive: true, displaylogo: false }

                    Plotly.newPlot(tester, dataplot, layout, config)
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})
                    var y_axis_end = tester.layout.yaxis.range[1]
                    var y_axis_start = tester.layout.yaxis.range[0]

                     // console.log(tester.data)

                    document.getElementById(id1).onchange = function () {

                        var backRGB = this.value;

                        const hexToRgb = hex =>
                            hex.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i
                                , (m, r, g, b) => '#' + r + r + g + g + b + b)
                                .substring(1).match(/.{2}/g)
                                .map(x => parseInt(x, 16))
                        var r = hexToRgb(backRGB)[0] * 0.6
                        var g = hexToRgb(backRGB)[1] * 0.6
                        var b = hexToRgb(backRGB)[2] * 0.6

                        function rgb2hex(red, green, blue) {
                            var rgb = blue | (green << 8) | (red << 16);
                            return '#' + (0x1000000 + rgb).toString(16).slice(1)
                        }
                        var newcolor = rgb2hex(r, g, b)

                        var update = { 'marker': { color: backRGB } };
                        var update2 = { 'marker': { color: newcolor } };


                        Plotly.restyle(tester, update, [0])
                        Plotly.restyle(tester, update2, [1])
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }

                    document.getElementById(id2).onchange = function () {
                        var textbox2length = document.getElementById(id3).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var y_axis_end = tester.layout.yaxis.range[1]
                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(textbox2length)
                         // console.log(y_axis_end)

                        if (textbox2length == 0) {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, y_axis_end], showgrid: gridlines_value, automargin: true
                                }
                            }
                        }
                        else {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id3).onchange = function () {
                        var textbox1length = document.getElementById(id2).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var gridlines_value = tester.layout.yaxis.showgrid
                         // console.log(gridlines_value)

                        if (textbox1length == 0) {
                            var layout = {
                                yaxis: {
                                    range: [y_axis_start, textbox2value], showgrid: gridlines_value, automargin: true
                                }
                            }
                        }
                        else {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    myPlot.on('plotly_click', function (data) {
                         // console.log(data.points[0].x)
                         // console.log(data.points)

                        var pn = '',
                            tn = '',
                            colors = [];
                        for (var i = 0; i < data.points.length; i++) {
                            pn = data.points[i].pointNumber;
                            tn = data.points[i].curveNumber;
                            colors = data.points[i].data.marker.color;
                        };
                         // console.log(colors)

                        var color = document.getElementById(id4).value
                        colors[pn] = color;
                         // console.log(pn)
                         // console.log(tn)
                         // console.log(colors)
                        var update = { 'marker': { color: colors } };
                        Plotly.restyle(tester, update, [tn])
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    });

                    document.getElementById(id9).onclick = function () {
                        var gridlinesvalue = document.getElementById(id9).value
                        var x_axis_title = tester.layout.xaxis.title.text
                         // console.log(gridlinesvalue)
                        if (gridlinesvalue == "show_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    automargin: true,
                                    showgrid: true
                                }, xaxis: {
                                    showgrid: true, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "hide_gridlines"
                            document.getElementById(id9).innerHTML = "Hide Gridlines"
                        }
                        if (gridlinesvalue == "hide_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    automargin: true,
                                    showgrid: false
                                }, xaxis: {
                                    showgrid: false, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "show_gridlines"
                            document.getElementById(id9).innerHTML = "Show Gridlines"

                        }
                        Plotly.relayout(tester, layout2)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    };
                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id
                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };
                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };
                    document.getElementById(id11).onchange = function () {
                        var xaxistitlevalue = document.getElementById(id11).value;

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(xaxistitlevalue)
                         // console.log(tester.layout.xaxis.title)

                        var layout = {
                            xaxis: {
                                showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: xaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }


                        }
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id14).onchange = function () {
                        var legendvalue1 = document.getElementById(id14).value;
                        var update = { name: legendvalue1 }

                        Plotly.restyle(tester, update, 0)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }
                    document.getElementById(id15).onchange = function () {
                        var legendvalue2 = document.getElementById(id15).value;
                        var update = { name: legendvalue2 }

                        Plotly.restyle(tester, update, 1)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }




                    try {
                        var changed_text = data.plotDict.changed_text
                    }
                    catch (err) {
                        var changed_text = []

                    }
                    myPlot.on('plotly_afterplot', function () {
                        Plotly.d3.selectAll(".xaxislayer-above").selectAll('text')
                            .on("click", function (d) {
                                 // console.log(d)
                                var labels = tester.data[0].x
                                var position = d.x
                                var text = d.text
                                var labeleditvalue = document.getElementById(id13).value;

                                var dict = {}
                                dict[text] = labeleditvalue
                                changed_text.push(dict)
                                $.each(labels, function (k, v) {
                                    if (v == text) {
                                        labels[k] = labeleditvalue;
                                    }
                                });
                                var update = { "x": [labels] };

                                Plotly.restyle(tester, update)
                                $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                                $(`#${id6}`).attr("data-changed_text", JSON.stringify(changed_text))
                                 // console.log(changed_text)

                            });
                    });
                    document.getElementById(id18).onclick = function () {
                         // console.log(x_axisdata2)
                         // console.log(data)
                        var update = { "x": [JSON.parse(JSON.stringify(x_axisdata2))] }
                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }
                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }
                             // console.log(graph_height)
                             // console.log(graph_width)

                            Plotly.relayout(tester, layout)
                            $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                        },
                    });
                }

                if (graph_subtype == 'Vertical_Area_Stacked') {
                    var x_axis = data.x_axis
                    var y_axis = data.y_axis
                    var second_column = data.second_column


                    var outermodalCard = $(`

<div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
right: 0 ;top : 10px;z-index: 1050">


  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
      <button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <label style="font-size:1.1rem">Change the graph color:</label>
  <input type="color" id=${id1} name="favcolor" value="#b8860b"><br><br>
  <label style="font-size:1.1rem">Change X and Y axis gridlines:</label>
      <button type="button" class="btn btn-primary" id="${id9}" data-toggle="button" role="tab"
                      aria-pressed="false" autocomplete="off" value="show_gridlines" style="line-height: 0.7;">Show Gridlines</button><br><br>
                      <label style="font-size:1.1rem">Change the range of the axis:</label>
  <input type="text" placeholder="Y Axis Start" id=${id2} size="7">
  <input type="text" placeholder="Y Axis End " id=${id3} size="7">
<br><br>
<label style="font-size:1.1rem">Change the title of the axes:</label>
    <input type="text" placeholder="X Axis Title" id=${id11} size="7">
    <br><br>
    <label style="font-size:1.1rem">Change the legend labels:</label>
  <input type="text" placeholder=${y_axis} id=${id14} size="7">
  <input type="text" placeholder=${second_column} id=${id15} size="7">
  <br><br>
<label style="font-size:1.1rem">Change the label of an element:</label><br>
    <input type="text" placeholder="X Axis Label" id=${id13} size="9"> &nbsp;&nbsp;
    <button type="button" class="btn btn-primary" id="${id18}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" style="line-height: 1.1;">Reset Axis Labels</button><br><br>
  </div>
</div>
`)
                    if (data.plotDict === undefined) {

                        outerCard.appendTo('#card')
                        var tab_id = 'main_page'
                                    outermodalCard.appendTo('#card')

                        var x_axisdata2 = JSON.parse(JSON.stringify(data.x_axisdata))



                        var trace1 = {
                            x: data.x_axisdata,
                            y: data.y_axisdata,
                            mode: 'lines',
                            marker: {
                                color: '#b8860b'
                            },
                            fill: 'tozeroy',
                            name: y_axis
                        };
                        var trace2 = {
                            x: data.x_axisdata,
                            y: data.second_columndata,
                            mode: 'lines',
                            marker: {
                                color: 'goldenrod'
                            },
                            fill: 'tonexty',
                            name: second_column
                        };
                        var dataplot = [trace1, trace2]
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)

                        var layout = {
                            margin: { l: 40, r: 0, b: 20, t: 10, pad: 4 },
                            yaxis: {
                                showgrid: false, automargin: true, font: {
                                    family: "Arial"
                                }
                            },
                            xaxis: {
                                title: {
                                    standoff: 20,
                                    text: x_axis, font: {
                                        family: "Arial"
                                    }
                                },
                                showgrid: false, automargin: true, font: {
                                    family: "Arial"
                                }
                            },
                        }
                    }
                    else {
                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tab_id = data.plotDict.tab_id
                                                outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)
                        var dataplot = data.plotDict.data
                        dataplot[0].x = data.x_axisdata
                        dataplot[0].y = data.y_axisdata
                        dataplot[1].x = data.x_axisdata
                        dataplot[1].y = data.second_columndata

                        var layout = data.plotDict.layout

                        var width = width.split("p")
                        var height = height.split("p")

                        var graph_height = height[0] * 0.876
                        var graph_width = width[0] * 0.9481

                        layout["height"] = graph_height
                        layout["width"] = graph_width

                         // console.log(layout)
                        var colorlength = data.x_axisdata.length

                    }
                    var config = { responsive: true, displaylogo: false }

                    Plotly.newPlot(tester, dataplot, layout, config)
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})
                    var y_axis_end = tester.layout.yaxis.range[1]
                    var y_axis_start = tester.layout.yaxis.range[0]

                     // console.log(tester.data)


                    document.getElementById(id1).onchange = function () {

                        var backRGB = this.value;

                        const hexToRgb = hex =>
                            hex.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i
                                , (m, r, g, b) => '#' + r + r + g + g + b + b)
                                .substring(1).match(/.{2}/g)
                                .map(x => parseInt(x, 16))
                        var r = hexToRgb(backRGB)[0] * 0.6
                        var g = hexToRgb(backRGB)[1] * 0.6
                        var b = hexToRgb(backRGB)[2] * 0.6

                        function rgb2hex(red, green, blue) {
                            var rgb = blue | (green << 8) | (red << 16);
                            return '#' + (0x1000000 + rgb).toString(16).slice(1)
                        }
                        var newcolor = rgb2hex(r, g, b)

                        var update = { 'marker': { color: backRGB } };
                        var update2 = { 'marker': { color: newcolor } };

                        Plotly.restyle(tester, update, [0])
                        Plotly.restyle(tester, update2, [1])
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }

                    document.getElementById(id2).onchange = function () {
                        var textbox2length = document.getElementById(id3).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var y_axis_end = tester.layout.yaxis.range[1]
                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(textbox2length)
                         // console.log(y_axis_end)

                        if (textbox2length == 0) {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, y_axis_end], showgrid: gridlines_value, automargin: true
                                }
                            }
                        }
                        else {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id3).onchange = function () {
                        var textbox1length = document.getElementById(id2).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var gridlines_value = tester.layout.yaxis.showgrid
                         // console.log(gridlines_value)

                        if (textbox1length == 0) {
                            var layout = {
                                yaxis: {
                                    range: [y_axis_start, textbox2value], showgrid: gridlines_value, automargin: true
                                }
                            }
                        }
                        else {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    myPlot.on('plotly_click', function (data) {
                         // console.log(data.points[0].x)
                         // console.log(data.points)

                        var pn = '',
                            tn = '',
                            colors = [];
                        for (var i = 0; i < data.points.length; i++) {
                            pn = data.points[i].pointNumber;
                            tn = data.points[i].curveNumber;
                            colors = data.points[i].data.marker.color;
                        };
                         // console.log(colors)

                        var color = document.getElementById(id4).value
                        colors[pn] = color;
                         // console.log(pn)
                         // console.log(tn)
                         // console.log(colors)
                        var update = { 'marker': { color: colors } };
                        Plotly.restyle(tester, update, [tn])
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    });

                    document.getElementById(id9).onclick = function () {
                        var gridlinesvalue = document.getElementById(id9).value
                        var x_axis_title = tester.layout.xaxis.title.text
                         // console.log(gridlinesvalue)
                        if (gridlinesvalue == "show_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    automargin: true,
                                    showgrid: true
                                }, xaxis: {
                                    showgrid: true, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "hide_gridlines"
                            document.getElementById(id9).innerHTML = "Hide Gridlines"
                        }
                        if (gridlinesvalue == "hide_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    automargin: true,
                                    showgrid: false
                                }, xaxis: {
                                    showgrid: false, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "show_gridlines"
                            document.getElementById(id9).innerHTML = "Show Gridlines"

                        }
                        Plotly.relayout(tester, layout2)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    };
                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id
                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };
                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };
                    document.getElementById(id11).onchange = function () {
                        var xaxistitlevalue = document.getElementById(id11).value;

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(xaxistitlevalue)
                         // console.log(tester.layout.xaxis.title)

                        var layout = {
                            xaxis: {
                                showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: xaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }


                        }
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id14).onchange = function () {
                        var legendvalue1 = document.getElementById(id14).value;
                        var update = { name: legendvalue1 }

                        Plotly.restyle(tester, update, 0)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }
                    document.getElementById(id15).onchange = function () {
                        var legendvalue2 = document.getElementById(id15).value;
                        var update = { name: legendvalue2 }

                        Plotly.restyle(tester, update, 1)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }




                    try {
                        var changed_text = data.plotDict.changed_text
                    }
                    catch (err) {
                        var changed_text = []

                    }
                    myPlot.on('plotly_afterplot', function () {
                        Plotly.d3.selectAll(".xaxislayer-above").selectAll('text')
                            .on("click", function (d) {
                                 // console.log(d)
                                var labels = tester.data[0].x
                                var position = d.x
                                var text = d.text
                                var labeleditvalue = document.getElementById(id13).value;

                                var dict = {}
                                dict[text] = labeleditvalue
                                changed_text.push(dict)
                                labels[position] = labeleditvalue;
                                 // console.log(position)
                                 // console.log(labels)

                                var update = { "x": [labels] };

                                Plotly.restyle(tester, update)
                                $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                                $(`#${id6}`).attr("data-changed_text", JSON.stringify(changed_text))
                                 // console.log(changed_text)

                            });
                    });
                    document.getElementById(id18).onclick = function () {
                         // console.log(x_axisdata2)
                         // console.log(data)
                        var update = { "x": [JSON.parse(JSON.stringify(x_axisdata2))] }
                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }
                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }
                             // console.log(graph_height)
                             // console.log(graph_width)

                            Plotly.relayout(tester, layout)
                            $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                        },
                    });
                }
                if (graph_subtype == 'Horizontal_Bar') {

                    var outermodalCard = $(`

<div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
right: 0 ;top : 10px;z-index: 1050">


  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
      <button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <label style="font-size:1.1rem">Change the graph color:</label>
  <input type="color" id=${id1} name="favcolor" value="#b8860b"><br><br><label style="font-size:1.1rem">Change the color or an element:</label>
  <input type="color" id=${id4} name="favcolor1" value="#b8860b"><br><br>
  <label style="font-size:1.1rem">Change X and Y axis gridlines:</label>
      <button type="button" class="btn btn-primary" id="${id9}" data-toggle="button" role="tab"
                      aria-pressed="false" autocomplete="off" value="show_gridlines" style="line-height: 0.7;">Show Gridlines</button><br><br>
                      <label style="font-size:1.1rem">Change the range of the axis:</label>
  <input type="text" placeholder="Y Axis Start" id=${id2} size="7">
  <input type="text" placeholder="Y Axis End " id=${id3} size="7">
<br><br>
<label style="font-size:1.1rem">Change the title of the axes:</label>
    <input type="text" placeholder="X Axis Title" id=${id11} size="7">
    <input type="text" placeholder="Y Axis Title" id=${id12} size="7">
    <br><br>
<label style="font-size:1.1rem">Change the label of an element:</label><br>
    <input type="text" placeholder="Y Axis Label" id=${id13} size="9"> &nbsp;&nbsp;
    <button type="button" class="btn btn-primary" id="${id18}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" style="line-height: 1.1;">Reset Axis Labels</button><br><br>
                        <label style="font-size:1.1rem">Change Plot Labels:</label>
        <button type="button" class="btn btn-primary" id="${id_labels}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" value="show_labels" style="line-height: 1.1;">Show Labels</button>
  </div>
</div>
`)
                    if (data.plotDict === undefined) {

                        outerCard.appendTo('#card')
                        var tab_id = 'main_page'
                                    outermodalCard.appendTo('#card')
                        var colorlength = data.x_axisdata.length
                        var colordata = [];
                        var x_axis = data.x_axis
                        var y_axis = data.y_axis
                        var y_axisdata2 = JSON.parse(JSON.stringify(data.y_axisdata))

                        for (var i = 0; i < colorlength; i++) {
                            colordata.push('#b8860b');
                        }
                         // console.log(colordata)
                        var trace1 = {
                            x: data.x_axisdata,
                            y: data.y_axisdata,
                            type: 'bar',
                            marker: {
                                color: colordata,
                            },
                            orientation: 'h',

                        };

                        var dataplot = [trace1]
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)

                        var layout = {
                            margin: { l: 0, r: 0, b: 20, t: 10, pad: 4 },
                            yaxis: {
                                title: {
                                    standoff: 20,
                                    text: y_axis, font: {
                                        family: "Arial"
                                    }
                                }, showgrid: false, font: {
                                    family: "Arial"
                                }, tickangle: 45,
                                automargin: true
                            },
                            xaxis: {
                                title: {
                                    standoff: 20,
                                    text: x_axis, font: {
                                        family: "Arial"
                                    }
                                },
                                showgrid: false, automargin: true, font: {
                                    family: "Arial"
                                }
                            },
                        }
                    }
                    else {
                         // console.log('load')
                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tab_id = data.plotDict.tab_id
                                                outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)
                        var dataplot = data.plotDict.data
                        dataplot[0].x = data.x_axisdata
                        dataplot[0].y = data.y_axisdata
                        delete dataplot[0]["selectedpoints"]

                        var layout = data.plotDict.layout

                        var width = width.split("p")
                        var height = height.split("p")

                        var graph_height = height[0] * 0.876
                        var graph_width = width[0] * 0.9481

                        layout["height"] = graph_height
                        layout["width"] = graph_width

                         // console.log(layout)
                        var colorlength = data.x_axis.length
                        var colordata = data.colordata
                    }
                    var config = { responsive: true, displaylogo: false }

                    Plotly.newPlot(tester, dataplot, layout, config)
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})
                    var x_axis_end = tester.layout.xaxis.range[1]
                    var x_axis_start = tester.layout.xaxis.range[0]

                     // console.log(tester.layout)

                    document.getElementById(id1).onchange = function () {
                        var colorlength = data.x_axisdata.length
                         // console.log(colorlength)
                        var colordata2 = [];
                        var backRGB = this.value;

                        for (var i = 0; i < colorlength; i++) {
                            colordata2.push(backRGB);
                        }
                         // console.log(colordata2)

                        var update = { 'marker': { color: colordata2 } };


                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }
                    document.getElementById(id_labels).onclick = function () {
                        var labelsvalue = document.getElementById(id_labels).value

                        if (labelsvalue == "show_labels") {
                            var x_axisdata = tester.data[0].x
                             // console.log(x_axisdata)
                            x_axisdata = x_axisdata.map(function(each_element){
                                return Number(each_element.toFixed(2));
                            });
                             // console.log(x_axisdata)
                            var update = tester.data
                            update[0]['text'] = x_axisdata.map(String),
                            update[0]['textposition'] = 'outside'
                            update[0]['textangle'] = 90
                            document.getElementById(id_labels).value = "hide_labels"
                            document.getElementById(id_labels).innerHTML = "Hide Labels"
                        }
                        if (labelsvalue == "hide_labels") {
                            var update = tester.data
                             // console.log(update)
                            delete update[0]["text"]
                            delete update[0]["textposition"]
                            document.getElementById(id_labels).value = "show_labels"
                            document.getElementById(id_labels).innerHTML = "Show Labels"
                        }
                         // console.log(update)
                        Plotly.redraw(tester, update)
                         // console.log(tester.data)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))
                    };
                    document.getElementById(id2).onchange = function () {
                        var textbox2length = document.getElementById(id3).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var x_axis_end = tester.layout.xaxis.range[1]
                        var gridlines_value = tester.layout.yaxis.showgrid
                        var x_axis_title = tester.layout.xaxis.title.text

                         // console.log(textbox2length)
                         // console.log(x_axis_end)

                        if (textbox2length == 0) {
                            var layout = {
                                xaxis: {
                                    range: [textbox1value, x_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        }
                        else {
                            var layout = {
                                xaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id3).onchange = function () {
                        var textbox1length = document.getElementById(id2).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var x_axis_start = tester.layout.xaxis.range[0]
                        var gridlines_value = tester.layout.xaxis.showgrid
                         // console.log(gridlines_value)
                        var x_axis_title = tester.layout.xaxis.title.text

                        if (textbox1length == 0) {
                            var layout = {
                                xaxis: {
                                    range: [x_axis_start, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        }
                        else {
                            var layout = {
                                xaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    myPlot.on('plotly_click', function (data) {
                         // console.log(data.points[0].x)
                         // console.log(data.points)

                        var pn = '',
                            tn = '',
                            colors = [];
                        for (var i = 0; i < data.points.length; i++) {
                            pn = data.points[i].pointNumber;
                            tn = data.points[i].curveNumber;
                            colors = data.points[i].data.marker.color;
                        };
                         // console.log(colors)

                        var color = document.getElementById(id4).value
                        colors[pn] = color;
                         // console.log(pn)
                         // console.log(tn)
                         // console.log(colors)
                        var update = { 'marker': { color: colors } };
                        Plotly.restyle(tester, update, [tn])
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    });

                    document.getElementById(id9).onclick = function () {
                        var gridlinesvalue = document.getElementById(id9).value
                         // console.log(gridlinesvalue)
                        var x_axis_title = tester.layout.xaxis.title.text
                        var y_axis_title = tester.layout.yaxis.title.text

                        if (gridlinesvalue == "show_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    showgrid: true, automargin: true, tickangle: 45, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: true, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "hide_gridlines"
                            document.getElementById(id9).innerHTML = "Hide Gridlines"
                        }
                        if (gridlinesvalue == "hide_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    showgrid: false, automargin: true, tickangle: 45, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: false, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "show_gridlines"
                            document.getElementById(id9).innerHTML = "Show Gridlines"

                        }
                        Plotly.relayout(tester, layout2)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    };
                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id
                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };
                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };
                    document.getElementById(id11).onchange = function () {
                        var xaxistitlevalue = document.getElementById(id11).value;

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(xaxistitlevalue)
                         // console.log(tester.layout.xaxis.title)

                        var layout = {
                            xaxis: {
                                showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: xaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }


                        }
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }

                    document.getElementById(id12).onchange = function () {
                        var yaxistitlevalue = document.getElementById(id12).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var y_axis_end = tester.layout.yaxis.range[1]

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(yaxistitlevalue)
                         // console.log(tester.layout.yaxis.title)

                        var layout = {
                            yaxis: {
                                range: [y_axis_start, y_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20, tickangle: 45,
                                    text: yaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }
                        }

                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }

                    myPlot.on('plotly_afterplot', function () {
                        Plotly.d3.selectAll(".yaxislayer-above").selectAll('text')
                            .on("click", function (d) {
                                 // console.log(d)
                                var labels = tester.data[0].y
                                var position = d.x
                                var text = d.text
                                var labeleditvalue = document.getElementById(id13).value;

                                var dict = {}
                                dict[text] = labeleditvalue
                                changed_text.push(dict)
                                labels[position] = labeleditvalue;
                                 // console.log(position)
                                 // console.log(labels)

                                var update = { "y": [labels] };

                                Plotly.restyle(tester, update)
                                $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))


                                $(`#${id6}`).attr("data-changed_text", JSON.stringify(changed_text))
                                 // console.log(changed_text)

                            });
                    });
                    document.getElementById(id18).onclick = function () {
                         // console.log(y_axisdata2)
                         // console.log(data)
                        var update = { "y": [JSON.parse(JSON.stringify(y_axisdata2))] }
                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }
                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }
                             // console.log(graph_height)
                             // console.log(graph_width)

                            Plotly.relayout(tester, layout)
                            $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                        },
                    });
                    myPlot.on('plotly_selected', function(data){
                        try {
                        points_array = data.points
                         // console.log(points_array)

                        var points = []
                        for(let i = 0; i < points_array.length; i++){
                            points.push(points_array[i].label)
                            }
                         // console.log(points)
                        var crossfilterdict = { 'points':points,'id':chartDivId}
                        crossfilter_function(crossfilterdict)
                        }
                        catch(err){
                                ;
                        }
                        })
                        myPlot.on('plotly_deselect', function(){
                        //  // console.log('hi')
                        // var CLICK_TIME = Date.now()

                        // if(CLICK_TIME - LAST_CLICK < 10000) {
                        var resetdict = {'id':chartDivId}
                        reset_function(resetdict)
                        // } else {
                        //     LAST_CLICK = CLICK_TIME
                        //      // console.log('single click')
                        // }


                    })
                }

                if (graph_subtype == 'Horizontal_Histogram') {

                    var outermodalCard = $(`

<div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
right: 0 ;top : 10px;z-index: 1050">


  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
      <button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <label style="font-size:1.1rem">Change the graph color:</label>
  <input type="color" id=${id1} name="favcolor" value="#b8860b"><br><br><label style="font-size:1.1rem"> <label style="font-size:1.1rem">Change X and Y axis gridlines:</label>
      <button type="button" class="btn btn-primary" id="${id9}" data-toggle="button" role="tab"
                      aria-pressed="false" autocomplete="off" value="show_gridlines" style="line-height: 0.7;">Show Gridlines</button><br><br>
                      <label style="font-size:1.1rem">Change the range of the axis:</label>
  <input type="text" placeholder="Y Axis Start" id=${id2} size="7">
  <input type="text" placeholder="Y Axis End " id=${id3} size="7">
<br><br>
<label style="font-size:1.1rem">Change the title of the axes:</label>
    <input type="text" placeholder="X Axis Title" id=${id11} size="7">
    <input type="text" placeholder="Y Axis Title" id=${id12} size="7">
  </div>
</div>
`)
                    if (data.plotDict === undefined) {

                        outerCard.appendTo('#card')
                        var tab_id = 'main_page'
                                    outermodalCard.appendTo('#card')
                        var colorlength = data.x_axisdata.length
                        var colordata = [];
                        var x_axis = data.x_axis

                        var trace1 = {
                            y: data.x_axisdata,
                            type: 'histogram',
                            marker: {
                                color: '#b8860b'
                            }
                        };

                        var dataplot = [trace1]
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)

                        var layout = {
                            margin: { l: 0, r: 0, b: 20, t: 10, pad: 4 },
                            yaxis: {
                                title: {
                                    standoff: 20,
                                    text: y_axis, font: {
                                        family: "Arial"
                                    }
                                }, showgrid: false, font: {
                                    family: "Arial"
                                }, tickangle: 45,
                                automargin: true
                            },
                            xaxis: {
                                title: {
                                    standoff: 20,
                                    text: x_axis, font: {
                                        family: "Arial"
                                    }
                                },
                                showgrid: false, automargin: true, font: {
                                    family: "Arial"
                                }
                            },
                        }
                    }
                    else {
                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tab_id = data.plotDict.tab_id
                                                outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)
                        var dataplot = data.plotDict.data
                        dataplot[0].y = data.x_axisdata

                        var layout = data.plotDict.layout

                        var width = width.split("p")
                        var height = height.split("p")

                        var graph_height = height[0] * 0.876
                        var graph_width = width[0] * 0.9481

                        layout["height"] = graph_height
                        layout["width"] = graph_width

                         // console.log(layout)

                    }
                    var config = { responsive: true, displaylogo: false }

                    Plotly.newPlot(tester, dataplot, layout, config)
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})
                    var x_axis_end = tester.layout.xaxis.range[1]
                    var x_axis_start = tester.layout.xaxis.range[0]

                     // console.log(tester.layout)


                    document.getElementById(id1).onchange = function () {
                        var colorlength = data.y_axisdata.length
                         // console.log(colorlength)
                        var colordata2 = [];
                        var backRGB = this.value;

                        for (var i = 0; i < colorlength; i++) {
                            colordata2.push(backRGB);
                        }
                         // console.log(colordata2)

                        var update = { 'marker': { color: colordata2 } };


                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))
                    }

                    document.getElementById(id2).onchange = function () {
                        var textbox2length = document.getElementById(id3).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var x_axis_end = tester.layout.xaxis.range[1]
                        var gridlines_value = tester.layout.yaxis.showgrid
                        var x_axis_title = tester.layout.xaxis.title.text

                         // console.log(textbox2length)
                         // console.log(x_axis_end)

                        if (textbox2length == 0) {
                            var layout = {
                                xaxis: {
                                    range: [textbox1value, x_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        }
                        else {
                            var layout = {
                                xaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id3).onchange = function () {
                        var textbox1length = document.getElementById(id2).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var x_axis_start = tester.layout.xaxis.range[0]
                        var gridlines_value = tester.layout.xaxis.showgrid
                         // console.log(gridlines_value)
                        var x_axis_title = tester.layout.xaxis.title.text

                        if (textbox1length == 0) {
                            var layout = {
                                xaxis: {
                                    range: [x_axis_start, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        }
                        else {
                            var layout = {
                                xaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }

                    document.getElementById(id9).onclick = function () {
                        var gridlinesvalue = document.getElementById(id9).value
                         // console.log(gridlinesvalue)
                        var x_axis_title = tester.layout.xaxis.title.text
                        var y_axis_title = tester.layout.yaxis.title.text

                        if (gridlinesvalue == "show_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    showgrid: true, automargin: true, tickangle: 45, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: true, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "hide_gridlines"
                            document.getElementById(id9).innerHTML = "Hide Gridlines"
                        }
                        if (gridlinesvalue == "hide_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    showgrid: false, automargin: true, tickangle: 45, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: false, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "show_gridlines"
                            document.getElementById(id9).innerHTML = "Show Gridlines"

                        }
                        Plotly.relayout(tester, layout2)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    };
                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id
                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };
                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };
                    document.getElementById(id11).onchange = function () {
                        var xaxistitlevalue = document.getElementById(id11).value;

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(xaxistitlevalue)
                         // console.log(tester.layout.xaxis.title)

                        var layout = {
                            xaxis: {
                                showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: xaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }


                        }
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }

                    document.getElementById(id12).onchange = function () {
                        var yaxistitlevalue = document.getElementById(id12).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var y_axis_end = tester.layout.yaxis.range[1]

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(yaxistitlevalue)
                         // console.log(tester.layout.yaxis.title)

                        var layout = {
                            yaxis: {
                                range: [y_axis_start, y_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20, tickangle: 45,
                                    text: yaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }
                        }

                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }

                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }
                             // console.log(graph_height)
                             // console.log(graph_width)

                            Plotly.relayout(tester, layout)
                            $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                        },
                    });
                }
                if (graph_subtype == 'Funnel') {

                    var outermodalCard = $(`

<div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
right: 0 ;top : 10px;z-index: 1050">


  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
      <button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <label style="font-size:1.1rem">Change the graph color:</label>
  <input type="color" id=${id1} name="favcolor" value="#b8860b"><br><br><label style="font-size:1.1rem">Change the color or an element:</label>
  <input type="color" id=${id4} name="favcolor1" value="#b8860b">
<br><br>
<label style="font-size:1.1rem">Change the title of the axes:</label>
    <input type="text" placeholder="Y Axis Title" id=${id12} size="7">
    <br><br>
<label style="font-size:1.1rem">Change the label of an element:</label><br>
    <input type="text" placeholder="Y Axis Label" id=${id13} size="9"> &nbsp;&nbsp;
    <button type="button" class="btn btn-primary" id="${id18}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" style="line-height: 1.1;">Reset Axis Labels</button><br><br>
  </div>
</div>
`)
                    if (data.plotDict === undefined) {

                        outerCard.appendTo('#card')
                        var tab_id = 'main_page'
                                    outermodalCard.appendTo('#card')
                        var colorlength = data.x_axisdata.length
                        var colordata = [];
                        var x_axis = data.x_axis
                        var y_axis = data.y_axis
                        var y_axisdata2 = JSON.parse(JSON.stringify(data.y_axisdata))

                        for (var i = 0; i < colorlength; i++) {
                            colordata.push('#b8860b');
                        }
                         // console.log(colordata)
                        var trace1 = {
                            x: data.x_axisdata,
                            y: data.y_axisdata,
                            type: 'funnel',
                            marker: {
                                color: colordata,
                            },
                        };

                        var dataplot = [trace1]
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)

                        var layout = {
                            margin: { l: 0, r: 0, b: 20, t: 10, pad: 4 },
                            yaxis: {
                                title: {
                                    standoff: 20,
                                    text: y_axis, font: {
                                        family: "Arial"
                                    }
                                }, showgrid: false, font: {
                                    family: "Arial"
                                },
                                tickangle: 45,
                                automargin: true
                            },

                        }
                    }
                    else {

                         // console.log('load')
                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tab_id = data.plotDict.tab_id
                                                outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)
                        var dataplot = data.plotDict.data
                        dataplot[0].x = data.x_axisdata
                        dataplot[0].y = data.y_axisdata
                        delete dataplot[0]["selectedpoints"]

                        var layout = data.plotDict.layout

                        var width = width.split("p")
                        var height = height.split("p")

                        var graph_height = height[0] * 0.876
                        var graph_width = width[0] * 0.9481

                        layout["height"] = graph_height
                        layout["width"] = graph_width

                         // console.log(layout)
                        var colorlength = data.x_axis.length
                    }
                    var config = { responsive: true, displaylogo: false }

                    Plotly.newPlot(tester, dataplot, layout, config)
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})
                     // console.log(tester.layout)

                    document.getElementById(id1).onchange = function () {
                        var colorlength = data.xaxis_data.length
                         // console.log(colorlength)
                        var colordata2 = [];
                        var backRGB = this.value;

                        for (var i = 0; i < colorlength; i++) {
                            colordata2.push(backRGB);
                        }
                         // console.log(colordata2)

                        var update = { 'marker': { color: colordata2 } };


                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }

                    myPlot.on('plotly_click', function (data) {
                         // console.log(data.points[0].x)
                         // console.log(data.points)

                        var pn = '',
                            tn = '',
                            colors = [];
                        for (var i = 0; i < data.points.length; i++) {
                            pn = data.points[i].pointNumber;
                            tn = data.points[i].curveNumber;
                            colors = data.points[i].data.marker.color;
                        };
                         // console.log(colors)

                        var color = document.getElementById(id4).value
                        colors[pn] = color;
                         // console.log(pn)
                         // console.log(tn)
                         // console.log(colors)
                        var update = { 'marker': { color: colors } };
                        Plotly.restyle(tester, update, [tn])
                    });

                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id
                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };
                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };


                    document.getElementById(id12).onchange = function () {
                        var yaxistitlevalue = document.getElementById(id12).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var y_axis_end = tester.layout.yaxis.range[1]

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(yaxistitlevalue)
                         // console.log(tester.layout.yaxis.title)

                        var layout = {
                            yaxis: {
                                range: [y_axis_start, y_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20, tickangle: 45,
                                    text: yaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }
                        }

                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }

                    myPlot.on('plotly_afterplot', function () {
                        Plotly.d3.selectAll(".yaxislayer-above").selectAll('text')
                            .on("click", function (d) {
                                 // console.log(d)
                                var labels = tester.data[0].y
                                var position = d.x
                                var text = d.text
                                var labeleditvalue = document.getElementById(id13).value;

                                var dict = {}
                                dict[text] = labeleditvalue
                                changed_text.push(dict)
                                labels[position] = labeleditvalue;
                                 // console.log(position)
                                 // console.log(labels)

                                var update = { "y": [labels] };

                                Plotly.restyle(tester, update)
                                $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                                $(`#${id6}`).attr("data-changed_text", JSON.stringify(changed_text))
                                 // console.log(changed_text)

                            });
                    });
                    document.getElementById(id18).onclick = function () {
                         // console.log(y_axisdata2)
                         // console.log(data)
                        var update = { "y": [JSON.parse(JSON.stringify(y_axisdata2))] }
                        Plotly.restyle(tester, update)

                    }
                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }
                             // console.log(graph_height)
                             // console.log(graph_width)

                            Plotly.relayout(tester, layout)
                            $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))
                        },
                    });
                    myPlot.on('plotly_selected', function(data){
                         // console.log("hi")
                         // console.log(data)

                        try {
                        points_array = data.points
                         // console.log(points_array)

                        var points = []
                        for(let i = 0; i < points_array.length; i++){
                            points.push(points_array[i].y)
                            }
                         // console.log(points)
                        var crossfilterdict = { 'points':points,'id':chartDivId}
                        crossfilter_function(crossfilterdict)
                        }
                        catch(err){
                                ;
                        }
                        })
                    // var LAST_CLICK = null;

                    myPlot.on('plotly_deselect', function(){
                        //  // console.log('hi')
                        // var CLICK_TIME = Date.now()

                        // if(CLICK_TIME - LAST_CLICK < 10000) {
                        var resetdict = {'id':chartDivId}
                        reset_function(resetdict)
                        // } else {
                        //     LAST_CLICK = CLICK_TIME
                        //      // console.log('single click')
                        // }


                    })
                }
                if (graph_subtype == 'Funnel_Stacked') {

                    var outermodalCard = $(`

<div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
right: 0 ;top : 10px;z-index: 1050">


  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
      <button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <label style="font-size:1.1rem">Change the graph color:</label>
  <input type="color" id=${id1} name="favcolor" value="#b8860b"><br><br><label style="font-size:1.1rem">Change the color or an element:</label>
  <input type="color" id=${id4} name="favcolor1" value="#b8860b">
<br><br>
<label style="font-size:1.1rem">Change the title of the axes:</label>
    <input type="text" placeholder="Y Axis Title" id=${id12} size="7">
    <br><br>
<label style="font-size:1.1rem">Change the label of an element:</label><br>
    <input type="text" placeholder="Y Axis Label" id=${id13} size="9"> &nbsp;&nbsp;
    <button type="button" class="btn btn-primary" id="${id18}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" style="line-height: 1.1;">Reset Axis Labels</button><br><br>
  </div>
</div>
`)

                    outerCard.appendTo('#card')
                    outermodalCard.appendTo('#card')
                    var colorlength = data.x_axisdata.length
                    var colordata = [];
                    var colordatasecond = [];

                    var x_axis = data.x_axis
                    var y_axis = data.y_axis
                    var y_axisdata2 = JSON.parse(JSON.stringify(data.y_axisdata))

                    for (var i = 0; i < colorlength; i++) {
                        colordata.push('#b8860b');
                    }
                    for (var i = 0; i < colorlength; i++) {
                        colordatasecond.push('goldenrod');
                    }
                     // console.log(colordata)
                    var trace1 = {
                        x: data.x_axisdata,
                        y: data.y_axisdata,
                        type: 'funnel',
                        marker: {
                            color: colordata,
                        },
                        name: x_axis
                    };
                    var trace2 = {
                        x: data.second_columndata,
                        y: data.y_axisdata,
                        type: 'funnel',
                        marker: {
                            color: colordatasecond,
                        },
                        name: data.second_column
                    };

                    var data = [trace1, trace2]
                    var tester = document.getElementById(id)
                    var myPlot = document.getElementById(id)

                    var layout = {
                        hovermode: 'closest',
                        funnelmode: "stack",
                        margin: { l: 0, r: 0, b: 20, t: 10, pad: 4 },
                        yaxis: {
                            title: {
                                standoff: 20,
                                text: y_axis, font: {
                                    family: "Arial"
                                }
                            }, showgrid: false, font: {
                                family: "Arial"
                            },
                            tickangle: 45,
                            automargin: true
                        },

                    }
                    var config = { responsive: true, displaylogo: false }

                    Plotly.newPlot(tester, data, layout, config)
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})

                     // console.log(tester.layout)


                    document.getElementById(id1).onchange = function () {
                         // console.log(colordata.length)
                        var colorlength = colordata.length
                         // console.log(colorlength)

                        var colordata2 = [];
                        var colordata3 = [];

                        var backRGB = this.value;

                        const hexToRgb = hex =>
                            hex.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i
                                , (m, r, g, b) => '#' + r + r + g + g + b + b)
                                .substring(1).match(/.{2}/g)
                                .map(x => parseInt(x, 16))
                        var r = hexToRgb(backRGB)[0] * 0.9
                        var g = hexToRgb(backRGB)[1] * 0.9
                        var b = hexToRgb(backRGB)[2] * 0.9

                        function rgb2hex(red, green, blue) {
                            var rgb = blue | (green << 8) | (red << 16);
                            return '#' + (0x1000000 + rgb).toString(16).slice(1)
                        }
                        var newcolor = rgb2hex(r, g, b)

                        for (var i = 0; i < colorlength; i++) {
                            colordata2.push(backRGB);
                        }
                        for (var i = 0; i < colorlength; i++) {
                            colordata3.push(newcolor);
                        }
                        var update = { 'marker': { color: colordata2 } };
                        var update2 = { 'marker': { color: colordata3 } };


                        Plotly.restyle(tester, update, [0])
                        Plotly.restyle(tester, update2, [1])

                    }


                    myPlot.on('plotly_click', function (data) {
                         // console.log(data.points[0].x)
                         // console.log(data.points)

                        var pn = '',
                            tn = '',
                            colors = [];
                        for (var i = 0; i < data.points.length; i++) {
                            pn = data.points[i].pointNumber;
                            tn = data.points[i].curveNumber;
                            colors = data.points[i].data.marker.color;
                        };
                         // console.log(colors)

                        var color = document.getElementById(id4).value
                        colors[pn] = color;
                         // console.log(pn)
                         // console.log(tn)
                         // console.log(colors)
                        var update = { 'marker': { color: colors } };
                        Plotly.restyle(tester, update, [tn])
                    });

                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id
                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };
                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };


                    document.getElementById(id12).onchange = function () {
                        var yaxistitlevalue = document.getElementById(id12).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var y_axis_end = tester.layout.yaxis.range[1]

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(yaxistitlevalue)
                         // console.log(tester.layout.yaxis.title)

                        var layout = {
                            yaxis: {
                                range: [y_axis_start, y_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20, tickangle: 45,
                                    text: yaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }
                        }

                        Plotly.relayout(tester, layout)

                    }

                    myPlot.on('plotly_afterplot', function () {
                        Plotly.d3.selectAll(".yaxislayer-above").selectAll('text')
                            .on("click", function (d) {
                                 // console.log(d)
                                var labels = tester.data[0].y
                                var position = d.x
                                var text = d.text
                                var labeleditvalue = document.getElementById(id13).value;

                                var dict = {}
                                dict[text] = labeleditvalue
                                changed_text.push(dict)
                                labels[position] = labeleditvalue;
                                 // console.log(position)
                                 // console.log(labels)

                                var update = { "y": [labels] };

                                Plotly.restyle(tester, update)

                                $(`#${id6}`).attr("data-changed_text", JSON.stringify(changed_text))
                                 // console.log(changed_text)

                            });
                    });
                    document.getElementById(id18).onclick = function () {
                         // console.log(y_axisdata2)
                         // console.log(data)
                        var update = { "y": [JSON.parse(JSON.stringify(y_axisdata2))] }
                        Plotly.restyle(tester, update)

                    }
                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }
                             // console.log(graph_height)
                             // console.log(graph_width)

                            Plotly.relayout(tester, layout)
                        },
                    });
                }
                if (graph_subtype == 'Funnel_Area') {

                    var outermodalCard = $(`

<div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
right: 0 ;top : 10px;z-index: 1050">


  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
      <button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <label style="font-size:1.1rem">Change the graph color:</label>
  <input type="color" id=${id1} name="favcolor" value="#b8860b"><br><br><label style="font-size:1.1rem">Change the color or an element:</label>
  <input type="color" id=${id4} name="favcolor1" value="#b8860b">
  </div>
</div>
`)
                    if (data.plotDict === undefined) {

                        outerCard.appendTo('#card')
                        var tab_id = 'main_page'
                                    outermodalCard.appendTo('#card')
                        var colorlength = data.x_axisdata.length
                        var colordata = data.colordata;
                        var x_axis = data.x_axis
                        var y_axis = data.y_axis
                        var y_axisdata2 = JSON.parse(JSON.stringify(data.y_axisdata))

                        for (var i = 0; i < colorlength; i++) {
                            colordata.push('#b8860b');
                        }
                         // console.log(colordata)
                        var trace1 = {
                            text: data.x_axisdata,
                            values: data.y_axisdata,
                            type: 'funnelarea',
                            marker: {
                                colors: colordata,
                            },
                        };

                        var dataplot = [trace1]
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)

                        var layout = {
                            margin: { l: 0, r: 0, b: 20, t: 10, pad: 4 },
                            yaxis: {
                                title: {
                                    standoff: 20,
                                    text: y_axis, font: {
                                        family: "Arial"
                                    }
                                }, showgrid: false, font: {
                                    family: "Arial"
                                },
                                tickangle: 45,
                                automargin: true
                            },

                        }
                    }
                    else {
                         // console.log('load')
                        //  // console.log(append_tab)
                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tab_id = data.plotDict.tab_id
                                                // outerCardhidden.appendTo(`#${data.tab_id}`)
                        outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)
                        var dataplot = data.plotDict.data
                        dataplot[0].text = data.x_axisdata
                        dataplot[0].values = data.y_axisdata
                         // console.log(dataplot)
                        var layout = data.plotDict.layout

                        var width = width.split("p")
                        var height = height.split("p")

                        var graph_height = height[0] * 0.876
                        var graph_width = width[0] * 0.9481

                        layout["height"] = graph_height
                        layout["width"] = graph_width

                         // console.log(layout)
                        var colorlength = data.x_axis.length
                        var colordata = data.colordata
                    }
                    var config = { responsive: true, displaylogo: false }

                    Plotly.newPlot(tester, dataplot, layout, config)
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})
                     // console.log(tester.layout)


                    document.getElementById(id1).onchange = function () {
                         // console.log(colordata.length)
                        var colorlength = colordata.length
                         // console.log(colorlength)
                        var colorList = [];
                        var backRGB = this.value;
                        var backRGB = this.value;

                        colorList.push(backRGB)
                        for (i = 0; i < colorlength - 1; i++) {
                             // console.log("inside here")
                             // console.log(colorList[colorList.length - 1])
                            var previousHex = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(colorList[colorList.length - 1]);
                            var r = parseInt(previousHex[1], 16) * 0.8;
                            var g = parseInt(previousHex[2], 16) * 0.8;
                            var b = parseInt(previousHex[3], 16) * 0.8;
                            function componentToHex(c) {
                                var hex = c.toString(16);
                                return hex.length == 1 ? "0" + hex : hex;
                            }
                            var newHex = '#' + componentToHex(Math.round(r)) + componentToHex(Math.round(g)) + componentToHex(Math.round(b));
                            colorList.push(newHex)
                        }
                         // console.log(colorList)
                        var update = { 'marker': { colors: colorList } };
                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }

                    myPlot.on('plotly_click', function (data) {
                         // console.log(data.points[0])
                         // console.log(data.points[0].fullData.marker.colors)

                        var pn = '',
                            tn = '',
                            colors = [],
                            pn = data.points[0].pointNumber,
                            tn = data.points[0].curveNumber;
                         // console.log(pn)
                         // console.log(tn)

                        for (var i = 0; i < data.points.length; i++) {

                            colors = data.points[0].data.marker.colors;
                        };
                         // console.log(colors)

                        var color = document.getElementById(id4).value
                        colors[pn] = color;
                         // console.log(pn)
                         // console.log(tn)
                         // console.log(colors)
                        var update = { 'marker': { colors: colors } };
                        Plotly.restyle(tester, update, [tn])
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    });

                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id
                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };
                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };


                    // myPlot.on('plotly_afterplot', function () {
                    //     Plotly.d3.selectAll(".yaxislayer-above").selectAll('text')
                    //         .on("click", function (d) {
                    //              // console.log(d)
                    //             var labels = tester.data[0].y
                    //             var position = d.x
                    //             var labeleditvalue = document.getElementById(id13).value;

                    //             labels[position] = labeleditvalue;
                    //              // console.log(position)
                    //              // console.log(labels)

                    //             var update = { "y": [labels] };

                    //             Plotly.restyle(tester, update)

                    //         });
                    // });
                    // document.getElementById(id18).onclick = function () {
                    //      // console.log(y_axisdata2)
                    //      // console.log(data)
                    //     var update = { "y": [JSON.parse(JSON.stringify(y_axisdata2))] }
                    //     Plotly.restyle(tester, update)

                    // }
                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }
                             // console.log(graph_height)
                             // console.log(graph_width)

                            Plotly.relayout(tester, layout)
                            $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                        },
                    });
                }
                if (graph_subtype == 'Horizontal_Area_Stacked') {
                    var x_axis = data.x_axis
                    var y_axis = data.y_axis
                    var second_column = data.second_column

                    var outermodalCard = $(`

<div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
right: 0 ;top : 10px;z-index: 1050">


  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
      <button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <label style="font-size:1.1rem">Change the graph color:</label>
  <input type="color" id=${id1} name="favcolor" value="#b8860b"><br><br><label style="font-size:1.1rem">Change the color or an element:</label>
  <input type="color" id=${id4} name="favcolor1" value="#b8860b"><br><br>
  <label style="font-size:1.1rem">Change X and Y axis gridlines:</label>
      <button type="button" class="btn btn-primary" id="${id9}" data-toggle="button" role="tab"
                      aria-pressed="false" autocomplete="off" value="show_gridlines" style="line-height: 0.7;">Show Gridlines</button><br><br>
                      <label style="font-size:1.1rem">Change the range of the axis:</label>
  <input type="text" placeholder="Y Axis Start" id=${id2} size="7">
  <input type="text" placeholder="Y Axis End " id=${id3} size="7">
<br><br>
<label style="font-size:1.1rem">Change the title of the axes:</label>
    <input type="text" placeholder="Y Axis Title" id=${id12} size="7">
    <br><br>
    <label style="font-size:1.1rem">Change the legend labels:</label>
  <input type="text" placeholder=${x_axis} id=${id14} size="7">
  <input type="text" placeholder=${second_column} id=${id15} size="7">
  <br><br>
<label style="font-size:1.1rem">Change the label of an element:</label><br>
    <input type="text" placeholder="Y Axis Label" id=${id13} size="9"> &nbsp;&nbsp;
    <button type="button" class="btn btn-primary" id="${id18}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" style="line-height: 1.1;">Reset Axis Labels</button><br><br>
  </div>
</div>
`)
                    if (data.plotDict === undefined) {

                        outerCard.appendTo('#card')
                        var tab_id = 'main_page'
                        outermodalCard.appendTo('#card')
                        var colorlength = data.x_axisdata.length
                        var colordata = [];
                        var colordatasecond = [];
                        var y_axisdata2 = JSON.parse(JSON.stringify(data.y_axisdata))

                        for (var i = 0; i < colorlength; i++) {
                            colordata.push('#b8860b');
                        }
                        for (var i = 0; i < colorlength; i++) {
                            colordatasecond.push('goldenrod');
                        }
                        var trace1 = {
                            x: data.x_axisdata,
                            y: data.y_axisdata,
                            mode: 'lines',
                            marker: {
                                color: '#b8860b'
                            },
                            fill: 'tozeroy',
                            name: y_axis
                        };
                        var trace2 = {
                            x: data.second_columndata,
                            y: data.y_axisdata,
                            mode: 'lines',
                            marker: {
                                color: 'goldenrod'
                            },
                            fill: 'tonexty',
                            name: second_column
                        };
                        var dataplot = [trace1, trace2]
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)

                        var layout = {
                            legend: {
                                orientation: 'h'
                            },
                            barmode: 'stack',
                            hovermode: 'closest',

                            margin: { l: 0, r: 0, b: 20, t: 10, pad: 4 },
                            yaxis: {
                                title: {
                                    standoff: 20,
                                    text: y_axis, font: {
                                        family: "Arial"
                                    }
                                }, showgrid: false, font: {
                                    family: "Arial"
                                }, tickangle: 45,
                                automargin: true
                            },
                            xaxis: {
                                showgrid: false, automargin: true, font: {
                                    family: "Arial"
                                }
                            },
                        }
                    }
                    else {
                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tab_id = data.plotDict.tab_id
                                                outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)
                        var dataplot = data.plotDict.data
                        dataplot[0].x = data.x_axisdata
                        dataplot[0].y = data.y_axisdata

                        dataplot[1].x = data.second_columndata
                        dataplot[1].y = data.y_axisdata
                        var layout = data.plotDict.layout

                        var width = width.split("p")
                        var height = height.split("p")

                        var graph_height = height[0] * 0.876
                        var graph_width = width[0] * 0.9481

                        layout["height"] = graph_height
                        layout["width"] = graph_width

                         // console.log(layout)
                        var colorlength = data.x_axisdata.length

                    }
                    var config = { responsive: true, displaylogo: false }

                    Plotly.newPlot(tester, dataplot, layout, config)
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})
                    var x_axis_end = tester.layout.xaxis.range[1]
                    var x_axis_start = tester.layout.xaxis.range[0]

                     // console.log(tester.layout)


                    document.getElementById(id1).onchange = function () {
                         // console.log(colordata.length)
                        var colorlength = colordata.length
                         // console.log(colorlength)

                        var colordata2 = [];
                        var colordata3 = [];

                        var backRGB = this.value;

                        const hexToRgb = hex =>
                            hex.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i
                                , (m, r, g, b) => '#' + r + r + g + g + b + b)
                                .substring(1).match(/.{2}/g)
                                .map(x => parseInt(x, 16))
                        var r = hexToRgb(backRGB)[0] * 0.9
                        var g = hexToRgb(backRGB)[1] * 0.9
                        var b = hexToRgb(backRGB)[2] * 0.9

                        function rgb2hex(red, green, blue) {
                            var rgb = blue | (green << 8) | (red << 16);
                            return '#' + (0x1000000 + rgb).toString(16).slice(1)
                        }
                        var newcolor = rgb2hex(r, g, b)

                        for (var i = 0; i < colorlength; i++) {
                            colordata2.push(backRGB);
                        }
                        for (var i = 0; i < colorlength; i++) {
                            colordata3.push(newcolor);
                        }
                        var update = { 'marker': { color: backRGB } };
                        var update2 = { 'marker': { color: newcolor } };


                        Plotly.restyle(tester, update, [0])
                        Plotly.restyle(tester, update2, [1])
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }

                    document.getElementById(id2).onchange = function () {
                        var textbox2length = document.getElementById(id3).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var x_axis_end = tester.layout.xaxis.range[1]
                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(textbox2length)
                         // console.log(x_axis_end)

                        if (textbox2length == 0) {
                            var layout = {
                                xaxis: {
                                    range: [textbox1value, x_axis_end], showgrid: gridlines_value, automargin: true
                                }
                            }
                        }
                        else {
                            var layout = {
                                xaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id3).onchange = function () {
                        var textbox1length = document.getElementById(id2).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var x_axis_start = tester.layout.xaxis.range[0]
                        var gridlines_value = tester.layout.xaxis.showgrid
                         // console.log(gridlines_value)

                        if (textbox1length == 0) {
                            var layout = {
                                xaxis: {
                                    range: [x_axis_start, textbox2value], showgrid: gridlines_value, automargin: true
                                }
                            }
                        }
                        else {
                            var layout = {
                                xaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    myPlot.on('plotly_click', function (data) {
                         // console.log(data.points[0].x)
                         // console.log(data.points)

                        var pn = '',
                            tn = '',
                            colors = [];
                        for (var i = 0; i < data.points.length; i++) {
                            pn = data.points[i].pointNumber;
                            tn = data.points[i].curveNumber;
                            colors = data.points[i].data.marker.color;
                        };
                         // console.log(colors)

                        var color = document.getElementById(id4).value
                        colors[pn] = color;
                         // console.log(pn)
                         // console.log(tn)
                         // console.log(colors)
                        var update = { 'marker': { color: colors } };
                        Plotly.restyle(tester, update, [tn])
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    });

                    document.getElementById(id9).onclick = function () {
                        var gridlinesvalue = document.getElementById(id9).value
                         // console.log(gridlinesvalue)
                        var y_axis_title = tester.layout.yaxis.title.text

                        if (gridlinesvalue == "show_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    showgrid: true, automargin: true, tickangle: 45, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: true, automargin: true
                                }
                            };
                            document.getElementById(id9).value = "hide_gridlines"
                            document.getElementById(id9).innerHTML = "Hide Gridlines"
                        }
                        if (gridlinesvalue == "hide_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    showgrid: false, automargin: true, tickangle: 45, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: false, automargin: true
                                }
                            };
                            document.getElementById(id9).value = "show_gridlines"
                            document.getElementById(id9).innerHTML = "Show Gridlines"

                        }
                        Plotly.relayout(tester, layout2)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    };
                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id
                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };
                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };


                    document.getElementById(id12).onchange = function () {
                        var yaxistitlevalue = document.getElementById(id12).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var y_axis_end = tester.layout.yaxis.range[1]

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(yaxistitlevalue)
                         // console.log(tester.layout.yaxis.title)

                        var layout = {
                            yaxis: {
                                range: [y_axis_start, y_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20, tickangle: 45,
                                    text: yaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }
                        }

                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id14).onchange = function () {
                        var legendvalue1 = document.getElementById(id14).value;
                        var update = { name: legendvalue1 }

                        Plotly.restyle(tester, update, 0)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }
                    document.getElementById(id15).onchange = function () {
                        var legendvalue2 = document.getElementById(id15).value;
                        var update = { name: legendvalue2 }

                        Plotly.restyle(tester, update, 1)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }

                    myPlot.on('plotly_afterplot', function () {
                        Plotly.d3.selectAll(".yaxislayer-above").selectAll('text')
                            .on("click", function (d) {
                                 // console.log(d)
                                var labels = tester.data[0].y
                                var position = d.x
                                var text = d.text
                                var labeleditvalue = document.getElementById(id13).value;

                                var dict = {}
                                dict[text] = labeleditvalue
                                changed_text.push(dict)
                                labels[position] = labeleditvalue;
                                 // console.log(position)
                                 // console.log(labels)

                                var update = { "y": [labels] };

                                Plotly.restyle(tester, update)
                                $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                                $(`#${id6}`).attr("data-changed_text", JSON.stringify(changed_text))
                                 // console.log(changed_text)

                            });
                    });
                    document.getElementById(id18).onclick = function () {
                         // console.log(y_axisdata2)
                         // console.log(data)
                        var update = { "y": [JSON.parse(JSON.stringify(y_axisdata2))] }
                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }
                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }
                             // console.log(graph_height)
                             // console.log(graph_width)

                            Plotly.relayout(tester, layout)
                            $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                        },
                    });
                }
                if (graph_subtype == 'Horizontal_Bar_Stacked') {
                    var x_axis = data.x_axis
                    var y_axis = data.y_axis
                    var second_column = data.second_column

                    var outermodalCard = $(`

<div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
right: 0 ;top : 10px;z-index: 1050">


  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
      <button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <label style="font-size:1.1rem">Change the graph color:</label>
  <input type="color" id=${id1} name="favcolor" value="#b8860b"><br><br><label style="font-size:1.1rem">Change the color or an element:</label>
  <input type="color" id=${id4} name="favcolor1" value="#b8860b"><br><br>
  <label style="font-size:1.1rem">Change X and Y axis gridlines:</label>
      <button type="button" class="btn btn-primary" id="${id9}" data-toggle="button" role="tab"
                      aria-pressed="false" autocomplete="off" value="show_gridlines" style="line-height: 0.7;">Show Gridlines</button><br><br>
                      <label style="font-size:1.1rem">Change the range of the axis:</label>
  <input type="text" placeholder="Y Axis Start" id=${id2} size="7">
  <input type="text" placeholder="Y Axis End " id=${id3} size="7">
<br><br>
<label style="font-size:1.1rem">Change the title of the axes:</label>
    <input type="text" placeholder="Y Axis Title" id=${id12} size="7">
    <br><br>
    <label style="font-size:1.1rem">Change the legend labels:</label>
  <input type="text" placeholder=${x_axis} id=${id14} size="7">
  <input type="text" placeholder=${second_column} id=${id15} size="7">
  <br><br>
<label style="font-size:1.1rem">Change the label of an element:</label><br>
    <input type="text" placeholder="Y Axis Label" id=${id13} size="9"> &nbsp;&nbsp;
    <button type="button" class="btn btn-primary" id="${id18}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" style="line-height: 1.1;">Reset Axis Labels</button><br><br>
                        <label style="font-size:1.1rem">Change Plot Labels:</label>
        <button type="button" class="btn btn-primary" id="${id_labels}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" value="show_labels" style="line-height: 1.1;">Show Labels</button>
  </div>
</div>
`)
                    if (data.plotDict === undefined) {

                        outerCard.appendTo('#card')
                        var tab_id = 'main_page'
                        outermodalCard.appendTo('#card')
                        var colorlength = data.x_axisdata.length
                        var colordata = [];
                        var colordatasecond = [];
                        var y_axisdata2 = JSON.parse(JSON.stringify(data.y_axisdata))

                        for (var i = 0; i < colorlength; i++) {
                            colordata.push('#b8860b');
                        }
                        for (var i = 0; i < colorlength; i++) {
                            colordatasecond.push('goldenrod');
                        } var trace1 = {
                            x: data.x_axisdata,
                            y: data.y_axisdata,
                            type: 'bar',
                            marker: {
                                color: colordata,
                            },
                            orientation: 'h',
                            name: x_axis,

                        };
                        var trace2 = {
                            x: data.second_columndata,
                            y: data.y_axisdata,
                            type: 'bar',
                            marker: {
                                color: colordatasecond,
                            },
                            orientation: 'h',
                            name: second_column,

                        };
                        var dataplot = [trace1, trace2]
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)

                        var layout = {
                            legend: {
                                orientation: 'h'
                            },
                            barmode: 'stack',
                            hovermode: 'closest',

                            margin: { l: 0, r: 0, b: 20, t: 10, pad: 4 },
                            yaxis: {
                                title: {
                                    standoff: 20,
                                    text: y_axis, font: {
                                        family: "Arial"
                                    }
                                }, showgrid: false, font: {
                                    family: "Arial"
                                }, tickangle: 45,
                                automargin: true
                            },
                            xaxis: {
                                showgrid: false, automargin: true, font: {
                                    family: "Arial"
                                }
                            },
                        }
                    }
                    else {
                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tab_id = data.plotDict.tab_id
                                                outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)
                        var dataplot = data.plotDict.data
                        dataplot[0].x = data.x_axisdata
                        dataplot[0].y = data.y_axisdata

                        dataplot[1].x = data.second_columndata
                        dataplot[1].y = data.y_axisdata
                        delete dataplot[1]["selectedpoints"]
                        delete dataplot[0]["selectedpoints"]
                        var layout = data.plotDict.layout

                        var width = width.split("p")
                        var height = height.split("p")

                        var graph_height = height[0] * 0.876
                        var graph_width = width[0] * 0.9481

                        layout["height"] = graph_height
                        layout["width"] = graph_width

                         // console.log(layout)
                        var colorlength = data.x_axisdata.length

                    }
                    var config = { responsive: true, displaylogo: false }

                    Plotly.newPlot(tester, dataplot, layout, config)
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})
                    var x_axis_end = tester.layout.xaxis.range[1]
                    var x_axis_start = tester.layout.xaxis.range[0]

                     // console.log(tester.layout)


                    document.getElementById(id1).onchange = function () {
                         // console.log(colordata.length)
                        var colorlength = colordata.length
                         // console.log(colorlength)

                        var colordata2 = [];
                        var colordata3 = [];

                        var backRGB = this.value;

                        const hexToRgb = hex =>
                            hex.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i
                                , (m, r, g, b) => '#' + r + r + g + g + b + b)
                                .substring(1).match(/.{2}/g)
                                .map(x => parseInt(x, 16))
                        var r = hexToRgb(backRGB)[0] * 0.9
                        var g = hexToRgb(backRGB)[1] * 0.9
                        var b = hexToRgb(backRGB)[2] * 0.9

                        function rgb2hex(red, green, blue) {
                            var rgb = blue | (green << 8) | (red << 16);
                            return '#' + (0x1000000 + rgb).toString(16).slice(1)
                        }
                        var newcolor = rgb2hex(r, g, b)

                        for (var i = 0; i < colorlength; i++) {
                            colordata2.push(backRGB);
                        }
                        for (var i = 0; i < colorlength; i++) {
                            colordata3.push(newcolor);
                        }
                        var update = { 'marker': { color: colordata2 } };
                        var update2 = { 'marker': { color: colordata3 } };


                        Plotly.restyle(tester, update, [0])
                        Plotly.restyle(tester, update2, [1])
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }
                    document.getElementById(id_labels).onclick = function () {
                        var labelsvalue = document.getElementById(id_labels).value

                        if (labelsvalue == "show_labels") {
                            var x_axisdata = tester.data[0].x
                            var x_axisdata2 = tester.data[1].x
                             // console.log(x_axisdata)
                            x_axisdata = x_axisdata.map(function(each_element){
                                return Number(each_element.toFixed(2));
                            });
                            x_axisdata2 = x_axisdata2.map(function(each_element){
                                return Number(each_element.toFixed(2));
                            });
                             // console.log(x_axisdata)
                            var update = tester.data
                            update[0]['text'] = x_axisdata.map(String),
                            update[0]['textposition'] = 'inside'
                            update[0]['textangle'] = 90
                            update[1]['text'] = x_axisdata2.map(String),
                            update[1]['textposition'] = 'inside'
                            update[1]['textangle'] = 90

                            document.getElementById(id_labels).value = "hide_labels"
                            document.getElementById(id_labels).innerHTML = "Hide Labels"
                        }
                        if (labelsvalue == "hide_labels") {
                            var update = tester.data
                             // console.log(update)
                            delete update[0]["text"]
                            delete update[0]["textposition"]
                            delete update[1]["text"]
                            delete update[1]["textposition"]
                            document.getElementById(id_labels).value = "show_labels"
                            document.getElementById(id_labels).innerHTML = "Show Labels"
                        }
                         // console.log(update)
                        Plotly.redraw(tester, update)
                         // console.log(tester.data)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))
                    };

                    document.getElementById(id_labels).onclick = function () {
                        var labelsvalue = document.getElementById(id_labels).value

                        if (labelsvalue == "show_labels") {
                            var x_axisdata = tester.data[0].x
                            var x_axisdata2 = tester.data[1].x
                             // console.log(x_axisdata)
                            x_axisdata = x_axisdata.map(function(each_element){
                                return Number(each_element.toFixed(2));
                            });
                            x_axisdata2 = x_axisdata2.map(function(each_element){
                                return Number(each_element.toFixed(2));
                            });
                             // console.log(x_axisdata)
                            var update = tester.data
                            update[0]['text'] = x_axisdata.map(String),
                            update[0]['textposition'] = 'outside'
                            update[0]['textangle'] = 90
                            update[1]['text'] = x_axisdata2.map(String),
                            update[1]['textposition'] = 'outside'
                            update[1]['textangle'] = 90

                            document.getElementById(id_labels).value = "hide_labels"
                            document.getElementById(id_labels).innerHTML = "Hide Labels"
                        }
                        if (labelsvalue == "hide_labels") {
                            var update = tester.data
                             // console.log(update)
                            delete update[0]["text"]
                            delete update[0]["textposition"]
                            delete update[1]["text"]
                            delete update[1]["textposition"]
                            document.getElementById(id_labels).value = "show_labels"
                            document.getElementById(id_labels).innerHTML = "Show Labels"
                        }
                         // console.log(update)
                        Plotly.redraw(tester, update)
                         // console.log(tester.data)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))
                    };
                    document.getElementById(id2).onchange = function () {
                        var textbox2length = document.getElementById(id3).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var x_axis_end = tester.layout.xaxis.range[1]
                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(textbox2length)
                         // console.log(x_axis_end)

                        if (textbox2length == 0) {
                            var layout = {
                                xaxis: {
                                    range: [textbox1value, x_axis_end], showgrid: gridlines_value, automargin: true
                                }
                            }
                        }
                        else {
                            var layout = {
                                xaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id3).onchange = function () {
                        var textbox1length = document.getElementById(id2).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var x_axis_start = tester.layout.xaxis.range[0]
                        var gridlines_value = tester.layout.xaxis.showgrid
                         // console.log(gridlines_value)

                        if (textbox1length == 0) {
                            var layout = {
                                xaxis: {
                                    range: [x_axis_start, textbox2value], showgrid: gridlines_value, automargin: true
                                }
                            }
                        }
                        else {
                            var layout = {
                                xaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    myPlot.on('plotly_click', function (data) {
                         // console.log(data.points[0].x)
                         // console.log(data.points)

                        var pn = '',
                            tn = '',
                            colors = [];
                        for (var i = 0; i < data.points.length; i++) {
                            pn = data.points[i].pointNumber;
                            tn = data.points[i].curveNumber;
                            colors = data.points[i].data.marker.color;
                        };
                         // console.log(colors)

                        var color = document.getElementById(id4).value
                        colors[pn] = color;
                         // console.log(pn)
                         // console.log(tn)
                         // console.log(colors)
                        var update = { 'marker': { color: colors } };
                        Plotly.restyle(tester, update, [tn])
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    });

                    document.getElementById(id9).onclick = function () {
                        var gridlinesvalue = document.getElementById(id9).value
                         // console.log(gridlinesvalue)
                        var y_axis_title = tester.layout.yaxis.title.text

                        if (gridlinesvalue == "show_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    showgrid: true, automargin: true, tickangle: 45, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: true, automargin: true
                                }
                            };
                            document.getElementById(id9).value = "hide_gridlines"
                            document.getElementById(id9).innerHTML = "Hide Gridlines"
                        }
                        if (gridlinesvalue == "hide_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    showgrid: false, automargin: true, tickangle: 45, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: false, automargin: true
                                }
                            };
                            document.getElementById(id9).value = "show_gridlines"
                            document.getElementById(id9).innerHTML = "Show Gridlines"

                        }
                        Plotly.relayout(tester, layout2)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    };
                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id
                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };
                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };


                    document.getElementById(id12).onchange = function () {
                        var yaxistitlevalue = document.getElementById(id12).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var y_axis_end = tester.layout.yaxis.range[1]

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(yaxistitlevalue)
                         // console.log(tester.layout.yaxis.title)

                        var layout = {
                            yaxis: {
                                range: [y_axis_start, y_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20, tickangle: 45,
                                    text: yaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }
                        }

                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id14).onchange = function () {
                        var legendvalue1 = document.getElementById(id14).value;
                        var update = { name: legendvalue1 }

                        Plotly.restyle(tester, update, 0)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }
                    document.getElementById(id15).onchange = function () {
                        var legendvalue2 = document.getElementById(id15).value;
                        var update = { name: legendvalue2 }

                        Plotly.restyle(tester, update, 1)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }

                    myPlot.on('plotly_afterplot', function () {
                        Plotly.d3.selectAll(".yaxislayer-above").selectAll('text')
                            .on("click", function (d) {
                                 // console.log(d)
                                var labels = tester.data[0].y
                                var position = d.x
                                var text = d.text
                                var labeleditvalue = document.getElementById(id13).value;

                                var dict = {}
                                dict[text] = labeleditvalue
                                changed_text.push(dict)
                                labels[position] = labeleditvalue;
                                 // console.log(position)
                                 // console.log(labels)

                                var update = { "y": [labels] };

                                Plotly.restyle(tester, update)
                                $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                                $(`#${id6}`).attr("data-changed_text", JSON.stringify(changed_text))
                                 // console.log(changed_text)

                            });
                    });
                    document.getElementById(id18).onclick = function () {
                         // console.log(y_axisdata2)
                         // console.log(data)
                        var update = { "y": [JSON.parse(JSON.stringify(y_axisdata2))] }
                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }
                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }
                             // console.log(graph_height)
                             // console.log(graph_width)

                            Plotly.relayout(tester, layout)
                            $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                        },
                    });
                    myPlot.on('plotly_selected', function(data){
                        try {
                        points_array = data.points

                         // console.log(points_array)

                        var points = []
                        for(let i = 0; i < points_array.length; i++){
                            points.push(points_array[i].label)
                            }
                         // console.log(points)
                        var unique = points.filter((v, i, a) => a.indexOf(v) === i);
                         // console.log(unique)
                        var crossfilterdict = { 'points':unique,'id':chartDivId}
                        crossfilter_function(crossfilterdict)
                        }
                        catch(err){
                                ;
                        }
                        })
                    myPlot.on('plotly_deselect', function(){
                        //  // console.log('hi')
                        // var CLICK_TIME = Date.now()

                        // if(CLICK_TIME - LAST_CLICK < 10000) {
                        var resetdict = {'id':chartDivId}
                        reset_function(resetdict)
                        // } else {
                        //     LAST_CLICK = CLICK_TIME
                        //      // console.log('single click')
                        // }


                    })
                }
                if (graph_subtype == 'Horizontal_Grouped_Box') {
                    var x_axis = data.x_axis
                    var y_axis = data.y_axis
                    var second_column = data.second_column

                    var outermodalCard = $(`

<div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
right: 0 ;top : 10px;z-index: 1050">


  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
      <button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <label style="font-size:1.1rem">Change the graph color:</label>
  <input type="color" id=${id1} name="favcolor" value="#b8860b"><br><br><label style="font-size:1.1rem">Change the color or an element:</label>
  <input type="color" id=${id4} name="favcolor1" value="#b8860b"><br><br>
  <label style="font-size:1.1rem">Change X and Y axis gridlines:</label>
      <button type="button" class="btn btn-primary" id="${id9}" data-toggle="button" role="tab"
                      aria-pressed="false" autocomplete="off" value="show_gridlines" style="line-height: 0.7;">Show Gridlines</button><br><br>
                      <label style="font-size:1.1rem">Change the range of the axis:</label>
  <input type="text" placeholder="Y Axis Start" id=${id2} size="7">
  <input type="text" placeholder="Y Axis End " id=${id3} size="7">
<br><br>
<label style="font-size:1.1rem">Change the title of the axes:</label>
    <input type="text" placeholder="Y Axis Title" id=${id12} size="7">
    <br><br>
    <label style="font-size:1.1rem">Change the legend labels:</label>
  <input type="text" placeholder=${x_axis} id=${id14} size="7">
  <input type="text" placeholder=${second_column} id=${id15} size="7">
  <br><br>
<label style="font-size:1.1rem">Change the label of an element:</label><br>
    <input type="text" placeholder="Y Axis Label" id=${id13} size="9"> &nbsp;&nbsp;
    <button type="button" class="btn btn-primary" id="${id18}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" style="line-height: 1.1;">Reset Axis Labels</button><br><br>
  </div>
</div>
`)
                    if (data.plotDict === undefined) {

                        outerCard.appendTo('#card')
                        var tab_id = 'main_page'
                        outermodalCard.appendTo('#card')
                        var colorlength = data.x_axisdata.length
                        var colordata = [];
                        var colordatasecond = [];
                        var y_axisdata2 = JSON.parse(JSON.stringify(data.y_axisdata))

                        for (var i = 0; i < colorlength; i++) {
                            colordata.push('#b8860b');
                        }
                        for (var i = 0; i < colorlength; i++) {
                            colordatasecond.push('goldenrod');
                        }
                        var trace1 = {
                            x: data.x_axisdata,
                            y: data.y_axisdata,
                            type: 'box',
                            boxpoints: false,
                            marker: {
                                color: '#b8860b'
                            },
                            orientation: 'h',
                            name: x_axis
                        };
                        var trace2 = {
                            x: data.second_columndata,
                            y: data.y_axisdata,
                            type: 'box',
                            boxpoints: false,
                            marker: {
                                color: 'goldenrod'
                            },
                            orientation: 'h',
                            name: second_column
                        };
                        var dataplot = [trace1, trace2]
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)

                        var layout = {
                            legend: {
                                orientation: 'h'
                            },
                            boxmode: 'group',
                            hovermode: 'closest',

                            margin: { l: 0, r: 0, b: 20, t: 10, pad: 4 },
                            yaxis: {
                                title: {
                                    standoff: 20,
                                    text: y_axis, font: {
                                        family: "Arial"
                                    }
                                }, showgrid: false, font: {
                                    family: "Arial"
                                }, tickangle: 45,
                                automargin: true
                            },
                            xaxis: {
                                showgrid: false, automargin: true, font: {
                                    family: "Arial"
                                }
                            },
                        }
                    }
                    else {
                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tab_id = data.plotDict.tab_id
                                                outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)
                        var dataplot = data.plotDict.data
                        dataplot[0].x = data.x_axisdata
                        dataplot[0].y = data.y_axisdata

                        dataplot[1].x = data.second_columndata
                        dataplot[1].y = data.y_axisdata

                        var layout = data.plotDict.layout

                        var width = width.split("p")
                        var height = height.split("p")

                        var graph_height = height[0] * 0.876
                        var graph_width = width[0] * 0.9481

                        layout["height"] = graph_height
                        layout["width"] = graph_width

                         // console.log(layout)
                        var colorlength = data.x_axisdata.length

                    }
                    var config = { responsive: true, displaylogo: false }

                    Plotly.newPlot(tester, dataplot, layout, config)
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})
                    var x_axis_end = tester.layout.xaxis.range[1]
                    var x_axis_start = tester.layout.xaxis.range[0]

                     // console.log(tester.layout)


                    document.getElementById(id1).onchange = function () {
                        var colorlength = data.x_axisdata.length

                        var colordata2 = [];
                        var colordata3 = [];

                        var backRGB = this.value;

                        const hexToRgb = hex =>
                            hex.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i
                                , (m, r, g, b) => '#' + r + r + g + g + b + b)
                                .substring(1).match(/.{2}/g)
                                .map(x => parseInt(x, 16))
                        var r = hexToRgb(backRGB)[0] * 0.8
                        var g = hexToRgb(backRGB)[1] * 0.8
                        var b = hexToRgb(backRGB)[2] * 0.8

                        function rgb2hex(red, green, blue) {
                            var rgb = blue | (green << 8) | (red << 16);
                            return '#' + (0x1000000 + rgb).toString(16).slice(1)
                        }
                        var newcolor = rgb2hex(r, g, b)
                        var update = { 'marker': { color: backRGB } };
                        var update2 = { 'marker': { color: newcolor } };


                        Plotly.restyle(tester, update, [0])
                        Plotly.restyle(tester, update2, [1])
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }

                    document.getElementById(id2).onchange = function () {
                        var textbox2length = document.getElementById(id3).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var x_axis_end = tester.layout.xaxis.range[1]
                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(textbox2length)
                         // console.log(x_axis_end)

                        if (textbox2length == 0) {
                            var layout = {
                                xaxis: {
                                    range: [textbox1value, x_axis_end], showgrid: gridlines_value, automargin: true
                                }
                            }
                        }
                        else {
                            var layout = {
                                xaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id3).onchange = function () {
                        var textbox1length = document.getElementById(id2).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var x_axis_start = tester.layout.xaxis.range[0]
                        var gridlines_value = tester.layout.xaxis.showgrid
                         // console.log(gridlines_value)

                        if (textbox1length == 0) {
                            var layout = {
                                xaxis: {
                                    range: [x_axis_start, textbox2value], showgrid: gridlines_value, automargin: true
                                }
                            }
                        }
                        else {
                            var layout = {
                                xaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    myPlot.on('plotly_click', function (data) {
                         // console.log(data.points[0].x)
                         // console.log(data.points)

                        var pn = '',
                            tn = '',
                            colors = [];
                        for (var i = 0; i < data.points.length; i++) {
                            pn = data.points[i].pointNumber;
                            tn = data.points[i].curveNumber;
                            colors = data.points[i].data.marker.color;
                        };
                         // console.log(colors)

                        var color = document.getElementById(id4).value
                        colors[pn] = color;
                         // console.log(pn)
                         // console.log(tn)
                         // console.log(colors)
                        var update = { 'marker': { color: colors } };
                        Plotly.restyle(tester, update, [tn])
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    });

                    document.getElementById(id9).onclick = function () {
                        var gridlinesvalue = document.getElementById(id9).value
                         // console.log(gridlinesvalue)
                        var y_axis_title = tester.layout.yaxis.title.text

                        if (gridlinesvalue == "show_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    showgrid: true, automargin: true, tickangle: 45, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: true, automargin: true
                                }
                            };
                            document.getElementById(id9).value = "hide_gridlines"
                            document.getElementById(id9).innerHTML = "Hide Gridlines"
                        }
                        if (gridlinesvalue == "hide_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    showgrid: false, automargin: true, tickangle: 45, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: false, automargin: true
                                }
                            };
                            document.getElementById(id9).value = "show_gridlines"
                            document.getElementById(id9).innerHTML = "Show Gridlines"

                        }
                        Plotly.relayout(tester, layout2)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    };
                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id
                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };
                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };


                    document.getElementById(id12).onchange = function () {
                        var yaxistitlevalue = document.getElementById(id12).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var y_axis_end = tester.layout.yaxis.range[1]

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(yaxistitlevalue)
                         // console.log(tester.layout.yaxis.title)

                        var layout = {
                            yaxis: {
                                range: [y_axis_start, y_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20, tickangle: 45,
                                    text: yaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }
                        }

                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id14).onchange = function () {
                        var legendvalue1 = document.getElementById(id14).value;
                        var update = { name: legendvalue1 }

                        Plotly.restyle(tester, update, 0)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }
                    document.getElementById(id15).onchange = function () {
                        var legendvalue2 = document.getElementById(id15).value;
                        var update = { name: legendvalue2 }

                        Plotly.restyle(tester, update, 1)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }

                    myPlot.on('plotly_afterplot', function () {
                        Plotly.d3.selectAll(".yaxislayer-above").selectAll('text')
                            .on("click", function (d) {
                                 // console.log(d)
                                var labels = tester.data[0].y
                                var position = d.x
                                var text = d.text
                                var labeleditvalue = document.getElementById(id13).value;

                                var dict = {}
                                dict[text] = labeleditvalue
                                changed_text.push(dict)
                                $.each(labels, function (k, v) {
                                    if (v == text) {
                                        labels[k] = labeleditvalue;
                                    }
                                });
                                 // console.log(position)
                                 // console.log(labels)

                                var update = { "y": [labels] };

                                Plotly.restyle(tester, update)
                                $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                                $(`#${id6}`).attr("data-changed_text", JSON.stringify(changed_text))
                                 // console.log(changed_text)

                            });
                    });
                    document.getElementById(id18).onclick = function () {
                         // console.log(y_axisdata2)
                         // console.log(data)
                        var update = { "y": [JSON.parse(JSON.stringify(y_axisdata2))] }
                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }
                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }
                             // console.log(graph_height)
                             // console.log(graph_width)

                            Plotly.relayout(tester, layout)
                            $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                        },
                    });
                }
                if (graph_subtype == 'Horizontal_Grouped_Violin') {
                    var x_axis = data.x_axis
                    var y_axis = data.y_axis
                    var second_column = data.second_column

                    var outermodalCard = $(`

<div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
right: 0 ;top : 10px;z-index: 1050">


  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
      <button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <label style="font-size:1.1rem">Change the graph color:</label>
  <input type="color" id=${id1} name="favcolor" value="#b8860b"><br><br><label style="font-size:1.1rem">Change the color or an element:</label>
  <input type="color" id=${id4} name="favcolor1" value="#b8860b"><br><br>
  <label style="font-size:1.1rem">Change X and Y axis gridlines:</label>
      <button type="button" class="btn btn-primary" id="${id9}" data-toggle="button" role="tab"
                      aria-pressed="false" autocomplete="off" value="show_gridlines" style="line-height: 0.7;">Show Gridlines</button><br><br>
                      <label style="font-size:1.1rem">Change the range of the axis:</label>
  <input type="text" placeholder="Y Axis Start" id=${id2} size="7">
  <input type="text" placeholder="Y Axis End " id=${id3} size="7">
<br><br>
<label style="font-size:1.1rem">Change the title of the axes:</label>
    <input type="text" placeholder="Y Axis Title" id=${id12} size="7">
    <br><br>
    <label style="font-size:1.1rem">Change the legend labels:</label>
  <input type="text" placeholder=${x_axis} id=${id14} size="7">
  <input type="text" placeholder=${second_column} id=${id15} size="7">
  <br><br>
<label style="font-size:1.1rem">Change the label of an element:</label><br>
    <input type="text" placeholder="Y Axis Label" id=${id13} size="9"> &nbsp;&nbsp;
    <button type="button" class="btn btn-primary" id="${id18}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" style="line-height: 1.1;">Reset Axis Labels</button><br><br>
  </div>
</div>
`)
                    if (data.plotDict === undefined) {

                        outerCard.appendTo('#card')
                        var tab_id = 'main_page'
                        outermodalCard.appendTo('#card')
                        var colorlength = data.x_axisdata.length
                        var colordata = [];
                        var colordatasecond = [];
                        var y_axisdata2 = JSON.parse(JSON.stringify(data.y_axisdata))

                        for (var i = 0; i < colorlength; i++) {
                            colordata.push('#b8860b');
                        }
                        for (var i = 0; i < colorlength; i++) {
                            colordatasecond.push('goldenrod');
                        }
                        var trace1 = {
                            x: data.x_axisdata,
                            y: data.y_axisdata,
                            type: 'violin',
                            boxpoints: false,
                            marker: {
                                color: '#b8860b'
                            },
                            orientation: 'h',
                            name: x_axis
                        };
                        var trace2 = {
                            x: data.second_columndata,
                            y: data.y_axisdata,
                            type: 'violin',
                            boxpoints: false,
                            marker: {
                                color: 'goldenrod'
                            },
                            orientation: 'h',
                            name: second_column
                        };
                        var dataplot = [trace1, trace2]
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)

                        var layout = {
                            violinmode: 'group',
                            legend: {
                                orientation: 'h'
                            },
                            boxmode: 'group',
                            hovermode: 'closest',

                            margin: { l: 0, r: 0, b: 20, t: 10, pad: 4 },
                            yaxis: {
                                title: {
                                    standoff: 20,
                                    text: y_axis, font: {
                                        family: "Arial"
                                    }
                                }, showgrid: false, font: {
                                    family: "Arial"
                                }, tickangle: 45,
                                automargin: true
                            },
                            xaxis: {
                                showgrid: false, automargin: true, font: {
                                    family: "Arial"
                                }
                            },
                        }
                    }
                    else {
                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tab_id = data.plotDict.tab_id
                                                outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)
                        var dataplot = data.plotDict.data
                        dataplot[0].x = data.x_axisdata
                        dataplot[0].y = data.y_axisdata

                        dataplot[1].x = data.second_columndata
                        dataplot[1].y = data.y_axisdata

                        var layout = data.plotDict.layout

                        var width = width.split("p")
                        var height = height.split("p")

                        var graph_height = height[0] * 0.876
                        var graph_width = width[0] * 0.9481

                        layout["height"] = graph_height
                        layout["width"] = graph_width

                         // console.log(layout)
                        var colorlength = data.x_axisdata.length

                    }
                    var config = { responsive: true, displaylogo: false }

                    Plotly.newPlot(tester, dataplot, layout, config)
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})
                    var x_axis_end = tester.layout.xaxis.range[1]
                    var x_axis_start = tester.layout.xaxis.range[0]

                     // console.log(tester.layout)


                    document.getElementById(id1).onchange = function () {
                        var colorlength = data.x_axisdata.length

                        var colordata2 = [];
                        var colordata3 = [];

                        var backRGB = this.value;

                        const hexToRgb = hex =>
                            hex.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i
                                , (m, r, g, b) => '#' + r + r + g + g + b + b)
                                .substring(1).match(/.{2}/g)
                                .map(x => parseInt(x, 16))
                        var r = hexToRgb(backRGB)[0] * 0.8
                        var g = hexToRgb(backRGB)[1] * 0.8
                        var b = hexToRgb(backRGB)[2] * 0.8

                        function rgb2hex(red, green, blue) {
                            var rgb = blue | (green << 8) | (red << 16);
                            return '#' + (0x1000000 + rgb).toString(16).slice(1)
                        }
                        var newcolor = rgb2hex(r, g, b)
                        var update = { 'marker': { color: backRGB } };
                        var update2 = { 'marker': { color: newcolor } };


                        Plotly.restyle(tester, update, [0])
                        Plotly.restyle(tester, update2, [1])
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }

                    document.getElementById(id2).onchange = function () {
                        var textbox2length = document.getElementById(id3).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var x_axis_end = tester.layout.xaxis.range[1]
                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(textbox2length)
                         // console.log(x_axis_end)

                        if (textbox2length == 0) {
                            var layout = {
                                xaxis: {
                                    range: [textbox1value, x_axis_end], showgrid: gridlines_value, automargin: true
                                }
                            }
                        }
                        else {
                            var layout = {
                                xaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id3).onchange = function () {
                        var textbox1length = document.getElementById(id2).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var x_axis_start = tester.layout.xaxis.range[0]
                        var gridlines_value = tester.layout.xaxis.showgrid
                         // console.log(gridlines_value)

                        if (textbox1length == 0) {
                            var layout = {
                                xaxis: {
                                    range: [x_axis_start, textbox2value], showgrid: gridlines_value, automargin: true
                                }
                            }
                        }
                        else {
                            var layout = {
                                xaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    myPlot.on('plotly_click', function (data) {
                         // console.log(data.points[0].x)
                         // console.log(data.points)

                        var pn = '',
                            tn = '',
                            colors = [];
                        for (var i = 0; i < data.points.length; i++) {
                            pn = data.points[i].pointNumber;
                            tn = data.points[i].curveNumber;
                            colors = data.points[i].data.marker.color;
                        };
                         // console.log(colors)

                        var color = document.getElementById(id4).value
                        colors[pn] = color;
                         // console.log(pn)
                         // console.log(tn)
                         // console.log(colors)
                        var update = { 'marker': { color: colors } };
                        Plotly.restyle(tester, update, [tn])
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    });

                    document.getElementById(id9).onclick = function () {
                        var gridlinesvalue = document.getElementById(id9).value
                         // console.log(gridlinesvalue)
                        var y_axis_title = tester.layout.yaxis.title.text

                        if (gridlinesvalue == "show_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    showgrid: true, automargin: true, tickangle: 45, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: true, automargin: true
                                }
                            };
                            document.getElementById(id9).value = "hide_gridlines"
                            document.getElementById(id9).innerHTML = "Hide Gridlines"
                        }
                        if (gridlinesvalue == "hide_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    showgrid: false, automargin: true, tickangle: 45, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: false, automargin: true
                                }
                            };
                            document.getElementById(id9).value = "show_gridlines"
                            document.getElementById(id9).innerHTML = "Show Gridlines"

                        }
                        Plotly.relayout(tester, layout2)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    };
                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id
                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };
                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };


                    document.getElementById(id12).onchange = function () {
                        var yaxistitlevalue = document.getElementById(id12).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var y_axis_end = tester.layout.yaxis.range[1]

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(yaxistitlevalue)
                         // console.log(tester.layout.yaxis.title)

                        var layout = {
                            yaxis: {
                                range: [y_axis_start, y_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20, tickangle: 45,
                                    text: yaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }
                        }

                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id14).onchange = function () {
                        var legendvalue1 = document.getElementById(id14).value;
                        var update = { name: legendvalue1 }

                        Plotly.restyle(tester, update, 0)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }
                    document.getElementById(id15).onchange = function () {
                        var legendvalue2 = document.getElementById(id15).value;
                        var update = { name: legendvalue2 }

                        Plotly.restyle(tester, update, 1)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }

                    myPlot.on('plotly_afterplot', function () {
                        Plotly.d3.selectAll(".yaxislayer-above").selectAll('text')
                            .on("click", function (d) {
                                 // console.log(d)
                                var labels = tester.data[0].y
                                var position = d.x
                                var text = d.text
                                var labeleditvalue = document.getElementById(id13).value;

                                var dict = {}
                                dict[text] = labeleditvalue
                                changed_text.push(dict)
                                $.each(labels, function (k, v) {
                                    if (v == text) {
                                        labels[k] = labeleditvalue;
                                    }
                                });
                                 // console.log(position)
                                 // console.log(labels)

                                var update = { "y": [labels] };

                                Plotly.restyle(tester, update)
                                $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                                $(`#${id6}`).attr("data-changed_text", JSON.stringify(changed_text))
                                 // console.log(changed_text)

                            });
                    });
                    document.getElementById(id18).onclick = function () {
                         // console.log(y_axisdata2)
                         // console.log(data)
                        var update = { "y": [JSON.parse(JSON.stringify(y_axisdata2))] }
                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }
                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }
                             // console.log(graph_height)
                             // console.log(graph_width)

                            Plotly.relayout(tester, layout)
                            $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                        },
                    });
                }
                if (graph_subtype == 'Horizontal_Waterfall_Grouped') {
                    var x_axis = data.x_axis
                    var y_axis = data.y_axis
                    var second_column = data.second_column

                    var outermodalCard = $(`

<div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
right: 0 ;top : 10px;z-index: 1050">


  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
      <button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
  <label style="font-size:1.1rem">Change X and Y axis gridlines:</label>
      <button type="button" class="btn btn-primary" id="${id9}" data-toggle="button" role="tab"
                      aria-pressed="false" autocomplete="off" value="show_gridlines" style="line-height: 0.7;">Show Gridlines</button><br><br>
                      <label style="font-size:1.1rem">Change the range of the axis:</label>
  <input type="text" placeholder="Y Axis Start" id=${id2} size="7">
  <input type="text" placeholder="Y Axis End " id=${id3} size="7">
<br><br>
<label style="font-size:1.1rem">Change the title of the axes:</label>
    <input type="text" placeholder="Y Axis Title" id=${id12} size="7">
    <br><br>
    <label style="font-size:1.1rem">Change the legend labels:</label>
  <input type="text" placeholder=${x_axis} id=${id14} size="7">
  <input type="text" placeholder=${second_column} id=${id15} size="7">
  <br><br>
<label style="font-size:1.1rem">Change the label of an element:</label><br>
    <input type="text" placeholder="Y Axis Label" id=${id13} size="9"> &nbsp;&nbsp;
    <button type="button" class="btn btn-primary" id="${id18}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" style="line-height: 1.1;">Reset Axis Labels</button><br><br>
                        <label style="font-size:1.1rem">Change Plot Labels:</label>
        <button type="button" class="btn btn-primary" id="${id_labels}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" value="show_labels" style="line-height: 1.1;">Show Labels</button>
  </div>
</div>
`)
                    if (data.plotDict === undefined) {

                        outerCard.appendTo('#card')
                        var tab_id = 'main_page'
                        outermodalCard.appendTo('#card')
                        var colorlength = data.x_axisdata.length
                        var colordata = [];
                        var colordatasecond = [];

                        var measure = [];

                        var x_axis = data.x_axis
                        var y_axis = data.y_axis
                        var x_axisdata = data.x_axisdata
                        var y_axisdata = data.y_axisdata
                        var x_axisdata2 = data.second_columndata
                        var y_axisdata2 = JSON.parse(JSON.stringify(data.y_axisdata))
                        y_axisdata2.push('Total')

                        y_axisdata.push('Total')
                        x_axisdata.push(0)
                        x_axisdata2.push(0)

                        for (var i = 0; i < colorlength; i++) {
                            colordata.push('#b8860b');
                        }
                        for (var i = 0; i < colorlength; i++) {
                            colordatasecond.push('goldenrod');
                        }
                        for (var i = 0; i < colorlength; i++) {
                            measure.push('relative');
                        }
                        measure.push('total')

                         // console.log(data.second_column)
                        var trace1 = {
                            x: x_axisdata,
                            y: y_axisdata,
                            type: "waterfall",
                            orientation: "h",
                            measure: measure,
                            marker: {
                                color: colordata
                            },
                            name: x_axis
                        };
                        var trace2 = {
                            x: x_axisdata2,
                            y: y_axisdata,
                            type: "waterfall",
                            orientation: "h",
                            measure: measure,
                            marker: {
                                color: colordatasecond
                            },
                            name: data.second_column
                        };
                        var dataplot = [trace1, trace2]
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)

                        var layout = {
                            legend: {
                                orientation: 'h'
                            },
                            hovermode: 'closest',
                            margin: { l: 0, r: 0, b: 20, t: 10, pad: 4 },
                            yaxis: {
                                title: {
                                    standoff: 20,
                                    text: y_axis, font: {
                                        family: "Arial"
                                    }
                                }, showgrid: false, font: {
                                    family: "Arial"
                                }, tickangle: 45,
                                automargin: true
                            },
                            xaxis: {
                                showgrid: false, automargin: true, font: {
                                    family: "Arial"
                                }
                            },
                        }
                    }
                    else {
                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tab_id = data.plotDict.tab_id
                                                outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)
                        var dataplot = data.plotDict.data
                        var x_axisdata = data.x_axisdata
                        var measure = []
                        var y_axisdata = data.y_axisdata
                        var x_axisdata2 = data.second_columndata
                        var y_axisdata2 = JSON.parse(JSON.stringify(data.y_axisdata))
                        y_axisdata2.push('Total')

                        y_axisdata.push('Total')
                        x_axisdata.push(0)
                        x_axisdata2.push(0)

                        for (var i = 0; i < colorlength; i++) {
                            colordata.push('#b8860b');
                        }
                        for (var i = 0; i < colorlength; i++) {
                            colordatasecond.push('goldenrod');
                        }
                        for (var i = 0; i < colorlength; i++) {
                            measure.push('relative');
                        }
                        measure.push('total')

                        dataplot[0].x = x_axisdata
                        dataplot[0].y = y_axisdata
                        dataplot[1].x = x_axisdata2
                        dataplot[1].y = y_axisdata
                        dataplot[0].measure = measure
                        dataplot[1].measure = measure
                        var layout = data.plotDict.layout

                        var width = width.split("p")
                        var height = height.split("p")

                        var graph_height = height[0] * 0.876
                        var graph_width = width[0] * 0.9481

                        layout["height"] = graph_height
                        layout["width"] = graph_width

                         // console.log(layout)
                        var colorlength = data.x_axisdata.length

                    }
                    var config = { responsive: true, displaylogo: false }

                    Plotly.newPlot(tester, dataplot, layout, config)
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})
                    var x_axis_end = tester.layout.xaxis.range[1]
                    var x_axis_start = tester.layout.xaxis.range[0]

                     // console.log(tester.layout)

                    document.getElementById(id2).onchange = function () {
                        var textbox2length = document.getElementById(id3).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var x_axis_end = tester.layout.xaxis.range[1]
                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(textbox2length)
                         // console.log(x_axis_end)

                        if (textbox2length == 0) {
                            var layout = {
                                xaxis: {
                                    range: [textbox1value, x_axis_end], showgrid: gridlines_value, automargin: true
                                }
                            }
                        }
                        else {
                            var layout = {
                                xaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id_labels).onclick = function () {
                        var labelsvalue = document.getElementById(id_labels).value

                        if (labelsvalue == "show_labels") {
                            var x_axisdata = tester.data[0].x
                            var x_axisdata2 = tester.data[1].x
                             // console.log(x_axisdata)
                            x_axisdata = x_axisdata.map(function(each_element){
                                return Number(each_element.toFixed(2));
                            });
                            x_axisdata2 = x_axisdata2.map(function(each_element){
                                return Number(each_element.toFixed(2));
                            });
                             // console.log(x_axisdata)
                            var update = tester.data
                            update[0]['text'] = x_axisdata.map(String),
                            update[0]['textposition'] = 'outside'
                            update[0]['textangle'] = 90
                            update[1]['text'] = x_axisdata2.map(String),
                            update[1]['textposition'] = 'outside'
                            update[1]['textangle'] = 90

                            document.getElementById(id_labels).value = "hide_labels"
                            document.getElementById(id_labels).innerHTML = "Hide Labels"
                        }
                        if (labelsvalue == "hide_labels") {
                            var update = tester.data
                             // console.log(update)
                            delete update[0]["text"]
                            delete update[0]["textposition"]
                            delete update[1]["text"]
                            delete update[1]["textposition"]
                            document.getElementById(id_labels).value = "show_labels"
                            document.getElementById(id_labels).innerHTML = "Show Labels"
                        }
                         // console.log(update)
                        Plotly.redraw(tester, update)
                         // console.log(tester.data)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))
                    };
                    document.getElementById(id3).onchange = function () {
                        var textbox1length = document.getElementById(id2).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var x_axis_start = tester.layout.xaxis.range[0]
                        var gridlines_value = tester.layout.xaxis.showgrid
                         // console.log(gridlines_value)

                        if (textbox1length == 0) {
                            var layout = {
                                xaxis: {
                                    range: [x_axis_start, textbox2value], showgrid: gridlines_value, automargin: true
                                }
                            }
                        }
                        else {
                            var layout = {
                                xaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }

                    document.getElementById(id9).onclick = function () {
                        var gridlinesvalue = document.getElementById(id9).value
                         // console.log(gridlinesvalue)
                        var y_axis_title = tester.layout.yaxis.title.text

                        if (gridlinesvalue == "show_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    showgrid: true, automargin: true, tickangle: 45, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: true, automargin: true
                                }
                            };
                            document.getElementById(id9).value = "hide_gridlines"
                            document.getElementById(id9).innerHTML = "Hide Gridlines"
                        }
                        if (gridlinesvalue == "hide_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    showgrid: false, automargin: true, tickangle: 45, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: false, automargin: true
                                }
                            };
                            document.getElementById(id9).value = "show_gridlines"
                            document.getElementById(id9).innerHTML = "Show Gridlines"

                        }
                        Plotly.relayout(tester, layout2)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    };
                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id
                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };
                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };


                    document.getElementById(id12).onchange = function () {
                        var yaxistitlevalue = document.getElementById(id12).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var y_axis_end = tester.layout.yaxis.range[1]

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(yaxistitlevalue)
                         // console.log(tester.layout.yaxis.title)

                        var layout = {
                            yaxis: {
                                range: [y_axis_start, y_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20, tickangle: 45,
                                    text: yaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }
                        }

                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id14).onchange = function () {
                        var legendvalue1 = document.getElementById(id14).value;
                        var update = { name: legendvalue1 }

                        Plotly.restyle(tester, update, 0)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }
                    document.getElementById(id15).onchange = function () {
                        var legendvalue2 = document.getElementById(id15).value;
                        var update = { name: legendvalue2 }

                        Plotly.restyle(tester, update, 1)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }

                    myPlot.on('plotly_afterplot', function () {
                        Plotly.d3.selectAll(".yaxislayer-above").selectAll('text')
                            .on("click", function (d) {
                                 // console.log(d)
                                var labels = tester.data[0].y
                                var position = d.x
                                var text = d.text
                                var labeleditvalue = document.getElementById(id13).value;

                                var dict = {}
                                dict[text] = labeleditvalue
                                changed_text.push(dict)
                                labels[position] = labeleditvalue;
                                 // console.log(position)
                                 // console.log(labels)

                                var update = { "y": [labels] };

                                Plotly.restyle(tester, update)
                                $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                                $(`#${id6}`).attr("data-changed_text", JSON.stringify(changed_text))
                                 // console.log(changed_text)

                            });
                    });
                    document.getElementById(id18).onclick = function () {
                         // console.log(y_axisdata2)
                         // console.log(data)
                        var update = { "y": [JSON.parse(JSON.stringify(y_axisdata2))] }
                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }
                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }
                             // console.log(graph_height)
                             // console.log(graph_width)

                            Plotly.relayout(tester, layout)
                            $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                        },
                    });
                }
                if (graph_subtype == 'Horizontal_Bar_Grouped') {
                    var x_axis = data.x_axis
                    var y_axis = data.y_axis
                    var second_column = data.second_column

                    var outermodalCard = $(`

<div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
right: 0 ;top : 10px;z-index: 1050">


  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
      <button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <label style="font-size:1.1rem">Change the graph color:</label>
  <input type="color" id=${id1} name="favcolor" value="#b8860b"><br><br>
  <label style="font-size:1.1rem">Change the color or an element:</label>
  <input type="color" id=${id4} name="favcolor1" value="#b8860b"><br><br><label style="font-size:1.1rem">Change X and Y axis gridlines:</label>
      <button type="button" class="btn btn-primary" id="${id9}" data-toggle="button" role="tab"
                      aria-pressed="false" autocomplete="off" value="show_gridlines" style="line-height: 0.7;">Show Gridlines</button><br><br>
                      <label style="font-size:1.1rem">Change the range of the axis:</label>
  <input type="text" placeholder="Y Axis Start" id=${id2} size="7">
  <input type="text" placeholder="Y Axis End " id=${id3} size="7">
<br><br>
<label style="font-size:1.1rem">Change the title of the axes:</label>
    <input type="text" placeholder="Y Axis Title" id=${id12} size="7">
    <br><br>
    <label style="font-size:1.1rem">Change the legend labels:</label>
  <input type="text" placeholder=${x_axis} id=${id14} size="7">
  <input type="text" placeholder=${second_column} id=${id15} size="7">
  <br><br>
<label style="font-size:1.1rem">Change the label of an element:</label><br>
    <input type="text" placeholder="Y Axis Label" id=${id13} size="9"> &nbsp;&nbsp;
    <button type="button" class="btn btn-primary" id="${id18}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" style="line-height: 1.1;">Reset Axis Labels</button><br><br>
                        <label style="font-size:1.1rem">Change Plot Labels:</label>
        <button type="button" class="btn btn-primary" id="${id_labels}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" value="show_labels" style="line-height: 1.1;">Show Labels</button>
  </div>
</div>
`)
                    if (data.plotDict === undefined) {

                        outerCard.appendTo('#card')
                        var tab_id = 'main_page'
                        outermodalCard.appendTo('#card')

                        var colorlength = data.x_axisdata.length
                        var colordata = [];
                        var colordatasecond = [];
                        var y_axisdata2 = JSON.parse(JSON.stringify(data.y_axisdata))

                        for (var i = 0; i < colorlength; i++) {
                            colordata.push('#b8860b');
                        }
                        for (var i = 0; i < colorlength; i++) {
                            colordatasecond.push('goldenrod');
                        }
                        var trace1 = {
                            x: data.x_axisdata,
                            y: data.y_axisdata,
                            type: 'bar',
                            marker: {
                                color: colordata,
                            },
                            orientation: 'h',
                            name: x_axis
                        };
                        var trace2 = {
                            x: data.second_columndata,
                            y: data.y_axisdata,
                            type: 'bar',
                            marker: {
                                color: colordatasecond,
                            },
                            orientation: 'h',
                            name: y_axis
                        };
                        var dataplot = [trace1, trace2]
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)

                        var layout = {
                            legend: { orientation: "h" },
                            barmode: 'group',
                            hovermode: 'closest',
                            margin: { l: 0, r: 0, b: 20, t: 10, pad: 4 },
                            yaxis: {
                                title: {
                                    standoff: 20,
                                    text: y_axis, font: {
                                        family: "Arial"
                                    }
                                }, showgrid: false, font: {
                                    family: "Arial"
                                }, tickangle: 45,
                                automargin: true
                            },
                            xaxis: {
                                showgrid: false, automargin: true, font: {
                                    family: "Arial"
                                }
                            },
                        }
                    }
                    else {
                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tab_id = data.plotDict.tab_id
                                               outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)
                        var dataplot = data.plotDict.data
                        dataplot[0].x = data.x_axisdata
                        dataplot[0].y = data.y_axisdata
                        dataplot[1].x = data.second_columndata
                        dataplot[1].y = data.y_axisdata
                        delete dataplot[1]["selectedpoints"]
                        delete dataplot[0]["selectedpoints"]
                        var layout = data.plotDict.layout

                        var width = width.split("p")
                        var height = height.split("p")

                        var graph_height = height[0] * 0.876
                        var graph_width = width[0] * 0.9481

                        layout["height"] = graph_height
                        layout["width"] = graph_width

                         // console.log(layout)
                        var colorlength = data.x_axisdata.length

                    }
                    var config = { responsive: true, displaylogo: false }

                    Plotly.newPlot(tester, dataplot, layout, config)
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})
                    var x_axis_end = tester.layout.xaxis.range[1]
                    var x_axis_start = tester.layout.xaxis.range[0]

                     // console.log(tester.layout)

                    document.getElementById(id1).onchange = function () {
                        var colorlength = data.x_axisdata.length

                        var colordata2 = [];
                        var colordata3 = [];

                        var backRGB = this.value;

                        const hexToRgb = hex =>
                            hex.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i
                                , (m, r, g, b) => '#' + r + r + g + g + b + b)
                                .substring(1).match(/.{2}/g)
                                .map(x => parseInt(x, 16))
                        var r = hexToRgb(backRGB)[0] * 0.9
                        var g = hexToRgb(backRGB)[1] * 0.9
                        var b = hexToRgb(backRGB)[2] * 0.9

                        function rgb2hex(red, green, blue) {
                            var rgb = blue | (green << 8) | (red << 16);
                            return '#' + (0x1000000 + rgb).toString(16).slice(1)
                        }
                        var newcolor = rgb2hex(r, g, b)

                        for (var i = 0; i < colorlength; i++) {
                            colordata2.push(backRGB);
                        }
                        for (var i = 0; i < colorlength; i++) {
                            colordata3.push(newcolor);
                        }
                        var update = { 'marker': { color: colordata2 } };
                        var update2 = { 'marker': { color: colordata3 } };


                        Plotly.restyle(tester, update, [0])
                        Plotly.restyle(tester, update2, [1])
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }
      document.getElementById(id_labels).onclick = function () {
                        var labelsvalue = document.getElementById(id_labels).value

                        if (labelsvalue == "show_labels") {
                            var x_axisdata = tester.data[0].x
                            var x_axisdata2 = tester.data[1].x
                             // console.log(x_axisdata)
                            x_axisdata = x_axisdata.map(function(each_element){
                                return Number(each_element.toFixed(2));
                            });
                            x_axisdata2 = x_axisdata2.map(function(each_element){
                                return Number(each_element.toFixed(2));
                            });
                             // console.log(x_axisdata)
                            var update = tester.data
                            update[0]['text'] = x_axisdata.map(String),
                            update[0]['textposition'] = 'outside'
                            update[0]['textangle'] = 90
                            update[1]['text'] = x_axisdata2.map(String),
                            update[1]['textposition'] = 'outside'
                            update[1]['textangle'] = 90

                            document.getElementById(id_labels).value = "hide_labels"
                            document.getElementById(id_labels).innerHTML = "Hide Labels"
                        }
                        if (labelsvalue == "hide_labels") {
                            var update = tester.data
                             // console.log(update)
                            delete update[0]["text"]
                            delete update[0]["textposition"]
                            delete update[1]["text"]
                            delete update[1]["textposition"]
                            document.getElementById(id_labels).value = "show_labels"
                            document.getElementById(id_labels).innerHTML = "Show Labels"
                        }
                         // console.log(update)
                        Plotly.redraw(tester, update)
                         // console.log(tester.data)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))
                    };
                    document.getElementById(id2).onchange = function () {
                        var textbox2length = document.getElementById(id3).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var x_axis_end = tester.layout.xaxis.range[1]
                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(textbox2length)
                         // console.log(x_axis_end)

                        if (textbox2length == 0) {
                            var layout = {
                                xaxis: {
                                    range: [textbox1value, x_axis_end], showgrid: gridlines_value, automargin: true
                                }
                            }
                        }
                        else {
                            var layout = {
                                xaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id3).onchange = function () {
                        var textbox1length = document.getElementById(id2).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var x_axis_start = tester.layout.xaxis.range[0]
                        var gridlines_value = tester.layout.xaxis.showgrid
                         // console.log(gridlines_value)

                        if (textbox1length == 0) {
                            var layout = {
                                xaxis: {
                                    range: [x_axis_start, textbox2value], showgrid: gridlines_value, automargin: true
                                }
                            }
                        }
                        else {
                            var layout = {
                                xaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    myPlot.on('plotly_click', function (data) {
                         // console.log(data.points[0].x)
                         // console.log(data.points)

                        var pn = '',
                            tn = '',
                            colors = [];
                        for (var i = 0; i < data.points.length; i++) {
                            pn = data.points[i].pointNumber;
                            tn = data.points[i].curveNumber;
                            colors = data.points[i].data.marker.color;
                        };
                         // console.log(colors)

                        var color = document.getElementById(id4).value
                        colors[pn] = color;
                         // console.log(pn)
                         // console.log(tn)
                         // console.log(colors)
                        var update = { 'marker': { color: colors } };
                        Plotly.restyle(tester, update, [tn])
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    });

                    document.getElementById(id9).onclick = function () {
                        var gridlinesvalue = document.getElementById(id9).value
                         // console.log(gridlinesvalue)
                        var y_axis_title = tester.layout.yaxis.title.text

                        if (gridlinesvalue == "show_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    showgrid: true, automargin: true, tickangle: 45, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: true, automargin: true,
                                }
                            };
                            document.getElementById(id9).value = "hide_gridlines"
                            document.getElementById(id9).innerHTML = "Hide Gridlines"
                        }
                        if (gridlinesvalue == "hide_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    showgrid: false, automargin: true, tickangle: 45, title: {
                                        standoff: 20,
                                        text: y_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }, xaxis: {
                                    showgrid: false, automargin: true
                                }
                            };
                            document.getElementById(id9).value = "show_gridlines"
                            document.getElementById(id9).innerHTML = "Show Gridlines"

                        }
                        Plotly.relayout(tester, layout2)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    };
                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id
                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };
                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };

                    document.getElementById(id12).onchange = function () {
                        var yaxistitlevalue = document.getElementById(id12).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var y_axis_end = tester.layout.yaxis.range[1]

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(yaxistitlevalue)
                         // console.log(tester.layout.yaxis.title)

                        var layout = {
                            yaxis: {
                                range: [y_axis_start, y_axis_end], showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20, tickangle: 45,
                                    text: yaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }
                        }

                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id14).onchange = function () {
                        var legendvalue1 = document.getElementById(id14).value;
                        var update = { name: legendvalue1 }

                        Plotly.restyle(tester, update, 0)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }
                    document.getElementById(id15).onchange = function () {
                        var legendvalue2 = document.getElementById(id15).value;
                        var update = { name: legendvalue2 }

                        Plotly.restyle(tester, update, 1)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }

                    myPlot.on('plotly_afterplot', function () {
                        Plotly.d3.selectAll(".yaxislayer-above").selectAll('text')
                            .on("click", function (d) {
                                 // console.log(d)
                                var labels = tester.data[0].y
                                var position = d.x
                                var text = d.text
                                var labeleditvalue = document.getElementById(id13).value;

                                var dict = {}
                                dict[text] = labeleditvalue
                                changed_text.push(dict)
                                labels[position] = labeleditvalue;
                                 // console.log(position)
                                 // console.log(labels)

                                var update = { "y": [labels] };

                                Plotly.restyle(tester, update)
                                $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                                $(`#${id6}`).attr("data-changed_text", JSON.stringify(changed_text))
                                 // console.log(changed_text)

                            });
                    });
                    document.getElementById(id18).onclick = function () {
                         // console.log(y_axisdata2)
                         // console.log(data)
                        var update = { "y": [JSON.parse(JSON.stringify(y_axisdata2))] }
                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }
                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }
                             // console.log(graph_height)
                             // console.log(graph_width)

                            Plotly.relayout(tester, layout)
                            $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                        },
                    });
                    myPlot.on('plotly_selected', function(data){
                        try {
                        points_array = data.points

                         // console.log(points_array)

                        var points = []
                        for(let i = 0; i < points_array.length; i++){
                            points.push(points_array[i].label)
                            }
                         // console.log(points)
                        var unique = points.filter((v, i, a) => a.indexOf(v) === i);
                         // console.log(unique)
                        var crossfilterdict = { 'points':unique,'id':chartDivId}
                        crossfilter_function(crossfilterdict)
                        }
                        catch(err){
                                ;
                        }
                        })
                    myPlot.on('plotly_deselect', function(){
                        //  // console.log('hi')
                        // var CLICK_TIME = Date.now()

                        // if(CLICK_TIME - LAST_CLICK < 10000) {
                        var resetdict = {'id':chartDivId}
                        reset_function(resetdict)
                        // } else {
                        //     LAST_CLICK = CLICK_TIME
                        //      // console.log('single click')
                        // }


                    })
                }
                if (graph_subtype == 'Vertical_Bar_Grouped') {
                    var x_axis = data.x_axis
                    var y_axis = data.y_axis
                    var second_column = data.second_column

                    var outermodalCard = $(`

<div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
right: 0 ;top : 10px;z-index: 1050">


  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
      <button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <label style="font-size:1.1rem">Change the graph color:</label>
  <input type="color" id=${id1} name="favcolor" value="#b8860b"><br><br>
  <label style="font-size:1.1rem">Change the color or an element:</label>
  <input type="color" id=${id4} name="favcolor1" value="#b8860b"><br><br><label style="font-size:1.1rem">Change X and Y axis gridlines:</label>
      <button type="button" class="btn btn-primary" id="${id9}" data-toggle="button" role="tab"
                      aria-pressed="false" autocomplete="off" value="show_gridlines" style="line-height: 0.7;">Show Gridlines</button><br><br>
                      <label style="font-size:1.1rem">Change the range of the axis:</label>
  <input type="text" placeholder="Y Axis Start" id=${id2} size="7">
  <input type="text" placeholder="Y Axis End " id=${id3} size="7">
<br><br>
<label style="font-size:1.1rem">Change the title of the axes:</label>
    <input type="text" placeholder="X Axis Title" id=${id11} size="7">
    <br><br>
    <label style="font-size:1.1rem">Change the legend labels:</label>
  <input type="text" placeholder=${y_axis} id=${id14} size="7">
  <input type="text" placeholder=${second_column} id=${id15} size="7">
  <br><br>
<label style="font-size:1.1rem">Change the label of an element:</label><br>
    <input type="text" placeholder="X Axis Label" id=${id13} size="9"> &nbsp;&nbsp;
    <button type="button" class="btn btn-primary" id="${id18}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" style="line-height: 1.1;">Reset Axis Labels</button><br><br>
                        <label style="font-size:1.1rem">Change Plot Labels:</label>
        <button type="button" class="btn btn-primary" id="${id_labels}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" value="show_labels" style="line-height: 1.1;">Show Labels</button>
  </div>
</div>
`)
                    if (data.plotDict === undefined) {

                        outerCard.appendTo('#card')
                        var tab_id = 'main_page'
                                    outermodalCard.appendTo('#card')

                        var colorlength = data.x_axisdata.length
                        var colordata = [];

                        var colordatasecond = [];
                        var x_axisdata2 = JSON.parse(JSON.stringify(data.x_axisdata))

                        for (var i = 0; i < colorlength; i++) {
                            colordata.push('#b8860b');
                        }
                        for (var i = 0; i < colorlength; i++) {
                            colordatasecond.push('goldenrod');
                        }
                         // console.log(colordata)
                        var trace1 = {
                            x: data.x_axisdata,
                            y: data.y_axisdata,
                            type: 'bar',
                            marker: {
                                color: colordata
                            },
                            name: y_axis
                        };

                        var trace2 = {
                            x: data.x_axisdata,
                            y: data.second_columndata,
                            type: 'bar',
                            marker: {
                                color: colordatasecond,
                            },
                            name: second_column
                        };
                        var dataplot = [trace1, trace2]
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)

                        var layout = {
                            barmode: 'group',
                            hovermode: 'closest',
                            margin: { l: 40, r: 0, b: 20, t: 10, pad: 4 },
                            yaxis: {
                                showgrid: false, 'automargin': true, font: {
                                    family: "Arial"
                                }
                            },
                            xaxis: {
                                title: {
                                    standoff: 20,
                                    text: x_axis, font: {
                                        family: "Arial"
                                    }
                                },
                                showgrid: false, 'automargin': true, font: {
                                    family: "Arial"
                                }
                            },
                        }
                    }
                    else {
                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tab_id = data.plotDict.tab_id
                                               outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)
                        var dataplot = data.plotDict.data
                        dataplot[0].x = data.x_axisdata
                        dataplot[0].y = data.y_axisdata
                        dataplot[1].x = data.x_axisdata
                        dataplot[1].y = data.second_columndata
                        delete dataplot[1]["selectedpoints"]
                        delete dataplot[0]["selectedpoints"]
                        var layout = data.plotDict.layout

                        var width = width.split("p")
                        var height = height.split("p")

                        var graph_height = height[0] * 0.876
                        var graph_width = width[0] * 0.9481

                        layout["height"] = graph_height
                        layout["width"] = graph_width

                         // console.log(layout)
                        var colorlength = data.x_axisdata.length
                    }
                    var config = { responsive: true, displaylogo: false }

                    Plotly.newPlot(tester, dataplot, layout, config)
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})
                    var y_axis_end = tester.layout.yaxis.range[1]
                    var y_axis_start = tester.layout.yaxis.range[0]

                     // console.log(tester.layout)


                    document.getElementById(id1).onchange = function () {
                        var colorlength = data.x_axisdata.length

                        var colordata2 = [];
                        var colordata3 = [];

                        var backRGB = this.value;

                        const hexToRgb = hex =>
                            hex.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i
                                , (m, r, g, b) => '#' + r + r + g + g + b + b)
                                .substring(1).match(/.{2}/g)
                                .map(x => parseInt(x, 16))
                        var r = hexToRgb(backRGB)[0] * 0.9
                        var g = hexToRgb(backRGB)[1] * 0.9
                        var b = hexToRgb(backRGB)[2] * 0.9

                        function rgb2hex(red, green, blue) {
                            var rgb = blue | (green << 8) | (red << 16);
                            return '#' + (0x1000000 + rgb).toString(16).slice(1)
                        }
                        var newcolor = rgb2hex(r, g, b)

                        for (var i = 0; i < colorlength; i++) {
                            colordata2.push(backRGB);
                        }
                        for (var i = 0; i < colorlength; i++) {
                            colordata3.push(newcolor);
                        }
                        var update = { 'marker': { color: colordata2 } };
                        var update2 = { 'marker': { color: colordata3 } };


                        Plotly.restyle(tester, update, [0])
                        Plotly.restyle(tester, update2, [1])
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }
                    document.getElementById(id_labels).onclick = function () {
                        var labelsvalue = document.getElementById(id_labels).value

                        if (labelsvalue == "show_labels") {
                            var y_axisdata = tester.data[0].y
                            var y_axisdata2 = tester.data[1].y
                             // console.log(y_axisdata)
                            y_axisdata = y_axisdata.map(function(each_element){
                                return Number(each_element.toFixed(2));
                            });
                            y_axisdata2 = y_axisdata2.map(function(each_element){
                                return Number(each_element.toFixed(2));
                            });
                             // console.log(y_axisdata)
                            var update = tester.data
                            update[0]['text'] = y_axisdata.map(String),
                            update[0]['textposition'] = 'outside'
                            update[1]['text'] = y_axisdata2.map(String),
                            update[1]['textposition'] = 'outside'

                            document.getElementById(id_labels).value = "hide_labels"
                            document.getElementById(id_labels).innerHTML = "Hide Labels"
                        }
                        if (labelsvalue == "hide_labels") {
                            var update = tester.data
                             // console.log(update)
                            delete update[0]["text"]
                            delete update[0]["textposition"]
                            delete update[1]["text"]
                            delete update[1]["textposition"]
                            document.getElementById(id_labels).value = "show_labels"
                            document.getElementById(id_labels).innerHTML = "Show Labels"
                        }
                         // console.log(update)
                        Plotly.redraw(tester, update)
                         // console.log(tester.data)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))
                    };
                    document.getElementById(id2).onchange = function () {
                        var textbox2length = document.getElementById(id3).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var y_axis_end = tester.layout.yaxis.range[1]
                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(textbox2length)
                         // console.log(y_axis_end)

                        if (textbox2length == 0) {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, y_axis_end], showgrid: gridlines_value, automargin: true
                                }
                            }
                        }
                        else {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id3).onchange = function () {
                        var textbox1length = document.getElementById(id2).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var gridlines_value = tester.layout.yaxis.showgrid
                         // console.log(gridlines_value)

                        if (textbox1length == 0) {
                            var layout = {
                                yaxis: {
                                    range: [y_axis_start, textbox2value], showgrid: gridlines_value, automargin: true
                                }
                            }
                        }
                        else {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    myPlot.on('plotly_click', function (data) {
                         // console.log(data.points[0].x)
                         // console.log(data.points)

                        var pn = '',
                            tn = '',
                            colors = [];
                        for (var i = 0; i < data.points.length; i++) {
                            pn = data.points[i].pointNumber;
                            tn = data.points[i].curveNumber;
                            colors = data.points[i].data.marker.color;
                        };

                        var color = document.getElementById(id4).value
                        colors[pn] = color;
                         // console.log(pn)
                         // console.log(tn)
                         // console.log(colors)
                        var update = { 'marker': { color: colors } };
                        Plotly.restyle(tester, update, [tn])
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    });

                    document.getElementById(id9).onclick = function () {
                        var gridlinesvalue = document.getElementById(id9).value
                         // console.log(gridlinesvalue)
                        var x_axis_title = tester.layout.xaxis.title.text

                        if (gridlinesvalue == "show_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    showgrid: true, automargin: true
                                }, xaxis: {
                                    showgrid: true, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "hide_gridlines"
                            document.getElementById(id9).innerHTML = "Hide Gridlines"
                        }
                        if (gridlinesvalue == "hide_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    showgrid: false, automargin: true
                                }, xaxis: {
                                    showgrid: false, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "show_gridlines"
                            document.getElementById(id9).innerHTML = "Show Gridlines"

                        }
                        Plotly.relayout(tester, layout2)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    };
                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id
                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };
                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };
                    document.getElementById(id11).onchange = function () {
                        var xaxistitlevalue = document.getElementById(id11).value;

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(xaxistitlevalue)
                         // console.log(tester.layout.xaxis.title)

                        var layout = {
                            xaxis: {
                                showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: xaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }


                        }
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id14).onchange = function () {
                        var legendvalue1 = document.getElementById(id14).value;
                        var update = { name: legendvalue1 }

                        Plotly.restyle(tester, update, 0)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }
                    document.getElementById(id15).onchange = function () {
                        var legendvalue2 = document.getElementById(id15).value;
                        var update = { name: legendvalue2 }

                        Plotly.restyle(tester, update, 1)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }


                    try {
                        var changed_text = data.plotDict.changed_text
                    }
                    catch (err) {
                        var changed_text = []

                    }
                    myPlot.on('plotly_afterplot', function () {
                        Plotly.d3.selectAll(".xaxislayer-above").selectAll('text')
                            .on("click", function (d) {
                                 // console.log(d)
                                var labels = tester.data[0].x
                                var position = d.x
                                var text = d.text
                                var labeleditvalue = document.getElementById(id13).value;

                                var dict = {}
                                dict[text] = labeleditvalue
                                changed_text.push(dict)
                                labels[position] = labeleditvalue;
                                 // console.log(position)
                                 // console.log(labels)

                                var update = { "x": [labels] };

                                Plotly.restyle(tester, update)
                                $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                                $(`#${id6}`).attr("data-changed_text", JSON.stringify(changed_text))
                                 // console.log(changed_text)

                            });
                    });
                    document.getElementById(id18).onclick = function () {
                         // console.log(x_axisdata2)
                         // console.log(data)
                        var update = { "x": [JSON.parse(JSON.stringify(x_axisdata2))] }
                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }
                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }
                             // console.log(graph_height)
                             // console.log(graph_width)

                            Plotly.relayout(tester, layout)
                            $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                        },
                    });
                    myPlot.on('plotly_selected', function(data){
                        try {
                        points_array = data.points

                         // console.log(points_array)

                        var points = []
                        for(let i = 0; i < points_array.length; i++){
                            points.push(points_array[i].label)
                            }
                         // console.log(points)
                        var unique = points.filter((v, i, a) => a.indexOf(v) === i);
                         // console.log(unique)
                        var crossfilterdict = { 'points':unique,'id':chartDivId}
                        crossfilter_function(crossfilterdict)
                        }
                        catch(err){
                                ;
                        }
                        })
                    myPlot.on('plotly_deselect', function(){
                        //  // console.log('hi')
                        // var CLICK_TIME = Date.now()

                        // if(CLICK_TIME - LAST_CLICK < 10000) {
                        var resetdict = {'id':chartDivId}
                        reset_function(resetdict)
                        // } else {
                        //     LAST_CLICK = CLICK_TIME
                        //      // console.log('single click')
                        // }


                    })
                }
                if (graph_subtype == 'Stacked_Histogram') {
                    var x_axis = data.x_axis
                    var y_axis = data.y_axis
                    var second_column = data.second_column


                    var outermodalCard = $(`

<div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
right: 0 ;top : 10px;z-index: 1050">

  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
      <button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <label style="font-size:1.1rem">Change the graph color:</label>
  <input type="color" id=${id1} name="favcolor" value="#b8860b"><br><br>
  <label style="font-size:1.1rem">Change the color or an element:</label>
  <input type="color" id=${id4} name="favcolor1" value="#b8860b"><br><br><label style="font-size:1.1rem">Change X and Y axis gridlines:</label>
      <button type="button" class="btn btn-primary" id="${id9}" data-toggle="button" role="tab"
                      aria-pressed="false" autocomplete="off" value="show_gridlines" style="line-height: 0.7;">Show Gridlines</button><br><br>
                      <label style="font-size:1.1rem">Change the range of the axis:</label>
  <input type="text" placeholder="Y Axis Start" id=${id2} size="7">
  <input type="text" placeholder="Y Axis End " id=${id3} size="7">
<br><br>
<label style="font-size:1.1rem">Change the title of the axes:</label>
    <input type="text" placeholder="X Axis Title" id=${id11} size="7">
    <br><br>
    <label style="font-size:1.1rem">Change the legend labels:</label>
  <input type="text" placeholder=${y_axis} id=${id14} size="7">
  <input type="text" placeholder=${second_column} id=${id15} size="7">
  <br><br>
<label style="font-size:1.1rem">Change the label of an element:</label><br>
    <input type="text" placeholder="X Axis Label" id=${id13} size="9"> &nbsp;&nbsp;
    <button type="button" class="btn btn-primary" id="${id18}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" style="line-height: 1.1;">Reset Axis Labels</button><br><br>
  </div>
</div>
`)
                    outerCard.appendTo('#card')
                    outermodalCard.appendTo('#card')

                    var colorlength = data.x_axisdata.length
                    var colordata = [];

                    var colordatasecond = [];
                    var x_axisdata2 = JSON.parse(JSON.stringify(data.x_axisdata))

                    var trace1 = {
                        x: data.x_axisdata,
                        type: 'histogram',
                        marker: {
                            color: '#b8860b'
                        }
                    };

                    var trace2 = {
                        x: data.y_axisdata,
                        type: 'histogram',
                        marker: {
                            color: 'goldenrod'
                        }
                    };

                    var data = [trace1, trace2]
                    var tester = document.getElementById(id)
                    var myPlot = document.getElementById(id)

                    var layout = {
                        barmode: 'stack',
                        hovermode: 'closest',
                        margin: { l: 40, r: 0, b: 20, t: 10, pad: 4 },
                        yaxis: {
                            showgrid: false, 'automargin': true, font: {
                                family: "Arial"
                            }
                        },
                        xaxis: {
                            title: {
                                standoff: 20,
                                text: x_axis, font: {
                                    family: "Arial"
                                }
                            },
                            showgrid: false, 'automargin': true, font: {
                                family: "Arial"
                            }
                        },
                    }
                    var config = { responsive: true, displaylogo: false }

                    Plotly.newPlot(tester, data, layout, config)
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})

                    var y_axis_end = tester.layout.yaxis.range[1]
                    var y_axis_start = tester.layout.yaxis.range[0]

                     // console.log(tester.data)


                    document.getElementById(id1).onchange = function () {
                         // console.log(colordata.length)
                        var colorlength = colordata.length
                         // console.log(colorlength)

                        var colordata2 = [];
                        var colordata3 = [];

                        var backRGB = this.value;

                        const hexToRgb = hex =>
                            hex.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i
                                , (m, r, g, b) => '#' + r + r + g + g + b + b)
                                .substring(1).match(/.{2}/g)
                                .map(x => parseInt(x, 16))
                        var r = hexToRgb(backRGB)[0] * 0.9
                        var g = hexToRgb(backRGB)[1] * 0.9
                        var b = hexToRgb(backRGB)[2] * 0.9

                        function rgb2hex(red, green, blue) {
                            var rgb = blue | (green << 8) | (red << 16);
                            return '#' + (0x1000000 + rgb).toString(16).slice(1)
                        }
                        var newcolor = rgb2hex(r, g, b)

                        var update = { 'marker': { color: backRGB } };
                        var update2 = { 'marker': { color: newcolor } };

                        Plotly.restyle(tester, update, [0])
                        Plotly.restyle(tester, update2, [1])
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }

                    document.getElementById(id2).onchange = function () {
                        var textbox2length = document.getElementById(id3).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var y_axis_end = tester.layout.yaxis.range[1]
                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(textbox2length)
                         // console.log(y_axis_end)

                        if (textbox2length == 0) {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, y_axis_end], showgrid: gridlines_value, automargin: true
                                }
                            }
                        }
                        else {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id3).onchange = function () {
                        var textbox1length = document.getElementById(id2).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var gridlines_value = tester.layout.yaxis.showgrid
                         // console.log(gridlines_value)

                        if (textbox1length == 0) {
                            var layout = {
                                yaxis: {
                                    range: [y_axis_start, textbox2value], showgrid: gridlines_value, automargin: true
                                }
                            }
                        }
                        else {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }

                    document.getElementById(id9).onclick = function () {
                        var gridlinesvalue = document.getElementById(id9).value
                         // console.log(gridlinesvalue)
                        var x_axis_title = tester.layout.xaxis.title.text

                        if (gridlinesvalue == "show_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    showgrid: true, automargin: true
                                }, xaxis: {
                                    showgrid: true, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "hide_gridlines"
                            document.getElementById(id9).innerHTML = "Hide Gridlines"
                        }
                        if (gridlinesvalue == "hide_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    showgrid: false, automargin: true
                                }, xaxis: {
                                    showgrid: false, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "show_gridlines"
                            document.getElementById(id9).innerHTML = "Show Gridlines"

                        }
                        Plotly.relayout(tester, layout2)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    };
                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id
                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };
                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };
                    document.getElementById(id11).onchange = function () {
                        var xaxistitlevalue = document.getElementById(id11).value;

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(xaxistitlevalue)
                         // console.log(tester.layout.xaxis.title)

                        var layout = {
                            xaxis: {
                                showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: xaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }


                        }
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id14).onchange = function () {
                        var legendvalue1 = document.getElementById(id14).value;
                        var update = { name: legendvalue1 }

                        Plotly.restyle(tester, update, 0)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }
                    document.getElementById(id15).onchange = function () {
                        var legendvalue2 = document.getElementById(id15).value;
                        var update = { name: legendvalue2 }

                        Plotly.restyle(tester, update, 1)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }


                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }
                             // console.log(graph_height)
                             // console.log(graph_width)

                            Plotly.relayout(tester, layout)
                            $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                        },
                    });
                }
                if (graph_subtype == 'Vertical_Waterfall_Grouped') {
                    var x_axis = data.x_axis
                    var y_axis = data.y_axis
                    var second_column = data.second_column


                    var outermodalCard = $(`


<div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
right: 0 ;top : 10px;z-index: 1050">


  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
      <button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
<label style="font-size:1.1rem">Change X and Y axis gridlines:</label>
      <button type="button" class="btn btn-primary" id="${id9}" data-toggle="button" role="tab"
                      aria-pressed="false" autocomplete="off" value="show_gridlines" style="line-height: 0.7;">Show Gridlines</button><br><br>
                      <label style="font-size:1.1rem">Change the range of the axis:</label>
  <input type="text" placeholder="Y Axis Start" id=${id2} size="7">
  <input type="text" placeholder="Y Axis End " id=${id3} size="7">
<br><br>
<label style="font-size:1.1rem">Change the title of the axes:</label>
    <input type="text" placeholder="X Axis Title" id=${id11} size="7">
    <br><br>
    <label style="font-size:1.1rem">Change the legend labels:</label>
  <input type="text" placeholder=${y_axis} id=${id14} size="7">
  <input type="text" placeholder=${second_column} id=${id15} size="7">
  <br><br>
<label style="font-size:1.1rem">Change the label of an element:</label><br>
    <input type="text" placeholder="X Axis Label" id=${id13} size="9"> &nbsp;&nbsp;
    <button type="button" class="btn btn-primary" id="${id18}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" style="line-height: 1.1;">Reset Axis Labels</button><br><br>
                        <label style="font-size:1.1rem">Change Plot Labels:</label>
        <button type="button" class="btn btn-primary" id="${id_labels}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" value="show_labels" style="line-height: 1.1;">Show Labels</button>
  </div>
</div>
`)
                    if (data.plotDict === undefined) {

                        outerCard.appendTo('#card')
                        var tab_id = 'main_page'
                                    outermodalCard.appendTo('#card')

                        var colorlength = data.x_axisdata.length
                        var colordata = [];

                        var colordatasecond = [];
                        var measure = [];

                        var x_axis = data.x_axis
                        var y_axis = data.y_axis
                        var x_axisdata = data.x_axisdata
                        var y_axisdata = data.y_axisdata
                        var y_axisdata2 = data.second_columndata
                        var x_axisdata2 = JSON.parse(JSON.stringify(data.x_axisdata))
                        x_axisdata2.push('Total')

                        x_axisdata.push('Total')
                        y_axisdata.push(0)
                        y_axisdata2.push(0)

                        for (var i = 0; i < colorlength; i++) {
                            colordata.push('#b8860b');
                        }
                        for (var i = 0; i < colorlength; i++) {
                            colordatasecond.push('goldenrod');
                        }
                        for (var i = 0; i < colorlength; i++) {
                            measure.push('relative');
                        }
                        measure.push('total')

                         // console.log(data.second_column)
                        var trace1 = {
                            x: x_axisdata,
                            y: y_axisdata,
                            type: "waterfall",
                            measure: measure,
                            marker: {
                                color: colordata
                            },
                            name: y_axis
                        };
                        var trace2 = {
                            x: x_axisdata,
                            y: y_axisdata2,
                            type: "waterfall",
                            measure: measure,
                            marker: {
                                color: colordatasecond
                            },
                            name: data.second_column
                        };
                        var dataplot = [trace1, trace2]
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)

                        var layout = {
                            barmode: 'group',
                            hovermode: 'closest',
                            margin: { l: 40, r: 0, b: 20, t: 10, pad: 4 },
                            yaxis: {
                                showgrid: false, 'automargin': true, font: {
                                    family: "Arial"
                                }
                            },
                            xaxis: {
                                title: {
                                    standoff: 20,
                                    text: x_axis, font: {
                                        family: "Arial"
                                    }
                                },
                                showgrid: false, 'automargin': true, font: {
                                    family: "Arial"
                                }
                            },
                        }
                    }
                    else {
                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tab_id = data.plotDict.tab_id
                                               outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)
                        var dataplot = data.plotDict.data
                        var colorlength = data.x_axisdata.length
                        var measure = [];

                        for (var i = 0; i < colorlength; i++) {
                            measure.push('relative');
                        }
                        var x_axisdata = data.x_axisdata
                        var y_axisdata = data.y_axisdata
                        var second_columndata = data.second_columndata
                        var x_axisdata2 = JSON.parse(JSON.stringify(data.x_axisdata))
                        x_axisdata2.push('Total')

                        x_axisdata.push('Total')
                        y_axisdata.push(0)
                        second_columndata.push(0)

                        measure.push('total')
                        dataplot[0].x = x_axisdata
                        dataplot[0].y = y_axisdata
                        dataplot[0].measure = measure
                        dataplot[1].x = x_axisdata
                        dataplot[1].y = second_columndata
                        dataplot[1].measure = measure

                        var layout = data.plotDict.layout

                        var width = width.split("p")
                        var height = height.split("p")

                        var graph_height = height[0] * 0.876
                        var graph_width = width[0] * 0.9481

                        layout["height"] = graph_height
                        layout["width"] = graph_width

                         // console.log(layout)

                    }
                    var config = { responsive: true, displaylogo: false }

                    Plotly.newPlot(tester, dataplot, layout, config)
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})
                    var y_axis_end = tester.layout.yaxis.range[1]
                    var y_axis_start = tester.layout.yaxis.range[0]

                     // console.log(tester.layout)

                    document.getElementById(id2).onchange = function () {
                        var textbox2length = document.getElementById(id3).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var y_axis_end = tester.layout.yaxis.range[1]
                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(textbox2length)
                         // console.log(y_axis_end)

                        if (textbox2length == 0) {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, y_axis_end], showgrid: gridlines_value, automargin: true
                                }
                            }
                        }
                        else {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id_labels).onclick = function () {
                        var labelsvalue = document.getElementById(id_labels).value

                        if (labelsvalue == "show_labels") {
                            var y_axisdata = tester.data[0].y
                            var y_axisdata2 = tester.data[1].y
                             // console.log(y_axisdata)
                            y_axisdata = y_axisdata.map(function(each_element){
                                return Number(each_element.toFixed(2));
                            });
                            y_axisdata2 = y_axisdata2.map(function(each_element){
                                return Number(each_element.toFixed(2));
                            });
                             // console.log(y_axisdata)
                            var update = tester.data
                            update[0]['text'] = y_axisdata.map(String),
                            update[0]['textposition'] = 'outside'
                            update[1]['text'] = y_axisdata2.map(String),
                            update[1]['textposition'] = 'outside'

                            document.getElementById(id_labels).value = "hide_labels"
                            document.getElementById(id_labels).innerHTML = "Hide Labels"
                        }
                        if (labelsvalue == "hide_labels") {
                            var update = tester.data
                             // console.log(update)
                            delete update[0]["text"]
                            delete update[0]["textposition"]
                            delete update[1]["text"]
                            delete update[1]["textposition"]
                            document.getElementById(id_labels).value = "show_labels"
                            document.getElementById(id_labels).innerHTML = "Show Labels"
                        }
                         // console.log(update)
                        Plotly.redraw(tester, update)
                         // console.log(tester.data)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))
                    };
                    document.getElementById(id3).onchange = function () {
                        var textbox1length = document.getElementById(id2).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var gridlines_value = tester.layout.yaxis.showgrid
                         // console.log(gridlines_value)

                        if (textbox1length == 0) {
                            var layout = {
                                yaxis: {
                                    range: [y_axis_start, textbox2value], showgrid: gridlines_value, automargin: true
                                }
                            }
                        }
                        else {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }

                    document.getElementById(id9).onclick = function () {
                        var gridlinesvalue = document.getElementById(id9).value
                         // console.log(gridlinesvalue)
                        var x_axis_title = tester.layout.xaxis.title.text

                        if (gridlinesvalue == "show_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    showgrid: true, automargin: true
                                }, xaxis: {
                                    showgrid: true, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "hide_gridlines"
                            document.getElementById(id9).innerHTML = "Hide Gridlines"
                        }
                        if (gridlinesvalue == "hide_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    showgrid: false, automargin: true
                                }, xaxis: {
                                    showgrid: false, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "show_gridlines"
                            document.getElementById(id9).innerHTML = "Show Gridlines"

                        }
                        Plotly.relayout(tester, layout2)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    };
                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id
                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };
                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };
                    document.getElementById(id11).onchange = function () {
                        var xaxistitlevalue = document.getElementById(id11).value;

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(xaxistitlevalue)
                         // console.log(tester.layout.xaxis.title)

                        var layout = {
                            xaxis: {
                                showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: xaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }


                        }
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id14).onchange = function () {
                        var legendvalue1 = document.getElementById(id14).value;
                        var update = { name: legendvalue1 }

                        Plotly.restyle(tester, update, 0)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }
                    document.getElementById(id15).onchange = function () {
                        var legendvalue2 = document.getElementById(id15).value;
                        var update = { name: legendvalue2 }

                        Plotly.restyle(tester, update, 1)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }


                    try {
                        var changed_text = data.plotDict.changed_text
                    }
                    catch (err) {
                        var changed_text = []

                    }
                    myPlot.on('plotly_afterplot', function () {
                        Plotly.d3.selectAll(".xaxislayer-above").selectAll('text')
                            .on("click", function (d) {
                                 // console.log(d)
                                var labels = tester.data[0].x
                                var position = d.x
                                var text = d.text
                                var labeleditvalue = document.getElementById(id13).value;

                                var dict = {}
                                dict[text] = labeleditvalue
                                changed_text.push(dict)
                                labels[position] = labeleditvalue;
                                 // console.log(position)
                                 // console.log(labels)

                                var update = { "x": [labels] };

                                Plotly.restyle(tester, update)
                                $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                                $(`#${id6}`).attr("data-changed_text", JSON.stringify(changed_text))
                                 // console.log(changed_text)

                            });
                    });
                    document.getElementById(id18).onclick = function () {
                         // console.log(x_axisdata2)
                         // console.log(data)
                        var update = { "x": [JSON.parse(JSON.stringify(x_axisdata2))] }
                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }
                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }
                             // console.log(graph_height)
                             // console.log(graph_width)

                            Plotly.relayout(tester, layout)
                            $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                        },
                    });
                }
                if (graph_subtype == 'Vertical_Bar_Stacked') {
                    var x_axis = data.x_axis
                    var y_axis = data.y_axis
                    var second_column = data.second_column


                    var outermodalCard = $(`

<div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
right: 0 ;top : 10px;z-index: 1050">


  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
      <button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <label style="font-size:1.1rem">Change the graph color:</label>
  <input type="color" id=${id1} name="favcolor" value="#b8860b"><br><br>
  <label style="font-size:1.1rem">Change the color or an element:</label>
  <input type="color" id=${id4} name="favcolor1" value="#b8860b"><br><br><label style="font-size:1.1rem">Change X and Y axis gridlines:</label>
      <button type="button" class="btn btn-primary" id="${id9}" data-toggle="button" role="tab"
                      aria-pressed="false" autocomplete="off" value="show_gridlines" style="line-height: 0.7;">Show Gridlines</button><br><br>
                      <label style="font-size:1.1rem">Change the range of the axis:</label>
  <input type="text" placeholder="Y Axis Start" id=${id2} size="7">
  <input type="text" placeholder="Y Axis End " id=${id3} size="7">
<br><br>
<label style="font-size:1.1rem">Change the title of the axes:</label>
    <input type="text" placeholder="X Axis Title" id=${id11} size="7">
    <br><br>
    <label style="font-size:1.1rem">Change the legend labels:</label>
  <input type="text" placeholder=${y_axis} id=${id14} size="7">
  <input type="text" placeholder=${second_column} id=${id15} size="7">
  <br><br>
<label style="font-size:1.1rem">Change the label of an element:</label><br>
    <input type="text" placeholder="X Axis Label" id=${id13} size="9"> &nbsp;&nbsp;
    <button type="button" class="btn btn-primary" id="${id18}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" style="line-height: 1.1;">Reset Axis Labels</button><br><br>
                        <label style="font-size:1.1rem">Change Plot Labels:</label>
        <button type="button" class="btn btn-primary" id="${id_labels}" data-toggle="button" role="tab"
                        aria-pressed="false" autocomplete="off" value="show_labels" style="line-height: 1.1;">Show Labels</button>
  </div>
</div>
`)
                    if (data.plotDict === undefined) {

                        outerCard.appendTo('#card')
                        var tab_id = 'main_page'
                                    outermodalCard.appendTo('#card')

                        var colorlength = data.x_axisdata.length
                        var colordata = [];

                        var colordatasecond = [];
                        var x_axisdata2 = JSON.parse(JSON.stringify(data.x_axisdata))

                        for (var i = 0; i < colorlength; i++) {
                            colordata.push('#b8860b');
                        }
                        for (var i = 0; i < colorlength; i++) {
                            colordatasecond.push('goldenrod');
                        }
                         // console.log(colordata)
                        var trace1 = {
                            x: data.x_axisdata,
                            y: data.y_axisdata,
                            type: 'bar',
                            marker: {
                                color: colordata
                            },
                            name: y_axis
                        };

                        var trace2 = {
                            x: data.x_axisdata,
                            y: data.second_columndata,
                            type: 'bar',
                            marker: {
                                color: colordatasecond,
                            },
                            name: second_column

                        };
                        var dataplot = [trace1, trace2]
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)

                        var layout = {
                            barmode: 'stack',
                            hovermode: 'closest',
                            margin: { l: 40, r: 0, b: 20, t: 10, pad: 4 },
                            yaxis: {
                                showgrid: false, 'automargin': true, font: {
                                    family: "Arial"
                                }
                            },
                            xaxis: {
                                title: {
                                    standoff: 20,
                                    text: x_axis, font: {
                                        family: "Arial"
                                    }
                                },
                                showgrid: false, 'automargin': true, font: {
                                    family: "Arial"
                                }
                            },
                        }
                    }
                    else {
                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tab_id = data.plotDict.tab_id
                                               outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)
                        var dataplot = data.plotDict.data
                        dataplot[0].x = data.x_axisdata
                        dataplot[0].y = data.y_axisdata
                        dataplot[1].x = data.x_axisdata
                        dataplot[1].y = data.second_columndata
                        delete dataplot[1]["selectedpoints"]
                        delete dataplot[0]["selectedpoints"]
                        var layout = data.plotDict.layout

                        var width = width.split("p")
                        var height = height.split("p")

                        var graph_height = height[0] * 0.876
                        var graph_width = width[0] * 0.9481

                        layout["height"] = graph_height
                        layout["width"] = graph_width

                         // console.log(layout)
                        var colorlength = data.x_axisdata.length
                    }
                    var config = { responsive: true, displaylogo: false }

                    Plotly.newPlot(tester, dataplot, layout, config)
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})
                    var y_axis_end = tester.layout.yaxis.range[1]
                    var y_axis_start = tester.layout.yaxis.range[0]

                     // console.log(tester.layout)


                    document.getElementById(id1).onchange = function () {
                        var colorlength = data.x_axisdata.length

                        var colordata2 = [];
                        var colordata3 = [];

                        var backRGB = this.value;

                        const hexToRgb = hex =>
                            hex.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i
                                , (m, r, g, b) => '#' + r + r + g + g + b + b)
                                .substring(1).match(/.{2}/g)
                                .map(x => parseInt(x, 16))
                        var r = hexToRgb(backRGB)[0] * 0.9
                        var g = hexToRgb(backRGB)[1] * 0.9
                        var b = hexToRgb(backRGB)[2] * 0.9

                        function rgb2hex(red, green, blue) {
                            var rgb = blue | (green << 8) | (red << 16);
                            return '#' + (0x1000000 + rgb).toString(16).slice(1)
                        }
                        var newcolor = rgb2hex(r, g, b)

                        for (var i = 0; i < colorlength; i++) {
                            colordata2.push(backRGB);
                        }
                        for (var i = 0; i < colorlength; i++) {
                            colordata3.push(newcolor);
                        }
                        var update = { 'marker': { color: colordata2 } };
                        var update2 = { 'marker': { color: colordata3 } };


                        Plotly.restyle(tester, update, [0])
                        Plotly.restyle(tester, update2, [1])
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }
                    document.getElementById(id_labels).onclick = function () {
                        var labelsvalue = document.getElementById(id_labels).value

                        if (labelsvalue == "show_labels") {
                            var y_axisdata = tester.data[0].y
                            var y_axisdata2 = tester.data[1].y
                             // console.log(y_axisdata)
                            y_axisdata = y_axisdata.map(function(each_element){
                                return Number(each_element.toFixed(2));
                            });
                            y_axisdata2 = y_axisdata2.map(function(each_element){
                                return Number(each_element.toFixed(2));
                            });
                             // console.log(y_axisdata)
                            var update = tester.data
                            update[0]['text'] = y_axisdata.map(String),
                            update[0]['textposition'] = 'inside'
                            update[1]['text'] = y_axisdata2.map(String),
                            update[1]['textposition'] = 'inside'

                            document.getElementById(id_labels).value = "hide_labels"
                            document.getElementById(id_labels).innerHTML = "Hide Labels"
                        }
                        if (labelsvalue == "hide_labels") {
                            var update = tester.data
                             // console.log(update)
                            delete update[0]["text"]
                            delete update[0]["textposition"]
                            delete update[1]["text"]
                            delete update[1]["textposition"]
                            document.getElementById(id_labels).value = "show_labels"
                            document.getElementById(id_labels).innerHTML = "Show Labels"
                        }
                         // console.log(update)
                        Plotly.redraw(tester, update)
                         // console.log(tester.data)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))
                    };
                    document.getElementById(id2).onchange = function () {
                        var textbox2length = document.getElementById(id3).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var y_axis_end = tester.layout.yaxis.range[1]
                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(textbox2length)
                         // console.log(y_axis_end)

                        if (textbox2length == 0) {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, y_axis_end], showgrid: gridlines_value, automargin: true
                                }
                            }
                        }
                        else {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id3).onchange = function () {
                        var textbox1length = document.getElementById(id2).value.length;
                        var textbox2value = document.getElementById(id3).value;
                        var textbox1value = document.getElementById(id2).value;
                        var y_axis_start = tester.layout.yaxis.range[0]
                        var gridlines_value = tester.layout.yaxis.showgrid
                         // console.log(gridlines_value)

                        if (textbox1length == 0) {
                            var layout = {
                                yaxis: {
                                    range: [y_axis_start, textbox2value], showgrid: gridlines_value, automargin: true
                                }
                            }
                        }
                        else {
                            var layout = {
                                yaxis: {
                                    range: [textbox1value, textbox2value], showgrid: gridlines_value, automargin: true
                                }
                            }
                        };
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    myPlot.on('plotly_click', function (data) {
                         // console.log(tester.data)

                         // console.log(data.points[0].x)
                         // console.log(data.points)

                        var pn = '',
                            tn = '',
                            colors = [];
                        for (var i = 0; i < data.points.length; i++) {
                            pn = data.points[i].pointNumber;
                            tn = data.points[i].curveNumber;
                            colors = data.points[i].data.marker.color;
                        };
                         // console.log(colors)

                        var color = document.getElementById(id4).value
                        colors[pn] = color;
                         // console.log(pn)
                         // console.log(tn)
                         // console.log(colors)
                        var update = { 'marker': { color: colors } };
                        Plotly.restyle(tester, update, [tn])
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    });

                    document.getElementById(id9).onclick = function () {
                        var gridlinesvalue = document.getElementById(id9).value
                         // console.log(gridlinesvalue)
                        var x_axis_title = tester.layout.xaxis.title.text

                        if (gridlinesvalue == "show_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    showgrid: true, automargin: true
                                }, xaxis: {
                                    showgrid: true, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "hide_gridlines"
                            document.getElementById(id9).innerHTML = "Hide Gridlines"
                        }
                        if (gridlinesvalue == "hide_gridlines") {
                            var layout2 = {
                                yaxis: {
                                    showgrid: false, automargin: true
                                }, xaxis: {
                                    showgrid: false, automargin: true, title: {
                                        standoff: 20,
                                        text: x_axis_title, font: {
                                            family: "Arial"
                                        }
                                    }
                                }
                            };
                            document.getElementById(id9).value = "show_gridlines"
                            document.getElementById(id9).innerHTML = "Show Gridlines"

                        }
                        Plotly.relayout(tester, layout2)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    };
                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id
                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };
                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };


                    document.getElementById(id11).onchange = function () {
                        var xaxistitlevalue = document.getElementById(id11).value;

                        var gridlines_value = tester.layout.yaxis.showgrid

                         // console.log(xaxistitlevalue)
                         // console.log(tester.layout.xaxis.title)

                        var layout = {
                            xaxis: {
                                showgrid: gridlines_value, automargin: true, title: {
                                    standoff: 20,
                                    text: xaxistitlevalue, font: {
                                        family: "Arial"
                                    }
                                }
                            }


                        }
                        Plotly.relayout(tester, layout)
                        $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                    }
                    document.getElementById(id14).onchange = function () {
                        var legendvalue1 = document.getElementById(id14).value;
                        var update = { name: legendvalue1 }

                        Plotly.restyle(tester, update, 0)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }
                    document.getElementById(id15).onchange = function () {
                        var legendvalue2 = document.getElementById(id15).value;
                        var update = { name: legendvalue2 }

                        Plotly.restyle(tester, update, 1)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }

                    try {
                        var changed_text = data.plotDict.changed_text
                    }
                    catch (err) {
                        var changed_text = []

                    }
                    myPlot.on('plotly_afterplot', function () {
                         // console.log(tester.data)
                        Plotly.d3.selectAll(".xaxislayer-above").selectAll('text')
                            .on("click", function (d) {
                                 // console.log(tester.data)
                                 // console.log(d)
                                var position = d.x
                                var text = d.text
                                var labels = tester.data[0].x

                                var labeleditvalue = document.getElementById(id13).value;

                                var dict = {}
                                dict[text] = labeleditvalue
                                changed_text.push(dict)
                                labels[position] = labeleditvalue;
                                 // console.log(position)
                                 // console.log(labels)

                                var update = { "x": [labels] };

                                Plotly.restyle(tester, update)
                                $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                                $(`#${id6}`).attr("data-changed_text", JSON.stringify(changed_text))
                                 // console.log(changed_text)

                            });
                    });
                    document.getElementById(id18).onclick = function () {
                         // console.log(x_axisdata2)
                         // console.log(data)
                        var update = { "x": [JSON.parse(JSON.stringify(x_axisdata2))] }
                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }

                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }
                             // console.log(graph_height)
                             // console.log(graph_width)

                            Plotly.relayout(tester, layout)
                            $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                        },
                    });
                    myPlot.on('plotly_selected', function(data){
                        try {
                        points_array = data.points

                         // console.log(points_array)

                        var points = []
                        for(let i = 0; i < points_array.length; i++){
                            points.push(points_array[i].label)
                            }
                         // console.log(points)
                        var unique = points.filter((v, i, a) => a.indexOf(v) === i);
                         // console.log(unique)
                        var crossfilterdict = { 'points':unique,'id':chartDivId}
                        crossfilter_function(crossfilterdict)
                        }
                        catch(err){
                                ;
                        }
                        })
                    myPlot.on('plotly_deselect', function(){
                        //  // console.log('hi')
                        // var CLICK_TIME = Date.now()

                        // if(CLICK_TIME - LAST_CLICK < 10000) {
                        var resetdict = {'id':chartDivId}
                        reset_function(resetdict)
                        // } else {
                        //     LAST_CLICK = CLICK_TIME
                        //      // console.log('single click')
                        // }


                    })
                }
                if (graph_subtype == 'Angular_Gauge') {
                    var x_axis = data.x_axis
                    var y_axis = data.y_axis
                    var second_column = data.second_column


                    var outermodalCard = $(`

<div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
right: 0 ;top : 10px;z-index: 1050">


  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
      <button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <label style="font-size:1.1rem">Change the graph color:</label>
  <input type="color" id=${id1} name="favcolor" value="#b8860b"><br><br>
  </div>
</div>
`)
                    if (data.plotDict === undefined) {

                        outerCard.appendTo('#card')
                        var tab_id = 'main_page'
                                    outermodalCard.appendTo('#card');
                        var trace1 = {
                            value: data.value,
                            title: { text: y_axis + "-" + data.second_column },
                            type: "indicator",
                            mode: "gauge+number",
                            gauge: { axis: { range: [null, data.value * 1.1] }, bar: { color: "var(--primary-color)" } },
                        }
                        var dataplot = [trace1]

                        var layout = {
                            margin: { l: 0, r: 0, b: 0, t: 20, pad: 1 },
                        }

                        var tester = document.getElementById(id)
                    }
                    else {
                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tab_id = data.plotDict.tab_id
                                               outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)
                        var dataplot = data.plotDict.data
                        dataplot[0].title = { text: data.y_axis + "-" + data.second_column }
                        dataplot[0].value = data.value
                        dataplot[0].gauge.axis.range = [null, data.value * 1.1]

                        var layout = data.plotDict.layout

                        var width = width.split("p")
                        var height = height.split("p")

                        var graph_height = height[0] * 0.876
                        var graph_width = width[0] * 0.9481

                        layout["height"] = graph_height
                        layout["width"] = graph_width

                         // console.log(layout)
                    }
                    var config = { responsive: true, displaylogo: false }

                    Plotly.newPlot(tester, dataplot, layout, config);
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})

                     // console.log(data)

                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };
                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id
                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };

                    document.getElementById(id1).onchange = function () {

                        var backRGB = this.value;
                        var update = { gauge: { axis: { range: [null, data.value * 1.1] }, bar: { color: backRGB } } }

                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }
                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }
                             // console.log(graph_height)
                             // console.log(graph_width)

                            Plotly.relayout(tester, layout)
                            $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                        },
                    });
                }
                if (graph_subtype == 'Bullet_Gauge') {
                    var x_axis = data.x_axis
                    var y_axis = data.y_axis
                    var second_column = data.second_column
                    var title = y_axis + "-" + data.second_column


                    var outermodalCard = $(`

<div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
right: 0 ;top : 10px;z-index: 1050">


  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
      <button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <label style="font-size:1.1rem">Change the graph color:</label>
  <input type="color" id=${id1} name="favcolor" value="#b8860b"><br><br>
  </div>
</div>
`)
                    if (data.plotDict === undefined) {

                        outerCard.appendTo('#card')
                        var tab_id = 'main_page'
                        outermodalCard.appendTo('#card');
                        var trace1 = {
                            value: data.value,
                            type: "indicator",
                            mode: "number+gauge",
                            gauge: { axis: { range: [null, data.value * 1.1] }, bar: { color: "var(--primary-color)" }, shape: "bullet" },
                        }
                        var dataplot = [trace1]

                        var layout = {
                            margin: { l: 60, r: 0, b: 0, t: 20, pad: 1 },
                        }
                        var tester = document.getElementById(id)
                    }
                    else {
                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tab_id = data.plotDict.tab_id
                                               outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tester = document.getElementById(id)
                        var myPlot = document.getElementById(id)
                        var dataplot = data.plotDict.data
                        dataplot[0].value = data.value
                        dataplot[0].gauge.axis.range = [null, data.value * 1.1]

                        var layout = data.plotDict.layout

                        var width = width.split("p")
                        var height = height.split("p")

                        var graph_height = height[0] * 0.876
                        var graph_width = width[0] * 0.9481

                        layout["height"] = graph_height
                        layout["width"] = graph_width

                         // console.log(layout)

                    }
                    var config = { responsive: true, displaylogo: false }

                    Plotly.newPlot(tester, dataplot, layout, config);
                    crossFilterlist.push({'id':chartDivId,'tester':tester,'graph_subtype':graph_subtype})

                     // console.log(data)

                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = modalid.offsetTop + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };

                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id
                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };

                    document.getElementById(id1).onchange = function () {

                        var backRGB = this.value;
                        var update = { gauge: { axis: { range: [null, data.value * 1.1] }, shape: "bullet", bar: { color: backRGB } } }

                        Plotly.restyle(tester, update)
                        $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))

                    }
                    $(`#${id6}`).resizable({
                        start: function (event, size) {
                            var classname = document.getElementById(id6).className
                             // console.log(classname)
                            document.getElementById(id6).className = "charts ui-resizable ui-draggable ui-resizable-resizing"
                        },
                        stop: function (event, size) {
                            var graph_height = size.size.height * 0.876
                            var graph_width = size.size.width * 0.9481
                            var layout = { 'height': graph_height, 'width': graph_width }
                             // console.log(graph_height)
                             // console.log(graph_width)

                            Plotly.relayout(tester, layout)
                            $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))

                        },
                    });
                }
                if (graph_subtype == "Nested_Table") {
                        outerCard.appendTo('#card')
                        var tab_id = 'main_page'
                        // outermodalCard.appendTo('#card');
                        groupStartOpen = []
                        for(let i = 0; i < data.y_axisdata.length; i++){
                            groupStartOpen.push(false)
                        }
                        columns = []
                        for(let i = 0; i < data.headers.length; i++){
                            columns.push({title:data.headers[i], field:data.headers[i],headerFilter:"input"})
                        }
                        console.log(columns)
                        var table = new Tabulator(`#${id}`, {
                                data:data.x_axisdata,             //load row data from array
                                layout:"fitColumns",      //fit columns to width of table
                                height:300,       //allow row order to be changed
                                // width:1000,
                                virtualDom:true,
                                // paginationSize:20,
                                groupBy:data.y_axisdata,
                                groupStartOpen:groupStartOpen,
                                groupToggleElement:"header",
                            //     groupHeader:[
                            //     function(value, count, data){ //generate header contents for gender groups
                            //         return value + "<span style='color:black'>(" + count + " items)</span>";
                            //     },
                            //     function(value, count, data){ //generate header contents for color groups
                            //         return value + "<span style='color:black'>(" + count + " items)</span>";
                            //     },
                            // ],
                                // pagination:"local", // send parameters to the server as a JSON encoded string   //allow row order to be changed
                                columns:columns
                            });

                }
                if (graph_subtype == "Aggregation") {
                    if (data.plotDict === undefined) {

                        // var outputVal = data.output;
                        // chartClass=plotDict.x+plotDict.y
                        var outercard = $(`<div class="col-3 draggable_charts datacards" style="height:6rem;background-color:#ffc107" id=${id6} data-modalClass="${id7}">
<div class="d-flex justify-content-between">

    </div> <!-- flex -->
            <!-- small box -->
            <div class="small-box">
                <div class="row">
                <div class="col-md-8" style="padding-top: 1rem">
                <h1 id = ${id11}>${data.value}</h1>
                <p class="draggable_div" id = ${id12} style="color: #212529;"><span class="contentEditable">${data.title}</span> </p>
              </div>
              <div class="col-md-2" style="padding-top: 1rem;padding-left: 1.6rem;">

                <i class="fa fa-bar-chart" id = ${id4} style="font-size:2.5rem;color:goldenrod;padding-top: 1.1rem;"></i>
                </div>
                <div class = "col-md-2" style="padding-left: 2rem;padding-top: 0.5rem"">
    <div class="dropdown">
        <i class="fa fa-cog" style="font-size:20px"></i>
<div class="dropdown-content" style="right: 0rem; top: 1.5rem">
<div class="row" id=${id8} style="font-size:1rem; padding-left:0.95rem"> <button type="button" style="border-width:0px;padding: 1px 1px;background-color: white;"> &nbsp; <i class="fa fa-edit fa-lg"  style="font-size:1.3rem;padding-top: 0.1rem;color:var(--primary-color)"></i> Configure</button></div>
<div class="row handle_for_draggable_charts" style="font-size:1rem; padding-left:0.8rem">&nbsp; <i class="fa fa-arrows fa-lg" style="font-size:1.2rem ; padding-top: 0.3rem; color:var(--primary-color)"></i>&nbsp; Move</div>
<div class="row" id=${id5} style="font-size:1rem; padding-left:1rem"><button type="button" style="border-width:0px;padding: 1px 1px;background-color: white;"> &nbsp;<i class="fa fa-times fa-lg"  style="font-size:1.4rem;color:var(--primary-color)"></i>&nbsp; Delete</button></div>
<div class="row" id=${id16} style="font-size:1rem; padding-left:1.3rem"><div class="dropdown2-tab"><button type="button" style="border-width:0px;padding: 1px 1px;background-color: white;"> <i class="fa fa-copy fa-lg" style="font-size:1.2rem;color:var(--primary-color)"></i>&nbsp; Copy </button>  <div class="dropdown2-content-tab" id = ${id17} style="right: 8rem; top: 0rem; display:none; z-index:1100; min-width: 80px;">
<div class="row" style="padding-left:2rem"><button type="button" class="analysisDashboardmove" data-plotClass="${id6}" data-modalClass="${id7}" data-tab='Tab1' style="border-width:0px;padding: 1px 1px">Tab 1</button></div> <div class="row" style="padding-left:2rem"><button type="button" class="analysisDashboardmove" data-tab='Tab2' data-plotClass="${id6}" data-modalClass="${id7}" style="border-width:0px;padding: 1px 1px">Tab 2</button> </div><div class="row" style="padding-left:2rem"><button type="button" class="analysisDashboardmove" data-plotClass="${id6}" data-modalClass="${id7}" data-tab='Tab3' style="border-width:0px;padding: 1px 1px">Tab 3</button></div>
</div>
</div></div></div></div>
              </div>
            </div>
          </div></div>`)

                    }

                    else {
                        var width = data.plotDict.width + "px"
                        var height = data.plotDict.height + "px"
                        var styletop = data.plotDict.position.top + "px"
                        var left = data.plotDict.position.left + "px"
                        var backgroundcolor = data.plotDict.backgroundcolor
                        var titlefontsize = data.plotDict.titlefontsize + "px"
                        var valuefontsize = data.plotDict.valuefontsize + "px"
                         // console.log(plotDict)

                        rgb = backgroundcolor.substring(4, backgroundcolor.length - 1)
                            .replace(/ /g, '')
                            .split(',');
                        var r = (rgb)[0] * 0.8
                        var g = (rgb)[1] * 0.8
                        var b = (rgb)[2] * 0.8

                        function rgb2hex(red, green, blue) {
                            var rgb = blue | (green << 8) | (red << 16);
                            return '#' + (0x1000000 + rgb).toString(16).slice(1)
                        }
                        var newcolor = rgb2hex(r, g, b)
                         // console.log(newcolor)

                         // console.log(rgb)
                         // console.log(backgroundcolor)
                         // console.log(valuefontsize)
                         // console.log(titlefontsize)

                        var outercard = $(`<div class="col-3 draggable_charts datacards" style="position:absolute;width:${width};height:${height};top:${styletop};left:${left};background-color:${backgroundcolor}" id=${id6} data-modalClass="${id7}">
<div class="d-flex justify-content-between">

    </div> <!-- flex -->
            <!-- small box -->
            <div class="small-box">
                <div class="row">
                <div class="col-md-8" style="padding-top: 1rem">
                <h1 style="font-size:${valuefontsize}" id = ${id11}>${data.value}</h1>
                <p class="draggable_div" id = ${id12} style="color: #212529;font-size:${titlefontsize}"><span class="contentEditable">${data.title}</span> </p>
              </div>
              <div class="col-md-2" style="padding-top: 1rem;padding-left: 1.6rem;">

                <i class="fa fa-bar-chart" id = ${id4} style="font-size:2.5rem;color:${newcolor};padding-top: 1.1rem;"></i>
                </div>
                <div class = "col-md-2" style="padding-left: 2rem;padding-top: 0.5rem"">
    <div class="dropdown">
        <i class="fa fa-cog" style="font-size:20px"></i>
<div class="dropdown-content" style="right: 0rem; top: 1.5rem">
<div class="row" id=${id8} style="font-size:1rem; padding-left:0.95rem"> <button type="button" style="border-width:0px;padding: 1px 1px;background-color: white;"> &nbsp; <i class="fa fa-edit fa-lg"  style="font-size:1.3rem;padding-top: 0.1rem;color:var(--primary-color)"></i> Configure</button></div>
<div class="row handle_for_draggable_charts" style="font-size:1rem; padding-left:0.8rem">&nbsp; <i class="fa fa-arrows fa-lg" style="font-size:1.2rem ; padding-top: 0.3rem; color:var(--primary-color)"></i>&nbsp; Move</div>
<div class="row" id=${id5} style="font-size:1rem; padding-left:1rem"><button type="button" style="border-width:0px;padding: 1px 1px;background-color: white;"> &nbsp;<i class="fa fa-times fa-lg"  style="font-size:1.4rem;color:var(--primary-color)"></i>&nbsp; Delete</button></div>
<div class="row" id=${id16} style="font-size:1rem; padding-left:1.3rem"><div class="dropdown2-tab"><button type="button" style="border-width:0px;padding: 1px 1px;background-color: white;"> <i class="fa fa-copy fa-lg" style="font-size:1.2rem;color:var(--primary-color)"></i>&nbsp; Copy </button>  <div class="dropdown2-content-tab" id = ${id17} style="right: 8rem; top: 0rem; display:none; z-index:1100; min-width: 80px;">
<div class="row" style="padding-left:2rem"><button type="button" class="analysisDashboardmove" data-plotClass="${id6}" data-modalClass="${id7}" data-tab='Tab1' style="border-width:0px;padding: 1px 1px">Tab 1</button></div> <div class="row" style="padding-left:2rem"><button type="button" class="analysisDashboardmove" data-tab='Tab2' data-plotClass="${id6}" data-modalClass="${id7}" style="border-width:0px;padding: 1px 1px">Tab 2</button> </div><div class="row" style="padding-left:2rem"><button type="button" class="analysisDashboardmove" data-plotClass="${id6}" data-modalClass="${id7}" data-tab='Tab3' style="border-width:0px;padding: 1px 1px">Tab 3</button></div>
</div>
</div></div></div></div>
              </div>
            </div>
          </div></div>`)

                    }
                    var outermodalCard = $(`

<div class="modal-dialog modalgraphs modal-full-height modal-right" id=${id7} role="document" style="display:none;float:right;  position: absolute;
right: 0 ;top : 10px;z-index: 1050">


  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title w-100" id="myModalLabel">Configure</h4>
      <button type="button" class="close" data-dismiss="modal" id=${id10} aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <label style="font-size:1.1rem">Change the card color:</label>
  <input type="color" id=${id1} name="favcolor" value="#b8860b">
<br><br>
  <label style="font-size:1.1rem">Change the size of the font:</label>
  <input type="text" placeholder="value" id=${id2} size="7">
  <input type="text" placeholder="category" id=${id3} size="7">
  <br><br>

  <label style="font-size:1.1rem">Choose value unit:</label>
  <select name="cars" id=${id18} datavalue = ${data.value} style="font-size:1.1rem">
    <option value="Units">Units</option>
    <option value="Hundreds">Hundreds</option>
    <option value="Thousands">Thousands</option>
    <option value="Millions">Millions</option>
    <option value="Billions">Billions</option>
  </select>
  </div>
</div>
`)
                    if (data.plotDict === undefined) {

                        outerCard.appendTo('#card')
                        var tab_id = 'main_page'
                                              outermodalCard.appendTo('#card');
                    }
                    else {
                        outerCard.appendTo(`#${data.plotDict.tab_id}`)
                        var tab_id = data.plotDict.tab_id
                                               outermodalCard.appendTo(`#${data.plotDict.tab_id}`)
                    }

                     // console.log(document.getElementById(id1))
                    document.getElementById(id1).onchange = function () {
                        var backRGB = this.value;

                        const hexToRgb = hex =>
                            hex.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i
                                , (m, r, g, b) => '#' + r + r + g + g + b + b)
                                .substring(1).match(/.{2}/g)
                                .map(x => parseInt(x, 16))
                        var r = hexToRgb(backRGB)[0] * 0.8
                        var g = hexToRgb(backRGB)[1] * 0.8
                        var b = hexToRgb(backRGB)[2] * 0.8

                        function rgb2hex(red, green, blue) {
                            var rgb = blue | (green << 8) | (red << 16);
                            return '#' + (0x1000000 + rgb).toString(16).slice(1)
                        }
                        var newcolor = rgb2hex(r, g, b)
                        document.getElementById(id6).style.backgroundColor = backRGB
                        document.getElementById(id4).style.color = newcolor
                    }
                    document.getElementById(id2).onchange = function () {
                        var fontsizetitle = document.getElementById(id2).value;
                        document.getElementById(id11).style.fontSize = fontsizetitle + "px"
                    }
                    document.getElementById(id3).onchange = function () {
                        var fontsizebody = document.getElementById(id3).value;
                        document.getElementById(id12).style.fontSize = fontsizebody + "px"
                    }
                    document.getElementById(id18).onchange = function () {
                        var selectValue = document.getElementById(id18).value
                        var outputValue = $(this).attr('datavalue');
                         // console.log(selectValue)
                         // console.log(outputValue)

                        if (selectValue == 'Units') {
                            var changedOuputValue = (outputValue / 1)
                            document.getElementById(id11).innerHTML = changedOuputValue
                        }
                        if (selectValue == 'Hundreds') {
                            var changedOuputValue = (outputValue / 100).toFixed(2) + "H"
                            document.getElementById(id11).innerHTML = changedOuputValue
                        }
                        if (selectValue == 'Thousands') {
                            var changedOuputValue = (outputValue / 1000).toFixed(2) + "K"
                            document.getElementById(id11).innerHTML = changedOuputValue
                        }
                        if (selectValue == 'Millions') {
                            var changedOuputValue = (outputValue / 1000000).toFixed(2) + "M"
                            document.getElementById(id11).innerHTML = changedOuputValue
                        }
                        if (selectValue == 'Billions') {
                            var changedOuputValue = (outputValue / 1000000000).toFixed(2) + "B"
                            document.getElementById(id11).innerHTML = changedOuputValue
                        }
                    }

                    document.getElementById(id5).onclick = function () {
                        var maindiv = document.getElementById(id5).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id
                         // console.log(maindiv)
                        document.getElementById(maindiv).remove();
                    };
                    document.getElementById(id10).onclick = function () {
                        var modaldiv = document.getElementById(id10).parentElement.parentElement.parentElement.id
                         // console.log(modaldiv)
                        document.getElementById(modaldiv).style.display = "none"
                        $('.charts').each(function () {

                            $(this).css('opacity', '')
                        })
                    };
                    document.getElementById(id8).onclick = function () {

                        var modalid = document.getElementById(id6)
                         // console.log(modalid)

                        var offset = (modalid.offsetTop) + `px`;
                         // console.log(offset)

                        var offsetvalue = document.getElementById(id7).style.top

                        document.getElementById(id7).style.top = offset
                         // console.log(offsetvalue)
                         // console.log(document.getElementById(id7).style)

                        var displayvalue = document.getElementById(id7).style.display
                         // console.log(displayvalue)
                        if (displayvalue == "none") {
                            document.getElementById(id7).style.display = "block";

                            $('.charts').each(function () {
                                if ($(this).attr('id') != `${id6}`) {
                                    $(this).css('opacity', '0.5')
                                }
                            })
                        }
                        else {
                            document.getElementById(id7).style.display = "none"
                            $('.charts').each(function () {

                                $(this).css('opacity', '')
                            })
                        }
                    };
                    $(`#${id6}`).each(function () {
                        $(this).resizable({
                            start: function (event, size) {
                                var classname = document.getElementById(id6).className
                                 // console.log(classname)
                                document.getElementById(id6).className = "datacards draggable_charts ui-resizable ui-draggable ui-resizable-resizing"
                            },
                            stop: function (event, size) {

                                var logo_size = size.size.width * size.size.height * 0.0012 * 0.7
                                var configure_padding_left = size.size.width * size.size.height * 0.000768 * 0.4
                                 // console.log(document.getElementById(id4).style.fontSize)

                                document.getElementById(id4).style.fontSize = logo_size + "px"
                                 // console.log(document.getElementById(id8).parentElement.parentElement.parentElement)
                                document.getElementById(id8).parentElement.parentElement.parentElement.style.paddingLeft = configure_padding_left + "px"
                                 // console.log(document.getElementById(id4).style.fontSize)
                            },
                        });
                    });
                }
                if (graph_subtype == "Aggregation") {
                    $(`#${id6}`).attr("data-id", id)
                    $(`#${id6}`).attr("data-subtype", graph_subtype)
                    $(`#${id6}`).attr("data-data", data.value)
                    $(`#${id6}`).attr("data-layout", data.title)
                    $(`#${id6}`).attr("data-entity", entity)
                    $(`#${id6}`).attr("data-date", date)
                    $(`#${id6}`).attr("data-model", model)
                    $(`#${id6}`).attr("data-xaxis", x_axis)
                    $(`#${id6}`).attr("data-yaxis", y_axis)
                    $(`#${id6}`).attr("data-secondcolumn", second_column)
                    $(`#${id6}`).attr("data-operation", operation)
                }
                if (graph_subtype == "Nested_Table") {
                    $(`#${id6}`).attr("data-id", id)
                    $(`#${id6}`).attr("data-subtype", graph_subtype)
                    $(`#${id6}`).attr("data-xaxis", JSON.stringify(x_axis))
                    $(`#${id6}`).attr("data-yaxis", JSON.stringify(y_axis))
                }
                else {
                    $(`#${id6}`).attr("data-layout", JSON.stringify(tester.layout))
                    $(`#${id6}`).attr("data-data", JSON.stringify(tester.data))
                    $(`#${id6}`).attr("data-id", id)
                    $(`#${id6}`).attr("data-subtype", graph_subtype)
                    $(`#${id6}`).attr("data-xaxis", x_axis)
                    $(`#${id6}`).attr("data-yaxis", y_axis)
                    $(`#${id6}`).attr("data-entity", entity)
                    $(`#${id6}`).attr("data-date", date)
                    $(`#${id6}`).attr("data-model", model)
                    try {
                        var changed_text = data.plotDict.changed_text
                    }
                    catch (err) {
                        var changed_text = []

                    }
                    $(`#${id6}`).attr("data-changed_text", JSON.stringify(changed_text))
                    if (second_column == undefined) {
                        $(`#${id6}`).attr("data-secondcolumn", "None")
                    }
                    else {
                        $(`#${id6}`).attr("data-secondcolumn", second_column)

                    }
                    if (operation == undefined) {
                        $(`#${id6}`).attr("data-operation", "None")
                    }
                    else {
                        $(`#${id6}`).attr("data-operation", operation)

                    }
                    $(`#${id6}`).attr("data-entity", entity)
                    $(`#${id6}`).attr("data-date", date)
                    $(`#${id6}`).attr("data-model", model)
                     // console.log(data)
                }

                $('.datacards').draggable({
                    containment: "parent",
                    handle: ".handle_for_draggable_charts",
                    opacity: 0.5
                })
                $('.charts').draggable({
                    containment: "parent",
                    handle: ".handle_for_draggable_charts",
                    opacity: 0.5
                })
                $('.draggable_div').draggable({
                    containment: "parent",
                    opacity: 0.5
                })
                // $('#btnsave').on('click', function () {
                //      // console.log(tester.data)
                // })

                // Jquery draggable
                $('.modal-dialog').draggable({
                    handle: ".modal-header"
                });
                $('.contentEditable').each(function () {
                    $(this).on('click', function () {
                        $(this).attr("contenteditable", "true")
                        $(this).focus()
                    })
                    $(this).focusout(function () {
                        $(this).removeAttr("contenteditable")
                    })
                })
                document.getElementById(id16).onclick = function () {
                    $(`#${id17}`).empty()
                    var displayvalue = document.getElementById(id17).style.display
                    $('.tabname').each(function () {
                        tabrowname = ($(this).attr("data-tab"))

                        tablistname = $(this)[0].innerHTML
                        $(`#${id17}`).append($(`<div class="row" style="padding-left:2rem"><button type="button" class="analysisDashboardmove" data-plotClass="${id6}" data-modalClass="${id7}" data-tab="${tabrowname}"" style="border-width:0px;padding: 1px 1px">${tablistname}</button></div>`));
                    })
                    $('.analysisDashboardmove').click(function () {
                        document.getElementById(id17).style.display = "none"
                        plotClassName = $(this).attr('data-plotClass')
                        modalClassName = $(this).attr('data-modalClass')
                        var element = $(this).attr("data-tab")
                         // console.log('plot')
                         // console.log($(`#${element}`))

                        var outercardappend = $(this).parent().parent().parent().parent().parent().parent().parent().parent().parent().parent()
                        var modalcardappend = $(`#${modalClassName}`)

                        outercardappend.appendTo(`#${element}`)
                        modalcardappend.appendTo(`#${element}`)
                        // chartsavedata.push({ "data": tester.data, "layout": tester.layout, "chartid": id, "graph_subtype": graph_subtype, "tab": element, "topposition": document.getElementById(id6).offsetTop, "leftposition": document.getElementById(id6).offsetLeft })
                        //  // console.log(chartsavedata)

                    })
                    document.getElementById(id17).style.display = "block"

                }
                $('.nav-item').click(function () {
                    document.getElementById(id17).style.display = "none"
                })
                document.getElementById(id16).onmouseleave = function () {
                    var displayvalue = document.getElementById(id17).style.display
                    document.getElementById(id17).style.display = "none"
                }
                // $('.analysisDashboardmove').click(function () {
                //     plotClassName = $(this).attr('data-plotClass')
                //     modalClassName = $(this).attr('data-modalClass')
                //     var element = $(this)[0].innerHTML
                //     var outercardappend = $(this).parent().parent().parent().parent().parent().parent().parent().parent().parent().parent()
                //     var modalcardappend = $(`#${modalClassName}`)
                //      // console.log(outercardappend)

                //      // console.log($(this).parent().parent().parent().parent().parent().parent().parent().parent().parent().parent().attr(''))

                //      // console.log("modal")

                //     if (element == "Tab 1") {
                //         outercardappend.appendTo("#analysisrow1")
                //         modalcardappend.appendTo("#analysisrow1")
                //     }
                //     if (element == "Tab 2") {
                //         outercardappend.appendTo("#analysisrow2")
                //         modalcardappend.appendTo("#analysisrow2")
                //     }
                //     if (element == "Tab 3") {
                //         outercardappend.appendTo("#analysisrow3")
                //         modalcardappend.appendTo("#analysisrow3")
                //     }


                //     // chartsavedata.push({ "data": tester.data, "layout": tester.layout, "chartid": id, "graph_subtype": graph_subtype, "tab": element, "topposition": document.getElementById(id6).offsetTop, "leftposition": document.getElementById(id6).offsetLeft })
                //     //  // console.log(chartsavedata)

                // })
            },

            error: function () {
                Swal.fire({icon: 'error',text: 'Error! Please try again.'});
            }
        })
    };
    $('.charts').draggable({
        containment: "parent",
        handle: ".handle_for_draggable_charts",
        opacity: 0.5
    })

    $('.draggable_div').draggable({
        containment: "parent",
        opacity: 0.5
    })
    $('.datacards').draggable({
        containment: "parent",
        handle: ".handle_for_draggable_charts",
        opacity: 0.5
    })

    $('.contentEditable').each(function () {
        $(this).on('click', function () {
            $(this).attr("contenteditable", "true")
            $(this).focus()
        })
        $(this).focusout(function () {
            $(this).removeAttr("contenteditable")
        })
    })

    // Jquery draggable
    $('.modal-dialog').draggable({
        handle: ".modal-header"
    });
    // $('.analysisDashboardmove').click(function () {
    //     plotClassName = $(this).attr('data-plotClass')
    //     modalClassName = $(this).attr('data-modalClass')
    //     var element = $(this)[0].innerHTML
    //     var outercardappend = $(this).parent().parent().parent().parent().parent().parent().parent().parent().parent().parent()
    //     var modalcardappend = $(`#${modalClassName}`)
    //      // console.log(outercardappend)

    //      // console.log($(this).parent().parent().parent().parent().parent().parent().parent().parent().parent().parent().attr(''))

    //      // console.log("modal")

    //     if (element == "Tab 1") {
    //         outercardappend.appendTo("#analysisrow1")
    //         modalcardappend.appendTo("#analysisrow1")
    //     }
    //     if (element == "Tab 2") {
    //         outercardappend.appendTo("#analysisrow2")
    //         modalcardappend.appendTo("#analysisrow2")
    //     }
    //     if (element == "Tab 3") {
    //         outercardappend.appendTo("#analysisrow3")
    //         modalcardappend.appendTo("#analysisrow3")
    //     }


    //     // chartsavedata.push({ "data": tester.data, "layout": tester.layout, "chartid": id, "graph_subtype": graph_subtype, "tab": element, "topposition": document.getElementById(id6).offsetTop, "leftposition": document.getElementById(id6).offsetLeft })
    //     //  // console.log(chartsavedata)

    // })
    $("ul.nav-tabs a").click(function (e) {
        e.preventDefault();
        $(this).tab('show');
    });

    var button = '<button class="close" type="button" title="Remove this page"></button>';


    function resetTab() {
        var tabs = $("#tab-list li:not(:first)");
        var len = 1
        $(tabs).each(function (k, v) {
            len++;
            $(this).find('a').html('Tab ' + len + button);
        })
        tabID--;
    }

    $(document).ready(function () {
        var tabID = $('.navtab').length;

        $('#btn-add-tab').click(function () {
             // console.log(tabID)
             // console.log('hi')
            tabID++;
            $('#tab-list').append($(`<li class="nav-item navtab"><a class="nav-link" id="analysistab${tabID}" href="#tab${tabID}" role="tab" data-toggle="tab" aria-controls="#tab${tabID}" aria-selected="false"><div class="row"><div class="col-md-10" style="padding-right: 0.1rem"><span class="contentEditable tabname" data-tab="analysisrow${tabID}">Tab${tabID}</span></div><div class="col-md-2" style="padding-top: 0.3rem"><div class="dropdown"><i class="fa fa-cog fa-lg" style="font-size:1.2rem"></i><div class="dropdown-content" style="right: 0rem; top: 1.5rem"><div style="height:8px"></div><div class="row" id="saveChartConfigButton${tabID}" data-tab="analysisrow${tabID}" style="font-size:1rem;">
                                    <button type="button"
                                                    style="border-width:0px;padding: 1px 1px;background-color: white;">
                                                    <i class="fa fa-save fa-lg"
                                                        style="font-size:1.3rem;padding-top: 0.1rem;color:var(--primary-color)"></i>
                                                    Save</button></div>
                                                    <div class="row closetab" style="font-size:1rem; padding-left:0.1rem"><button type="button" style="border-width:0px;padding: 1px 1px;background-color: white;"> &nbsp;<i class="fa fa-times fa-lg"  style="font-size:1.4rem;color:var(--primary-color)"></i>&nbsp; Delete</button></div>
                                                    <div class="row" id="${"AddComment" + tabID}" style="font-size:1rem;padding-left:0.1rem"><button type="button" style="border-width:0px;padding: 1px 1px;background-color: white;"> &nbsp;<i class="fa fa-font fa-lg"  style="font-size:1rem;color:var(--primary-color)"></i>Comment</button></div>

                                        </div>
                                    </div>
                                </div>
                            </div></a></li>`));
            $('#tab-content').append($(`<div class="tab-pane fade" id="tab${tabID}" role="tabpanel" aria-labelledby="analysistab${tabID}"><div class="row" style="margin-left: 1rem;"><button id="analysisPDF${tabID}" type="button" class="btn btn-primary">Convert to PDF</button></div><div class="col-lg-12 m-3 row savealltab resizablediv" id="analysisrow${tabID}"></div></div>`));

            $('.contentEditable').each(function () {
                $(this).on('click', function () {
                    $(this).attr("contenteditable", "true")
                    $(this).focus()
                })
                $(this).focusout(function () {
                    $(this).removeAttr("contenteditable")
                })
            })
            $('.resizablediv').resizable({
                handles: 'n, s'
            })
            $(`#${"AddComment" + tabID}`).click(function () {

                var tab_no = ($(this).parent().parent().parent().parent().parent()[0].id).split("b")[1]
                var commentboxid = "analysisrow" + tab_no
                var commentid = $('.commentboxcard').length;
                 // console.log(commentid)
                var commentcardid = "commentcard" + commentid
                var cancelid = "cancelcard" + commentid
                var commentbox = $(`<div class="commentboxcard" style="height:6rem" data-tab="${commentcardid}"><div class="row"><i class="fa fa-times" id="${cancelid}" style="font-size:1rem"></i></div><div><div class="row"><textarea id="${commentcardid}" class="commentbox" rows="4" cols="20" name="comment" form="usrform" style="resize:none;margin:0.5rem"></textarea></div></div></div>`)
                 // console.log(commentbox)

                commentbox.appendTo(`#${commentboxid}`)
                document.getElementById(cancelid).onclick = function () {
                     // console.log(cancelid)
                     // console.log($(this).parent())
                    $(this).parent().parent().remove()
                }
                $(".commentbox").resizable({
                    start: function (event, size) {
                         // console.log($(this).parent()[0].style.height)
                        $(this).parent()[0].style.height = ""
                        $(this).parent()[0].style.position = "absolute"
                    },
                    stop: function (event, size) { cancel: '' }
                });
                $(".commentboxcard").draggable({ cancel: '' });

            })
            $(`#analysisPDF${tabID}`).click(function(){
                    tab_no = $(this)[0].id.split('F')[1]

                    page_section = $(`#analysisrow${tab_no}`);
                    HTML_Width = page_section.width();
                    HTML_Height = page_section.height();
                    top_left_margin = 15;
                    PDF_Width = HTML_Width + (top_left_margin * 2);
                    PDF_Height = (PDF_Width * 1.2) + (top_left_margin * 2);
                    pdfName="PDF"
                    html2canvas($(`#analysisrow${tab_no}`)[0], {useCORS:true}).then(function(canvas) {
                      canvas_image_height= $(`#analysisrow${tab_no}`).height()
                      canvas_image_width=$(`#analysisrow${tab_no}`).width()
                      var imgData = canvas.toDataURL('image/svg');
                      var doc = new jsPDF("l","px",[HTML_Width, HTML_Height]); //210mm wide and 297mm high
                      doc.addImage(imgData, 'SVG',0,0);
                      doc.save(pdfName);
                    });
                  })

            $(`#saveChartConfigButton${tabID}`).click(function () {
                var tab_id = $(this).attr("data-tab")
                var analysis_id = "analysistab" + tab_id.split("w")[1]
                var tab_name = $(`#${analysis_id}`).children()[0].children[0].innerText
                var tabheight = document.querySelector(`#${tab_id}`).offsetHeight
                $(".charts").each(function () {
                    var chart_tab = $(this).parent().attr("id")
                    if (chart_tab == tab_id) {
                        var chartheader = $(this).find("h5")[0].innerText
                         // console.log($(this).find("h5"))
                         // console.log(chartheader)
                        var layout = $(this).attr("data-layout")
                        var graphdata = JSON.parse($(this).attr("data-data"))

                         // console.log(graphdata)
                        var unique_id = $(this).attr("data-id")
                        var graph_subtype = $(this).attr("data-subtype")
                        var changed_text = $(this).attr("data-changed_text")
                         // console.log(changed_text)
                        if (graph_subtype == "Pie_Chart" || graph_subtype == "Treemap" || graph_subtype == "Donut_Chart") {
                            graphdata[0].labels = []
                            graphdata[0].values = []
                        }
                        if (graph_subtype == "Sunburst") {
                            graphdata[0].labels = []
                            graphdata[0].values = []
                            graphdata[0].ids = []
                            graphdata[0].parents = []
                        }
                        if (graph_subtype == "Vertical_Bar" || graph_subtype == "Funnel" || graph_subtype == "Horizontal_Bar" || graph_subtype == "Line" || graph_subtype == "Stepped_Line_Graph" || graph_subtype == "Area" || graph_subtype == "Horizontal_Area" || graph_subtype == "Scatter" || graph_subtype == "2D_Histogram_Contour" || graph_subtype == "Vertical_Box" || graph_subtype == "Horizontal_Box" || graph_subtype == "Horizontal_Dot_Plot" || graph_subtype == "Scatter_with_Straight_Lines_and_Markers" || graph_subtype == "Vertical_Violin" || graph_subtype == "Horizontal_Violin" || graph_subtype == "3D_Scatter_Plot" || graph_subtype == "3D_Mesh_Plot") {
                            graphdata[0].x = []
                            graphdata[0].y = []
                        }
                        if (graph_subtype == "Scatter" || graph_subtype == "Scatter_with_Straight_Lines_and_Markers" || graph_subtype == "Horizontal_Dot_Plot" || graph_subtype == "3D_Scatter_Plot") {
                            graphdata[0].marker.color = []
                        }
                        if (graph_subtype == "3D_Scatter_Plot" || graph_subtype == "3D_Mesh_Plot") {
                            graphdata[0].z = []
                        }
                        if (graph_subtype == "Vertical_Waterfall" || graph_subtype == "Horizontal_Waterfall") {
                            graphdata[0].x = []
                            graphdata[0].y = []
                            graphdata[0].measure = []
                        }
                        if (graph_subtype == "Funnel_Area") {
                            graphdata[0].text = []
                            graphdata[0].values = []
                        }
                        if (graph_subtype == "Vertical_Histogram" || graph_subtype == "Cumulative_Histogram") {
                            graphdata[0].x = []
                        }
                        if (graph_subtype == "Horizontal_Histogram") {
                            graphdata[0].y = []
                        }
                        if (graph_subtype == "Angular_Gauge") {
                            graphdata[0].value = []
                            graphdata[0].title = []
                            graphdata[0].gauge.axis.range = []
                        }
                        if (graph_subtype == "Bullet_Gauge") {
                            graphdata[0].value = []
                            graphdata[0].gauge.axis.range = []
                        }
                        if (graph_subtype == "Vertical_Bar_Stacked" || graph_subtype == "Vertical_Grouped_Violin" || graph_subtype == "Horizontal_Grouped_Violin" || graph_subtype == "Vertical_Grouped_Box" || graph_subtype == "Vertical_Bar_Grouped" || graph_subtype == "Vertical_Line_Stacked" || graph_subtype == "Vertical_Area_Stacked" || graph_subtype == "Horizontal_Area_Stacked" || graph_subtype == "Vertical_Waterfall_Grouped" || graph_subtype == "Horizontal_Bar_Stacked" || graph_subtype == "Horizontal_Grouped_Box" || graph_subtype == "Horizontal_Bar_Grouped" || graph_subtype == "Horizontal_Waterfall_Grouped" || graph_subtype == 'Funnel_Stacked') {
                            graphdata[0].x = []
                            graphdata[0].y = []
                            graphdata[1].x = []
                            graphdata[1].y = []
                        }
                        if (graph_subtype == "Vertical_Waterfall_Grouped") {
                            graphdata[0].measure = []
                            graphdata[1].measure = []
                        }
                        var x_axis = $(this).attr("data-xaxis")
                        var y_axis = $(this).attr("data-yaxis")
                        var second_column = $(this).attr("data-secondcolumn")
                        var operation = $(this).attr("data-operation")

                        var entity = $(this).attr("data-entity")
                        var date = $(this).attr("data-date")
                        var model = $(this).attr("data-model")

                        chartsavedata.push({ "entity": entity, "date": date, "model": model, "operation": operation, "tabheight": tabheight, "tab_name": tab_name, "chartheader": chartheader, "x_axis": x_axis, "y_axis": y_axis, "second_column": second_column, "tab_id": tab_id, "height": $(this).height(), "width": $(this).width(), "position": $(this).position(), "layout": JSON.parse(layout), "data": graphdata, "id": unique_id, "graph_subtype": graph_subtype, "changed_text": JSON.parse(changed_text) })
                         // console.log(chartsavedata)
                    }
                })
                $(".draggable_charts").each(function () {
                    var chart_tab = $(this).parent().attr("id")
                    if (chart_tab == tab_id) {
                        var x_axis = $(this).attr("data-xaxis")
                        var y_axis = $(this).attr("data-yaxis")
                        var second_column = $(this).attr("data-secondcolumn")
                        var entity = $(this).attr("data-entity")
                        var date = $(this).attr("data-date")
                        var model = $(this).attr("data-model")
                        var operation = $(this).attr("data-operation")
                        var layout = $(this).attr("data-layout")
                        var graphdata = $(this).attr("data-data")
                        var unique_id = $(this).attr("data-id")
                        var graph_subtype = $(this).attr("data-subtype")
                        var operation = $(this).attr("data-operation")
                        var backgroundcolor = $(this).css("background-color")
                        var valuefontsize = $(this).find("h1").css("font-size")
                        var titlefontsize = $(this).find("p").css("font-size")
                        chartsavedata.push({ "entity": entity, "date": date, "model": model, "operation": operation, "tabheight": tabheight, "tab_name": tab_name, "x_axis": x_axis, "y_axis": y_axis, "second_column": second_column, "tab_id": tab_id, "height": $(this).height(), "width": $(this).width(), "position": $(this).position(), "layout": layout, "data": graphdata, "id": unique_id, "graph_subtype": graph_subtype, "backgroundcolor": backgroundcolor, "titlefontsize": titlefontsize, "valuefontsize": valuefontsize })
                    }
                })
                $(".commentboxcard").each(function () {
                    var chart_tab = $(this).parent().attr("id")
                    if (chart_tab == tab_id) {
                        var textboxid = $(this).attr("data-tab")
                         // console.log(textboxid)

                        var textboxvalue = document.getElementById(textboxid).value
                         // console.log(textboxvalue)

                        var height = $(`#${textboxid}`).height()
                        var width = $(`#${textboxid}`).width()

                        chartsavedata.push({ "graph_subtype": "Textbox", "tabheight": tabheight, "tab_name": tab_name, "tab_id": tab_id, "height": height, "width": width, "position": $(this).position(), "textboxvalue": textboxvalue, "textboxid": textboxid })
                         // console.log(chartsavedata)
                    }
                })

                $.ajax({
                    url: '/dashboard/save_plot',

                    data: {
                        'operation': "savePlotHomePage",
                        'plotDataList': JSON.stringify(chartsavedata),
                        'tab_id': tab_id,
                        'tab_name': tab_name,
                        'tabheight': tabheight
                    },
                    type: "POST",
                    dataType: "json",
                    success: function (data) {
                        chartsavedata = []
                    },
                    error: function () {
                        console.log("Error");
                    }
                })
            })


        });

        $('#tab-list').on('click', '.closetab', function () {
            var tabID = $(this).parents('a').attr('href');
            $(this).parents('li').remove();
            $(tabID).remove();
            $.ajax({
                url: '/dashboard/delete_plot',

                data: {
                    'tab_id': tabID,
                },
                type: "POST",
                dataType: "json",
                success: function (data) { },
                error: function () {
                    console.log("Error");
                }
            })
            //display first tab
            // var tabFirst = $('#tab-list a').first();
            // resetTab();
            // tabFirst.tab('show');
        });


        var list = document.getElementById("tab-list");
         // console.log("list")
         // console.log(list)
    });
    $('.contentEditable').each(function () {
        $(this).on('click', function () {
            $(this).attr("contenteditable", "true")
            $(this).focus()
        })
        $(this).focusout(function () {
            $(this).removeAttr("contenteditable")
        })
    })

    // $('#btnsave2').on('click', function () {
    //     console.log('hi')
    //     $("#drilldownmodal").modal("toggle")
    //     // document.getElementById('drilldownmodal2').style.display = "block"
    //      })

    $(`#saveall`).click(function () {
        $(".savealltab").each(function () {
            var tab_id = $(this).attr("id")
             // console.log($(this).parent())
             // console.log("tab_id")
            var chartsavedata = []
            var display = $(this).parent().css('display');
            $(this).parent().css('display', 'block');
             // console.log($(this))
             // console.log(display)

            var tabheight = document.querySelector(`#${tab_id}`).offsetHeight

            var analysis_id = "analysistab" + tab_id.split("w")[1]
            var tab_name = $(`#${analysis_id}`).children()[0].children[0].innerText
            $(".charts").each(function () {

                var chart_tab = $(this).parent().attr("id")
                if (chart_tab == tab_id) {
                    var chartheader = $(this).find("h5")[0].innerText

                    var layout = $(this).attr("data-layout")
                    var graphdata = JSON.parse($(this).attr("data-data"))
                    var unique_id = $(this).attr("data-id")
                    var graph_subtype = $(this).attr("data-subtype")
                    var changed_text = $(this).attr("data-changed_text")
                     // console.log(changed_text)
                    if (graph_subtype == "Pie_Chart" || graph_subtype == "Treemap" || graph_subtype == "Donut_Chart") {
                        graphdata[0].labels = []
                        graphdata[0].values = []
                    }
                    if (graph_subtype == "Sunburst") {
                        graphdata[0].labels = []
                        graphdata[0].values = []
                        graphdata[0].ids = []
                        graphdata[0].parents = []
                    }
                    if (graph_subtype == "Vertical_Bar" || graph_subtype == "Funnel" || graph_subtype == "Horizontal_Bar" || graph_subtype == "Line" || graph_subtype == "Stepped_Line_Graph" || graph_subtype == "Area" || graph_subtype == "Horizontal_Area" || graph_subtype == "Scatter" || graph_subtype == "2D_Histogram_Contour" || graph_subtype == "Vertical_Box" || graph_subtype == "Horizontal_Box" || graph_subtype == "Horizontal_Dot_Plot" || graph_subtype == "Scatter_with_Straight_Lines_and_Markers" || graph_subtype == "Vertical_Violin" || graph_subtype == "Horizontal_Violin" || graph_subtype == "3D_Scatter_Plot") {
                        graphdata[0].x = []
                        graphdata[0].y = []
                    }
                    if (graph_subtype == "Scatter" || graph_subtype == "Scatter_with_Straight_Lines_and_Markers" || graph_subtype == "Horizontal_Dot_Plot" || graph_subtype == "3D_Scatter_Plot") {
                        graphdata[0].marker.color = []
                    }
                    if (graph_subtype == "3D_Scatter_Plot") {
                        graphdata[0].z = []
                    }
                    if (graph_subtype == "Vertical_Waterfall" || graph_subtype == "Horizontal_Waterfall") {
                        graphdata[0].x = []
                        graphdata[0].y = []
                        graphdata[0].measure = []
                    }
                    if (graph_subtype == "Funnel_Area") {
                        graphdata[0].text = []
                        graphdata[0].values = []
                    }
                    if (graph_subtype == "Vertical_Histogram" || graph_subtype == "Cumulative_Histogram") {
                        graphdata[0].x = []
                    }
                    if (graph_subtype == "Horizontal_Histogram") {
                        graphdata[0].y = []
                    }
                    if (graph_subtype == "Angular_Gauge") {
                        graphdata[0].value = []
                        graphdata[0].title = []
                        graphdata[0].gauge.axis.range = []
                    }
                    if (graph_subtype == "Bullet_Gauge") {
                        graphdata[0].value = []
                        graphdata[0].gauge.axis.range = []
                    }
                    if (graph_subtype == "Vertical_Bar_Stacked" || graph_subtype == "Vertical_Grouped_Box" || graph_subtype == "Vertical_Bar_Grouped" || graph_subtype == "Vertical_Line_Stacked" || graph_subtype == "Vertical_Area_Stacked" || graph_subtype == "Horizontal_Area_Stacked" || graph_subtype == "Vertical_Waterfall_Grouped" || graph_subtype == "Horizontal_Bar_Stacked" || graph_subtype == "Horizontal_Grouped_Box" || graph_subtype == "Horizontal_Bar_Grouped" || graph_subtype == "Horizontal_Waterfall_Grouped" || graph_subtype == 'Funnel_Stacked') {
                        graphdata[0].x = []
                        graphdata[0].y = []
                        graphdata[1].x = []
                        graphdata[1].y = []
                    }
                    if (graph_subtype == "Vertical_Waterfall_Grouped") {
                        graphdata[0].measure = []
                        graphdata[1].measure = []
                    }
                     // console.log(graphdata)
                    var x_axis = $(this).attr("data-xaxis")
                    var y_axis = $(this).attr("data-yaxis")
                    var second_column = $(this).attr("data-secondcolumn")
                    var entity = $(this).attr("data-entity")
                    var date = $(this).attr("data-date")
                    var model = $(this).attr("data-model")
                    var operation = $(this).attr("data-operation")
                     // console.log(changed_text)

                    chartsavedata.push({ "entity": entity, "date": date, "model": model, "operation": operation, "tabheight": tabheight, "tab_name": tab_name, "chartheader": chartheader, "x_axis": x_axis, "y_axis": y_axis, "second_column": second_column, "tab_id": tab_id, "height": $(this).height(), "width": $(this).width(), "position": $(this).position(), "layout": JSON.parse(layout), "data": graphdata, "id": unique_id, "graph_subtype": graph_subtype, "changed_text": JSON.parse(changed_text) })
                     // console.log(chartsavedata)
                }
            })
            $(".draggable_charts").each(function () {
                var chart_tab = $(this).parent().attr("id")
                if (chart_tab == tab_id) {
                    var x_axis = $(this).attr("data-xaxis")
                    var y_axis = $(this).attr("data-yaxis")
                    var second_column = $(this).attr("data-secondcolumn")
                    var entity = $(this).attr("data-entity")
                    var date = $(this).attr("data-date")
                    var model = $(this).attr("data-model")
                    var operation = $(this).attr("data-operation")
                    var layout = $(this).attr("data-layout")
                    var graphdata = $(this).attr("data-data")
                    var unique_id = $(this).attr("data-id")
                    var graph_subtype = $(this).attr("data-subtype")
                    var operation = $(this).attr("data-operation")
                    var backgroundcolor = $(this).css("background-color")
                    var valuefontsize = $(this).find("h1").css("font-size")
                    var titlefontsize = $(this).find("p").css("font-size")
                    chartsavedata.push({ "entity": entity, "date": date, "model": model, "operation": operation, "tabheight": tabheight, "tab_name": tab_name, "x_axis": x_axis, "y_axis": y_axis, "second_column": second_column, "tab_id": tab_id, "height": $(this).height(), "width": $(this).width(), "position": $(this).position(), "layout": layout, "data": graphdata, "id": unique_id, "graph_subtype": graph_subtype, "backgroundcolor": backgroundcolor, "titlefontsize": titlefontsize, "valuefontsize": valuefontsize })
                }
            })
            $(".commentboxcard").each(function () {
                var chart_tab = $(this).parent().attr("id")
                if (chart_tab == tab_id) {
                    var textboxid = $(this).attr("data-tab")
                     // console.log(textboxid)

                    var textboxvalue = document.getElementById(textboxid).value
                     // console.log(textboxvalue)

                    var height = $(`#${textboxid}`).height()
                    var width = $(`#${textboxid}`).width()

                    chartsavedata.push({ "graph_subtype": "Textbox", "tabheight": tabheight, "tab_name": tab_name, "tab_id": tab_id, "height": height, "width": width, "position": $(this).position(), "textboxvalue": textboxvalue, "textboxid": textboxid })
                     // console.log(chartsavedata)
                }
            })
            $(this).parent().css('display', "");

            $.ajax({
                url: '/dashboard/save_plot',

                data: {
                    'operation': "savePlotHomePage",
                    'plotDataList': JSON.stringify(chartsavedata),
                    'tab_id': tab_id,
                    'tab_name': tab_name,
                    'tabheight': tabheight
                },
                type: "POST",
                dataType: "json",
                success: function (data) {
                    chartsavedata = []
                },
                error: function () {
                    console.log("Error");
                }
            })
        })
    })
    function crossfilter_function(crossfilterdict){
        var points = crossfilterdict.points
         // console.log(points)
        for (var i = 0; i < crossFilterlist.length; i++) {
                if (crossFilterlist[i].id == crossfilterdict.id){
                  // console.log("hi")
                }
                else{

                    if (crossFilterlist[i].graph_subtype == "Vertical_Bar" || crossFilterlist[i].graph_subtype == "Vertical_Histogram" || crossFilterlist[i].graph_subtype == "Scatter" || crossFilterlist[i].graph_subtype == "Cumulative_Histogram"){
                     // console.log(crossFilterlist[i].tester.data)

                    var tester = crossFilterlist[i].tester;
                    var colors = crossFilterlist[i].tester.data[0].marker.color
                    var labels = crossFilterlist[i].tester.data[0].x

                    opacity = []

                    for (var t = 0; t < labels.length; t++) {
                        opacity.push(0.2);
                            }
                    $.each(labels, function (k, v) {
                        for (var g = 0; g < points.length; g++) {
                                    if (v == points[g]) {
                                        opacity[k] = 1;
                                    }
                                }
                            });

                    var update = { 'marker': { opacity: opacity,color:colors } };
                     // console.log(update)
                    Plotly.restyle(tester, update)
                        }
                    if (crossFilterlist[i].graph_subtype == "Horizontal_Bar" || crossFilterlist[i].graph_subtype == "Horizontal_Histogram" ){

                     // console.log(crossFilterlist[i].tester.data)

                    var tester = crossFilterlist[i].tester;
                    var colors = crossFilterlist[i].tester.data[0].marker.color
                    var labels = crossFilterlist[i].tester.data[0].y

                    opacity = []

                    for (var t = 0; t < labels.length; t++) {
                        opacity.push(0.2);
                            }
                    $.each(labels, function (k, v) {
                        for (var g = 0; g < points.length; g++) {
                                    if (v == points[g]) {
                                        opacity[k] = 1;
                                    }
                                }
                            });

                    var update = { 'marker': { opacity: opacity,color:colors } };
                     // console.log(update)
                    Plotly.restyle(tester, update)
                        }
                        if (crossFilterlist[i].graph_subtype == "Vertical_Bar_Grouped" || crossFilterlist[i].graph_subtype == "Vertical_Bar_Stacked"){
                     // console.log(crossFilterlist[i].tester.data)

                    var tester = crossFilterlist[i].tester;
                    var colors = crossFilterlist[i].tester.data[0].marker.color
                    var colors2 = crossFilterlist[i].tester.data[1].marker.color
                    var labels = crossFilterlist[i].tester.data[0].x

                    opacity = []

                    for (var t = 0; t < labels.length; t++) {
                        opacity.push(0.2);
                            }
                    $.each(labels, function (k, v) {
                        for (var g = 0; g < points.length; g++) {
                                    if (v == points[g]) {
                                        opacity[k] = 1;
                                    }
                                }
                            });

                    var update = { 'marker': { opacity: opacity,color:colors } };
                    var update2 = { 'marker': { opacity: opacity,color:colors2 } };

                     // console.log(update)
                        Plotly.restyle(tester, update, [0])
                        Plotly.restyle(tester, update2, [1])
                        }
                        if (crossFilterlist[i].graph_subtype == "Horizontal_Bar_Grouped" || crossFilterlist[i].graph_subtype == "Horizontal_Bar_Stacked" || crossFilterlist[i].graph_subtype == "Funnel_Stacked" ){
                     // console.log(crossFilterlist[i].tester.data)

                    var tester = crossFilterlist[i].tester;
                    var colors = crossFilterlist[i].tester.data[0].marker.color
                    var colors2 = crossFilterlist[i].tester.data[1].marker.color
                    var labels = crossFilterlist[i].tester.data[0].y

                    opacity = []

                    for (var t = 0; t < labels.length; t++) {
                        opacity.push(0.2);
                            }
                    $.each(labels, function (k, v) {
                        for (var g = 0; g < points.length; g++) {
                                    if (v == points[g]) {
                                        opacity[k] = 1;
                                    }
                                }
                            });

                    var update = { 'marker': { opacity: opacity,color:colors } };
                    var update2 = { 'marker': { opacity: opacity,color:colors2 } };
                     // console.log(update)
                    Plotly.restyle(tester, update, [0])
                    Plotly.restyle(tester, update2, [1])
                                                }
                    if (crossFilterlist[i].graph_subtype == "Pie_Chart" || crossFilterlist[i].graph_subtype == "Treemap" || crossFilterlist[i].graph_subtype == "Donut_Chart" || crossFilterlist[i].graph_subtype == "Sunburst" || crossFilterlist[i].graph_subtype == "Funnel_Area" || crossFilterlist[i].graph_subtype == "Funnel" ){
                    var tester = crossFilterlist[i].tester;
                     // console.log(crossFilterlist[i].graph_subtype)
                    if (crossFilterlist[i].graph_subtype == "Funnel"){

                    var colors = crossFilterlist[i].tester.data[0].marker.color
                    }
                    else{
                        var colors = crossFilterlist[i].tester.data[0].marker.colors

                    }

                    var labels = crossFilterlist[i].tester.data[0].labels
                    if (crossFilterlist[i].graph_subtype == "Funnel_Area"){
                        var labels = crossFilterlist[i].tester.data[0].text
                    }
                    if (crossFilterlist[i].graph_subtype == "Funnel"){
                        var labels = crossFilterlist[i].tester.data[0].y
                    }
                    for (var t = 0; t < colors.length; t++) {
                        if (colors[t].length > 7){
                            colors[t] = colors[t].slice(0,7)

                        }
                        }
                    $.each(labels, function (k, v) {
                            if (! points.includes(v)) {
                                colors[k] = colors[k] + 20;
                                }
                            });
                    if (crossFilterlist[i].graph_subtype == "Funnel"){
                        var update = {"marker":{color: colors }};
                    }
                    else{
                        var update = {"marker":{colors: colors }};
                    }
                     // console.log(update)
                    Plotly.restyle(tester, update)
                     // console.log(tester.data)
                    }
            }
            }
        }
        function reset_function(resetdict){
            for (var i = 0; i < crossFilterlist.length; i++) {
                if (crossFilterlist[i].id == resetdict.id){
                  // console.log("hi")
                }
                else{
                    var tester = crossFilterlist[i].tester;

                    if (crossFilterlist[i].graph_subtype == "Vertical_Bar" || crossFilterlist[i].graph_subtype == "Vertical_Histogram" || crossFilterlist[i].graph_subtype == "Scatter" || crossFilterlist[i].graph_subtype == "Cumulative_Histogram"  || crossFilterlist[i].graph_subtype == "Horizontal_Bar" || crossFilterlist[i].graph_subtype == "Horizontal_Histogram" ){
                    var colors = crossFilterlist[i].tester.data[0].marker.color

                    opacity = []
                    for (var t = 0; t < colors.length; t++) {
                        opacity.push(1);
                        }
                    var update = { 'marker': { opacity: opacity,color:colors } };
                     // console.log(update)
                    Plotly.restyle(tester, update)
                    }
                    if (crossFilterlist[i].graph_subtype == "Vertical_Bar_Grouped" || crossFilterlist[i].graph_subtype == "Vertical_Bar_Stacked" || crossFilterlist[i].graph_subtype == "Horizontal_Bar_Stacked" || crossFilterlist[i].graph_subtype == "Horizontal_Bar_Grouped" ){
                    var colors = crossFilterlist[i].tester.data[0].marker.color
                    var colors2 = crossFilterlist[i].tester.data[1].marker.color

                    opacity = []
                    for (var t = 0; t < colors.length; t++) {
                        opacity.push(1);
                        }
                    var update = { 'marker': { opacity: opacity,color:colors } };
                    var update2 = { 'marker': { opacity: opacity,color:colors2 } };

                     // console.log(update)
                    Plotly.restyle(tester, update, [0])
                    Plotly.restyle(tester, update2, [1])
                                        }
                    if (crossFilterlist[i].graph_subtype == "Pie_Chart" || crossFilterlist[i].graph_subtype == "Treemap" || crossFilterlist[i].graph_subtype == "Donut_Chart" || crossFilterlist[i].graph_subtype == "Sunburst" || crossFilterlist[i].graph_subtype == "Funnel_Area"){
                    var colors = crossFilterlist[i].tester.data[0].marker.colors
                     // console.log(colors)

                    for (var t = 0; t < colors.length; t++) {
                        if (colors[t].length > 7){
                            colors[t] = colors[t].slice(0,7)

                        }
                        }
                     // console.log(colors)

                    var update = { 'marker': {colors:colors } };
                    Plotly.restyle(tester, update)
                    }
                    if(crossFilterlist[i].graph_subtype == "Funnel"){
                        var colors = crossFilterlist[i].tester.data[0].marker.color
                     // console.log(colors)

                    for (var t = 0; t < colors.length; t++) {
                        if (colors[t].length > 7){
                            colors[t] = colors[t].slice(0,7)

                        }
                        }
                     // console.log(colors)

                    var update = { 'marker': {color:colors } };
                    Plotly.restyle(tester, update)
                    }
                }
            }
        }

        $(`#btnsaveall`).click(function(){
            crossFilterlist.forEach(function(item, i) {
            // for (var i = 0; i < crossFilterlist.length; i++) {
                var tester = crossFilterlist[i].tester;
                var id = crossFilterlist[i].id;
                 // console.log($(`#${id}`).parent()[0].innerHTML)
                var dataplot = tester.data
                var layout = tester.layout
                // var innergraphcard = $(`<img id=${id}></img>`)
                 // console.log(id)
                 // console.log(dataplot)
                 // console.log(layout)
                $(`#${id}`).parent().html($(`<img id=${id}></img>`))
                var d3 = Plotly.d3;
                var img_jpg= d3.select(`#${id}`);
                var config = { responsive: true, displaylogo: false}
                var tester2 = document.getElementById(id)
                Plotly.newPlot(tester2, dataplot, layout, config).then(
                    function(gd)
                    {
                    Plotly.toImage(gd,{
                    format:'png'})
                        .then(
                            function(url)
                        {
                            img_jpg.attr("src", url);
                        }
                        )
                });
                 // console.log($(`#${id}`).parent()[0].innerHTML)
                 // console.log("finish")
                // // Plotly.plot(tester, data, layout).then((gd) => {
                // // return Plotly.toImage(gd, { format: 'svg' });
                // // }).then((dataURI) => {
                // //  // console.log(dataURI);
                // // });
            })

            setTimeout(function() { pdffunction(crossFilterlist); }, 3000);
        })

        function pdffunction(crossFilterlist) {
            crossFilterlist.forEach(function(item, i) {
                var id = crossFilterlist[i].id;
                 // console.log($(`#${id}`).parent()[0].innerHTML)
            })
            var tablist = []
            $(".savealltab").each(function () {
                var tab_id = $(this).attr("id")
                tablist.push(tab_id)
            })
             // console.log(tablist)
             // console.log(tablist.length)
            var tablength = tablist.length - 1;
            var doc;
            doc = "";
            for (let i = 0; i < tablist.length; i++) {
                var tab_id = tablist[i]
                var tabdisplayid = "tab" + tab_id.split('w')[1];
                 // console.log(tabdisplayid)
                $(`#${tabdisplayid}`)[0].style.display = "block"
                var page_section = $(`#${tab_id}`);
                 // console.log(doc)
                HTML_Width = page_section.width();
                HTML_Height = page_section.height();
                top_left_margin = 15;
                PDF_Width = HTML_Width + (top_left_margin * 2);
                PDF_Height = (PDF_Width * 1.2) + (top_left_margin * 2);
                pdfName="PDF"
                 // console.log(i)
                // setTimeout(function() {
                html2canvas($(`#${tab_id}`)[0], {useCORS:true}).then(function(canvas) {
                     // console.log("html2canvas")
                    canvas_image_height= $(`#${tab_id}`).height()
                    canvas_image_width=$(`#${tab_id}`).width()
                //   canvas.crossOrigin = 'Anonymous'
                    var imgData = canvas.toDataURL('image/png');
                     // console.log(i)

                    if (i == 0){
                    doc = new jsPDF("l","px",[HTML_Width, HTML_Height]); //210mm wide and 297mm high
                     // console.log(doc)
                     // console.log("first")
                    doc.addImage(imgData, 'PNG',0,0);
                        if (tablength == 0){
                            doc.save(pdfName);
                        }
                    }
                    if (i > 0){
                        setTimeout(function() {

                        if (i == tablength){
                            setTimeout(function() {
                             // console.log("last")
                            doc.addPage(HTML_Width, HTML_Height);
                            doc.addImage(imgData, 'PNG',0,0);
                            doc.save(pdfName);
                        }, 3000);
                        }
                        else{
                             // console.log("middle")
                            doc.addPage(HTML_Width, HTML_Height);
                            doc.addImage(imgData, 'PNG',0,0);
                        }
                    }, 3000);

                    }
                // //   $("#tab2")[0].style.display = "block"
                 // console.log("display")
                for (let t = 0; t < tablist.length; t++) {
                    var tab_id = tablist[t]
                     // console.log(tab_id)
                    var tabdisplayid = "tab" + tab_id.split('w')[1];
                     // console.log(tabdisplayid)
                    $(`#${tabdisplayid}`)[0].style.display = ""
                }
                 // console.log("end")
                });
                // }, 3000)
            }
            var timeoutvalue = tablist.length * 2000
            setTimeout(function() { resetgraphfunction(crossFilterlist); }, timeoutvalue);
        }
        function resetgraphfunction(crossFilterlist) {
            location.reload()
        }
        $('#btnslice').on('click', function () {
            console.log("hi")
            selectedvalues = document.getElementById(example-getting-started).value
            console.log(selectedvalues)
        })

</script>

{% endblock %}