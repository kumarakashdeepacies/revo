function renderUserTables(){const e=[{data:"username",title:"Name",render:function(e,a,t,r){if("display"==a){let e='<div class="img-circle elevation-2 navlink-img">';return t.profile_pic?e+=`<img src="/media/${t.profile_pic}" class="img-circle elevation-2 mx-auto user-profile-photo"\n            alt="User profile picture">`:t.first_name?e+=`<b class="profile-initials">${t.first_name[0]}${t.last_name[0]}</b>`:e+=`<b class="profile-initials">${t.username[0]}</b>`,e+="</div>",e+=`\n          <div class="username_details">\n            <h5 class="col-username">${t.first_name} ${t.last_name}</h5>\n            <div class="col-additional-info">${t.username}</div>\n          </div>\n          `,`<div class="user_details" style="padding-left:1rem;">${e}</div>`}return e}},{data:"role",title:"Role",render:function(e,a,t,r){if("display"===a){let a="";return"No Access Assigned"==e?a='<div class="roles-ui-buttons no-role">Unassigned</div>':(a='<div class="roles-ui-buttons role-user">User</div>',"Admin"===e?a+='<div class="roles-ui-buttons role-admin">Admin</div>':"Developer"===e?a+='<div class="roles-ui-buttons role-developer">Developer</div>':"Admin and Developer"===e&&(a+='<div class="roles-ui-buttons role-admin">Admin</div>',a+='<div class="roles-ui-buttons role-developer">Developer</div>')),`<div class="user_details roles" >${a}</div>`}return e},searchable:!0},{data:"action",title:"Action",render:function(e,a,t,r){if("display"==a){let e="";"No Access Assigned"===t.role&&(e="disabled");let a=`<div>\n          <div class="tab_view_actions user_details">\n            <a href="/users/${app_code2}/${current_dev_mode2}/user_management/user_logout/${t.id}/" class="call_to_action_buttons logout-user" data-toggle="tooltip" title="Logout User"> <i class="fas fa-power-off fa-lg"></i> </a>\n            <button class="call_to_action_buttons manage-user" data-toggle="modal" data-target="#ManageUserModal" onclick="manageUser('${t.id}','${t.username}','${t.first_name}','${t.last_name}','${t.email}','${t.role}','${t.profile_pic}','${t.first_name[0]}','${t.last_name[0]}')"> <i class="fas fa-user-cog fa-lg mr-2"></i> Manage User </button>\n            <button class="call_to_action_buttons remove-user" data-user="${t.username}" data-user-id="${t.id}" ${e} onclick="removeUser.call(this)"> <i class="fa-solid fa-user-xmark fa-lg mr-2"></i> Remove User </button>\n            <div class="radioGroup" style="overflow: hidden ;">\n          `,r="checked",s="Active",i="",o="Deactivate";return t.is_active||(r="",s="Activate",i="checked",o="Inactive"),a+=`\n              <input type="radio" id="activate_user_${t.id}" data-user="${t.username}" ${r} data-user-id="${t.id}" class="activate_user" value="activate_user" name="activate_deactivate_${t.id}">\n              <label for="activate_user_${t.id}" style="margin-top: 0.8%;margin-bottom: 0;">${s}</label>\n              <input type="radio" id="deactivate_user_${t.id}" data-user="${t.username}" ${i} data-user-id="${t.id}" class="deactivate_user" value="deactivate_user" name="activate_deactivate_${t.id}">\n              <label for="deactivate_user_${t.id}" style="margin-top: 0.8%;margin-bottom: 0;">${o}</label>\n              <span class="indicator"></span>\n            </div>\n          </div>\n          <div class="mobile_view_actions">\n            <i class="fa-solid fa-gears dropdown-i" data-toggle="dropdown"></i>\n            <div class="dropdown-menu dropdown-menu-sm dropdown-menu-right user-actions-dropdown">\n                <span class="dropdown-item" data-toggle="modal" data-target="#ManageUserModal" onclick="manageUser('${t.id}','${t.username}','${t.first_name}','${t.last_name}','${t.email}','${t.role}','${t.profile_pic}','${t.first_name[0]}','${t.last_name[0]}')">\n                    <i class="fas fa-user-cog fa-lg mr-2"></i> Manage User\n                </span>\n                <div class="dropdown-divider"></div>\n                <span class="dropdown-item" data-user="${t.username}" data-user-id="${t.id}" ${e} onclick="removeUser.call(this)">\n                    <i class="fa-solid fa-user-xmark fa-lg mr-2" style="color:red"></i> Remove User\n                </span>\n                <div class="dropdown-divider"></div>\n          `,t.is_active?a+=`\n                <span class="dropdown-item deactivate_user" data-user="${t.username}">\n                    <i class="fa-solid fa-user-minus fa-lg mr-2" style="color:#f91c1c"></i> Deactivate User\n                </span>\n            `:a+=`\n                <span class="dropdown-item activate_user" data-user="${t.username}">\n                    <i class="fa-solid fa-user-check fa-lg mr-2" style="color:#00e936"></i> Activate User\n                </span>\n            `,a+=`\n                <div class="dropdown-divider"></div>\n                  <span class="dropdown-item" onclick='window.location.href="/users/${app_code2}/${current_dev_mode2}/user_management/user_logout/${t.id}/"'>\n                      <i class="fa-solid fa-power-off fa-lg mr-2" style="color:#f91c1c"></i> Logout User\n                  </span>\n              </div>\n            </div>\n          </div>`,a}return e}}];var a=$("#userTable").DataTable({scrollY:"50vh",scrollCollapse:!0,scrollX:"120%",ordering:!1,autoWidth:!1,bAutoWidth:!1,serverSide:!0,orderCellsTop:!0,responsive:!0,colReorder:{fixedColumnsLeft:1},stateSave:!1,deferRender:!0,paging:!0,stripeClasses:[],pageLength:50,lengthMenu:[[1,5,50,100,-1],[1,5,50,100,"All"]],dom:"lrtip",buttons:[],ajax:`/users/${app_code2}/${current_dev_mode2}/user_management/fetch_user_server_side/`,columns:e,columnDefs:[{targets:"_all",className:"dt-center allColumnClass all",width:"33%"}],sScrollX:"120%",initComplete:function(){$("#userTable_info").css("margin-left","1rem"),$("#userTable_paginate").css("margin-right","1rem"),$(".activate_user").off("click").on("click",activateUser),$(".deactivate_user").off("click").on("click",deactivateUser)}}).columns.adjust();$("#searchUsers").off("keyup").on("keyup",function(){let e=this.value;a.columns(0).search(e).draw()}),$("#userTable_wrapper").prepend("<div class='show_filter_wrap'></div>"),$("#userTable_length").appendTo(".show_filter_wrap"),role_filter_html='\n    <div id="userTable_role_type_filter" class="datatable_filter_role_type">\n        <div class="role_filter_wrap">\n            <h6 class="mb-0 mr-2">Filter by Role:</h6>\n            <select id="role_type_filter" style="border-radius:1.8rem">\n              <option value="">All</option>\n              <option value="User">User</option>\n              <option value="Developer">Developer</option>\n              <option value="Admin">Admin</option>\n              <option value="Unassigned">Unassigned</option>\n            </select>\n        </div>\n    </div>\n  ',$(role_filter_html).appendTo(".show_filter_wrap"),$("#role_type_filter").select2(),$("#role_type_filter").off("select2:select").on("select2:select",function(){let e=this.value;a.columns(1).search(e).draw()}),$("[name=userTable_length]").closest("label").css("display","flex"),$("[name=userTable_length]").closest("label").css("align-items","center"),$("[name=userTable_length]").closest("label").css("gap","9px"),$("[name=userTable_length]").closest("label").css("text-indent","0"),$("[name=userTable_length]").closest("label").css("padding-left","7.5px"),$("[name=userTable_length]").select2({width:"50%"})}function activateUser(){$(this).next("label").text("Active"),$.ajax({url:`/users/${app_code2}/${current_dev_mode2}/user_management/`,data:{operation:"user_app_activation",username:$(this).attr("data-user"),is_active:"true"},type:"POST",dataType:"json",success:function(e){Swal.fire({icon:"success",text:"User activated successfully!"})},error:function(){Swal.fire({icon:"error",text:"Error! Please try again."})}})}function deactivateUser(){username=$(this).attr("data-user"),element=$(this),Swal.fire({icon:"question",text:"Are you sure you wish to deactivate "+username+" from the app?",showDenyButton:!0}).then(e=>{e.isConfirmed?($(element).next("label").text("Inactive"),$.ajax({url:`/users/${app_code2}/${current_dev_mode2}/user_management/`,data:{operation:"user_app_activation",username:username,is_active:"false"},type:"POST",dataType:"json",success:function(e){Swal.fire({icon:"success",text:"User deactivated successfully!"})},error:function(){Swal.fire({icon:"error",text:"Error! Please try again."})}})):$(element).closest(".radioGroup").find(".activate_user").prop("checked",!0).trigger("change")})}function level_0_selected(){if("0"==$("#id_permission_level").val()){var e=$("#id_permission_name").val();$(`#id_permission_name option[value='${e[0]}']`).html()}if($(`#newdiv button[value='${e}']`).on("click",functionbutton),"0"!=$("#id_permission_level").val()){var a=$("#id_permission_name").val();$.ajax({url:`/users/${app_code2}/${current_dev_mode2}/user_management/`,data:{operation:"level_0_selected",selected:JSON.stringify(a),app_code:$("#id_application").val()},type:"POST",dataType:"json",success:function(e){var a=[],t=!1;$("#div_level_1").css("display","block"),$("#id_level_1").val().length>0&&(a=$("#id_level_1").val(),t=!0);var r=[];$("#div_level_1").find("button[type=button]").each(function(){r.push($(this).attr("value"))}),$("#id_level_1").empty();for(var s=0;s<e.data.length;s++)r.includes(e.data[s].item_code)||(a.includes(e.data[s].item_code)?$("#id_level_1").append(new Option(e.data[s].item_name,e.data[s].item_code,!1,!0)):$("#id_level_1").append(new Option(e.data[s].item_name,e.data[s].item_code,!1,!1)));t&&level_1_selected()},error:function(){Swal.fire({icon:"error",text:"Error! Failure in assigning Level 1 permission. Please try again"})}})}}function hierarchy_selected(){var e=$("#id_permission_name").val();$.ajax({url:`/users/${app_code2}/${current_dev_mode2}/user_management/`,data:{operation:"hierarchy_selected",selected:JSON.stringify(e),app_code:$("#id_application").val()},type:"POST",dataType:"json",success:function(e){var a=[];$("#div_level_1").css("display","block"),$("#id_level_1").val().length>0&&(a=$("#id_level_1").val()),$("#id_level_1").empty();for(var t=0;t<e.data.length;t++)a.includes(e.data[t].hierarchy_name)?$("#id_level_1").append(new Option(e.data[t].hierarchy_name,e.data[t].Hierarchy_concat,!1,!0)):$("#id_level_1").append(new Option(e.data[t].hierarchy_name,e.data[t].Hierarchy_concat,!1,!1))},error:function(){Swal.fire({icon:"error",text:"Error! Failure in assigning Level 1 permission. Please try again"})}})}function functionbutton(e){$(`<option value='${e.target.value}'> ${e.target.name}</option>`).appendTo("#id_permission_name"),$(this).remove()}function level_1_selected(){if("1"==$("#id_permission_level").val()){var e=$("#id_level_1").val();$(`#id_level_1 option[value='${e[0]}']`).html()}if("1"!=$("#id_permission_level").val()){var a=$("#id_level_1").val();$.ajax({url:`/users/${app_code2}/${current_dev_mode2}/user_management/`,data:{operation:"level_1_selected",selected:JSON.stringify(a),app_code:$("#id_application").val()},type:"POST",dataType:"json",success:function(e){var a=[];$("#div_level_2").css("display","block"),$("#id_level_2").val().length>0&&(a=$("#id_level_2").val()),$("#id_level_2").empty();var t=[];$("#div_id_level_2").find("button[type=button]").each(function(){t.push($(this).attr("value"))});for(var r=0;r<e.data.length;r++)t.includes(e.data[r].tab_type)||(a.includes(e.data[r].tab_type)?$("#id_level_2").append(new Option(e.data[r].tab_header_name,e.data[r].tab_type,!1,!0)):$("#id_level_2").append(new Option(e.data[r].tab_header_name,e.data[r].tab_type,!1,!1)))},error:function(){Swal.fire({icon:"error",text:"Error! Failure in assigning Level 2 permission. Please try again"})}})}}function functionbtn(e){$(this).attr("data-parent")==$("#id_permission_name").val()&&$(`<option value='${e.target.value}'> ${e.target.name}</option>`).appendTo("#id_level_1"),$(this).remove()}function addBtnPerm(){$("#id_level_button_access").empty();let e=["CreateView - Save","CreateView - Save as Draft","CreateView - Back","CreateView - Custom Validation","CreateView - Refresh Computation","CreateView - View History","CreateView - View Rejected Records","CreateView - View Transaction Status","CreateView - Approval Parameters","CreateView - Reset Draft Status","UploadView - Upload","UploadView - Map Columns","UploadView - Custom Validation","UploadView - Add computation logic","UploadView - Download data","UploadView - Upload history","UploadView - Last upload errors","UploadView - Detailed error log","UploadView - Transaction status","UploadView - SFTP connectors","ListView - Save template","ListView - Upload","ListView - Paste Tabular Data","ListView - Edit Mode","ListView - Delete all data","ListView - Find and replace","ListView - Freeze Panes","ListView - Formatters","ListView - Transactions Status","ListView - Plot Charts","ListView - Filter","ListView - Add Computed Fields","ListView - Expand","ListView - Edit Record","ListView - Delete Record","ListView - View Record","ListView - Extract Data","ListView - Bulk Update","ListView - Conditional Delete","ListView - Approve all","ListView - Reject all","ListView - Approve Multiple","ListView - Reject Multiple","Computation - Run Model","Computation - Configure Scenario","Computation - Filter","Analysis - Previous Versions","Analysis - Save and Share","Analysis - Plot charts","Analysis - Global Settings","Analysis - PDF","Analysis - Save","Analysis - Add tab","Analysis - Tab config","Analysis - Import dashboard","Analysis - Publish"],a=[];for(i in $("#div_id_level_2 button").each(function(){var t=$(this).attr("value").split("__")[1];"create_view"==t&&(a=a.concat(e.filter(e=>e.startsWith("CreateView")))),"list_view"==t&&(a=a.concat(e.filter(e=>e.startsWith("ListView")))),"data_connector"==t&&(a=a.concat(e.filter(e=>e.startsWith("UploadView")))),"computation"==t&&(a=a.concat(e.filter(e=>e.startsWith("Computation")))),"analysis"==t&&(a=a.concat(e.filter(e=>e.startsWith("Analysis"))))}),a)1!=$(`#id_level_button_access option[value='${a[i]}']`).length&&$("#id_level_button_access").append($("<option></option>").attr("value",a[i]).text(a[i]))}function level_2_selected(e){$("#div_id_level_2").find("button").remove();var a=$("#id_level_2").val();for(let e=0;e<a.length;e++){var t=$(`#id_level_2 option[value='${a[e]}']`).html();null!=t&&($(`<button style="display:none" type='button' class='btn btn-dark m-1' name='${t}'\n                                  value='${a}' data-parent="${$("#id_level_1").val()}"> ${t}</button>`).appendTo("#div_id_level_2"),$(`#div_id_level_2 button[value='${a}']`).on("click",functionbutton2))}addBtnPerm()}function functionbutton2(e){$(this).attr("data-parent")==$("#id_level_1").val()&&$(`<option value='${e.target.value}'> ${e.target.name}</option>`).appendTo("#id_level_2"),$(this).remove(),addBtnPerm()}function deleteUserGroup(e,a){url=`users/${app_code2}/${current_dev_mode2}/user_management/`,Swal.fire({icon:"question",text:`Are you sure you want to delete ${a} group?`,showDenyButton:!0,showCancelButton:!1,confirmButtonText:"Yes",denyButtonText:"No",showCloseButton:!0}).then(t=>{t.isConfirmed&&$.ajax({url:`/users/${app_code2}/${current_dev_mode2}/user_management/`,data:{operation:"deleteUserGroupObj",group_name:a,group_id:e},dataType:"json",type:"POST",success:function(e){Swal.fire({icon:"success",text:e.response}).then(e=>{e.isConfirmed&&window.location.reload()})},error:function(){Swal.fire({icon:"error",text:"Error! Please try again"})}})})}function editUserGroupName(e,a){$("#edit_group_input").val(a),$("#edit_group_input").attr("data-groupId",e),$("#edit_group_input").attr("data-oldname",a),$("#edit_group").modal("show")}function renameUserGroup(){var e=$("#edit_group_input").attr("data-groupId"),a=$("#edit_group_input").attr("data-oldname"),t=$("#edit_group_input").val();$.ajax({url:`/users/${app_code2}/${current_dev_mode2}/user_management/`,data:{operation:"renameUserGroup",old_group_name:a,new_group_name:t,group_id:e},dataType:"json",type:"POST",success:function(e){Swal.fire({icon:"success",text:""}).then(e=>{e.isConfirmed&&window.location.reload()})},error:function(){Swal.fire({icon:"error",text:"Error! Please try again"})}})}function removeUserFromGroup(){var e=$(this).attr("data-group-name"),a=$(this).attr("data-username");Swal.fire({icon:"question",text:`Are you sure you want to remove ${a} user from ${e} group?`,showDenyButton:!0,showCancelButton:!1,confirmButtonText:"Yes",denyButtonText:"No",showCloseButton:!0}).then(t=>{t.isConfirmed?$.ajax({url:`/users/${app_code2}/${current_dev_mode2}/user_management/`,data:{operation:"deleteUserFromGroup",group_name:e,user_name:a},dataType:"json",type:"POST",success:function(e){window.location.reload()},error:function(){Swal.fire({icon:"error",text:"Error! Please try again"})}}):t.isDenied})}function removeUser(){var e=$(this).attr("data-user"),a=$(this).attr("data-user-id");Swal.fire({icon:"question",text:`Are you sure you wish to remove ${e} from the app? This will remove the user from all the groups with permissions for this app.`,showDenyButton:!0,showCancelButton:!1,confirmButtonText:"Yes",denyButtonText:"No",showCloseButton:!0}).then(e=>{e.isConfirmed?$.ajax({url:`/users/${app_code2}/${current_dev_mode2}/user_management/`,data:{user_id:a,operation:"remove_user_from_app"},dataType:"json",type:"POST",success:function(e){Swal.fire({icon:"success",text:"User removed from the app successfully."}),$("#userTable").DataTable().draw()},error:function(){Swal.fire({icon:"error",text:"Error! Please try again"})}}):e.isDenied})}function restrictFile(e){var a=document.getElementById(e);if(a.value){var t=a.value;idxDot=t.lastIndexOf(".")+1,extFile=t.substr(idxDot,t.length).toLowerCase(),"csv"!=extFile&&"xlsx"!=extFile?Swal.fire({text:"Only csv and xlsx files are allowed!",icon:"warning"}).then(e=>{e.isConfirmed&&(a.value="",$(a).siblings(".custom-file-label").html("Upload File"))}):$(`#${e}`).closest("form").find("button[type=submit]").prop("disabled",!1)}}function downloadTemplate(e){$.ajax({url:`/users/${app_code2}/${current_dev_mode2}/user_management/`,data:{operation:"donwloadTemplate",id:e},type:"POST",xhrFields:{responseType:"blob"},dataType:"binary",success:function(a){var t=window.document.createElement("a"),r=[];r.push(a),t.href=window.URL.createObjectURL(new Blob(r,{type:"text/csv"})),"downloadUserFileTemplate"==e?t.download="user_approval.csv":"downloadUserGroupTemplate"==e?t.download="user_group.csv":"downloadGroupPermissionsTemplate"==e?t.download="group_permission.csv":"downloadUserWithGroupTemplate"==e&&(t.download="usergroup_approval.csv"),window.document.body.appendChild(t),t.click(),window.document.body.removeChild(t)},error:function(){}})}function getPermissionTableData(){var e=$("#select_user_group").val();e&&e.length>0&&($(".view_permission_card").css("display","block"),$.ajax({url:`/users/${app_code2}/${current_dev_mode2}/user_management/`,data:{operation:"fetch_group_permissions",group_name:JSON.stringify(e)},type:"POST",dataType:"json",success:function(e){let a=e.permission_list;$.fn.dataTable.isDataTable("#example_viewpermissions")&&$("#example_viewpermissions").DataTable().clear().destroy();for(const e in a)delete a[e].app_name,delete a[e].app_code,delete a[e].action;var t=[{data:"user",mData:"user"},{data:"type",mData:"type"},{data:"level",mData:"level"},{data:"name",mData:"name"},{data:"created_by",mData:"created_by"}];$("#example_viewpermissions").DataTable({data:a,columns:t,autoWidth:!0,scrollY:200,scrollX:500,scrollCollapse:!0,bSort:!1,orderCellsTop:!0,responsive:!0,colReorder:{fixedColumnsLeft:1},deferRender:!0,paging:!0,lengthMenu:[[1,5,50,100,-1],[1,5,50,100,"All"]],pageLength:50,search:!1,columnDefs:[{targets:"_all",className:"dt-center allColumnClass all"}]}).columns.adjust(),$("#example_viewpermissions").on("column-visibility.dt",function(e,a,t,r){$("#example_viewpermissions").DataTable().columns.adjust()}),$(document).on("shown.bs.modal",function(e){$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust()}),$("[name=example_viewpermissions_length]").closest("label").css("display","flex"),$("[name=example_viewpermissions_length]").closest("label").css("align-items","center"),$("[name=example_viewpermissions_length]").closest("label").css("gap","9px"),$("[name=example_viewpermissions_length]").closest(".col-sm-12.col-md-6").css("padding-left","1rem"),$("[name=example_viewpermissions_length]").select2({width:"50%"}),$("#example_viewpermissions_filter").find("input[type=search]").attr("style","border-radius: 1.8rem !important;border: 1px solid lightgrey !important;height: 28px;padding: 4px 9px;")},error:function(e,a,t){console.log("errorr",e,a,t)}}))}function manageUser(e,a,t,r,s,i,o,n,l){$("#ManageUserModal").attr("data-userid",e),$("#ManageUserModal").find(".manage_user_modal").empty(),$("#ManageUserModal").find("#saveManageUser").attr("onclick",`saveManageUser('${e}', '${a}', '${t}', '${r}', '${s}', '${i}','${user_group_list[a]}')`),$("#ManageUserGroupsAndPermissions").find("#saveUserGroupDetails").attr("onclick",`saveUserGroupDetails('${e}', '${a}', '${t}', '${r}', '${s}', '${i}','${user_group_list[a]}')`),$("#reset-password").attr("data-user",a),$("#save_reset_password").attr("data-user",a),initials=t?n+l:a[0],"No Access Assigned"==i?role_html='<div class="roles-ui-buttons no-role">Unassigned</div>':(role_html='<div class="roles-ui-buttons role-user">User</div>',"Admin"==i?role_html+='<div class="roles-ui-buttons role-admin">Admin</div>':"Developer"==i?role_html+='<div class="roles-ui-buttons role-developer">Developer</div>':"Admin and Developer"==i&&(role_html+='<div class="roles-ui-buttons role-admin">Admin</div>\n          <div class="roles-ui-buttons role-developer">Developer</div>')),img_html=o?`<img src="/media/${o}" class="img-circle elevation-2 mx-auto user-profile-photo" alt="User profile picture" >`:`<span  class="profile-initials">${initials}</span>`,$("#ManageUserModal").find(".user_details").find(".manage-user-profile").html(img_html),$("#ManageUserModal").find(".user_details").find(".col-additional-info").text(a),$("#ManageUserModal").find(".user_details").find(".col-username").text(t+" "+r),$("#ManageUserModal").find(".manage_user_modal").append(role_html),$("#ManageUserModal").find("#first_name").val(t),$("#ManageUserModal").find("#last_name").val(r),$("#ManageUserModal").find("#email").val(s),$("#ManageUserModal").find("#assign_user_groups").val(user_group_list[a]).trigger("change"),$("#ManageUserModal").find("#assign_user_groups").prop("disabled",!0),$("#ManageUserGroupsAndPermissions").find("#select_user_group").off("select2:select"),$("#ManageUserGroupsAndPermissions").find("#select_user_group").val(user_group_list[a]).trigger("change"),$("#ManageUserGroupsAndPermissions").find("#select_user_group").on("select2:select",function(e){var a=e.params.data.text;new_users_groups_global.push(a)}),$("#ManageUserGroupsAndPermissions").find("#select_user_group").on("select2:unselect",function(e){var a=e.params.data.text;new_users_groups_global.includes(a)&&new_users_groups_global.pop(a)})}function saveManageUser(e,a,t,r,s,i,o){var n=$(".user_manage_details").find("#first_name").val(),l=$(".user_manage_details").find("#last_name").val(),d=$(".user_manage_details").find("#email").val(),p=($(".user_manage_groups").find("#assign_user_groups").val(),e),c=t,u=r,_=s,m=(o.split(","),{});let v=!0;var f,b,g;if(n.trim()!=c.trim()&&(m.first_name=n,f=!0),l.trim()!=u.trim()&&(m.last_name=l,b=!0),d.trim()!=_.trim()&&(m.email=d,g=!0),Object.keys(m).length>0)for(let e in m){let a=/<|>|'|"/.test(m[e]);if(a){v=!1;break}}v?(f||b||g)&&$.ajax({url:`/users/${app_code2}/${current_dev_mode2}/user_management/`,data:{user_id:p,changedStatus:JSON.stringify(m),operation:"save_manage_user",username:a},dataType:"json",type:"POST",success:function(e){$("#userTable").DataTable().draw();var a="User Profile details updated successfully!";Swal.fire({icon:"success",text:a}),$("#ManageUserModal").modal("hide")},error:function(){Swal.fire({icon:"error",text:"Error! Failure in updating user. Please try again"}),$("#ManageUserModal").modal("hide")}}):Swal.fire({icon:"error",text:"Unauthorised input. Please check and try again."})}function saveUserGroupDetails(e,a,t,r,s,i,o){var n=e;a=a;new_users_groups_global&&$.ajax({url:`/users/${app_code2}/${current_dev_mode2}/user_management/`,data:{user_id:n,operation:"save_user_group",new_users_groups:JSON.stringify(new_users_groups_global),username:a},dataType:"json",type:"POST",success:function(e){var a="Group details are sent for approval.";Swal.fire({icon:"success",text:a})},error:function(){Swal.fire({icon:"error",text:"Error! Failure in creating user. Please try again"})}})}function viewDetailsUserApproval(e,a,t){$.fn.dataTable.isDataTable("#viewDetailsUserTable")&&$("#viewDetailsUserTable").DataTable().clear().destroy();var r=`\n      <tr>\n          <td>${e}</td>\n          <td>${t}</td>\n          <td>${a}</td>\n      </tr>\n  `;$("#viewDetailsUserModal").find("#viewDetailsUserTable").find("#viewDetailsUserTableBody").html(r);$("#viewDetailsUserModal").find("#viewDetailsUserTable").DataTable({paging:!1,info:!1,searching:!1,bSort:!1,responsive:!0}).columns.adjust();$("#viewDetailsUserTable").on("column-visibility.dt",function(e,a,t,r){$("#viewDetailsUserTable").DataTable().columns.adjust()}),$(document).on("shown.bs.modal",function(e){$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust()}),$("#viewDetailsUserModal").modal("show")}function viewDetailsPermissionApproval(e,a,t){$.ajax({url:`/users/${app_code2}/${current_dev_mode2}/user_management/`,data:{groupname:e,level_of_permission:a,operation:"permissionapproval_viewdetails",app_code:t},type:"POST",dataType:"json",success:function(e){$.fn.dataTable.isDataTable("#viewDetailsPermissionTable")&&$("#viewDetailsPermissionTable").DataTable().clear().destroy();var a="";for(user_obj of e.data)a+=`\n                  <tr>\n                      <td>${user_obj["Group Name"]}</td>\n                      <td>${user_obj["Permission Name"]}</td>\n                      <td>${user_obj["Application Name"]}</td>\n                  </tr>\n              `;$("#viewDetailsPermissionModal").find("#viewDetailsPermissionTable").find("#viewDetailsPermissionTableBody").html(a);$("#viewDetailsPermissionModal").find("#viewDetailsPermissionTable").DataTable({paging:!1,info:!1,searching:!1,bSort:!1,responsive:!0}).columns.adjust();$("#viewDetailsPermissionTable").on("column-visibility.dt",function(e,a,t,r){$("#viewDetailsPermissionTable").DataTable().columns.adjust()}),$(document).on("shown.bs.modal",function(e){$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust()}),$("#viewDetailsPermissionModal").modal("show")},error:function(){Swal.fire({icon:"error",text:"Error! Failure in exporting data. Please try again."})}})}function viewDetailsUserGroupApproval(e,a){$.ajax({url:`/users/${app_code2}/${current_dev_mode2}/user_management/`,data:{user_name:e,operation:"view_usergroup_approval_details"},type:"POST",dataType:"json",success:function(e){$.fn.dataTable.isDataTable("#viewDetailsGroupTable")&&$("#viewDetailsGroupTable").DataTable().clear().destroy();var a="";for(user_obj of e.data)a+=`\n                  <tr>\n                      <td>${user_obj["User Name"]}</td>\n                      <td>${user_obj["Group Name"]}</td>\n                  </tr>\n              `;$("#viewDetailsGroupModal").find("#viewDetailsGroupTable").find("#viewDetailsGroupTableBody").html(a);$("#viewDetailsGroupModal").find("#viewDetailsGroupTable").DataTable({paging:!1,info:!1,searching:!1,bSort:!1,responsive:!0}).columns.adjust();$("#viewDetailsGroupTable").on("column-visibility.dt",function(e,a,t,r){$("#viewDetailsGroupTable").DataTable().columns.adjust()}),$(document).on("shown.bs.modal",function(e){$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust()}),$("#viewDetailsGroupModal").modal("show")},error:function(){Swal.fire({icon:"error",text:"Error! Failure in exporting data. Please try again."})}})}function groupApproval(){$("#modal-table-header").empty(),$("#modal-table-body").empty(),$("#approvaldownmodal").modal("show");var e=$(this).closest("tr").attr("data-username");let a=window.location.pathname,t=a.indexOf("/",a.indexOf("/")+1),r=a.indexOf("/",a.indexOf("/")+t+1),s=a.indexOf("/",a.indexOf("/")+r+1),i=a.substring(t+1,r),o=a.substring(r+1,s);"Build"!=o&&"Edit"!=o&&(o="User"),$.ajax({url:`/users/${i}/${o}/permissionapproval/`,data:{user_name:e,operation:"approval_table"},type:"POST",dataType:"json",success:function(a){$("#approvalmodal_heading").text(e);for(const e of a.columns)$("#modal-table-header").append(`<th>${e}</th>`);$("#modal-table-header").append("<th>Approve</th>");var t=0;for(const e of a.data){html="";for(const t of a.columns)html+=`<th>${e[t]}</th>`;html+=`<td><button id="approve_${a.approve_id[t]}" type="button" class="approve_ind btn btn-floating btn-lg" style="color:var(--primary-color) !important;"><i class="fa fa-check-square" aria-hidden="true"></i></button><button id="reject_${a.approve_id[t]}" type="button" class="reject_ind btn btn-floating btn-lg" style="color:#000000;"><i class="fa fa-window-close" aria-hidden="true"></i></button></td>`,$("#modal-table-body").append("<tr>"+html+"</tr>"),t++}if($(".approve_ind").on("click",approve_ind),$(".reject_ind").on("click",reject_ind),!$.fn.dataTable.isDataTable("#approval_table"))$("#approval_table").DataTable({autoWidth:!0,paging:!1,info:!1,searching:!1,bSort:!1,responsive:!0,paging:!0,lengthMenu:[[1,5,50,100,-1],[1,5,50,100,"All"]],stripeClasses:!1,pageLength:50,columnDefs:[{targets:"_all",className:"dt-center allColumnClass all"},{targets:0,width:"20%",className:"noVis"}]})},error:function(){Swal.fire({icon:"error",text:"Error! Failure in exporting data. Please try again."})}})}function approve_ind(){let e=$(this);$(this).prop("disabled",!0),$(this).attr("disabled","disabled");var a=$(this).closest("tr").attr("data-groupname");let t=$(this).closest("tr").attr("data-username"),r=Number($(this).attr("id").split("_")[1]),s="reject_"+r;$("#"+s).prop("disabled",!0),$("#"+s).attr("disabled","disabled");let i=window.location.pathname,o=i.indexOf("/",i.indexOf("/")+1),n=i.indexOf("/",i.indexOf("/")+o+1),l=i.indexOf("/",i.indexOf("/")+n+1),d=i.substring(o+1,n),p=i.substring(n+1,l);"Build"!=p&&"Edit"!=p&&(p="User"),$.ajax({url:`/users/${d}/${p}/permissionapproval/`,data:{userName:t,groupName:a,approval_id:r,operation:"approve_ind"},type:"POST",dataType:"json",success:function(r){Swal.fire({icon:"info",text:"Approved group "+a+" for user "+t+". Permissions for users are getting updated. Please check the Notifications bell for further updates."}),remove_tr=e.closest("tr");let s=$("#user_access_approvals_table").DataTable();s.row(remove_tr).remove().draw()},error:function(){Swal.fire({icon:"error",text:"Error! Failure in updating permissions. Please try again."})}})}function reject_ind(){let e=$(this);$(this).prop("disabled",!0),$(this).attr("disabled","disabled");var a=$(this).closest("tr").attr("data-groupname");let t=$(this).closest("tr").attr("data-username"),r=Number($(this).attr("id").split("_")[1]),s="approve_"+r;$("#"+s).prop("disabled",!0),$("#"+s).attr("disabled","disabled");let i=window.location.pathname,o=i.indexOf("/",i.indexOf("/")+1),n=i.indexOf("/",i.indexOf("/")+o+1),l=i.indexOf("/",i.indexOf("/")+n+1),d=i.substring(o+1,n),p=i.substring(n+1,l);"Build"!=p&&"Edit"!=p&&(p="User"),$.ajax({url:`/users/${d}/${p}/permissionapproval/`,data:{userName:t,approval_id:r,operation:"reject_ind"},type:"POST",dataType:"json",success:function(r){Swal.fire({icon:"success",text:"Rejected group "+a+" for user "+t+" successfully!"}),remove_tr=e.closest("tr");let s=$("#user_access_approvals_table").DataTable();s.row(remove_tr).remove().draw()},error:function(){Swal.fire({icon:"error",text:"Error! Failure in executing rejection. Please try again."})}})}function approve_all(){
let e=$("#approvalmodal_heading").text().replace(": ",""),a=window.location.pathname,t=a.indexOf("/",a.indexOf("/")+1),r=a.indexOf("/",a.indexOf("/")+t+1),s=a.indexOf("/",a.indexOf("/")+r+1),i=a.substring(t+1,r),o=a.substring(r+1,s);"Build"!=o&&"Edit"!=o&&(o="User"),$.ajax({url:`/users/${i}/${o}/permissionapproval/`,data:{userName:e,operation:"approve_all"},type:"POST",dataType:"json",success:function(e){Swal.fire({icon:"info",text:"Approved successfully! Permissions for users are getting updated. Please check the Notifications bell for further updates."}),$("#userTable").DataTable().draw()},error:function(){Swal.fire({icon:"error",text:"Error! Failure in executing approvals. Please try again."})}})}function reject_all(){let e=$("#approvalmodal_heading").text().replace(": ",""),a=window.location.pathname,t=a.indexOf("/",a.indexOf("/")+1),r=a.indexOf("/",a.indexOf("/")+t+1),s=a.indexOf("/",a.indexOf("/")+r+1),i=a.substring(t+1,r),o=a.substring(r+1,s);"Build"!=o&&"Edit"!=o&&(o="User"),$.ajax({url:`/users/${i}/${o}/permissionapproval/`,data:{userName:e,operation:"reject_all"},type:"POST",dataType:"json",success:function(e){Swal.fire({icon:"success",text:"Rejected approvals successfully!"})},error:function(){Swal.fire({icon:"error",text:"Error! Failure in executing rejection of approvals. Please try again."})}})}function userApproval(){var e=$(this),a=$(this).closest("tr").attr("data-username"),t=$(this).closest("tr").attr("data-password"),r=$(this).closest("tr").attr("data-email"),s=$(this).closest("tr").attr("data-type"),i=$(this).closest("tr").attr("data-developer"),o=$(this).closest("tr").attr("data-action");let n=window.location.pathname,l=n.indexOf("/",n.indexOf("/")+1),d=n.indexOf("/",n.indexOf("/")+l+1),p=n.indexOf("/",n.indexOf("/")+d+1),c=n.substring(l+1,d),u=n.substring(d+1,p);"Build"!=u&&"Edit"!=u&&(u="User"),$.ajax({url:`/users/${c}/${u}/permissionapproval/`,data:{operation:"userapproval",username:a,password:t,email:r,action:o,type:s,is_developer:i},type:"POST",dataType:"json",success:function(a){if("warning"==a.icon)Swal.fire({icon:"warning",text:a.response});else{Swal.fire({icon:"success",text:"Approved successfully"}),remove_tr=e.closest("tr");let t=$("#user_access_approvals_table").DataTable();t.row(remove_tr).remove().draw(),pending_approvals=parseInt($(".approval_notification_badge").text()),pending_approvals-1<1?($(".approval_notification_badge").text("0"),$(".approval_notification_badge").css("display","none")):$(".approval_notification_badge").text(pending_approvals-1),"error"==a.data&&Swal.fire({icon:"error",text:a.msg})}},error:function(){Swal.fire({icon:"error",text:"Error! Please try again."})}})}function userReject(){var e=$(this),a=$(this).closest("tr").find("td:first-child").attr("data-username"),t=$(this).closest("tr").find("td:first-child").attr("data-password"),r=$(this).closest("tr").find("td:first-child").attr("data-email");let s=window.location.pathname,i=s.indexOf("/",s.indexOf("/")+1),o=s.indexOf("/",s.indexOf("/")+i+1),n=s.indexOf("/",s.indexOf("/")+o+1),l=s.substring(i+1,o),d=s.substring(o+1,n);"Build"!=d&&"Edit"!=d&&(d="User"),$.ajax({url:`/users/${l}/${d}/permissionapproval/`,data:{operation:"userrejection",username:a,password:t,email:r},type:"POST",dataType:"json",success:function(a){Swal.fire({icon:"success",text:"Rejected successfully"}),remove_tr=e.closest("tr");let t=$("#user_access_approvals_table").DataTable();t.row(remove_tr).remove().draw(),pending_approvals=parseInt($(".approval_notification_badge").text()),pending_approvals-1<1?($(".approval_notification_badge").text("0"),$(".approval_notification_badge").css("display","none")):$(".approval_notification_badge").text(pending_approvals-1)},error:function(){Swal.fire({icon:"error",text:"Error! Please try again."})}})}function approvePermissions(){$("#modal-table-header-permission").empty(),$("#modal-table-body-permission").empty(),$("#permissiondownmodal").modal("show");var e=$(this).closest("tr").attr("data-groupname"),a=$(this).closest("tr").attr("data-level");let t=window.location.pathname,r=t.indexOf("/",t.indexOf("/")+1),s=t.indexOf("/",t.indexOf("/")+r+1),i=t.indexOf("/",t.indexOf("/")+s+1),o=t.substring(r+1,s),n=t.substring(s+1,i);"Build"!=n&&"Edit"!=n&&(n="User"),$.ajax({url:`/users/${o}/${n}/permissionapproval/`,data:{groupname:e,level_of_permission:a,operation:"permissionapproval_table",app_code:$(this).attr("data-app_code")},type:"POST",dataType:"json",success:function(t){$("#permissionmodal_heading").text(`(User Group : ${e})`),$("#permissionmodal_level").text(a);for(const e of t.columns)$("#modal-table-header-permission").append(`<th>${e}</th>`);$("#modal-table-header-permission").append("<th>Approve</th>");var r=0;for(const e of t.data){html="";for(const a of t.columns)html+=`<td>${e[a]}</td>`;html+=`<td><button id="approve_${t.count_id[r]}" data-app_code="${e.app_code}" type="button" class="approve_ind_permission btn btn-primary btn-xs rounded mb-1 px-2" style="color:var(--primary-color) !important;background-color:unset !important;border:0;margin-bottom: 0 !important;"><i class="fas fa-check-circle" style="font-size: large;"></i></button><button id="reject_${t.count_id[r]}" data-app_code="${e.app_code}" type="button" class="reject_ind_permission btn btn-primary btn-xs rounded mb-1 px-2" style="color:var(--primary-color) !important;background-color:unset !important;border:0;margin-bottom: 0 !important;"><i class="fa-solid fa-circle-xmark" style="font-size: large;"></i></button></td>`,$("#modal-table-body-permission").append("<tr>"+html+"</tr>"),r++}if("approve_Administrative access"==$(".approve_ind_permission").eq(0).attr("id")?($("#approve_all_permission").prop("disabled",!0),$("#reject_all_permission").prop("disabled",!0)):($("#approve_all_permission").prop("disabled",!1),$("#reject_all_permission").prop("disabled",!1)),$(".approve_ind_permission").on("click",approve_ind_permission),$(".reject_ind_permission").on("click",reject_ind_permission),!$.fn.dataTable.isDataTable("#permission_table")){$("#permission_table").DataTable({autoWidth:!0,scrollCollapse:!0,orderCellsTop:!0,responsive:!0,bSort:!1,colReorder:{fixedColumnsLeft:1},stateSave:!0,deferRender:!0,paging:!0,lengthMenu:[[1,5,50,100,-1],[1,5,50,100,"All"]],stripeClasses:!1,pageLength:50,columnDefs:[{targets:"_all",className:"dt-center allColumnClass all"},{targets:0,width:"20%",className:"noVis"}]});$("#permission_table_length").parent().attr("class","col-sm-12 col-md-3"),$("#permission_table_filter").parent().attr("class","col-sm-12 col-md-5 d-flex justify-content-start"),$("#permission_table_filter").find("label").css("font-size","0.8rem"),$("#permission_table_filter").parent().after($(".permission-approve-reject"))}},error:function(){Swal.fire({icon:"error",text:"Error! Failure in exporting data. Please try again."})}})}function approve_ind_permission(){$(this).prop("disabled",!0),$(this).attr("disabled","disabled");let e=$("#permissionmodal_heading").text().split(":")[1].split(")")[0].trim(),a=$("#permissionmodal_level").text(),t=Number($(this).attr("id").split("_")[1]),r="reject_"+t;$("#"+r).prop("disabled",!0),$("#"+r).attr("disabled","disabled");let s=window.location.pathname,i=s.indexOf("/",s.indexOf("/")+1),o=s.indexOf("/",s.indexOf("/")+i+1),n=s.indexOf("/",s.indexOf("/")+o+1),l=s.substring(i+1,o),d=s.substring(o+1,n);"Build"!=d&&"Edit"!=d&&(d="User"),$.ajax({url:`/users/${l}/${d}/userpermissionapproval/`,data:{groupName:e,level:a,approval_id:t,operation:"approve_ind_permission",app_code:$(this).attr("data-app_code")},type:"POST",dataType:"json",success:function(e){Swal.fire({icon:"success",text:"Approved successfully! Permissions for users are getting updated. Please check the Notifications bell for further updates."}),$("#userTable").DataTable().draw()},error:function(){Swal.fire({icon:"error",text:"Error! Failure in approving permission. Please try again."})}})}function reject_ind_permission(){$(this).prop("disabled",!0),$(this).attr("disabled","disabled");let e=$("#permissionmodal_heading").text().split(":")[1].split(")")[0].trim(),a=Number($(this).attr("id").split("_")[1]),t="approve_"+a,r=$("#permissionmodal_level").text();$("#"+t).prop("disabled",!0),$("#"+t).attr("disabled","disabled");let s=window.location.pathname,i=s.indexOf("/",s.indexOf("/")+1),o=s.indexOf("/",s.indexOf("/")+i+1),n=s.indexOf("/",s.indexOf("/")+o+1),l=s.substring(i+1,o),d=s.substring(o+1,n);"Build"!=d&&"Edit"!=d&&(d="User"),$.ajax({url:`/users/${l}/${d}/userpermissionrejection/`,data:{groupName:e,level:r,approval_id:a,operation:"reject_ind_permission",app_code:$(this).attr("data-app_code")},type:"POST",dataType:"json",success:function(e){Swal.fire({icon:"success",text:"Permission successfully rejected!."})},error:function(){Swal.fire({icon:"error",text:"Error! Failure in rejecting permission. Please try again."})}})}function userAccessHandler(){$.ajax({url:`/users/${app_code2}/${current_dev_mode2}/user_management/`,data:{operation:"fetch_pending_user_access_approvals"},type:"POST",dataType:"json",success:function(e){let a=$("#user_access_approvals_table > tbody"),t=$("#user_requests_table > tbody");a.empty(),t.empty();let r="",s="";if(e.combined_approvals_sorted){for(const a of e.combined_approvals_sorted){if("user_approval"==a.approval_type)if("Yes"==a.can_approve){let e="",t=`<tr data-username="${a.username}" data-action="${a.action_requested}" data-email="${a.email}" data-password="${a.password}" data-type="${a.authentication_type}" data-developer="${a.is_developer}">`;"Yes"==a.can_approve?t+=`\n                              <td data-username="${a.username}" data-action="${a.action_requested}" data-email="${a.email}" data-password="${a.password}" data-type="${a.authentication_type}" data-developer="${a.is_developer}">\n                                  <button type="button"  data-toggle="tooltip" title="Approve User Permission" class="userpermission_approve btn btn-primary btn-xs rounded mb-1 px-2" style="color:var(--primary-color) !important;background-color:unset !important;border:0"><i class="fas fa-check-circle" style="font-size: large;"></i></button>\n                                  <button type="button" data-toggle="tooltip" title="Reject User Permission" class="userpermission_reject btn btn-primary btn-xs rounded mb-1 px-2" style="color:var(--primary-color) !important;background-color:unset !important;border:0"><i class="fa-solid fa-circle-xmark" style="font-size: large;"></i></button>\n                              </td>\n                              `:t+=`\n                              <td data-username="${a.username}" data-action="${a.action_requested}" data-email="${a.email}" data-password="${a.password}" data-type="${a.authentication_type}" data-developer="${a.is_developer}">\n                                  <button type="button"  data-toggle="tooltip" title="Pending for approval" disabled  class="userpermission_approve btn btn-primary btn-xs rounded mb-1 px-2" style="color:var(--primary-color) !important;background-color:unset !important;border:0"><i class="fas fa-check-circle" style="font-size: large;"></i></button>\n                                  <button type="button" data-toggle="tooltip" title="Pending for rejection" disabled class="userpermission_reject btn btn-primary btn-xs rounded mb-1 px-2" style="color:var(--primary-color) !important;background-color:unset !important;border:0"><i class="fa-solid fa-circle-xmark" style="font-size: large;"></i></button>\n                              </td>\n                              `,t+=`<td><button class="btn btn-light" class="view_details_user_approval" onclick="viewDetailsUserApproval('${a.username}','${a.action_requested}','${a.email}')">View Details</button></td>`,"new user"==a.action_requested?t+="<td>New user request</td>":t+="<td>Delete user request</td>",t+=`<td>${a.username}</td>`,t+=`<td>${a.created_by}</td>`,t+=`<td>${a.created_date}</td>`,t+="</tr>",e+=t,r+=e}else{let e="",t=`<tr data-username="${a.username}" data-action="${a.action_requested}" data-email="${a.email}" data-password="${a.password}" data-type="${a.authentication_type}" data-developer="${a.is_developer}">`;t+=`<td><button class="btn btn-light" class="view_details_user_approval" onclick="viewDetailsUserApproval('${a.username}','${a.action_requested}','${a.email}')">View Details</button></td>`,"new user"==a.action_requested?t+="<td>New user request</td>":t+="<td>Delete user request</td>",t+=`<td>${a.username}</td>`,t+=`<td>${a.created_by}</td>`,t+=`<td>${a.created_date}</td>`,t+="</tr>",e+=t,s+=e}if("group_approval"==a.approval_type)if("Yes"==a.can_approve){let e="",t=`<tr data-username="${a.user_name}" data-groupname="${a.group_name}">`;"Yes"==a.can_approve?t+=`\n                              <td>\n                                  <button id="approve_${a.id}" type="button" data-toggle="tooltip" title="Pending for approval" class="approve_ind btn btn-primary btn-xs rounded mb-1 px-2" style="color:var(--primary-color) !important;background-color:unset !important;border:0"><i class="fa fa-check-circle" style="font-size: large;" aria-hidden="true"></i></button>\n                                  <button id="reject_${a.id}" type="button" data-toggle="tooltip" title="Pending for rejection" class="reject_ind btn btn-primary btn-xs rounded mb-1 px-2" style="color:var(--primary-color) !important;background-color:unset !important;border:0"><i class="fa fa-circle-xmark" style="font-size: large;" aria-hidden="true"></i></button>\n                              </td>`:t+=`\n                              <td>\n                                  <button id="approve_${a.id}" type="button" disabled class="approve_ind btn btn-primary btn-xs rounded mb-1 px-2" style="color:var(--primary-color) !important;background-color:unset !important;border:0"><i class="fa fa-check-circle" style="font-size: large;" aria-hidden="true"></i></button>\n                                  <button id="reject_${a.id}" type="button" disabled class="reject_ind btn btn-primary btn-xs rounded mb-1 px-2" style="color:var(--primary-color) !important;background-color:unset !important;border:0"><i class="fa fa-circle-xmark" style="font-size: large;" aria-hidden="true"></i></button>\n                              </td>`,t+=`<td><button class="btn btn-light" onclick="viewDetailsUserGroupApproval('${a.user_name}','${a.count_of_approval}')">View Details</button></td>`,t+="<td>New user group request</td>",t+=`<td>${a.user_name}</td>`,t+=`<td>${a.created_by}</td>`,t+=`<td>${a.created_date}</td>`,t+="</tr>",e+=t,r+=e}else{let e="",t=`<tr data-username="${a.user_name}" data-groupname="${a.group_name}">`;t+=`<td><button class="btn btn-light" onclick="viewDetailsUserGroupApproval('${a.user_name}','${a.count_of_approval}')">View Details</button></td>`,t+="<td>New user group request</td>",t+=`<td>${a.user_name}</td>`,t+=`<td>${a.created_by}</td>`,t+=`<td>${a.created_date}</td>`,t+="</tr>",e+=t,s+=e}if("permission_approval"==a.approval_type)if("Yes"==a.can_approve){let e="",t=`<tr data-groupname="${a.usergroup}" data-level="${a.permission_level}">`;"Yes"==a.can_approve?t+=`\n                              <td>\n                                  <button type="button" data-app_code="${a.app_code}" data-toggle="tooltip" title="Approve Group Permission" class="permission_button btn btn-light btn-md">Click Here</button>\n                              </td>\n                              `:t+=`<td><button type="button" disabled data-app_code="${a.app_code}" data-toggle="tooltip" title="Approve Group Permission" class="permission_button btn btn-light btn-md " >Click Here</button></td>`,t+=`<td><button class="btn btn-light" onclick="viewDetailsPermissionApproval('${a.usergroup}','${a.permission_level}','${a.app_code}')">View Details</button></td>`,t+="<td>New group permission request</td>",t+=`<td>${a.usergroup}</td>`,t+=`<td>${a.created_by}</td>`,t+=`<td>${a.created_date}</td>`,t+="</tr>",e+=t,r+=e}else{let e="",t=`<tr data-groupname="${a.usergroup}" data-level="${a.permission_level}">`;t+=`<td><button class="btn btn-light" onclick="viewDetailsPermissionApproval('${a.usergroup}','${a.permission_level}','${a.app_code}')">View Details</button></td>`,t+="<td>New group permission request</td>",t+=`<td>${a.usergroup}</td>`,t+=`<td>${a.created_by}</td>`,t+=`<td>${a.created_date}</td>`,t+="</tr>",e+=t,s+=e}}a.append(r),t.append(s)}var i,o;$.fn.dataTable.isDataTable("#user_access_approvals_table")&&$("#user_access_approvals_table").DataTable().destroy(),$.fn.dataTable.isDataTable("#user_requests_table")&&$("#user_requests_table").DataTable().destroy(),$.fn.dataTable.ext.order["date-format"]=function(e,a){return this.api().column(a,{order:"index"}).nodes().map(function(e,a){var t=$(e).text().replace(/(\d+)[^\d]+(\d+)[^\d]+(\d+)[^\d]+(\d+):(\d+)\s*([APMapm]+)\s*\./,"$1-$2-$3 $4:$5 $6");return new Date(t)})},i=$("#user_access_approvals_table").DataTable({autoWidth:!0,scrollY:250,scrollX:500,scrollCollapse:!0,searching:!0,search:!0,bSort:!1,responsive:!0,colReorder:{fixedColumnsLeft:1},bFilter:!0,deferRender:!0,paging:!0,lengthMenu:[[1,5,50,100,-1],[1,5,50,100,"All"]],pageLength:50,columnDefs:[{targets:"_all",className:"dt-center allColumnClass all"},{type:"date-format",targets:5}],order:[[5,"desc"]]}).columns.adjust(),filter_html='\n              <div class="col-sm-12 col-md-12 p-0">\n                  <div id="user_access_approvals_table_filter_approval_type" class="datatable_filter_approval_type">\n                      <div style="display:flex;align-items:center;">\n                          <h6 class="mb-0 mr-2">Approval Type:</h6>\n                          <select id="approval_type_filter" style="border-radius:1.8rem">\n                              <option value="">All</option>\n                              <option value="New user group request">New user group request</option>\n                              <option value="New group permission request">New group permission request</option>\n                              <option value="New user request">New user request</option>\n                              <option value="Delete user request">Delete user request</option>\n                          </select>\n                      </div>\n                  </div>\n              </div>',$("#user_access_approvals_table_wrapper").find(".row").eq(0).addClass("mobile-column-reverse"),$("#user_access_approvals_table_wrapper").find(".row").eq(0).append(filter_html),$("#approval_type_filter").select2({width:"25%"}),$("[name=user_access_approvals_table_length]").closest("label").css("display","flex"),$("[name=user_access_approvals_table_length]").closest("label").css("align-items","center"),$("[name=user_access_approvals_table_length]").closest("label").css("gap","9px"),$("[name=user_access_approvals_table_length]").closest("label").css("text-indent","0"),$("[name=user_access_approvals_table_length]").closest("label").css("padding-left","7.5px"),$("[name=user_access_approvals_table_length]").select2({width:"50%"}),$("#user_access_approvals_table_filter").find("input[type=search]").attr("style","border-radius: 1.8rem !important;border: 1px solid lightgrey !important;height: 28px;padding: 4px 9px;"),$("#user_access_approvals_table_filter").parent().attr("class","col-sm-12 col-md-12 col-lg-6"),$("#approval_type_filter").on("change",function(){var e=$(this).val();""==e?(i.column(2).search(""),i.column(2).draw()):(i.column(2).search(""),i.column(2).draw(),i.column(2).search("^"+e+"$",!0,!1),i.column(2).draw())}),$("#user_access_approvals_table").on("column-visibility.dt",function(e,a,t,r){$("#user_access_approvals_table").DataTable().columns.adjust()}),$(document).on("shown.bs.modal",function(e){$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust()}),o=$("#user_requests_table").DataTable({autoWidth:!0,scrollY:250,scrollX:500,scrollCollapse:!0,searching:!0,search:!0,bSort:!1,responsive:!0,colReorder:{fixedColumnsLeft:1},bFilter:!0,deferRender:!0,paging:!0,lengthMenu:[[1,5,50,100,-1],[1,5,50,100,"All"]],pageLength:50,columnDefs:[{targets:"_all",className:"dt-center allColumnClass all"},{type:"date-format",targets:4}],order:[[4,"desc"]]}).columns.adjust(),requests_table_filter_html='\n              <div class="col-sm-12 col-md-12 p-0">\n                  <div id="user_requests_table_filter_approval_type" class="datatable_filter_approval_type">\n                      <div style="display:flex;align-items:center;">\n                          <h6 class="mb-0 mr-2">Approval Type:</h6>\n                          <select id="request_approval_type_filter" style="border-radius:1.8rem">\n                              <option value="">All</option>\n                              <option value="New user group request">New user group request</option>\n                              <option value="New group permission request">New group permission request</option>\n                              <option value="New user request">New user request</option>\n                              <option value="Delete user request">Delete user request</option>\n                          </select>\n                      </div>\n                  </div>\n              </div>',$("#user_requests_table_wrapper").find(".row").eq(0).addClass("mobile-column-reverse"),$("#user_requests_table_wrapper").find(".row").eq(0).append(requests_table_filter_html),$("#request_approval_type_filter").select2({width:"25%"}),$("[name=user_requests_table_length]").closest("label").css("display","flex"),$("[name=user_requests_table_length]").closest("label").css("align-items","center"),$("[name=user_requests_table_length]").closest("label").css("gap","9px"),$("[name=user_requests_table_length]").closest("label").css("text-indent","0"),$("[name=user_requests_table_length]").closest("label").css("padding-left","7.5px"),$("[name=user_requests_table_length]").select2({width:"50%"}),$("#user_requests_table_filter").find("input[type=search]").attr("style","border-radius: 1.8rem !important;border: 1px solid lightgrey !important;height: 28px;padding: 4px 9px;"),$("#user_requests_table_filter").parent().attr("class","col-sm-12 col-md-12 col-lg-6"),$("#request_approval_type_filter").on("change",function(){var e=$(this).val();""==e?(o.column(1).search(""),o.column(1).draw()):(o.column(1).search(""),o.column(1).draw(),o.column(1).search("^"+e+"$",!0,!1),o.column(1).draw())}),$("#user_requests_table").on("column-visibility.dt",function(e,a,t,r){$("#user_requests_table").DataTable().columns.adjust()}),$(document).on("shown.bs.modal",function(e){$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust()}),$(".permission_button").on("click",approvePermissions),$(".userpermission_approve").on("click",userApproval),$(".userpermission_reject").on("click",userReject),$(".approve_button").on("click",groupApproval),$(".approve_ind").on("click",approve_ind),$(".reject_ind").on("click",reject_ind)},error:function(){Swal.fire({icon:"error",text:"Error! Please try again."})}})}function createUsers(){user_list=[],counter=1,user_creation=$(".user_creation");var e=!0,a=!1;for(element of user_creation){if(obj={},$(element).find("[name=username]").val()&&$(element).find("[name=password]").val()&&$(element).find("[name=email]").val())obj.name=$(element).find("[name=username]").val(),obj.password=$(element).find("[name=password]").val(),obj.email=$(element).find("[name=email]").val(),obj.a_type=$(element).find(`[name=a_type__${counter}]:checked`).val(),obj.is_developer=$(element).find("[name=is_developer]").prop("checked"),user_list.push(obj),a=!0;else if(1==counter){Swal.fire({icon:"warning",text:"Please enter all the details for atleast 1 user"});break}counter+=1}var t=["name","password","email"];for(let a in user_list)if(e)for(let r in t){let s=/<|>/.test(user_list[a][t[r]]);if(s){e=!1;break}}e?a&&$.ajax({url:`/users/${app_code2}/${current_dev_mode2}/user_management/`,data:{user_list:JSON.stringify(user_list),operation:"user_creation"},dataType:"json",type:"POST",success:function(e){if(developerMsg=e.DeveloperMsg,userMsg=e.UserMsg,SuccessMsg=e.SuccessMsg,reloadUserTable=e.sent_for_approval,devError="",userError="",success_msg="",SuccessMsg.length>0)for(msg of SuccessMsg)success_msg=`\n                        <ul>\n                            <li>${msg}</li>\n                        </ul>\n                        <br>\n                        `;if(developerMsg.length>0)for(msg of developerMsg)devError=`\n                        <b>Developer Creation Errors</b>\n                        <ul style="text-align:justify">\n                            <li>${msg}</li>\n                        </ul>\n                        <br>\n                        `;if(userMsg.length>0){for(msg of(userError='\n                        <b>User Creation Errors</b>\n                        <ul style="text-align:justify">\n                        ',userMsg))userError+=`\n                            <li>${msg}</li>\n                        `;userError+="</ul>\n                        "}final_html="",devError||userError?(final_html=devError+userError,icon="warning"):(final_html="User/s successfully sent for approval.",icon="success"),$("#createNewUserModal").modal("hide"),Swal.fire({icon:icon,html:final_html}),reloadUserTable||$("#userTable").DataTable().draw()},error:function(){$("#createNewUserModal").modal("hide"),Swal.fire({icon:"error",text:"Error! Failure in creating users. Please try again"})}}):Swal.fire({icon:"error",text:"Unauthorised input. Please check and try again."})}function approve_all_permission(){let e=$("#permissionmodal_heading").text().replace("(User Group : ","").replace(")",""),a=$("#permissionmodal_level").text();var t=$(".approve_ind_permission").eq(0).attr("data-app_code");$.ajax({url:`/users/${app_code2}/${current_dev_mode2}/userpermissionapproval/`,data:{groupName:e,level:a,operation:"approve_all_permission",app_code:t},type:"POST",dataType:"json",success:function(e){Swal.fire({icon:"info",text:"Approved successfully! Permissions for users are getting updated. Please check the Notifications bell for further updates."}),location.reload()},error:function(){Swal.fire({icon:"error",text:"Error! Failure in executing approvals. Please try again."})}})}function reject_all_permission(){let e=$("#permissionmodal_heading").text().replace(": ",""),a=$("#permissionmodal_level").text();var t=$(".approve_ind_permission").eq(0).attr("data-app_code");$.ajax({url:`/users/${app_code2}/${current_dev_mode2}/userpermissionrejection/`,data:{groupName:e,perm_level:a,operation:"reject_all_permission",app_code:t},type:"POST",dataType:"json",success:function(e){Swal.fire({icon:"success",text:"Rejected approvals successfully"}),location.reload()},error:function(){Swal.fire({icon:"error",text:"Error! Failure in executing rejection of approvals. Please try again."})}})}$(document).ready(function(){$("#user_range").daterangepicker({locale:{format:"YYYY-MM-DD"}})});